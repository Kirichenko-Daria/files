(window.webpackJsonp=window.webpackJsonp||[]).push([["common"],{"+UAi":function(e,t,n){"use strict";n.r(t),n.d(t,"EVENT_TRANSITION_TO_ITEM",function(){return i}),n.d(t,"EVENT_TRANSITION_TO_ALBUM",function(){return a}),n.d(t,"EVENT_SWITCH_ITEM_VARIANT_1",function(){return o}),n.d(t,"EVENT_SWITCH_ITEM_VARIANT_2",function(){return r}),n.d(t,"EVENT_TRANSITION_TO_ITEM_LEFT",function(){return s}),n.d(t,"EVENT_TRANSITION_TO_ITEM_RIGHT",function(){return l}),n.d(t,"EVENT_VIEW_ITEM",function(){return c}),n.d(t,"EVENT_VIEW_ALBUM",function(){return u}),n.d(t,"EVENT_CLOSE_ITEM",function(){return d}),n.d(t,"EVENT_TRANSITION_TO_OWNER",function(){return _}),n.d(t,"EVENT_VIEW_ITEM_MEDIA",function(){return f}),n.d(t,"EVENT_ADD_ITEM_TO_CART",function(){return p}),n.d(t,"EVENT_EXPAND_ITEM_DESCRIPTION",function(){return h}),n.d(t,"EVENT_ADD_ITEM_TO_BOOKMARKS",function(){return m}),n.d(t,"EVENT_REMOVE_ITEM_FROM_BOOKMARKS",function(){return v}),n.d(t,"EVENT_EXPAND_COMMENTS",function(){return A}),n.d(t,"EVENT_COMMENT",function(){return g}),n.d(t,"EVENT_ADD_TO_CART_HS",function(){return b}),n.d(t,"EVENT_OPEN_WIKI",function(){return y}),n.d(t,"EVENT_SEND_MESSAGE_TO_OWNER",function(){return w}),n.d(t,"EVENT_OPEN_CHAT_WITH_OWNER",function(){return k}),n.d(t,"EVENT_LIKE_ITEM",function(){return S}),n.d(t,"EVENT_UNLIKE_ITEM",function(){return C}),n.d(t,"EVENT_SHARE_ITEM",function(){return O}),n.d(t,"EVENT_CTA_LINK",function(){return E}),n.d(t,"EVENT_CREATE_ITEM",function(){return j}),n.d(t,"EVENT_CREATE_ALBUM",function(){return T}),n.d(t,"EVENT_EDIT_ITEM",function(){return I}),n.d(t,"EVENT_EDIT_ALBUM",function(){return M}),n.d(t,"EVENT_DELETE_ITEM",function(){return x}),n.d(t,"EVENT_DELETE_ALBUM",function(){return P}),n.d(t,"EVENT_GROUP_ITEMS",function(){return B}),n.d(t,"EVENT_ADD_PROPERTY",function(){return L}),n.d(t,"EVENT_ADD_PROPERTY_VALUE",function(){return R}),n.d(t,"EVENT_DELETE_PROPERTY",function(){return D}),n.d(t,"EVENT_DELETE_PROPERTY_VALUE",function(){return N}),n.d(t,"EVENT_TRANSITION_TO_EDIT_PROPERTIES",function(){return H}),n.d(t,"EVENT_TRANSITION_TO_EDIT_ALBUMS",function(){return V}),n.d(t,"EVENT_TRANSITION_TO_ADD_ALBUM",function(){return F}),n.d(t,"EVENT_TRANSITION_TO_ADD_ITEM",function(){return U}),n.d(t,"EVENT_TRANSITION_TO_EDIT_ITEM",function(){return $}),n.d(t,"EVENT_TRANSITION_TO_GROUP_ITEMS",function(){return q}),n.d(t,"isValidECommGoodsEvent",function(){return z});var i="transition_to_item",a="transition_to_album",o="switch_item_variant_1",r="switch_item_variant_2",s="transition_to_item_left",l="transition_to_item_right",c="view_item",u="view_album",d="close_item",_="transition_to_owner",f="view_item_media",p="add_item_to_cart",h="expand_item_description",m="add_item_to_bookmarks",v="remove_item_from_bookmarks",A="expand_comments",g="comment",b="add_to_cart_hs",y="open_wiki",w="send_message_to_owner",k="open_chat_with_owner",S="like_item",C="unlike_item",O="share_item",E="cta_link",j="create_item",T="create_album",I="edit_item",M="edit_album",x="delete_item",P="delete_album",B="group_items",L="add_property",R="add_property_value",D="delete_property",N="delete_property_value",H="transition_to_edit_properties",V="transition_to_edit_albums",F="transition_to_add_album",U="transition_to_add_item",$="transition_to_edit_item",q="transition_to_group_items",W=[i,a,o,r,s,l,c,u,d,_,f,p,h,m,v,A,g,b,y,w,k,S,C,O,E,j,T,I,M,x,P,B,L,R,D,N,H,V,F,U,$,q];function z(e){return W.includes(e)}},"+YbT":function(e,t){var n={obj:null,highlight:!1,start:function(e){e.touches&&1==e.touches.length&&(n.clear(),n.end(e),n.obj=this||null,n.obj&&(n.highlight=!0,addClass("hover",n.obj),addClass("_thover",n.obj)))},cancel:function(e){n.obj&&(n.highlight=!1,n.end(e))},end:function(){n.obj&&(removeClass("hover",n.obj),n.highlight&&(n.clear(),addClass("active",n.obj)),n.obj=null,n.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=n},"/8IX":function(e,t){function n(e,t){if(!e)throw new Error(t||"AssertionError")}n.notEqual=function(e,t,i){n(e!=t,i)},n.notOk=function(e,t){n(!e,t)},n.equal=function(e,t,i){n(e==t,i)},n.ok=n,e.exports=n},"/Id8":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("9y81"),s=n("KMpi"),l=n("u33z"),c=n("B+U2"),u=n("BoyB"),d=n("fdw3");function _(){var e=Object(i.default)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return _=function(){return e},e}function f(){var e=Object(i.default)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return f=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return v=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return A=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return g=function(){return e},e}function b(){var e=Object(i.default)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function k(){var e=Object(i.default)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return k=function(){return e},e}function S(){var e=Object(i.default)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n    </div>\n  "]);return S=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return C=function(){return e},e}function O(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return O=function(){return e},e}function E(){var e=Object(i.default)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return E=function(){return e},e}function j(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n    </div>\n  "]);return j=function(){return e},e}var T=function(e){var t=e.id,n=e.removed,i=e.service,c=function(e){var t=window.lang;if(e.service)return e.text;var n,i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),c=Object(r.default)({mix:"msg__check",icon:"check"}),u=o.default.html({class:"msg__star"}),d=!!e.attaches.gift,_=store.mail.msgs[e.id];_&&_.authorId===_.peerId&&(n=store.mail.peers[_.peerId]);var f,p=e.admin?(j=e.admin,a.default.html(y(),j.url,j.name)):"",h=e.removed?P(e.id):"",m=e.edited?x():"",v=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",A=e.pending?'<div class="msg__pending"></div>':"",g=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",b=e.channel?(S=e.id,O=Object(l.default)({class:"msg__actionForward",onClick:a.default.onClick("Msg._onActionClick","event","forward",S)}),a.default.html(w(),O)):"",k=d&&n?'<div class="msg__giftHead">'+langSex(n.sex,t.mobile_mail_sent_gift)+"</div>":"";var S,O;var j;f=d?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return a.default.html(C(),n,t)}(e):I(e);var T=e.keyboard?U(e):"";return a.default.html(E(),i,e.authorUrl,e.authorName,k,v,A,g,m,p,c,u,b,f,T,h)}(e),u=!i&&!(!e.attaches||!e.attaches.gift),d=a.default.class("msg",{id:t,service:i,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:u}),_="";i||(_=e.pending||e.failed?a.default.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):a.default.onClick("Msg._onClick","event","this",t));return a.default.html(j(),d,_,c)};function I(e){var t,n,i=window.lang,o=e.text,r=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,o,r,s){void 0===i&&(i=""),void 0===o&&(o=!0),void 0===r&&(r=""),void 0===s&&(s="");var l=Date.now(),c=Math.random(),u=""+l+c,d="msg__sticker",_="";s&&(d+=" sticker_animation",_='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var p=a.default.onClick("Msg._onStickerClick","event","this",o,i);return a.default.html(f(),d,r,p,_,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=a.default.html(p(),n)):W(e)&&Object.keys(e.attaches).length&&(r+=1,t=H(N(e),!e.failed&&1===r));var l,c=e.forwards;c.length&&(W(e)&&q(c)?(r+=1,l=H(langNumeric(c.length,i.mobile_mail_N_forwards),!e.failed&&1===r)):l=(l=c.map(function(t){return function e(t,n,i){var o=window.lang;var r=store.mail;var l=r.forwards[t]||r.msgs[t];if(!l)return"";var c=r.members[l.authorId];var u=l.peerId;r.peers[u];var d=$(c,u,r.cur.userId);var _=l.edited;var f=c.avatar;var p=c.url;var h=d;var m=l.date;var v=l.text;var A=l.attachesHTML;var g=l.forwards;var b=l.reply;var y=Object(s.default)({mix:"mi_author_photo",photos:[f],size:36});var w=_?x():"";var S;if(i>0){for(var C=[],O=g.length,E=0;E<O;E++){var j=e(g[E],n,i-1);C.push(j)}S=C.join("")}else if(g.length){var T=langNumeric(g.length,o.mobile_mail_N_forwards);S='<a href="/mail?act=msg&id='+n+'" class="msg__fwdsLink">'+T+"</a>"}A&&(A='<div class="mi_medias">'+(A=A.replace(/%top_msg_id%/g,n))+"</div>");S&&(S='<div class="mi_forwarded">'+S+"</div>");v&&(v='<div class="mi_text">'+v+"</div>");var I=b?L(b,n):"";var M=!!l.attaches.gift;var P=M?" msg__forwardGift":"";return a.default.html(k(),P,y,p,h,m,w,I,v,A,S)}(t,e.id,e.maxDepth-1)})).join(""));var u,_=e.reply;_&&(W(e)&&(q([_])||!function(e){var t=store.mail;return Object(d.isForwardedMessageId)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(_))?(r+=1,u=H(i.mobile_mail_in_reply_to,!e.failed&&1===r)):u=L(_,e.id));return t&&(t='<div class="mi_medias">'+t+"</div>"),l&&(l='<div class="mi_forwarded">'+l+"</div>"),o&&(o='<div class="mi_text">'+o+"</div>"),a.default.html(O(),u,o,t,l)}function M(e){var t=I(e),n=e.keyboard?U(e):"",i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),o=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],a=n.peers[i.peerId],o="";if(Object(d.isChatPeer)(i.peerId)){var r='<a href="'+Object(d.wrapCommunityMailUrl)("/mail?act=show&peer="+i.peerId)+'">'+a.title+"</a>";o=t.mobile_mail_message_to_chat.replace("{chat}",r)}return o}(e);return a.default.html(S(),i,e.authorUrl,e.authorName,o,e.date,t,n)}function x(){var e=window.lang;return a.default.html(b(),e.mobile_mail_edited_short)}function P(e){var t=window.lang,n=a.default.onClick("Msg._onRestoreClick","event",e);return a.default.html(g(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function B(e,t,n){var i="/mail?act=msg";return t?(i=Object(d.concatValues)(i,"&id="+t+"&reply=true"),n&&(i=Object(d.concatValues)(i,"&reply_id="+n))):i=Object(d.concatValues)(i,"&id="+e),Object(d.wrapCommunityMailUrl)(i)}function L(e,t){var n=store.mail.forwards[e]||store.mail.msgs[e],i=store.mail.replies[e]||store.mail.pendingReplies[e];return F(R(n,$(store.mail.members[n.authorId],n.peerId,store.mail.cur.userId),i.preview_url),i.msg_id,t,e)}function R(e,t,n){var i=e.body?D(e.body):V(e),o="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(o=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),a.default.html(A(),o,t,e.date,i)}function D(e){return e=e.replace(/<br>/g,"\n"),e=Object(d.mailReplaceDomainMentions)(e,"@$3"),e=Object(d.mailReplaceMentions)(e,"$3"),e=Object(d.emojiToHTML)(e)}function N(e){var t,n=window.lang,i=Object.keys(e.attaches),a=i.length;if(a>1){for(var o=0,r=i.length,s=0;s<r;s++)o+=0|e.attaches[i[s]];t=langNumeric(o,n.mobile_mail_attachments)}else if(1===a){var l=i[0],c=e.attaches[l];if(1===c)switch(l){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":t=n.mobile_mail_added_call}else if(c>1)switch(l){case"photo":t=langNumeric(c,n.mobile_mail_added_photos);break;case"video":t=langNumeric(c,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(c,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(c,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function H(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=Object(u.default)({large:!0}))+"</div>"),a.default.html(v(),e,n)}function V(e){var t=N(e);return a.default.html(m(),t)}function F(e,t,n,i){var o=B(t,n,i),r=a.default.onClick("Msg._onReplyClick","event",t,n,i);return a.default.html(h(),o,r,e)}function U(e){var t=o.default.render(Object(c.default)({keyboard:e.keyboard,msgId:e.id}));return a.default.html(_(),t)}function $(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function q(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,a=e.length,o=0;o<a;o++){var r=e[o];if(Object(d.isForwardedMessageId)(r)){var s=i[r];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var l=t[r];if(!l)return!0;if(!l.authorId||!n[l.authorId])return!0}}return!1}function W(e){return e.pending||e.failed||e.waiting}var z=n("UxAg"),Q=n("+cqQ"),Y=n("Gzds"),G=n("OcsD"),X=need("Voting");Object.assign(T,{class:"msg",onClick:Object(Q.default)(),onPendingClick:Object(Q.default)(),onRestoreClick:Object(Q.default)(),onReplyClick:Object(Q.default)(),onForward:Object(Q.default)(),onLoadAgain:Object(Q.default)(),getElem:function(e){return Object(z.$)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?Object(z.$$)(".msg_id_"+e).forEach(function(e){return e.remove()}):ie(e,!1)},spam:function(e){ie(e,!0)},restore:function(e){Object(z.$$)(".msg_id_"+e).forEach(function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")})},unselectAll:function(){Object(z.$$)(".msg_selected").forEach(function(e){return e.classList.remove("msg_selected")})},getReplyDataFromHTML:function(e){var t=e&&T.getElem(e),n="";if(t){var i=Object(z.$)(".thumbs_map .thumb_map_img_as_div",t);return(n=i&&i.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach(function(e){var n=Object(z.$)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)})},markAsRead:function(e){Object(z.$$)(".msg_id_"+e).forEach(function(e){return e.classList.remove("msg_unread")})},getId:function(e){var t=a.default.parseClass(J.msg,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(Z.text).innerHTML}}),T._onClick=ae,T._onPendingClick=oe,T._onTouchStart=se,T._onRestoreClick=ne,T._onActionClick=le,T._onReplyClick=ue,T._onStickerClick=de,T.onStickerTouchStart=_e;var K,J={msg:"msg"},Z={text:".msg__text"},ee=500,te=!1;function ne(e,t){e.stopPropagation(),t=parseInt(t,10),T.onRestoreClick(t)}function ie(e,t){void 0===t&&(t=!1);var n=P(e);Object(z.$$)(".msg_id_"+e).forEach(function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)})}function ae(e,t,n){re(e.target,t,function(){t.classList.toggle("msg_selected"),T.onClick(n)})}function oe(e,t,n,i,a){re(e.target,t,function(){T.onPendingClick(n,i,a)})}function re(e,t,n){for(var i=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(i&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+X.cls))return;e=e.parentElement}te?te=!1:ce()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||n()}function se(){ce()&&(te=!0)}function le(e,t,n){switch(t){case"forward":T.onForward(n)}}function ce(){return window.getSelection().toString().length>0}function ue(e,t,n,i){e.preventDefault(),T.onReplyClick(t,n,i)}function de(e,t,n,i){n&&(e.preventDefault(),i&&Y.default.stickersClick(t,i))}function _e(e,t){if(clearTimeout(K),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;Object(G.addEvent)(t,"contextmenu",fe),Object(G.addEvent)(t,"touchmove",a,{passive:!0}),Object(G.addEvent)(t,"touchend",o,{passive:!0}),Object(G.addEvent)(t,"touchcancel",o,{passive:!0}),K=setTimeout(function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),o()},ee)}function a(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&o()}function o(){clearTimeout(K),Object(G.removeEvent)(t,"contextmenu",fe),Object(G.removeEvent)(t,"touchmove",a,{passive:!0}),Object(G.removeEvent)(t,"touchend",o,{passive:!0}),Object(G.removeEvent)(t,"touchcancel",o,{passive:!0})}}function fe(e){event.preventDefault(),event.stopPropagation()}n.d(t,"Msg__restoreInner",function(){return P}),n.d(t,"Msg__reply",function(){return R}),n.d(t,"Msg__authorName",function(){return $}),n.d(t,"Msg__replyAttach",function(){return V}),n.d(t,"Msg__replyLink",function(){return F}),n.d(t,"Msg__textPreview",function(){return D}),n.d(t,"Msg__attachPreview",function(){return N}),n.d(t,"Msg_makeReplyLink",function(){return B}),n.d(t,"Msg_detailed",function(){return M});t.default=T;window.Msg=T},"/Rzu":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("TYsd"),a=(n("Mc5h"),n("s0aB")),o=n("7jQU"),r=n("/Id8"),s=n("fdw3"),l=function(e,t){void 0===t&&(t=null);var n="last"===t,i=store.mail,o=i.peers[e],r=o.url,s=null;if(t){var l;n||(r=r+"&msg="+t),(l=n?f(e):i.msgs[t])&&(s={text:c(l),date:l.dateShort,unreadCount:d(e),muted:o.isMuted,typing:p(e),pending:l.pending,failed:l.failed})}return Object(a.default)({id:e,url:r,photos:o.avatarImages,title:o.title,online:u(o),important:o.isImportant,profileUrl:o.profileUrl,isLast:n,more:s})};function c(e){var t=window.lang,n=store.mail,a=!!e.attaches.call;if(e.isService&&!a)return i.default.html({tag:"span",inner:[i.default.wrap(e.serviceText)]});var o=e.body?i.default.wrap(Object(r.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:Object(r.Msg__attachPreview)(e)}}(e),l="";return e.authorId===n.cur.userId&&e.peerId!==n.cur.userId?l=t.mobile_mail_you:Object(s.isChatPeer)(e.peerId)&&(l=(l=n.members[e.authorId].shortName).replace(/\.$/,"")),l&&(l+=": "),i.default.html({tag:"span",inner:[i.default.wrap(l),o]})}function u(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function d(e){var t=function(e){return store.mail.peers[e]}(e).countUnread;if(0===t){var n=store.mail,i=f(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function _(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],a=t.presend&&t.presend.failed[e];if(i&&i.length)for(var o=i.length-1;o>=0;o--){var r=i[o];if(-1===r.indexOf("edit"))return r}if(a&&a.length)for(var s=a.length-1;s>=0;s--){var l=a[s];if(-1===l.indexOf("edit"))return l}return n&&n.length?last(n):null}function f(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,a=_(e);return i&&i[a]?i[a]:a?t[a]:null}function p(e){var t,n,i=Object(o.uTyping_getPeerTyping)(e),a=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!a||Object(o.uTyping_getNames)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}n("+cqQ");Object.assign(l,{onTap:a.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=u(t);a.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=d(e);a.default.setUnreadCount(e,t)},redrawLastMsg:function(e){var t=f(e);t&&a.default.setLastMsg(e,c(t),{dateShort:t.dateShort,pending:t.pending,failed:t.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=Object(o.uTyping_getPeerTyping)(e),n=(t&&1===t.count&&t.users[0],p(e));a.default.setTyping(e,n)},redrawImportant:function(e,t){a.default.setImportant(e,t)}}),n.d(t,"uConvo_getLastMsgId",function(){return _});t.default=l;window.uConvo=l},"03kU":function(e,t,n){"use strict";n.r(t);var i=n("OmnB"),a=n.n(i),o=100,r=101,s=102,l=103,c=105,u=106,d=107,_=108,f=109,p=110,h=112,m=113,v=[r,l,s,u,d,_,f,p],A={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function g(e,t){for(var n in void 0===e&&(e={}),e)if(Object.prototype.hasOwnProperty.call(e,n)&&!1===t.call(e[n],n,e[n]))break;return e}function b(e,t,n){var i=[];if(g(e,function(e,t){n&&-1==["w","z","y","x","m","s"].indexOf(e)||i.push(t)}),!i.length)return[!1];i.sort(function(e,t){return e[1]-t[1]}),t*=window.devicePixelRatio>=2?2:1;var a=i[i.length-1];return g(i,function(e,n){if(n[1]>=t)return a=n,!1}),a}var y={};function w(e,t){if(isObject(t)&&!isEmpty(t)){var n="https://vk-callback.go.mail.ru/longread_pxl?action="+e;g(t,function(e,t){n+="&"+e+"="+t}),(new Image).src=n}}function k(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function S(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,n=document.getElementsByTagName("iframe"),i=n.length-1;i>=0;i--){var a=n[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout(function(){if("MEASURE"===e.type){var n=e.details.height;t.setAttribute("height",n)}},100)}}}function C(e,t){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes"));(domData(n,"media-links")||"").split(",");if(!(i.length<=1||domData(e,"carousel-inited"))){if(domData(e,"carousel-inited",1),t.mobile)return function(e,t,n){void 0===n&&(n={});var i,a,o,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=n.onClick,_=0,f=0,p=!1,h=0,m=0,v=!1,g=!1;r.addEventListener("touchstart",function(e){a=e.touches[0].pageX,i=e.touches[0].pageY,addClass(u,"--no_trans"),p=!0,clearTimeout(o)});var b,y=!1;function w(n,i,a){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(o=setTimeout(function(){u.style.transform="translateX(0px)"},700));clearTimeout(o),_=void 0===_?Math.min(e.length-1,Math.max(0,_+n)):a,domData(t,"photo-carousel-index",_),O(_,t),s.innerHTML=l.replace("{counter}",_+1).replace("{total}",e.length),u.style.transform="translateX(-"+_*c[0]+"px)"}}return r.addEventListener("touchmove",function(t){if(g||!(Math.abs(t.touches[0].pageY-i)>5||v)){if(f=t.touches[0].pageX-a,!(Math.abs(f)<10)||y){g||window.addEventListener("touchmove",b=function(e){return cancelEvent(e)},{passive:!1}),g=!0,y=!0;var n=Math.min(e.length-1,Math.max(0,_+(f<0?1:-1))),o=0===n&&0===_,r=n===e.length-1&&_===e.length-1;h=n;var s=-_*c[0];s+=o||r?.2*f:f,u.style.transform="translateX("+s+"px)"}}else v=!0}),r.addEventListener("touchend",function(){y=!1,v=!1,g=!1,m=_,removeClass(u,"--no_trans"),b&&window.removeEventListener("touchmove",b),Math.abs(f)<50||(_=h),w(0,!1,h),isFunction(d)&&m!==h&&d(m<h?A.clickOnCarouselNext:A.clickOnCarouselPrev)}),w}(i,e,t);var a=function(e,t,n,i){var a,o=0,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=geByClass1("article_photo_carousel__left",t),_=geByClass1("article_photo_carousel__right",t),f=n.onClick,p=!1;function h(n,i){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(a=setTimeout(function(){u.style.transform="translateX(0px)"},700));clearTimeout(a),o=Math.min(e.length-1,Math.max(0,o+n)),u.style.transform="translateX(-"+o*c[0]+"px)",s.innerHTML=l.replace("{counter}",o+1).replace("{total}",e.length),toggle(d,o>0),toggle(_,o<e.length-1),domData(t,"photo-carousel-index",o),O(o,t)}}return _.addEventListener("click",function(e){return h(1),f&&f(A.clickOnCarouselNext),cancelEvent(e)}),d.addEventListener("click",function(e){return h(-1),f&&f(A.clickOnCarouselPrev),cancelEvent(e)}),t.addEventListener("mousemove",function(){r.style.opacity=1}),t.addEventListener("mouseleave",function(){r.style.opacity=0}),h}(i,e,t);return window.data(e,"changePhotoFunction",a),a}}function O(e,t){var n=geByTag1("figcaption",t),i=[];n&&((i=domData(n,"captions"))&&(i=JSON.parse(i)),n.innerHTML=i[e]||"")}var E,j,T,I=n("lkNA"),M=window,x=M.geByTag,P=M.geByTag1,B=M.each,L=M.nav,R=M.removeClass,D=M.intval,N=M.toggleClass,H=M.domData,V=M.domQuery1,F=M.getW,U=M.getXY,$=M.getH,q=M.geByClass,W=M.ge,z=M.matchesSelector,Q={};window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;var Y,G,X,K,J,Z,ee,te=function(){function e(e,t,n){var i=this;this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._els={view:W("article_view_"+e.raw_id)},window.cur&&cur.destroy&&cur.destroy.push(function(){i.deinit()}),window.cur&&cur.destroy.push(function(){i.deinit()}),window.addEventListener("VKWebAppEvent",function(e){if(e&&e.detail&&void 0!==e.detail.index){var t=e.detail.index;if(T){var n=Q[H(T,"id")];n&&n(t)}}}),n&&this.ready()}var t=e.prototype;return t.getEl=function(){return this._els.view},t.getArticle=function(){return this._article},t.getScrollNode=function(){return this._options.getScrollNode?this._options.getScrollNode():document},t._getScrollTop=function(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop},t.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.deinit=function(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),clearTimeout(this._readTO)},t._onViewScroll=function(){var e=this,t=scrollGetY(),n=window.innerHeight;B(x("figure",this._els.view),function(i,a){var o=D(H(a,"done"));if(!o){var r=$(a),s=U(a)[1],l=D(H(a,"type")),c=101==l?-200:100,u=s<=t+n-c&&t+c<=s+r;(o=e._onObjectView(u,l,a))&&H(a,"done",1)}}),B(x("figure",this._els.view),function(i,a){var o,r=$(a),s=U(a)[1],l=D(H(a,"type")),c=s,u=s+r,d=t,_=t+n;if(c>_||d>u)o=!1;else{var f=Math.max(c,d);o=(Math.min(u,_)-f)/r>.7}e._onObjectPartialView(o,l,a)})},t._initObjects=function(){var e=this;this._initedObjects=this._initedObjects||{},B(q("_article_unmute_button",this._els.view),function(t,n){e._initedObjects[t]||(e._initedObjects[t]=!0,n.addEventListener("click",function(){var e=n.parentNode,t=P("video",e);t.muted=!t.muted,N(e,"article_object_unmuted",!t.muted)}))}),B(x("figure",this._els.view),function(t,n){if(!e._initedObjects[t])switch(e._initedObjects[t]=!0,parseInt(H(n,"type"))){case r:var i=C(n,{mobile:e._options.mobile,moderDeletePhoto:e._options.moderDeletePhoto,onClick:function(t){e.sendStats({type:t})}});if(e._initPhoto(n),i){var a=window._articleCarouselGlobalId++;n.setAttribute("data-carousel-id",a),Q[a]=i}break;case c:case o:geByClass1("article_figure_content",n).addEventListener("click",function(){e.sendStats({type:A.clickOnAudio})},!0);break;case h:case m:break;case l:case s:if(e._options.mobile){var u=P("video",n);u&&(u.addEventListener("play",function(){e.sendStats({type:A.clickOnVideo})}),u.addEventListener("pause",function(){e.sendStats({type:A.clickOnVideo})}))}else{geByClass1("article_figure_content",n).addEventListener("click",function(){e.sendStats({type:A.clickOnVideo})},!0)}}}),this._els.view.addEventListener("click",function(t){var n=t.target;if(z(n,'a[href^="/away"]')){var i=decodeURIComponent(unescape(n.href)).split("vk.com/away.php?to=")[1];i&&e.sendStats({type:A.clickOnExternalLink,domain:encodeURIComponent(e._getUrlDomain(i))})}})},t._initPhoto=function(e){var t=this;geByClass1("article_figure_content",e).addEventListener("click",function(){var n=V("[data-sizes]",e),i=JSON.parse(H(n,"sizes")),a=D(H(e,"photo-carousel-index"));t._options.onImageOpen&&t._options.onImageOpen.call(t,i,e,a),t.sendStats({type:A.clickOnPhoto})})},t._initStats=function(){if(this._statsInited)this._scrollStatEvent&&this._scrollStatEvent();else{this._statsInited=!0,this._openTime=Date.now();var e,t=-1,n=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);var i=this;this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){var o=i.getCurrentScrollRatio();if(!(o<0)){var r=1;o>=.95?r=4:o>.66?r=3:o>.33&&(r=2),function(o){if(i._isReady&&(i._article.has_more&&(o=Math.min(o,1)),!(t>=o))){for(var r=t+1;r<=o;r++)n.push(r);if(t=o,clearTimeout(e),e=setTimeout(a,300),3==o&&i._article.ttr){var s=i._article.ttr-i.getTimeSpent();s>0&&(i._readTO=setTimeout(function(){if(!document.hidden){var e=i.getCurrentScrollRatio();if(!(e<0||e>1.3)){var o=4==t;n=[t=4],a(o)}}},1e3*s))}}}(r),4!=r||i._article.has_more||(i.getScrollNode().removeEventListener("scroll",i._scrollStatEvent),i._scrollStatEvent=!1)}},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}function a(e){if(n.length){var t=i._article,a=i._options,o="";if(t.ref)o=t.ref;else if(window.cur){if("feed"===(o=window.cur.module)&&cur.articlePrevLoc&&!a.mobile)"search"===L.fromStr(cur.articlePrevLoc).section&&(o="feed_search")}var r={act:"stats",scroll:n.join(","),spent:i.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:a.isWebView?1:0,post_id:a.sourcePostId,is_widget:a.isWidget,is_delayed_scroll_4:D(e),track_code:a.trackCode,ref:o};ajax.post(a.mobile?"article.php":"al_articles.php",r),t.mailru_stats_data&&n.forEach(function(e){w("scroll_"+e,t.mailru_stats_data)}),n=[]}}},t._initGoogleAnalytics=function(){var e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{var t=document.createElement("script");t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+e),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}},t._onObjectPartialView=function(e,t,n){if(t==r){var i=V("[data-sizes]",n);if(JSON.parse(H(i,"sizes")).length>1){var a=n.getAttribute("data-carousel-id");e?j!=a&&(clearTimeout(E),E=setTimeout(function(){var e=Q[a];e&&e(1,!0)},400),j=a):a==j&&(j=-1,clearTimeout(E))}}},t._onObjectView=function(e,t,n){var i=!1;switch(t){case r:if(e){var a=P("img",n),o=F(a)||this._options.width,s=V("[data-sizes]",n),c=JSON.parse(H(s,"sizes")),h=x("img",n);c.forEach(function(e,t){var n=b(c[t],o,!0)[0];!function(e,t){if(!0===y[e])return t&&t(),!0;if(isArray(y[e]))return y[e].push(t),!1;y[e]=[t];var n=new Image;n.onload=function(){var t=y[e];y[e]=!0,g(t,function(e,t){t&&t()})},n.src=e}(n,function(){var e=h[t];R(e,"article_object_photo__image_blur"),e.src=n})}),i=!0}break;case l:if(!this._options.mobile){var m=P("video",n);if(m)if(e){if(m.hasAttribute("autoplay")){var v=m.play();v&&v.catch(function(){})}}else m.pause();else i=!0}break;case u:case d:case _:case f:case p:this.initEmbed(t,n),i=!0}return i},t.initEmbed=function(e,t){var n=this;switch(e){case u:var i=V("[data-tweet-id]",t),a=H(i,"tweet-id");Object(I.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){window.twttr.widgets.createTweet(a,i,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case d:var o=window.vk&&0==window.vk.lang?"ru_RU":"en_US";Object(I.loadScript)("https://connect.facebook.net/"+o+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){window.FB.XFBML.parse()}});break;case _:Object(I.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){window.instgrm.Embeds.process(),addEvent(window,"message",S)}});break;case f:var r=V("[data-raw-id]",t),s=H(r,"raw-id"),l=H(r,"index"),c=s.split(";"),h=c[0],m=c[1];Object(I.loadScript)("/js/api/openapi.js",{onLoad:function(){ajax.post("dev.php",{act:"a_get_post_hash",post:h+"_"+m},{onDone:function(e){e&&window.VK&&window.VK.Widgets&&window.VK.Widgets.Post("vk_post_"+s+"_"+l,h,m,e,{from:n._options.isWebView?"article_webview":""})}})}});break;case p:Object(I.loadScript)("https://telegram.org/js/telegram-widget.js?5",{})}},t.getCurrentScrollRatio=function(){var e=$(this._els.view),t=U(this._els.view)[1]-U(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e},t.getScreenVisibilityRatio=function(){var e=$(this._els.view),t=U(this._els.view)[1]-U(this.getScrollNode().firstElementChild)[1],n=this._getScrollTop(),i=window.innerHeight,a=t,o=t+e,r=n,s=n+i;if(r>o||a>s)return 0;var l=Math.max(a,r);return(Math.min(o,s)-l)/i},t.update=function(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())},t.ready=function(){var e=this;(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),setTimeout(function(){var t=k("anchor");if(t){e._options.isWebView||e.scrollToAnchor(t);var n=e.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body),n.click&&n.click(),n.focus()}},0),!this._options.mobile&&window.AudioPlaylist)&&(this._article.audios_list&&this._article.audios_list.length>0&&new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list}));this.getScrollNode().addEventListener("scroll",this._scrollEvent=function(){e._onViewScroll(),e._options.onScroll&&e._options.onScroll.call(e,e.getCurrentScrollRatio())}),setTimeout(function(){e._scrollEvent()},this._options.objectsInitDelay||0)},t.scrollToAnchor=function(e){e=e||k("anchor");var t=this._options,n=this.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body);e&&function(){var i=document.getElementById(e);if(i){"scrollRestoration"in history&&(history.scrollRestoration="manual");var a=t.isWebView?0:25,o=i.parentNode.offsetTop-a;window.setTimeout(function(){n.scrollTo?n.scrollTo(0,o):n.scrollTop=o},0)}}()},t.sendStats=function(e){var t=this._article,n=this._options,i={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:n.isWebView?1:0};Object.assign(i,e),ajax.post(n.mobile?"article.php":"al_articles.php",i)},t._getUrlDomain=function(e){var t=document.createElement("a");return t.href=e,t.hostname},e}(),ne=window,ie=ne.intval,ae=ne.domData,oe=ne.isEmpty,re=ne.isArray,se=ne.setStyle,le=ne.ce,ce=[],ue=!1,de=function(){function e(){}return e.init=function(e,t,n){if(void 0===n&&(n={}),ue=n.mobile||n.isWebView,t&&e.ads&&!oe(e.ads)&&!(e.has_more||re(e.ads)&&0==e.ads.length)){var i=le("ins");addClass(i,"mrg-tag"),addClass(i,"article_adsblock"),n.mobile&&addClass(i,"article_adsblock_mobile"),se(i,{display:"block","text-decoration":"none"});var a="";for(var o in n.deviceInfo)n.deviceInfo.hasOwnProperty(o)&&(a+="&"+o+"="+n.deviceInfo[o]);for(var r in e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",a),e.ads.data)e.ads.data.hasOwnProperty(r)&&ae(i,r,""+e.ads.data[r]);t.appendChild(i),window.MRGtag||(window.MRGtag=[]);var s=n.isWebView?{iframeMode:!0}:{},l=e.ads.eventsHash;if(_e(e,n,"requested",l),s.onNoAds=function(){_e(e,n,"no_ads",l)},s.onAdsLoaded=function(){_e(e,n,"ads_loaded",l)},s.onAdsClosed=function(){_e(e,n,"ads_closed",l)},s.onAdsSuccess=function(){_e(e,n,"ads_success",l)},s.onAdsClicked=function(){_e(e,n,"ads_clicked",l)},s.onScriptError=function(){_e(e,n,"script_error",l)},window.MRGtagOnAdsImpression=function(){_e(e,n,"ads_impression",l)},window.MRGtag.push(s),!window.mailRuSdsScriptLoaded){var c=document.createElement("script");c.setAttribute("src",e.ads.script),c.setAttribute("async","true"),document.head.appendChild(c),window.mailRuSdsScriptLoaded=!0}}},e.wasShown=function(){return!1},e}();function _e(e,t,n,i){ce.push(n+"/"+e.owner_id+"_"+e.id+"/"+i),clearTimeout(Y),Y=setTimeout(function(){var e=ue?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:ce.join(","),is_web_view:ie(t.isWebView)}),ce=[]},200)}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var fe,pe=!1,he=[],me=[],ve=20,Ae=.6,be={InProgress:1,NotAvailable:2},ye={},we={};function ke(e,t){e=e.split("_");for(var n=0;n<t.length;n++){var i=t[n].split("_");if(i[0]==e[0]&&i[1]==e[1])return n}return-1}function Se(){return document}function Ce(){return(document.scrollingElement||window.scrollNode||document.body).scrollTop}function Oe(e){return domQuery('.articleView__social_buttons[data-article-id="'+e+'"] .articleView__footer_btn_bookmark')}function Ee(e){if(ee!=e.raw_id)if(ee=e.raw_id,X.isWebView)!function(e){a.a.send("articleUpdate",{article:Le(e),isSubscribedToOwner:e.is_subscribed_to_owner})}(e);else{var t=geByClass1("articleView__owner"),n=geByTag1("img",t);t&&n&&(n.src=e.owner_photo);var i=geByTag1("a",t);t&&i&&(i.href=e.owner_href);var o=geByClass1("articleView__ownerName"),r=geByTag1("a",o);o&&r&&(r.href=e.owner_href,r.innerHTML=e.owner_name);var s=geByClass1("articleView__footer"),l=geByClass1("articleView__footer_views");l&&(l.innerHTML=e.views_formatted);var c=geByClass1("articleView__social_buttons",s);s&&c&&!e.is_blog&&c.setAttribute("data-article-id",e.raw_id);var u=[domQuery1('.articleView__content_misc_block[data-article-id="'+e.raw_id+'"] .articleView__footer_btn_share'),s&&domQuery1(".articleView__footer_btn_share",s)];each(u,function(t,n){n&&!e.is_blog&&(n.href="/like?act=publish&object=article"+e.raw_id+"&list="+e.access_hash)});var d=Oe(e.raw_id),_=JSON.stringify(e.mailru_stats_data);each(d,function(t,n){n&&(n.setAttribute("onclick","Article.fave(this, '"+e.url+"', '"+e.fave_hash+"', "+_+", '"+e.raw_id+"')"),toggleClass(n,"_active",e.is_faved))});var f=geByClass1("Unfold__item_name_noted");f&&(f.href="/feed?section=search&q=url:https://vk.com"+e.url);var p=geByClass1("Unfold__item_name_report");p&&(p.href="/reports?act=add&object=article"+e.raw_id+"_"+e.access_hash+"&refrom=feed")}}function je(e,t){void 0===t&&(t=!1),e.has_more||(he=he.concat(e.audios_list));var n=new te(e,{notFull:!!X.preloadMoreHash,isWebView:X.isWebView,mobile:!0,width:X.width,getScrollTop:Ce,getScrollNode:Se,trackCode:X.trackCode,onScroll:function(t){if(!e.has_more){var n=me[me.length-1],i=gpeByClass("articleView__content",n.getEl());t>Ae&&e.next_article_url&&(me.length<ve&&(Ie(e.next_article_url),addClass(i,"articleView_waitNextArticle")),function(){var e=me[me.length-1];if(e){var t=gpeByClass("articleView__content",e.getEl()),n=geByClass1("articleView__social_buttons",t);n&&show(n)}}()),t>.99&&e.next_article_url&&me.length<ve&&Ie(e.next_article_url,function(e,t){if(e){for(var n=0;n<me.length;n++)if(me[n].getArticle().raw_id==t.raw_id)return;fe||(fe=setTimeout(function(){var n=domCreate(e);Z.appendChild(n),removeClass(i,"articleView_waitNextArticle"),addClass(n,"articleView_nextPrepared"),requestAnimationFrame(function(){removeClass(n,"articleView_nextPrepared")}),je(t),fe=null},400))}}),this.getScreenVisibilityRatio()>.5&&Ee(e)}},onImageOpen:function(e,t,n){if(X.isWebView){for(var i=[],o=0;o<e.length;o++){var r=e[o],s=[];for(var l in r)r.hasOwnProperty(l)&&s.push({type:l,src:r[l][0],width:r[l][1],height:r[l][2]});i.push(s)}a.a.send("articlePhotoView",{photos:i,index:n})}}});t||n.ready(),me.push(n),Te(e),each(geByTag("video"),function(e,t){domData(t,"auto-pause-inited")||(domData(t,"auto-pause-inited",1),t.addEventListener("play",function(){each(geByTag("video"),function(e,n){n!=t&&n.pause()})}))}),X.isWebView&&each(geByTag("figure",n._els.view),function(e,t){var i=intval(domData(t,"type"));n._onObjectView(!1,i,t)&&domData(t,"done",1)})}function Te(e){var t=gpeByClass("articleView__content",ge("article_view_"+e.raw_id)),n=geByClass1("articleView__ads_block",t);de.init(e,n,X)}function Ie(e,t){var n=we[e];n!==be.NotAvailable?isArray(n)?t&&t(n[0],n[1]):(ye[e]=ye[e]||[],t&&ye[e].push(t),n!=be.InProgress&&(we[e]=be.InProgress,ajax.post("article.php",{act:"view",url:e,scroll_load:1,wall_owner_id:X.wallOwnerId,audio_bridge:intval(X.audioBridge),can_infinite_scroll:intval(X.canInfiniteScroll),web_view:X.isWebView,context:X.context,ref:"scroll",v:X.clientVersion},{onDone:function(t,n){for(var i=ye[e],a=0;a<i.length;a++)i[a](t,n);we[e]=[t,n]}}))):t&&t()}function Me(e,t){var n=Oe(e);each(n,function(e,n){toggleClass(n,"_active",t)})}function xe(){var e=k("anchor");e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var n=X.isWebView?0:25,i=t.parentNode.offsetTop-n;window.setTimeout(function(){var e;e=i,(document.scrollingElement||window.scrollNode||document.body).scrollTop=e},0)}}()}function Pe(e){if(void 0===e&&(e={}),pe)xe();else{X.deviceInfo=e.deviceInfo;var t=me[0],n=t.getArticle();t.ready(),n.has_more?ajax.post("article.php",{act:"load_more",rev:n.rev,hash:n.has_more_hash,article_owner_id:n.owner_id,article_id:n.id,audio_bridge:intval(X.audioBridge),no_lazy_images:intval(X.noLazyImages),can_infinite_scroll:intval(X.canInfiniteScroll),wall_owner_id:X.wallOwnerId,context:X.context,client_version:X.clientVersion},{onFail:function(){X.failTries>0&&(X.failTries--,setTimeout(function(){Pe(e)},2e3))},onDone:function(e,i){pe=!0,n.audios_list=i.audios_list,n.next_article_url=i.next_article_url,n.has_more=!1,n.audios_list&&n.audios_list.length&&(he=he.concat(n.audios_list));var a=domCreate(e),o=geByClass1("article_view",a),r=geByClass1("article_view");"figure"!==r.lastElementChild.tagName.toLowerCase()&&r.lastChild.remove();for(var s=r.children.length,l=o.children;s<l.length;)r.appendChild(l[s]);var c=geByClass1("article_preload_spinner");c&&c.parentNode.removeChild(c);var u=geByClass1("articleView__content_misc_block",a);r.parentNode.appendChild(u),function(){for(var e=geByClass1("article").children,t=0;t<e.length;t++){var n=t>0&&e[t-1],i=e[t],a=t+1<e.length&&e[t+1],o=n?n.tagName+"_"+domData(n,"type"):"",r=i?i.tagName+"_"+domData(i,"type"):"",s=a?a.tagName+"_"+domData(a,"type"):"",l=!1,c=!1,u=!1;o&&r==o||(l=!0),s&&r==s||(c=!0),(v.includes(+s.type)||s.sep)&&(u=!0),toggleClass(i,"article_decoration_first",l),toggleClass(i,"article_decoration_last",c),toggleClass(i,"article_decoration_before",u)}}(),Te(n),xe(),t.update()}}):ajax.post("article.php",{act:"next_url",access_hash:n.access_hash,article_owner_id:n.owner_id,article_id:n.id,wall_owner_id:X.wallOwnerId,context:X.context},{onDone:function(e){e&&(n.next_article_url=e,t.update())}});var i=t.getEl();e.paddingTop&&setStyle(i,"marginTop",intval(e.paddingTop)),e.paddingBottom&&setStyle(i,"marginBottom",intval(e.paddingBottom)),e.noDarkModeTransition&&addClass(i,"article_dark_no_transition")}}function Be(e){var t=null;return each(me,function(n,i){var a=i.getArticle();if(a.raw_id==e)return t=a,!1}),t}function Le(e){var t="https://"+X.devHost+"vk.com"+e.url,n={id:e.id,owner_id:e.owner_id,owner_name:e.owner_name,state:"available",can_report:e.can_report,title:e.title,subtitle:"",views:e.views,shares:e.shares,is_favorite:e.is_faved,url:t,view_url:t,access_key:e.access_hash,published_date:e.published_date,no_footer:e.no_footer};return e.owner_photo&&0!=e.owner_photo.indexOf("/images/")&&(n.owner_photo=e.owner_photo),n}function Re(e,t){void 0===t&&(t="");var n=me[me.length-1];if(t)for(var i=0;i<me.length;i++)if(me[i]._article.raw_id===t){n=me[i];break}n.sendStats({type:e})}window.ArticleView=te,window.Article={init:function(e,t){if((X=t).mobile=!0,X.failTries=50,window.cur&&(window.cur.lang=window.cur.lang||{},extend(window.cur.lang,t.lang||{})),Z=geByClass1("articleView__content_list"),!X.isWebView){var n,i=Ce(),o=geByClass1("articleView__header"),r=geByClass1("articleView__footer"),s=geByClass1("articleView__layout");Se().addEventListener("scroll",n=function(){var e=s.clientHeight,t=Math.max(0,Ce()),n=t-i>0,a=t+window.innerHeight+20>e;toggleClass(o,"articleView__header--narrow",n),r&&toggleClass(r,"articleView__footer--hidden",!a&&n),i=t},{passive:!0});var l=geByClass1("articleView__close"),c=geByClass1("articleView__close_mini");l.addEventListener("click",Re.bind(window,A.close)),c.addEventListener("click",Re.bind(window,A.close)),window.cur&&cur.destroy.push(function(){document.removeEventListener("scroll",n),removeClass(document.body,"article_body_with_transition")}),X.isStandalone&&(window.al=!1)}if(X.preloadMoreHash||show(geByClass1("article_layer_prev_next")),X.isWebView){var u=geByClass1("article");addClass(u,"article_webview")}X.isWebView&&X.audioBridge&&(window.audioplayer={playPause:function(e,t){var n=gpeByClass("audio_item",e.target);if(K&&K!=n&&(removeClass(K,"ai_playing"),K=!1),J&&(removeClass(J,"article_object_audioplaylist_playing"),J=!1),hasClass(n,"ai_playing"))a.a.send("audioPause",{}),removeClass(n,"ai_playing");else{var i=ke(t,he),o=he;-1==i&&(o.unshift(t),i=0),a.a.send("audioPlay",{audioIds:o,pos:i}),addClass(n,"ai_playing"),K=n}}}),X.isWebView?(a.a.send("articleReady"),window.addEventListener("VKWebAppEvent",function(e){var t=e.detail||{};switch(t.type){case"articleOwnerSubscribed":var n=t.ownerId,i=t.isSubscribed;each(me,function(e,t){var a=t.getArticle();if(a.owner_id==n)return a.is_subscribed_to_owner=i,!1});break;case"articleBookmarked":var a=t.articleOwnerId+"_"+t.articleId,o=Be(a);o&&(o.is_faved=t.isBookmarked);var r=Oe(a);each(r,function(e,n){toggleClass(n,"_active",!!t.isBookmarked)});break;case"articleWebViewShow":Pe(t);break;case"articleWebViewClose":Re(A.close);break;case"didShareArticle":var s=t.articleRawId,l=t.shareType;if(!l)break;Re(l,s);break;case"articleMentionClick":var c=t.articleRawId;Re(A.clickOnMentions,c)}}),je(e,!0)):je(e,!1)},fave:function(e,t,n,i,o){var r=!hasClass(e,"_active");ajax.post("article.php",{act:"fave",url:t,add:intval(r),hash:n}),me.forEach(function(e){var n=e.getArticle();n.url==t&&(n.is_faved=r)}),w(r?"fave":"unfave",i),Me(o,r),X.isWebView?function(e){var t=Be(e);t&&(JSON.stringify({article:Le(t)}),a.a.send("articleBookmarked",{article:Le(t)}))}(o):Share&&Share.setBookmarkState(o,r)},toggleButton:Me,share:function(e,t,n){return function(e){var t=Be(e),n=X.clientVersion;if(t)if(n){var i={type:"article",data:Le(t)};a.a.send("share",i)}else{var o={article:Le(t)};a.a.send("articleShare",o)}}(t),!1},subscribe:function(e,t,n){ajax.post("article.php",{act:"subscribe",owner_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"articleView__subscribed",t),e.innerHTML=n}})},toggleDarkMode:function(e){G||(G=setTimeout(function(){var t=geByClass1("articleView__layout");toggleClass(t,"article_dark",e),toggleClass(document.body,"article_dark",e);var n=intval(hasClass(t,"article_dark"));G=!1,void 0!==e||X.isWebView||ajax.post("article.php",{act:"set_dark_mode",dark:n});var i=geByClass1("articleMenu");i&&Unfold.setTitle(i,"dark_mode",n?getLang("mobile_articles_menu_dark_disable"):getLang("mobile_articles_menu_dark")),Re(n?A.nightModeOn:A.nightModeOff)},e?0:10))},onWebViewShow:Pe,sendStats:Re,audioPlayPlaylist:function(e,t,n){var i=gpeByClass("article_object_audioplaylist_webview",e);if(K&&(removeClass(K,"ai_playing"),K=!1),J){var o=J;if(removeClass(o,"article_object_audioplaylist_playing"),J=!1,o==i)return a.a.send("audioPause",{}),cancelEvent(n)}var r=ke(t,he),s=he;return-1==r&&(s.unshift(t),r=0),a.a.send("audioPlay",{audioIds:s,pos:r}),addClass(i,"article_object_audioplaylist_playing"),J=i,cancelEvent(n)},onAudioStateChanged:function(e,t){K&&(removeClass(K,"ai_playing"),K=!1),J&&(removeClass(J,"article_object_audioplaylist_playing"),J=!1),e=(e=e.split("_"))[0]+"_"+e[1];var n=ge("audio"+e);n&&toggleClass(n,"ai_playing","play"==t);for(var i=geByClass("_article_object_audioplaylist_webview"),a=0;a<i.length;a++){if((domData(i[a],"ids")||"").split(",").indexOf(e)>=0&&"play"==t){addClass(i[a],"article_object_audioplaylist_playing"),J=i[a];break}}}}},"0Nfb":function(e,t,n){"use strict";n.r(t);var i=function(e){void 0===e&&(e={});var t=window.lang;if(!e.inner)return{};if(isArray(e.inner)&&(e.inner=e.inner[0]),e.short||(e.short=""),!e.short&&!e.inner)return{};var n=e.short.length<e.inner.length;return e.short=Wd.html(e.short),e.inner=Wd.html(e.inner),{inner:[{inner:[e.short],class:"CroppedText__body",tag:"span"},n?{inner:[{tag:"br"},{tag:"br"},t.mobile_wall_show_full_text],class:"CroppedText__more",onclick:"CroppedText.expand(this)",tag:"a"}:null,{inner:[e.inner],class:"CroppedText__full",style:"display: none;",tag:"span"}],class:"CroppedText",tag:"div"}};window.CroppedText={expand:function(e){var t=e.closest(".CroppedText"),n=$(".CroppedText__body",t),i=$(".CroppedText__full",t);re(e),t.classList.add("CroppedText--expanded"),val(n,i.innerHTML)}};t.default=i},"0hva":function(e,t,n){"use strict";n.r(t);var i=n("vOib"),a=n("1VZq"),o=n("z1UI"),r=n("O5lf"),s=(n("tlMv"),n("z9sQ"));var l=function(e){void 0===e&&(e={});var t=window.lang,n=e.title||"",l=e.description||"",c=e.pretag,u=e.buttons||{},d=(e.photos||[]).map(function(e){return Object(a.default)({photo:e})}),_=null;if(e.is_loading)_=Wd.wrap(Object(r.default)({mix:"al_loading",type:"pageLoader"}));else{if(!d.length)return Object(o.default)({separator:!0,more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_type:"primary",more_url:e.add_url,text:t.mobile_photos_placeholder_album_text});_={inner:[d],class:"AlbumPage__photos photos_page",tag:"div"}}var f=s.default.class("AlbumPage",{withoutDescription:!l},"--");return{inner:[Object(i.default)({inner:[{inner:[{inner:[n],class:"AlbumPage__title",tag:"h2"},l&&{inner:[l],class:"AlbumPage__description",tag:"span"}],class:"AlbumPage__info",tag:"div"},u.prev,_,u.more,c]})],class:f,tag:"div"}},c=n("OcsD");function u(){var e,t,n=$("#mhead"),i=(Object(c.getH)(n),$(".AlbumPage__title")),a=Object(c.getH)(i);$(".AlbumPage")&&(Object(c.onBodyScroll)(function(){e||(e=$(".header__title",$("#mhead"))),t||(t=$(".header__text",e));var n=Math.min(40,Math.max(0,getY(i)-a-scrollTop()));c.setStyle.transform(t,1,[0,n]),e.classList.toggle("header__title--initial-position",0===n)}),Object(c.onBodyScroll)(!0))}var d=n("Cbap");n.d(t,"initAlbumPage",function(){return u}),d.default.getRouter().addRoute(/\/(?:album|tag)(-?\d+(?:_\d+)?)/,u,void 0),d.default.getRouter().addRoute(/\/(?:attachments\?act=choose_photo).*(?:album|tag)=(-?\d+(?:_\d+)?)/,u,void 0);t.default=l},"1VZq":function(e,t,n){"use strict";n.r(t);var i=function(e){var t=e.photo;return{inner:[{style:"background-image: url("+t.src+")",attrs:t.attrs,class:"_image PhotosPhotoItem__photo",tag:"div"}],href:t.href,class:"PhotosPhotoItem "+t.class,onclick:t.onclick,tag:"a"}};t.default=i},"29dZ":function(e,t,n){"use strict";n.r(t);var i=n("UvyM"),a=n("myok");Object.assign(i.default,a.default),window.Btn=i.default,t.default=i.default},"2IoG":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return o=function(){return e},e}t.default=function(e){void 0===e&&(e={});var t,n,i=a.default.list(e.inner);e.url?(t="a",n=a.default.attr("href",e.url)):(t=e.tag||"div",n="");return a.default.html(o(),t,e.mix,n,e.attrs,i,t)}},"4fRq":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},"4qiT":function(e,t){var n={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push(function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)}))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,a=t.content,o=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),o&&window.scrollTop()+2*window.innerHeight>a.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),function(t){e.elems.content.innerHTML+=t})},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_link",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")})},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,a){e.preventDefault(),this._closeUnfold(e);var o=+domData(t,"is-bookmarked"),r=o?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:r,item_type:5,item_oid:n,item_id:i,hash:a},{onDone:function(e,n,i){domData(t,"is-bookmarked",o?0:1),o?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,a){var o=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:a},{onDone:function(){o.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){a.updateList()}})}};window.AuthorPage=n},"5qQ6":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=(n("KMpi"),n("/Id8")),r=n("fdw3");function s(){var e=Object(i.default)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=function(e){var t,n=e.msgId,i=e.withDivider?function(){var e=window.lang;return a.default.html(s(),e.mobile_mail_new_msgs)}():"",c=store.mail,u=Object(r.isForwardedMessageId)(n)?c.forwards[n]:c.msgs[n],d=c.members[u.authorId],_=u.peerId,f=c.peers[_];if(!e.detailed){var p=store.mail.presend,h=(p=p&&p.msgs)&&p["edit"+n];h&&(u=h)}f&&(f.isIncomingMR||f.isRejectedMR)&&(i="");if(u.isService)t=Object(o.default)({id:n,text:u.service,service:!0,unread:u.isUnread});else{var m=Object(o.Msg__authorName)(d,_,c.cur.userId),v={id:n,text:u.text,important:u.isImportant,unread:u.isUnread,authorPhoto:d.avatar,authorName:m,authorUrl:d.url,date:u.date,removed:c.cur.msgRemoved[n],admin:u.adminName?{name:u.adminName,url:u.adminUrl}:null,edited:u.edited,channel:f.isChannel&&f.ownerId!==c.cur.viewerId,attaches:u.attaches,attachesHTML:u.attachesHTML,attachesLoading:u.attachesLoading,forwards:u.forwards,reply:u.reply,pending:u.pending,waiting:u.waiting,failed:u.failed,sendId:u.sendId,sticker:u.sticker,keyboard:u.keyboard,maxDepth:e.detailed?c.cur.maxDetailedMsgDepth:c.cur.maxMsgDepth};t=e.detailed?Object(o.Msg_detailed)(v):Object(o.default)(v)}return a.default.html(l(),i,t)};t.default=c;window.uMsg=c},6:function(e,t,n){e.exports=n("75Qd")},"75Qd":function(e,t,n){"use strict";n.r(t);n("XCiN");var i=n("OcsD"),a=n("CQvH"),o=n("a0wW"),r=n("z9sQ"),s=n("+cqQ"),l=n("TYsd"),c=n("Cbap"),u=n("tgcV"),d=n("BZzM"),_=(n("eGQV"),n("uQjJ"),n("jk6M")),f=(n("wcVR"),n("kr3z")),p={isUploading:!1,onBeforeRemove:Object(s.default)(),onRemove:Object(s.default)("removeElem"),onStart:Object(s.default)(),onError:Object(s.default)("response"),onComplete:Object(s.default)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}}),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),a=geByTag1("input",i),o=intval((a&&a.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var r=attr("add_post_btn","data-value");r&&val("add_post_btn",r)}else o&&each(geByTag("input",t),function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==o?this.disabled=!0:e>o&&(this.name="attach"+(e-1)+(n[2]||""))}})}},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=p.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),a=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),a){toggleClass("cp_attachBtnEl_sel",a,e>0);var o=geByClass1("inline_upload",a);if(o||(o=geByClass1("inline_upload",a.parentNode)),o){var r=attr(o,"data-max-attaches")||10;o.disabled=e>=r}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!p._processUploadQueue||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(l.default.html(t))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)p.onUploadError.call(t,e);else{var a=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(a)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),o=p.getLastAttachId()+1;if(a?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=$('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n&&e.src)var r=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(a&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(r,n),t.iw&&t.ih){if(t.iw>t.ih==r.width>r.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(r,"width",i)}reflow(r),setStyle(r,"opacity",1)},src:e.src});after(ce("input",{type:"hidden",name:"attach"+o,value:e.photo_raw}),n),after(ce("input",{type:"hidden",name:"attach"+o+"_type",value:"photo"}),n),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,p._processUploadQueue||(p.isUploading=!1,p.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,p.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),p.uploadQueueNext(),p.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){e.xhr=uploadFile(e.upload_url,{photo:e.file},{onProgress:bind(p.onUploadProgress,e),onComplete:bind(p.onUploadComplete,e),onError:bind(p.onUploadError,e)})}),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){readFile(e.file,function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});p.readerQueueNext()})}),addFile:function(e){var t=ge("attached_wrap"),n=geByClass1("pi_medias",t),i=n?geByClass("medias_thumb",n):[],a=n?geByClass1("medias_row",n):null,o=i[i.length-1],r=p.attachedPhotoTpl(e.id);if(t){if(window.ThumbsEdit&&ThumbsEdit.initialized)readFile(e.file,function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,a=n.height;window.fakeImg=n;var o=getImageOrientation(t);t="/images/blank.gif";var r=!1;o>4&&o<9&&(r=!0);var s=["photo",e.id,{sizes:{temp:[t,r?a:i,r?i:a]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}});else{if(!n){var s=geByClass1("AddedAttach",t);n=ce("div",{className:"pi_medias"}),append(n,s||t)}o?after(r,o):a?before(r,a):append(r,n)}p._processReaderQueue||p.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),p._processUploadQueue=!0;var e=p.uploadQueueRemove();if(!e)return clog("empty upload"),p._processUploadQueue=!1,void(p.isUploading=!1);p.uploadFile(e)},readerQueueNext:function(){clog("next reader"),p._processReaderQueue=!0;var e=p.readerQueueRemove();if(!e)return clog("empty reader"),void(p._processReaderQueue=!1);p.readFile(e)},queueInsert:function(e){var t=srand();return p.getUploadDataById(t)?p.queueInsert(e):(p._uploadData[t]=extend(e,{id:t}),p._uploadQueue.push(t),p._readerQueue.push(t),p._uploadData[t])},uploadQueueRemove:function(){var e=p._uploadQueue.shift();return!!e&&p.getUploadDataById(e)},readerQueueRemove:function(){var e=p._readerQueue.shift();return!!e&&p.getUploadDataById(e)},getUploadDataById:function(e){return p._uploadData[e]||!1},delUploadDataById:function(e){delete p._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return p.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),a=submitBtn(i),o=ge("attach_photo_btn"),r=attr(e,"data-upload-url"),s=attr(e,"data-done-url"),l=attr(e,"data-max-attaches")||10,c=p.getAttachesCount();return r&&s?(each(n,function(){var e={upload_url:r,done_url:s,file:this,uploaded:!1,attached:!1};if(c>=l)return!1;p.queueInsert(e),p.addFile(e),c++}),removeEvent(i,"submit",p.checkUploading),addEvent(i,"submit",p.checkUploading),removeEvent(a,"click",p.checkUploading),addEvent(a,"click",p.checkUploading),removeEvent(o,"click",p.checkUploading),addEvent(o,"click",p.checkUploading),p.refreshUploadState(c),replace(clone(e),e),p._processUploadQueue||p.uploadQueueNext(),window.isNewMail&&p.onStart(),p.isUploading=!0,!1):p.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&p.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),p.refreshAttachIds(e);var a=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(a)}else{var o=n,r=p.getUploadDataById(o);if(!r)return!1;r.attached?r.delete_url&&(ajax.post(r.delete_url,{_ajax:1}),p.refreshAttachIds(e)):(r.xhr&&r.xhr.abort&&r.xhr.abort(),r.loaded||p.uploadQueueNext()),i?i():remove("upload_item_"+o),p.delUploadDataById(o)}return p.refreshUploadState(),window.isNewMail&&p.onRemove(e),Replies.abortTimer("editing"),!1}};window.mediaUpload=p;var h=n("cGUQ"),m={onUploadedDone:Object(s.default)("resp"),fallback:function(e,t){var n=window.nav,i=e.nextSibling;return!!i&&!n.go(i)},onUploadProgress:function(e){window.photoview.updateUpload({progress:e.loaded/e.total})},onUploadComplete:function(e){var t=window.photoview,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)m.onUploadError.call(this,e);else{this.xhr=null,this.photo_res=n,this.photo_size=i.size;var a=this.static_url+i.x_src,o=i.size[0],r=i.size[1],s=Math.min(o,r);t.onClose=bind(m.onClose,this),t.openCrop({src:a,max_scale:s/200,onSelect:bind(m.onCropSelected,this)})}},onUploadError:function(e){var t=window.photoview;clog("upload error.",e.target.responseText),t.close()},onClose:function(e){this.xhr&&this.xhr.abort&&this.xhr.abort()},onCropSelected:function(e,t,n){var i=window.photoview,a=this,o=a.photo_res,r=a.photo_size,s=r[0],l=r[1],c=Math.min(s,l),u=Math.round(e*s),d=Math.round(t*l),_=Math.round(n*c);if(a.upload_edit_url)var f=a.upload_edit_url;else f=a.base_url+"upload.php?"+Object(h.toQueryString)({act:"owner_photo_edit",_query:o,_origin:location.protocol+"//"+location.host},!0);a.xhr=ajax.plainpost(f,{_crop:[u,d,_].join(",")},function(e){m.onCropSuccess.call(a,e)},function(e){m.onCropCancel.call(a)},!0),i.updateCrop({saving:!0})},onCropSuccess:function(e){var t=window.photoview,n=this;n.xhr=ajax.post("/photos.php?act=done_photo",{_ajax:1,_query:e,_from:n.from},{onDone:function(e){m.onUploadedDone(e),t.close()},onFail:function(){m.onCropCancel.call(n)}})},onCropCancel:function(){window.photoview.updateCrop({saving:!1})},prepareInput:function(e){e.files&&e.files.length&&(e.value="")},start:function(e,t){var n=window.photoview;if(!e||!canUploadFile())return m.fallback(e,t);var i=e.files[0]||!1,a=attr(e,"data-upload-url"),o=attr(e,"data-base-url"),r=attr(e,"data-static-url"),s=attr(e,"data-from");if(!i)return!1;if(!a)return m.fallback(e,t);var l={upload_url:a,base_url:o,static_url:r,file:i,from:s};return l.xhr=uploadFile(a,{photo:i},{onProgress:bind(m.onUploadProgress,l),onComplete:bind(m.onUploadComplete,l),onError:bind(m.onUploadError,l)}),readFile(i,function(e){n.updateUpload({thumb:e})}),replace(clone(e),e),n.onClose=bind(m.onClose,l),n.openUpload({src:null}),!1},getCropFromTag:function(e,t,n){if(!e)return!1;if(3==e.length)var i=+e[0],a=+e[1],o=+e[2];else{i=+e[0]*t/1e4,a=+e[1]*n/1e4,o=+e[2]*t/1e4;var r=+e[3]*n/1e4;if(o>r&&(i+=(o-r)/2,o=r),o<200){var s=(200-o)/2;i-=s,a-=s,o=200}o=Math.min(Math.max(o,200),Math.min(t,n)),i=Math.min(Math.max(i,0),t-o),a=Math.min(Math.max(a,0),n-o)}return[i/t,a/n,o/Math.min(t,n)]},crop:function(e){if(!e||!e.size&&!e.url)return!1;var t=window.photoview,n={upload_edit_url:e.upload_url};if(e.size){n.photo_size=e.size;var i=Math.min(e.size[0],e.size[1]);t.onClose=bind(m.onClose,n),t.openCrop({src:e.thumb,max_scale:i/200,rect:m.getCropFromTag(e.rect,e.size[0],e.size[1]),onSelect:bind(m.onCropSelected,n)})}else{var a=ce("img",{src:e.url,onload:function(){n.photo_size=[a.width,a.height];var i=Math.min(a.width,a.height);t.updateCrop({src:e.thumb,max_scale:i/200,rect:m.getCropFromTag(e.rect,a.width,a.height),onSelect:bind(m.onCropSelected,n)})}});t.onClose=bind(m.onClose,n),t.openCrop({src:!0})}return!0}};window.ownerPhotoUpload=m;n("+YbT"),n("T24x");var v=n("W9Tc"),A=n("wMVj"),g=n("UxAg"),b=n("BoyB"),y=n("V4qE"),w=n("YU/R"),k=n("Fkq0"),S=n("h8oe"),C=n("+UAi"),O=n("z9Td"),E=window.isPVRedesign;function j(e){var t=!1,n={onStart:function(){Object(i.addClass)("wia_item--loading",this.link)},onDone:function(){var a=e.onDone&&e.onDone.apply(this,arguments);if(a){var o=a.wdHTML,r=a.data,s=a.onDoneEnd;if(o){var l=Wd.elem(o);Object(i.replace)(l,this.link.parentNode),r&&!t&&Snackbar.init({text:r.title,action:{url:r.href,text:r.undo_title,callback:function(e,i){var a=i.id;e.preventDefault(),t=!0,ajax.click(l.querySelector("a"),n),Snackbar.close(a)}}}),t=!1}s&&s()}}};return n}var T={onDone:function(e,t,n,a){var o=Object(i.ge)(e)||Object(i.geByClass1)("like_box","z")||Object(i.geByClass1)("like_box")||Object(i.geByClass1)("wall_item_for_like_"+e);if(o&&e){var r,s,l=Object(i.geByClass1)("item_repost",o);if(Object(i.hasClass)("wall_item",o)||Object(i.hasClass)("market_item",o)||o.parentNode.classList.contains("PhotoviewPage")||o.parentNode.classList.contains("VideoPage")?s=Object(i.geByClass1)("wi_like_wrap",o):Object(i.hasClass)("ReplyItem",o)?r=Object(i.geByClass1)("ReplyItem__likeWrap",o):s=Object(i.geByClass1)("item_like",o),r||(r=Object(i.geByClass1)("like_wrap",o)),s&&(s.innerHTML=t||"",Object(i.toggleClass)("is_empty",s,!t),Object(i.toggle)(s,t)),l&&(l.innerHTML=n||"",Object(i.toggle)(l,n)),r){var c=Object(i.ceFromString)(a);!o.classList.contains("wall_item")&&c.classList.contains("like_wrap")?Object(i.val)(r.parentNode,a||""):Object(i.val)(r,a||"");var u=Object(k.marketItemIdToObject)(e);if(u){var d=r.querySelector(".item_like");d&&Object(S.trackMarketEvent)({table:S.TABLE_ECOMM_GOODS,event:d.classList.contains("item_sel")?C.EVENT_LIKE_ITEM:C.EVENT_UNLIKE_ITEM,ownerId:u.ownerId,itemId:u.itemId,instant:!0,platform:O.PLATFORM_MVK})}}}},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:nav.hard_go(e[0])}}},I={onDone:function(e,t,n,a,o){var r=window,s=r.photo;if(T.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){var c=Object(i.ce)("div",{innerHTML:l.likes});Object(i.val)(Object(i.geByClass1)("item_like",c),t),l.likes=Object(i.val)(c),l.publish='<span class="item_repost">'+n+"</span>",l.likes_cnt=Object(i.intval)((Object(i.attr)(Object(i.geByClass1)("v_like",c),"data-like_count")||"").replace(/\D+/g,"")),l.likes_me=o;c=Object(i.ce)("div",{innerHTML:l.actions});var u=Object(i.geByClass1)("like_wrap",c);Object(i.val)(u,a),l.actions=Object(i.val)(c),s.save(l)}}},onFail:T.onFail};E&&(I={onDone:function(e,t,n,a,o){var r=window,s=r.photo;if(T.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){Object(i.ce)("div",{innerHTML:t});var c=Object(i.ce)("div",{innerHTML:a});l.likes=Object(i.val)(u),l.likes_cnt=Object(i.intval)((Object(i.attr)(Object(i.geByClass1)("v_like",c),"data-like_count")||"").replace(/\D+/g,"")),l.likes_me=o,l.liked_people=t,l.like_buttons=a;var u=Object(i.ce)("div",{innerHTML:l.actions}),d=Object(i.geByClass1)("like_wrap",u);Object(i.val)(d,a);var _=window.isPVRedesign;_||(l.actions=Object(i.val)(u)),s.save(l)}}},onFail:T.onFail});var M={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:y.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:y.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var a=t.get(this.photo_id);a&&(a.tag_info="",t.save(a));var o=Object(i.geByClass1)("photo_view"),r=Object(i.geByClass1)("pv_tag_wrap",o);Object(i.val)(r,"")}}},x={onDone:function(e,t,n){var a=window.photo,o=window.menu,r=Object(i.geByClass1)("photo_view"),s=Object(i.geByClass1)("photo_msg"),l=!!t;if(r&&s){Object(i.val)(s,t||""),Object(i.toggleClass)("photo_deleted",r,l);var c=a.get(e);c&&(c.deleted=t,a.save(c)),n&&o&&o.refresh({pp:n})}}};E&&(x=j({onStart:function(e){console.log(this,e)},onDone:function(e,t,n,a){var o=photo.get(t);o&&(o.isDeleted=n,photo.save(o)),Object(g.$)(".PhotoviewPage").classList.toggle("PhotoviewPage--deleted",n);return{wdHTML:e,data:a,onDoneEnd:function(){var e=Object(g.$)("#photo_actions"),t=$$(".ContextMenu__list li",e);Array.from(t).forEach(function(e){n&&"delete"!==domData(e,"name")&&Object(i.hide)(e),n||Object(i.show)(e)}),o&&(o.actions=e.innerHTML,photo.save(o))}}}}));var P={onDone:function(e,t){var n=window.isNewMail&&Object(g.$)(".messenger")&&this.link.closest(".msg");if(Object(i.val)(e,t),n){var a=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[a].textFull=n.$(".msg__text").innerHTML}}},B={onDone:function(e){this.link&&(Object(i.after)(cdf(e),Object(i.gpeByClass)("pic_body_wrap",this.link)),Object(i.hide)(this.link))}},L=j({onStart:function(){Object(i.addClass)("cm_item_loading",this.link)},onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};this.link&&Object(i.val)(this.link.parentNode,e)}}),R={onDone:function(e,t){if(e){var n=window.photo;Object(i.remove)(e+"_msg");var a=Object(i.ge)(e);if(a){if(t){var o=Object(i.ce)("div",{id:e+"_msg",className:(a.className||"")+" post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+t+"</div>"),Object(i.after)(o,a),Object(i.hide)(a),Object(i.geByClass1)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else Object(i.show)(e);if(this.photo_id){var r=n.get(this.photo_id);if(r){var s=Object(i.geByClass1)("photoview"),l=Object(i.geByClass1)("comments_wrap",s);r.comments_html=Object(i.val)(l)}}}}}},D={onDone:function(e,t,n,a){if(e){Object(i.remove)(e+"_msg");var o=Object(i.ge)(e);if(o)if(t){var r=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=Object(i.ce)("div",{id:e+"_msg",className:r+"_item "+r+"_message_item"}),l=a||"message_item_cont";Object(i.val)(s,'<div class="'+l+'">'+t+"</div>"),Object(i.after)(s,o),Object(i.hide)(o)}else!1===t?Object(i.hide)(o):Object(i.show)(o)}}},N={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e),o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),s=o+(u<320?r:0)-Object(i.scrollTop)();if(Object(i.remove)(e+"_msg"),a){var l=Object(i.hasClass)("wall_item",a)||Object(i.hasClass)("post",a)?"wall":"post";if(n){var c=Object(i.ce)("div",{id:e+"_msg",className:l+"_item post_message_item"});Object(i.val)(c,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(c,a)}if(t){Object(i.each)(Object(i.geByClass)(l+"_item"),function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),a=Object(i.attr)(this,"data-copy"),o=!!a&&a.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||o&&o[1]==t)&&Object(i.toggleClass)("post_item_ignored",this,n)});var u=Object(i.getCw)(),d=(o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),o+(u<320?r:0)-s);Object(i.geByClass1)("wall_item")===a&&(d=0),Object(i.scrollTop)(d);var _=Object(g.$)(".ContextMenu",a);_&&w.default.close(_)}}}}},H={onDone:function(e,t){if(e){var n=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),n&&t){var a=Object(i.hasClass)("wall_item",n)||Object(i.hasClass)("post",n)?"wall":"post",o=Object(i.ce)("div",{id:e+"_msg",className:a+"_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+t+"</div>"),Object(i.after)(o,n)}Object(i.toggleClass)("post_item_ignored",n,t)}}},V={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),a){if(n){var o=Object(i.ce)("div",{id:e+"_msg",className:"wall_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(o,a)}Object(i.toggleClass)("post_item_ignored",a)}}}},F={onStart:function(){var e=Object(i.gpeByClass)("show_more_wrap",this.link),t=Object(i.geByClass1)("show_more",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"show_more_wrap"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=Object(i.ge)("show_more_wrap"),a=cdf(e);Object(i.before)(a,n),Object(i.remove)(n),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),Gif.onUpdate(),Object(d.resizePosters)()}},U={onStart:F.onStart,onDone:function(e,t){F.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},q={onStart:F.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("photos_page","mcont"),o=Object(i.ge)("show_more_wrap"),r=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),Object(d.resizePosters)()}},W={onStart:F.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("audios_block",Object(i.geByClass1)("audios","mcont")),o=Object(i.ge)("show_more_wrap"),r=cdf(t),s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},z=j({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.ge)(e);a&&a.parentNode&&t&&Object(i.replace)(cdf(t),a.parentNode)}}),Q=j({onDone:function(e,t,n){return void 0===n&&(n={}),n.snackbar&&Snackbar.init(n.snackbar),{wdHTML:e,data:t}}}),Y={onStart:function(){Object(i.addClass)("mva_item_loading",this.link)},onDone:function(e,t){Object(i.removeClass)("mva_item_loading",this.link),e.upload_url||t&&nav.hard_go(t),ownerPhotoUpload&&ownerPhotoUpload.crop(e)||t&&nav.hard_go(t)},onFail:function(){Object(i.removeClass)("mva_item_loading",this.link)}},G={onStart:function(){var e=this.link,t=Object(i.gpeByClass)("notify_lite",e);if(t)return Object(i.remove)(t);for(;e=e.parentNode;)if(Object(i.hasClass)("notify_item",e)){Object(i.hasClass)("notify_panel",e.parentNode)?Object(i.remove)(e.parentNode):Object(i.remove)(e);break}}},X={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)})},onDone:function(e,t,n){var a=window.mail,o=Object(i.ge)("messages"+t);o&&(Object(i.val)(o,e),a.onMessagesRepainted(!0),!this.save&&Object(i.scrollToEl)()),this.save&&a.saveDialog({messages:e},t),this.clear&&(Object(i.val)(Object(i.geByTag1)("textarea","write_form"),""),Object(i.remove)(Object(i.geByClass1)("pi_medias","write_form"))),Object(i.removeClass)("cp_attach_btn_sel",Object(i.geByClass1)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},K={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)})},onDone:function(e,t){var n=window.mail,a=Object(i.ge)("dialogs");a&&(Object(i.val)(a,e),!this.no_scroll&&Object(i.scrollToEl)(),n.cacheDialogsPage()),n.save(t)}},J={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},Z={onStart:function(){var e=Object(i.gpeByClass)("friendsList__showMoreBtnWrap",this.link),t=Object(i.geByClass1)("friendsList__showMoreBtn",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"wait_loading"}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"friendsList__showMoreBtnWrap"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout(function(){ajax.post(t,{_ajax:1},{onDone:Z.onDone.bind(e),onFail:Z.onFail.bind(e)})},500)},onDone:F.onDone},ee=j({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.ge)(e);a&&a.parentNode&&t&&Object(i.replace)(cdf(t),a.parentNode)}}),te=j({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var a=Object(i.geByClass)(e);if(a.length&&t)for(var o=0,r=a.length;o<r;o++)a[o].parentNode&&Object(i.replace)(cdf(t),a[o].parentNode)}}),ne={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,a,o){if(e){var r=Object(i.geByClass)(e);if(r.length&&t)for(var s=0,l=r.length;s<l;s++)r[s].parentNode&&Object(i.replace)(cdf(t),r[s].parentNode);Share.setBookmarkState(a,o),n&&Bookmarks.showSuccessSnack(n);var c=Object(k.parseBookmarkedProductClass)(e);c&&Object(S.trackMarketEvent)({table:"ecomm_goods",event:o?C.EVENT_ADD_ITEM_TO_BOOKMARKS:C.EVENT_REMOVE_ITEM_FROM_BOOKMARKS,ownerId:c.ownerId,itemId:c.itemId,instant:!0})}}},ie=j({onDone:function(e,t,n,a,o,r){if(!e)return{wdHTML:o,data:r};var s=Object(i.ge)(e);if(!s)return{wdHTML:o,data:r};var l=Object(i.geByClass1)("wia_close",s);if(l&&(Object(i.val)(l,n),l.href=t),!Object(i.hasClass)("single_wall_item",s))return{wdHTML:o,data:r};var c=Object(i.ge)("nc_form"),u=Object(i.geByClass1)("wall_replies");return c?Object(i.toggle)(c,!!a):a&&(u?domInsert(u,a):(domInsertAfter(Object(i.ce)("div",{innerHTML:a}),s),u=Object(i.geByClass1)("wall_replies"))),Object(i.toggleClass)("closed_comments",u,!a),{wdHTML:o,data:r}}}),ae={onStart:function(){var e=domPN(this.link),t=Object(i.geByClass1)("Loading",e);t||(t=Object(i.ceFromString)(Object(b.default)({})),append(t,e)),Object(i.addClass)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,a){var o,r=domPN(this.link),s=Object(i.hasClass)("RepliesThreadNext_prev",r),l=0,c=cdf(e);if(domChildren(c).forEach(function(e){Object(i.ge)(e.id)&&re(e)}),s?(o=Object(i.gpeByClass)("wall_replies",r),l=Object(i.getH)(o),Object(i.after)(c,r)):Object(i.before)(c,r),a?(this.link.href=a,Object(i.removeClass)("RepliesThreadNext_loading",r)):re(r),Gif.onUpdate(),Object(d.resizePosters)(),n&&(cur.replyNames=Object(i.extend)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),s){var u=Object(i.getH)(o)-l;Object(i.scrollTop)(Object(i.scrollTop)()+u)}Object(i.onBodyScrollForce)()},onFail:function(){var e=domPN(this.link),t=Object(i.geByClass1)("i_loading",e);Object(i.hide)(t),Object(i.show)(this.link),Object(i.removeClass)("RepliesThreadNext_loading",e)}},oe={onDone:function(e,t,n){var a=Object(i.geByClass1)("RepliesWrap");a.innerHTML=e,Gif.onUpdate(),Object(d.resizePosters)(),n&&Object(i.extend)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),Object(i.scrollTop)(Object(i.getH)(a)+Object(i.getY)(a))}},le={onDone:function(e,t,n,a){if(e){var o=Object(i.ge)(e);if(o){if(a)Object(i.geByClass)("ReplyItem__message_type_"+a,o).forEach(function(e){re(e)});var r=Object(i.geByClass1)("ReplyItem__wrap",o),s=Object(i.geByClass)("ReplyItem__message",o),l=s.pop();if(t){var c=cdf(t);Object(i.hide)(l||r),Object(i.after)(c,l||r),Object(i.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else a||(re(l),l=s.pop()),Object(i.show)(l||r);if(n){var u=Object(i.ge)("RepliesThread"+n);u&&Object(i.toggle)(u,!t)}}}}};window.Like=T,window.PhotoLike=I,window.PhotoTag=M,window.PhotoDelete=x,window.Poll=P,window.CopyHistory=B,window.ToggleMenu=L,window.Comment=R,window.ItemDelete=D,window.FeedIgnore=N,window.FeedIgnoreItem=H,window.FeedIgnoreComments=V,window.Wall=F,window.Bookmark=U,window.BookmarkToggle=ne,window.Photos=q,window.Audios=W,window.FixPost=z,window.ContextMenuCommonAction=Q,window.ProfileMove=Y,window.Notify=G,window.Dialog=X,window.Dialogs=K,window.LoginCheckAuthCodePage=J,window.WallSubscribe=ee,window.FeedSubscribe=te,window.ImportedFriends=Z,window.CloseComments=ie,window.RepliesNext=ae,window.RepliesLast=oe,window.ReplyAction=le,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=Object(i.ge)("mini_apps_"+e.dataset.section);t&&t.remove()}})}};n("AeId"),n("Gzds"),n("kYGI");var ue=n("Qz23"),de=!1,_e={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return!1},opened:function(){return Object(i.hasClass)("lm_opened",window.bodyNode)},toggle:function(e,t){return Object(i.checkEvent)(e),!0},open:function(e){window.zlayer;return Object(i.checkEvent)(e),!0},close:function(e){return Object(i.checkEvent)(e),!0},fix_size:function(e){var t=Object(i.ge)("l"),n=Object(i.ge)("m"),a=Object(i.ge)("mhead"),o=a&&a.offsetHeight||0,r=_e._st||0;t&&n&&(e?n.style.minHeight="0":(r=r>o?r:0,n.style.minHeight=t.offsetHeight+r+"px"),!_e.fixed||Object(i.getCw)()<320?e?n.style.marginTop="0":(t.style.minHeight=Object(i.getCh)()+"px",n.style.marginTop=-r+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},refreshCounters:function(e){if(!e||!e.length)return!0;if(!window.al||!window.al.menu)return!0;if(e.length!=window.al.menu.length)return!1;var t=window.al,n=Object(i.geByClass1)("main_menu","l");Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[2]),Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[3]);var a=e[2];return"number"==typeof a&&isFinite(a)&&(Bell.setCount(a),window.store&&(store.notificationsCount=a)),Object(i.each)(e,function(e,a){if(void 0===a)return!0;var o=t.menu[e],r=Object(i.geByClass1)("mmi_"+o[0],n),s=Object(i.geByClass1)("mm_item",r),l=Object(i.geByClass1)("mmi_wrap",r),c=Object(i.geByClass1)("mm_counter",l);Object(i.attr)(s,"data-href",!1),a?(o[3]&&Object(i.attr)(s,"href",o[3]),c?Object(i.val)(c,a):Object(i.append)(Object(i.ce)("em",{className:"mm_counter",innerHTML:a}),l)):(o[2]&&Object(i.attr)(s,"href",o[2]),Object(i.remove)(c)),ajax.prepare_click(s)}),!0},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&Object(i.val)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&Object(i.val)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&Object(i.val)("lm_bottom_notify",e.bn),e.lm&&Object(i.val)("l",e.lm),e.counters&&_e.refreshCounters(e.counters),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||Object(i.remove)("vk_topbar")},initEvents:function(){var e=_e.getStickedScrollingHandler();e&&(Object(i.onBodyScroll)(e),e(Object(i.scrollGetY)())),Object(i.onBodyResize)(function(){var t=Object(i.ge)("vk_wrap").offsetWidth,n=Object(i.hasClass)("_hfixed",window.bodyNode);t>=882&&_e.close(),_e.fix_size(!_e.opened(),n),e&&e(Object(i.scrollGetY)())})},init:function(){_e.fixed=Object(i.hasClass)("_hfixed",window.bodyNode),_e.initEvents(),Object(i.addEvent)(window,"orientationchange",function(){var e=Object(i.ge)("vk_wrap").offsetWidth,t=_e._st||0;e>=882&&t>44&&_e.close()});var e=Object(g.$)(".leftMenu__content");e&&Object(ue.setScrollView)(e,{topBanner:!!_.default.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=Object(i.ge)("vk_wrap");_e.opened()&&Object(i.getW)(t)<882&&Object(i.preventEvent)(e)},qsOpened:!1,qsOpen:function(){_e.qsOpened||(_e.qs_st=Object(i.scrollTop)(),Object(i.addClass)("qs_opened","vk_wrap"),Object(i.addClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(0),_e.qsOpened=!0)},qsClose:function(){_e.qsOpened&&(Object(i.removeClass)("qs_opened","vk_wrap"),Object(i.removeClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(_e.qs_st||0),_e.qsOpened=!1)},initSearch:function(){de||(de=!0,Object(i.addEvent)("lm_search_items","mousedown touchstart",function(e){e.stopPropagation()},{passive:!0}),Object(i.addEvent)(Object(i.geByClass1)("head_search","l"),"mousedown touchstart",function(e){e.stopPropagation()},{passive:!0}),Object(i.addEvent)(document,"mousedown touchstart",function(e){Object(i.ge)("vk_wrap");_e.qsOpened&&(_e.qsClose(),Object(i.elblur)("lm_search_field"))},{passive:!0}))},closeSearch:function(){return!0},cancelSearch:function(){return!0},headerAction:function(e,t){return Object(i.getW)("vk_wrap")>=882?nav.go(e,t):_e.toggle()},getStickedScrollingHandler:function(){var e=Object(g.$)(".leftMenu__content"),t=document.body;if(e&&t&&t.classList.contains("_hfixed")&&!t.classList.contains("_touch")){var n,a=Object(i.scrollGetY)(),o=Object(i.scrollGetY)(),r=!1,s=function(t,n){void 0===n&&(n=0),e.style.position=t,e.style.top=n+"px",e.style.bottom=""};return function(t){if(!(t<0||t+window.innerHeight>document.body.scrollHeight||Object(i.getCw)()<882)){var l=e.getBoundingClientRect(),c=Math.round(l.top),u=Math.floor(l.height);if(0!==u){var d=document.body,_=document.documentElement;if(u+56>=Math.max(d.scrollHeight,d.offsetHeight,_.clientHeight,_.scrollHeight,_.offsetHeight))s("absolute");else if(!(u+56>_.scrollHeight)){if((t>a||t===a&&t>0)&&(n="down"),t<a&&(n="up"),a=t,u<window.innerHeight)return s("fixed"),void(o=t+c-56);switch(n){case"down":r=u+c<=window.innerHeight;break;case"up":r=0<=c-56}var f,p;r?("down"===n?(f="fixed",void 0===p&&(p=0),e.style.position=f,e.style.top="",e.style.bottom=p+"px"):s("fixed"),o=t+Math.round(e.getBoundingClientRect().top)-56):s("absolute",o)}}else s("absolute")}}}}};window.menu=_e;var fe=n("wTgh"),pe=function(){var e={},t={},n=null,a=!1,o={},r={},s={},l=null;function c(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),function(){var e=+attr(this,"data-id");e&&t.push(e),i=pe.getPeerByMsg(e),replaceClass("_unread","_read",this)}),i){var a=ge("messages"+i);a&&e[i]&&(e[i].messages=val(a))}t.length&&pe.sendMarkAsRead(n,t)}}function u(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!_.mobPlatforms[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function d(e){(0,e.updater)(document.body),each(e.caches,function(t,n){var i=n.storage,a=n.getter,o=function(e,t){var n,i=t.split("."),a=i.length,o=e;for(n=0;n<a;n++)if(!(o=o[i[n]]))return null;return o}(i,a);if(o){var r="string"==typeof o;r&&(o=ce("div",{innerHTML:o})),e.updater(o),function(e,t,n){var i,a,o=t.split("."),r=o.length-1,s=e;for(a=0;a<r;a++)s=s[i=o[a]]||(s[i]={});s[o[r]]=n}(i,a,r?o.innerHTML:o)}})}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo(function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0}),!window.isNewMail&&window.nav&&window.nav.onBeforeGo(function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];pe.actualizeMessagesCornerCounter(n)}catch(e){}}})}),{wrapLinks:fe.wrapLinks,wrapMention:me,onShowDialogFromCache:Object(i.se)(),onShowWritePageFromCache:Object(i.se)(),onShowDialogsPageFromCache:Object(i.se)(),onMessagesRepainted:Object(i.se)(),init:function(t,i){var o=window.im;window.cur.destroy.push(function(){AudioMessagePlayer.detachPlayer()}),i&&(cur.ref=i.ref,cur.refSource=i.ref_source),t&&(n=t,i&&(pe.saveDialog(i,t),e[t])),a||(a=!0,addEvent(document,_.isTouch?"touchstart":"mousedown",c)),setTimeout(function(){o.on()})},unpinMessage:function(t){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach(function(e){return e.classList.remove("head_actions_has_pinned")}),e.$$(".pinnedMsg_peer_"+t).forEach(function(e){return e.classList.add("pinnedMsg_hidden")})}})},pinMessage:function(t,n){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach(function(e){return e.classList.add("head_actions_has_pinned")}),$$(".pinnedMsg_peer_"+t).forEach(function(e){return e.outerHTML=n})}})},clear:function(){nav.clear();var i=window.im;e={},t={},o={},n=null,removeEvent(document,_.isTouch?"touchstart":"mousedown",c),a=!1,i.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,pe.saveDialog(n,t)})},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,function(e,t){o[t]=n})},getPeerByMsg:function(e){return o[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=he("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=l||"",a=e.value||"";i.length==a.length&&i==a||(pe.myTyping(t,n),l=a)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();s[e]&&n-s[e]<5e3||(s[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(r[e]||(r[e]={}),r[e][t]=vkNow()):r[e]=vkNow(),pe.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),a=geByClass1("di_current_peer",i),o=geByClass1("di_typing",i);if(i){var s=[],l=vkNow();if(e>2e9)each(r[e]||{},function(e,n){t(o,"data-u"+e)&&n&&l-n<6e3&&s.push(e)});else{var c=r[e];t(o,"data-u"+e)&&c&&l-c<6e3&&s.push(e)}if(s.length){if(1==s.length){var u=s[0],d=t(o,"data-u"+u),_=t(o,"data-s"+u);val(o,'<i class="i_typing"></i>'+(n.mobile_mail_typing[_]||"").replace("{user}",d))}else{each(s,function(e,n){s[e]=t(o,"data-u"+n)});var f=s.pop();val(o,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",s.join(", ")).replace("{last_user}",f))}a.offsetWidth&&setStyle(o,"minWidth",a.offsetWidth),addClass("di_typing_now",i),setTimeout(function(){addClass("di_typing_animated",i)},10),setTimeout(function(){pe.updateTyping(e)},2e3)}else val(o,""),setStyle(o,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),function(e,t){u(t,n)}),e[t]){if(e[t].write_form){var a=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,a),function(e,t){u(t,n)}),e[t].write_form=val(a)}if(e[t].messages){a=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",a)),e[t].messages=val(a)}}},updateImportantMessages:function(n,i,a){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(he("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+a;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),d({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===a)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(he("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var a=e[n];a&&a.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:a.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach(function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}),a&&a.messages)){var t=ce("div",{innerHTML:a.messages}),n=geByClass1("_msg"+i,t),o=$('.audio-msg-track[data-msg="'+i+'"]',n);o&&o.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),a.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,function(e,n){pe.markAsRead(t,n)})}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var a=geByClass1("_msg"+n,i);hasClass("_read",a)||removeClass("mi_unread",a);var o=e[t];if(o&&o.messages){var r=ce("div",{innerHTML:o.messages});a=geByClass1("_msg"+n,r);hasClass("_read",a)||removeClass("mi_unread",a),o.messages=val(r)}}},markPeerAsRead:function(n,i,a){var o=ge("messages"+n);if(o&&(each(geByClass("msg_item",o),function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)}),(c=e[n])&&c.messages)){var r=ce("div",{innerHTML:c.messages});each(geByClass("msg_item",r),function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)}),c.messages=val(r)}var s=ge("dialogs"),l=a?"di_unread_outbox":"di_unread_inbox";if(s)(c=geByClass1("_peer"+n,s))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c)));else if(t.page){var c;r=ce("div",{innerHTML:t.page});(c=geByClass1("_peer"+n,r))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c))),t.page=val(r)}d({caches:[{storage:nav.page_get(he("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(l,t)&&(removeClass(l,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var a=e[t];if(a&&a.messages){var o=ce("div",{innerHTML:a.messages});remove(geByClass1("_msg"+n,o)),a.messages=val(o)}}ajax.click(he(nav.path),extend({no_scroll:!0},Dialogs))},addMessage:function(t,n,i,a){if(t<2e9?delete r[t]:r[t]&&delete r[t][i],pe.updateTyping(t),!0!==a){if(t&&n&&(o[n]=t),!geByClass1("_msg"+n)){var s=e[t];if(s&&s.messages){s.msgs&&s.msgs.push(n);var l=ce("div",{innerHTML:s.messages});(u=geByClass1("di_activity",l))?(after(cdf(a),u),s.messages=val(l)):s.messages=a+s.messages,(c=ge("messages"+t))&&(val(c,s.messages),pe.onMessagesRepainted(!0))}else{var c,u;if(c=ge("messages"+t))(u=geByClass1("di_activity",c))?after(cdf(a),u):val(c,a+val(c))}}}else if(ge("dialogs")&&"/mail"==nav.path){var d=nav.getQuery();d.act||d.offset||d.q||ajax.click(he(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,a){var o=ge("messages"+t),r=e[t];if(r&&r.messages){var s=ce("div",{innerHTML:r.messages}),l=geByClass1("_msg"+n,s);l&&(l.outerHTML=a),r.messages=val(s),val(o,r.messages)}else geByClass1("_msg"+n).outerHTML=a},getMsgHTML:function(t,n,i,a,o,r,s,l){var c=window,u=c.vk,d=c.lang,_=2&n?u.id:s&&s.from||i;if(!_)return!1;if(!ge("messages"+i))return!0;if(s.attach1||s.fwd||s.geo||s.emoji)return!1;if(s.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var f="_u"+_,p=geByClass1(f,"mcont","a"),h=stripTags(attr(p,"data-name")||val(p)||""),m=getHref(p),v=geByClass1(f,"mcont","img"),A=v&&v.src||"";if(!h||!m||!A)return!1;i=intval(i),t=intval(t),o=o&&-1==o.toString().indexOf(" ... ")&&i<2e9?o:"";var g,b,y,w=1&n?" mi_unread":"";return!(2&n)&&1&n&&(w+=w?" _unread":""),r=pe.wrapLinks(r,n),r=pe.wrapMention(r),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+he("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,f).replace(/{{href}}/g,m).replace("{{msgClass}}",w).replace("{{edited}}",l?'<span class="mi_edited">'+d.mobile_mail_edited+"</span>":"").replace("{{photo}}",A).replace("{{time}}",(g=new Date(1e3*a),b=g.getHours(),y=g.getMinutes(),b+":"+(y<10?"0":"")+y)).replace("{{dataName}}",escapeAttr(h)).replace("{{name}}",h.split(" ").shift()).replace("{{mi_title}}",o?'<div class="mi_title">'+o+"</div>":"").split("{{text}}").join(r)},updateStickers:function(){var t=window.cur,i=window.post,a=e[n];if(a){var o=a.write_form?(t.sticker_panel||"").split("mail-0").join("mail"+n):"",r=ge("stickers_panel");r&&(replace(cdf(o),r),r=null,i.stickersInit())}},showDialog:function(i,a,o){var r=window.cur,s=window,c=s.MessagesActions,u=s.Mention,d=s.Dialog,_=window.post;if(c.hasFwdMessages())return c.attachFwdMessages(a),!1;t.scroll_top=scrollTop();var f=e[a];if(f){var p=ce("div",{innerHTML:val("m")}),h=geByClass1("mhb_back",p);if(h&&f.header){var m=ce("div");val(m,f.header),before(m.firstElementChild,h),remove(h)}var v=f.write_form?(r.sticker_panel||"").split("mail-0").join("mail"+a):"";val(geByClass1("pcont",geByClass1("mcont",p)),f.write_form+v+(a?'<div id="messages'+a+'" class="messages bl_cont">'+(f.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",p.innerHTML),_.stickersInit(),ajax.refreshLinks(f.fv_link,f.app_link),alLoadingFix(),n=a,f;var A=getHref(i);nav.go(A,null,{push_only:!0,no_push:o}),a?(l=null,pe.updateTyping(a),ajax.click(A,extend({save:a},d),{scroll:!0})):pe.onShowWritePageFromCache(!0),pe.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(f&&f.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var g=geByClass1("MentionContainer"),b=parseJSON(attr(g,"data-mentions"))||[];return b.length&&u.init({url:!1,appendTo:g,defaultItems:b,items:b,preferDomain:!0}),AudioMessagePlayer.events.on("listened",pe.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),pe.onShowDialogsPageFromCache(!0);else{var i=he(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(he("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function he(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,a=n&&-1===e.indexOf("community=")?"community="+n:"",o=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return a?e+(e.indexOf("?")>=0?"&":"?")+a+o:e}function me(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,function(e,t,n,i,a){return'<a href="/'+(t+n)+'" class="mem_link">'+a+"</a>"})}window.mail=pe,window.makeUrl=he,window.Scroller=function(e,t){var n,i,a,o,r,s=t&&t.ignoreMouseWheel,l=t&&t.noAutoScroll,c=!isUndefined(document.ontouchmove),u=!0,d=!1,f=!1,p=!1,h=!1,m=0,v=0,A=!1,g=0,b=!1,y=!1,w=!1,k=!1;function S(e){var t=e.touches,n=getX(i),a=getY(i);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-a}}function C(e){A||(A=[]),A.push([vkNow(),e]),A=A.slice(-20)}function O(){A=!1}function E(){if(!A||A.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=A.pop(),i=A.length-1;i>=0;i--){if((a=e-A[i][0])>150)break;t=A[i]}if(!t||!n)return[0,0,0];var a,o=n[1].x-t[1].x,r=n[1].y-t[1].y,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}function j(e){"touchstart"==e.type?u=!e.touches||1==e.touches.length:"touchmove"==e.type?u=!1:"click"==e.type&&(u||(cancelEvent(e),u=!0))}function T(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||k&&e.touches&&e.touches.length>1)){if(O(),f){if(v<=1)return}else if(getW(i)-getW(a)>=0)return;p=S(e),C(h=p),w=!0,setStyle.animate(a)}}function I(e){if(p&&(k||w)){thover&&thover.cancel(e);var t=S(e);if(C(h=t),w){var n=p.x-t.x,o=p.y-t.y;if(Math.abs(n)>=Math.abs(o)&&(cancelEvent(e),k=!0),w=!1,k){var r=getY(i),s=getH(i),c=scrollTop(),u=getCh();!l&&(r-7<c?scrollTop(r-7):r+s+7>c+u&&scrollTop(r+s+7-u))}}if(k)if(cancelEvent(e),f){var _=getW(i);n=p.x-t.x;(m<=0&&n<0||m>=v-1&&n>0)&&(n/=3);var A=-m-n/_,b=d?100*A+"%":A*_;setStyle.transform(a,{translate:[b,0]})}else{var y=getW(i)-getW(a);n=p.x-t.x;if(y>0&&(y=0),(A=g-n)<y)b=y-(y-A)/3;else if(A>0)b=0+(A-0)/3;else b=g-n;B(b),setStyle.transform(a,{translate:[b,0]})}}}function M(e){if(p&&k){if(cancelEvent(e),f){var t=4.7*E()[1],n=p.x-h.x,o=getW(i),r=Math.abs(n)>=o/2;(m>0&&(r&&n<0||t>1)||m<v-1&&(r&&n>0||t<-1))&&(m+=n>0?1:-1);var s=-m,l=d?100*s+"%":s*o;p=!1,O(),L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}else{var c=function(){if(!A)return!1;var e=E(),t=e[0],n=e[1];if(O(),!t)return!1;var i=t/4.7,a=n*i-4.7*i*i/2;return i*=530,a*=140,clog("dx",a,"t",i),!(t<.1||!a)&&{dx:a,t:i}}(),u=getW(i)-getW(a);n=p.x-h.x,s=g-n;c&&(s+=c.dx),u>0&&(u=0),g=s<u?u:s>0?0:s;var _={duration:200,func:"ease"};c&&(_={duration:c.t,func:"cubic-bezier(0, 1, 1, 1)"}),B(g),setStyle.animate(a,"transform",_),setStyle.transform(a,{translate:[g,0]})}k=!1}}function x(e){if(!(s||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),f){if(v<=1)return}else if((n=getW(i)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===b&&(b=0),b+=t,!f){var n=getW(i)-getW(a),o=g-b;if(n>0&&(n=0),o<n)var r=n-(n-o)/3;else if(o>0)r=0+(o-0)/3;else r=g-b;B(r),setStyle.transform(a,{translate:[r,0]})}clearTimeout(y),y=setTimeout(function(){if(f){(m>0&&b<0||m<v-1&&b>0)&&(m+=b>0?1:-1);var e=-m,t=getW(i),n=d?100*e+"%":e*t;L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var o=getW(i)-getW(a);o>0&&(o=0),(e=g-b)<o?g=o:e>0?g=0:g-=b,B(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]})}b=!1},200)}}function P(e){if(f){var t=m;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),o=+attr(n,"data-i");m=o<0?0:o>v-1?v-1:o}p=!1,O(),k=!1;var r=getW(i),s=-m,l=d?100*s+"%":s*r;L(),t!=m&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}}function B(e){if(!f){e=e||g;var t=getW(i)-getW(a);toggleClass("sw_left",i,e<0),toggleClass("sw_right",i,e>t)}}function L(){if(f){var e=geByClass1("sp_ppt_sel",n);e&&e===r[m]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",r[m]))}}extend(this,{init:function(){i=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",i),f?(o=geByClass1("sp_pages_pts",n),r=geByClass("sp_ppt",o),v=(geByClass("scroller_page",a)||[]).length,m=0,L()):B(g=0),A=!1,setStyle.transform(a,{translate:[0,0]}),c?(addEvent(i,"touchstart touchmove click",j),addEvent(i,"touchstart",T),addEvent(i,"touchmove",I),addEvent(i,"touchend touchcancel",M)):(addEvent(i,"mousewheel",x),addEvent(o,"click",P)),d||onBodyResize(P)},destroy:function(){c?(removeEvent(i,"touchstart touchmove click",j),removeEvent(i,"touchstart",T),removeEvent(i,"touchmove",I),removeEvent(i,"touchend touchcancel",M)):(removeEvent(i,"mousewheel",x),removeEvent(o,"click",P)),d||onBodyResize("__clear",P)},onShow:function(){f?L():B(g)},canClick:function(){return u}}),n=e,(t=t||{}).byPage?(f=!0,d=!_.default.android):(f=!1,d=!1,this.showElem=function(e){if(!f){var t=getX(e)-getX(i),n=t+g,o=n+getW(e),r=getW(i),s=!1;n<0?s=0-t+20:o>r&&(s=r-getW(e)-t-20);var l=getW(i)-getW(a);if(l>0&&(l=0),s<l)s=l;else if(s>0)s=0;clog(t,g,n,o,0,r,s),!1!==s&&(B(g=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]}))}})};var ve=n("izth"),Ae=function(){var e=null,t={},n=1,i=null,a=!1,o=!1;function r(){n<64&&(n*=2)}function l(e,t){var n=window.al;if(!1===e&&(e=getNotify()+(t||1)),setNotify(e),window.al&&window.al.menu){var i=new Array(n.menu.length);i[3]=e,menu.refreshCounters(i)}}function c(e){return Object.keys(e).some(function(e){return-1!==e.indexOf("attach")})||e.fwd||e.emoji||e.geo}function u(e,t,n){var i=toInt(e.from_admin)||null,a=toInt(nav.getQuery("community"));return i&&a?a:2&t?window.vk.id:toInt(e.from)||n}function d(){return Number(nav.getQuery("offset"))>0}function _(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:Object(s.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(s.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(s.default)("msgId","dialogId"),onMsgReadByOther:Object(s.default)("msgId","dialogId"),onOnlineChange:Object(s.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(s.default)("dialogId","authorId"),onMultiTyping:Object(s.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(s.default)("msgId"),onMsgImportantAdd:Object(s.default)("msgId"),onMsgRemove:Object(s.default)("msgId"),onMsgRestore:Object(s.default)("msgId"),onPeerKeyboard:Object(s.default)("peerId"),onPeerBanner:Object(s.default)("peerId"),onDialogImportant:Object(s.default)("peerId","isImportant"),onUnreadCount:Object(s.default)("count"),onResync:Object(s.default)(),isLongPollingEnabled:function(){return!!a},init:function(t){e||(Object(ve.setDocumentDomain)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady(function(){append(e,window.bodyNode),!0})),Ae.refreshParams(t),setTimeout(Ae.check,1e3)},on:function(){clog("[longpoll] start"),a=!0,setTimeout(Ae.check,1e3)},off:function(){clog("[longpoll] pause"),a=!1},refreshParams:function(e){extend(t,e||{}),extend(Ae,t)},getKey:function(){if(i)try{i.abort()}catch(e){}i=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(Ae.refreshParams({key:e}),Ae.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(Ae.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),r()}})},check:function(){if(a&&!o)if(Ae.makeRequest)try{Ae.makeRequest(function(e,t){if(o=!1,a)if(window.vk.__debug)Ae.checked(parseJSON(t))&&(Ae.check(),n=1);else try{Ae.checked(parseJSON(t))&&(Ae.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(Ae.check,1e3*n),r()}},function(){o=!1,setTimeout(Ae.check,1e3*n),r()}),o=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(Ae.check,1e3)},checked:function(e){var i,a,o,s=e.failed;if(1==s||t.ts>=e.ts+256){if(Ae.refreshParams({ts:e.ts}),s)return!0}else{if(2==s)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(Ae.getKey,1e3*n),r(),!1;if(s)return void clog("[longpoll]",e)}if(Ae.refreshParams({ts:e.ts}),e.updates){var f=[],p=!1;for(var h in e.updates){if(116==e.updates[h][0])var m=e.updates[h][1],v=[e.updates[h][0],m.id,m.flags,m.peer_id,m.date,m.title||"",m.message,m.kludges,m.random_id];else v=e.updates[h];var A=intval(v[0]),g=intval(v[1]),b=intval(v[2]),y=intval(v[3]);if(1===b){if(10===A){mail.updateImportantDialog(g,!1);continue}if(12===A){mail.updateImportantDialog(g,!0);continue}}if(8&b){if(2===A){if(window.isNewMail){Ae.onMsgImportantAdd(g);continue}mail.updateImportantMessages(y,g,1);continue}if(3===A){if(window.isNewMail){Ae.onMsgImportantRemove(g);continue}mail.updateImportantMessages(y,g,-1);continue}}if(51!=A)if(61!=A)if(62!=A)if(8!=A)if(9!=A)if(6!=A&&7!=A)if(80!=A||!g||nav.getQuery("community"))if(52!=A){if(y)if(4!=A&&5!=A&&116!=A)if(0!=A)if(2!=A);else{if(128&b){if(window.isNewMail){Ae.onMsgRemove(g);continue}mail.markAsDeleted(y,g)}window.isNewMail&&64&b&&Ae.onMsgRemove(g)}else{if(window.isNewMail){Ae.onMsgRemove(g);continue}mail.markAsDeleted(g)}else{var w=5==A||116==A;if(window.isNewMail){var k=v,S=k[1],C=k[3],O=k[4],E=k[6],j=k[7],T=void 0===j?{}:j,I=k[8],M=c(T),x=(i=void 0,a=void 0,o=void 0,i=new Date(1e3*O),a=i.getHours(),o=i.getMinutes(),a+":"+(o<10?"0":"")+o),P=toInt(T.from_admin)||null,B=(toInt(nav.getQuery("community")),u(T,b,C)),L=!!T.source_act,R=T.keyboard?_(T.keyboard):null;if(w){var D={peerId:C,msgId:S,authorId:B,text:E,date:x,hasAttachments:M,flags:b,adminId:P,randomId:I};116==A?D.refreshed=1:D.edited=Math.floor(Date.now()/1e3),Ae.onEditMsg(D)}else Ae.onNewMsg({peerId:C,msgId:S,authorId:B,text:E,date:x,hasAttachments:M,flags:b,adminId:P,randomId:I,isService:L,keyboard:R});continue}var N=window.vk,H=2&b?N.id:v[7]&&v[7].from||y,V=v[7]&&v[7].source_act;p||(p=!!need("PinnedMsg").getByMsgId(g));var F=v[7].from_admin||V||p?null:mail.getMsgHTML(g,b,y,v[4],v[5],v[6],v[7],116!=A?w:"");if(F&&(w?mail.replaceMessage(y,g,H,F):d()||mail.addMessage(y,g,H,F),2&b||nav.getQuery("community")||l(!1,1)),"chat_kick_user"===V&&v[7].source_mid==N.id){var U=v[3];mail.unpinMessage(U)}F&&"chat_pin_message"!==V&&"chat_unpin_message"!==V||f.push({peer:y,msg_id:g,from_id:H,source_act:V,edited:w})}}else{var $=v,q=$[1],W=$[2];if(!window.isNewMail)continue;11==q&&Ae.onPeerKeyboard(W),10==q&&Ae.onPeerBanner(W)}else l(g);else{if(window.isNewMail){var z=v[1],Q=v[2];6===A?Ae.onMsgReadByMe(Q,z):Ae.onMsgReadByOther(Q,z);continue}mail.markPeerAsRead(g,b,7==A)}else{if(window.isNewMail){Ae.onOnlineChange({userId:-g,isOnline:!1,lastActionTime:y});continue}mail.updateOnline(-g,0)}else{if(window.isNewMail){Ae.onOnlineChange({userId:-g,isOnline:!0,onlinePlatform:7===(b||7)?"desktop":"mobile"});continue}mail.updateOnline(-g,b||7)}else{if(window.isNewMail){var Y=2e9+b,G=g;Ae.onTyping(Y,G);continue}mail.typing(2e9+b,g)}else{if(window.isNewMail){var X=g,K=g;Ae.onTyping(X,K);continue}mail.typing(g)}}if(f.length){var J=[];each(f,function(e,t){J.push(t.msg_id)});var Z={_ajax:1,act:"get_messages",msgs:J.join(","),community:nav.getQuery("community")};p&&(Z.force_pinned=1),ajax.post("/mail",Z,{onDone:function(e,t){var n=window.cur,i=d();each(f,function(t,n){var a=e[n.msg_id],o=n.peer;a.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,a.text):mail.addMessage(n.peer,n.msg_id,n.from_id,a.text)),a.unpin&&mail.unpinMessage(o),a.pinned&&mail.pinMessage(o,a.pinned)}),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}(),be=Ae,ye=n("WwUR");window.isNewLongpoll?window.im=ye.default:window.im=be;n("gNTM"),n("eoxF");var we={};function ke(e){var t,n,i;ke.getQueryREs=q;var a,o,r,s,l,c,u,d,_,f,p,h=!1,m=[],v={},A={},g={},b={},y=!1,w=null,k=null,S=null,C=0,O=[],E=null,j=null,T=null,I=!1,M=!1,x=10,P=30,B=[],L=!0,R=!1,D=!1,N=!1,H=0,V=0,F=!1,U={},$=e&&"au_search_field"===e.field&&attr(ge(e.field),"data-newsearch");function q(e){e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var t,n,i,a=M,o=[e,n=parseRusKeys(e,a)||e,i=parseLatKeys(e,a)||e,parseLat(n),parseCyr(i)],r={},s=[],l=0,c=o.length;l<c;l++)o[l]&&!r[o[l]]&&(r[o[l]]=!0,t=(t=escapeRE(o[l])).replace(/[её]/gi,"[её]").replace(/(e|yo)/gi,"(?:e|yo)"),s.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return s}function W(e,n,i,o){if(clearTimeout(k),!i)return k=setTimeout(function(){W(e,n,!0)},10),!1;var r=val(e)||"";if(w===r&&!o)return!1;var s,_="_"+r,f=A[_],p=q(r);if(!$&&!f&&r.length>2&&A["_"+r.slice(0,-2)]){var h="_"+r.slice(0,-2);A[h]&&b[h]&&!A[h].length&&(!N||N&&!g[h])&&(b[_]=!0,f=A[_]=[],N&&(g[_]=""))}o&&(delete b[_],delete A[_],delete g[_]);var y=0;if(!f){f=[];if(Se.isCachedPage)y=(geByClass1("_si_container",a)||a).childNodes.length;if(!r&&m.length)for(var O=C,E=C+Math.min(Math.max(x,y),m.length);O<E;O++)f.push([m[O]]),0;else{var j={},T=0;for(O=0,E=m.length;O<E;O++){var M=m[O];if(v[M]){if(j[M]=!0,(s=z(p,v[M][0]))&&(f.push([M,s]),++T>=P))break;0}}if(T<P)for(var M in v)if(!j[M]&&(s=z(p,v[M][0]))){if(f.push([M,s]),++T>=P)break;0}}b[_]=b[_]||!r&&m.length||f.length>2*x,b[_]=b[_]||N&&f.length>x}return(b[_]||!L&&!N)&&!o||c||function e(n,i,o){var r=$?800:200;clearTimeout(S);if(!o)return S=setTimeout(function(){e(n,i,!0)},r),!1;ajax.post(t,{_ajax:1,q:i},{onDone:function(e,t,a){u&&u.apply(null,arguments);for(var o,r="_"+i,s=A[r]||[],c={},d=q(i),_=0;_<s.length;_++)c[s[_][0]]=!0;for(var f=0;f<t.length;f++){var p=t[f];c[p]||((o=z(d,e[p][0]))||I||!i)&&s.push([p,o])}b[r]=!0,A[r]=s,N&&(g[r]=a||""),v=extend(e,v),U._cache=v,L=!R||len(v)<R,w===i?(Q(s,g[r]),onBodyScrollForce()):delete A[r],L||removeClass("input_loading",n),l&&(L=!1,R=Object.keys(v).length)},onFail:function(){delete A["_"+i],removeClass("input_loading",n)}});geByClass1("al_loading",a)||addClass("input_loading",n)}(e,r),A[_]=f,w=r,Q(f,g[_]),d&&d(r),D&&!w&&(H=Math.max(x,y)),onBodyScrollForce(),!1}function z(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([№])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var a=0;a<n.length;a++)for(var o=0,r=e.length;o<r;o++)if(-1!==n[a].search(e[o]))return e[o];return!1}function Q(e,t){var n="";if(j&&a){var i=Object.keys(B).filter(function(e){return!!B[e]}).map(function(e){return e+""});i.length&&""===w&&(e=e.filter(function(e){return!i.includes(String(e[0]))}),i.forEach(function(t){e.unshift([t,!1])}));for(var r=function(t){var i=e[t],a=i[0],o=i[1];if(!v[a])return"continue";var r=v[a].slice(1);if(o)for(var s in O){var l=O[s];r[l]&&(r[l]=r[l].replace(o,'$1<em class="found">$2</em>'))}n+=j.apply({id:a,q:w,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(o,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,function(e,i,a){return a&&t[a-1]?n.highlight(t[a-1]):i&&t[i-1]?t[i-1]:""})}},r)},l=0;l<e.length;l++)r(l);if(!n&&!b["_"+w]&&(L||N)&&!c){removeClass("_si_container_loading",a);var u=Wd.html({class:"al_loading qs_loading",inner:SVGIcon("wall","loading_40")});n=w?u:'<div id="al_loading"></div>'}if(!n&&T&&(n=T(w)),removeClass("input_loading",o),t||n!==p){var d=E?E(n,w,D,t):n+(t||"");val(a,d)}p=n,s&&(w?show(s):hide(s)),!w&&alLoadingFix(),_&&_(w)}}extend(this,{go:function(e){return!o||(W(o,e,!0,!0),o.blur(),cancelEvent(e),!1)},redraw:function(){var e="_"+w;Q(A[e],g[e]),onBodyScrollForce()},clear:function(e,t){return val(o,""),t?elfocus(o):elblur(o),W(o,e,!0),cancelEvent(e),!1},blur:function(){elblur(o)},toggleAttach:function(e,t){B[e]=t},init:function(e){if(e=e||{},a=ge(e.container)||null,o=ge(e.field)||null,r=ge(e.btn)||null,s=ge(e.clear_btn)||null,w=null,!y||t!=e.action||!e.init_once){A={},g={},b={},t=e.action||"",h=null!==e.next_from,i=e.next_from,n=e.al_action||t,m=e.top_items||[],v=e._cache||{},O=e.hl_fields||[],E=e.tpl||null,j=e.item_tpl||null,T=e.null_tpl||null,I=e.soft_filter||!1,M=e.need_invalid_keys||!1,x=e.top_len||10,R=e.load_limit||!1,u=e.onLoaded||!1,d=e.onFiltered||!1,_=e.onRendered||!1,f=e.onFocusChanged||!1,D=e.al_need||!1,C=!D&&e.init_offset||0,N=e.global_search||!1,c=e.no_search_query||!1,l=e.load_once||!1;var p=e.action+e.container;we[p]?U=we[p]:(U._cache=v,U.top_items=m,we[p]=U),Se.isCachedPage&&(m=U.top_items,v=U._cache)}var k=null;t&&a&&o&&j&&(L=!0!==t&&(!R||len(v)<R),addEvent(o,"focus",function(e){e&&e.preventDefault();clearTimeout(k),f&&f.call({q:w},!0),function t(n){!n&&W(o,e,!0),k=setTimeout(t,100)}(!0)}),addEvent(o,"keydown keypress change blur",function(e){"blur"==e.type&&(clearTimeout(k),f&&f.call({q:w},!1)),W(o,e,"keydown"!=e.type&&"keypress"!=e.type)}),e._new||r&&!attr(r,"onclick")&&attr(r,"onclick","return qsearch.go(event);"),!D||y&&e.init_once||(H=x,V=len(v),initAutoScroll(function(){var e=(geByClass1("_si_container",a)||a).childNodes;return e[H]||e[e.length-1]},function(){var e=geByClass1("_si_container",a)||a;if(!F&&!w){if(h?!!i:H+x>V&&L)F=!0,addClass(e,"_si_container_loading"),ajax.post(n,{_ajax:1,offset:V,next_from:i},{onDone:function(n,a,o){i=o,u&&u.apply(null,arguments);var r=len(n);if(F=!1,removeClass(e,"_si_container_loading"),R||(m=m.slice(0,V).concat(a),U.top_items=m),V+=r,v=extend(n,v),U._cache=v,L=!0!==t&&(!R&&r||len(v)<R),!w){H+=x;for(var s=[],l=0,c=Math.min(H,m.length);l<c;l++)s.push([m[l]]);Q(s,g._),onBodyScrollForce()}},onFail:function(){F=!1,removeClass(e,"_si_container_loading")}});else if(H<m.length){H+=x;for(var o=[],r=0,s=Math.min(H,m.length);r<s;r++)o.push([m[r]]);Q(o,g._),onBodyScrollForce()}}})),!e.skip_init_filter&&W(o,null,!0),y=!0)}}),e&&this.init(e)}var Se=new ke;window.QuickSearch=ke,window.QuickSearchCache=we,window.qsearch=Se;var Ce={onClose:Object(s.default)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){Ce.inited||(Ce.inited=!0,Ce.initEvents())},initEvents:function(){var e=function(e){Ce.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==Ce.opened&&toggleClass("z_opened",window.bodyNode,Ce._opened),Ce._opened},toggle:function(e,t){return!!checkEvent(e)||(Ce.opened()?Ce.close(e,t):Ce.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||!Ce.opened()&&(thover.clear(),Ce.init(),Ce._st=scrollTop(),Ce._lastNav=!1,addClass("z_opened",window.bodyNode),Ce._opened=!0,Ce.fixHeight(vkNow()+2e3,!0),scrollTop(0),!1)},close:function(e,t){return!!checkEvent(e)||!!Ce.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),Ce._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},Ce._opened=!1,Ce._destroy&&(Ce._destroy(),Ce._destroy=!1),scrollTop(Ce._st,1),Ce._st=!1,Ce.onResize=null,Ce.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(Ce.width=e.offsetWidth,Ce.height=e.offsetHeight,Ce.onResize&&Ce.onResize())},fixHeight:function(e,t){if((Ce._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),i=getCh();(Ce._lastWidth!=n||Ce._lastHeight!=i||t)&&(Ce._lastWidth=n,Ce._lastHeight=i,setStyle("z","height",i),Ce.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(Ce._fixTo),Ce._fixTo=setTimeout(Ce.fixHeight,50,e)}},create:function(e,t){val("z",e),Ce._destroy=t}};window.zlayer=Ce;var Oe=n("rc7J"),Ee=n("0Nfb"),je=n("fdw3"),Te=n("GVTI"),Ie=n("J8bf"),Me=window.isPVRedesign;window.photo=Me?{}:function(){var e,t,n,i,a,o,r,s,l,c,u,d,_,f,p=1,h=!1,m={},v={},A={},g=null,b=null,y=!1,w=null,k=null,S=!0,C=0,O=!1;function E(){if(!(e=geByClass1("photo_view","m")))return nav.al_go(nav.cur),!1;if(t=geByClass1("pv_summary",e),geByClass1("photo_msg",e),u=geByClass1("pv_tag_wrap",e),a=geByClass1("pv_body",e),o=geByClass1("thumb_item",a),i=geByClass1("pv_nav",a),l=geByClass1("pv_photo_wrap",o),r="a"==tag(o)&&o,s=geByTag1("img",o),c=geByClass1("pv_footer",e),(n=geByClass1("summary_loading",t))||(n=ce("div",{innerHTML:'<i class="i_loading"></i>',className:"summary_loading"},{display:"none"}),t.appendChild(n)),h=hasClass("pv_touch_full",a),i){var p=geByClass1("pv_nav_left",i),m=geByClass1("pv_nav_z",i),v=geByClass1("pv_nav_right",i);d=geByClass1("pv_nav_link",p),f=geByClass1("pv_nav_link",m),_=geByClass1("pv_nav_link",v),attr(d,"onclick","return photo.prev(event);"),attr(_,"onclick","return photo.next(event);"),attr(r,"onclick",!h&&"return photo.next(event);"),ajax.prepare_click([d,_,r])}return removeEvent(window,"orientationchange",L),addEvent(window,"orientationchange",L),!0}function j(){var t=window.photoview;return!!t&&(!!O||(O=!0,t.onPhotoChange=function(e,t){C=e,D(e,t)},t.onUpdate=function(){},t.onClose=function(t){if(uRegisterFloatBtn.show(),!function(e){var t=qs2obj(nav.params);if(delete t.z,!e.local&&!e.crop){if(nav.tryHistoryBack())return!1;var n=nav.path+obj2qs(t)+nav.hash;nav.go(n,null,{push_only:!0})}return!0}(t))return!0;var n=qs2obj(nav.params);e&&n.list==b&&R(C,!0)},!0))}function T(e){var t=window.photoview,n=[];return each(e,function(e,t){if(!t)return!0;n.push(m[t.id]=t)}),g&&t&&t.saveSource(P(g)),n}function I(e){return m[e]||{}}function M(e,t,n){if(null!==t){v[e]||(v[e]=new Array(n||len(t))),T(t);var i=v[e];y&&i.reverse(),extend(i,t),y?(g=copy(i),i.reverse()):g=i}else delete v[e]}function x(e){if("string"!=typeof e)return e;var t=v[e]||[];return y?copy(t).reverse():t}function P(e){var t=x(e),n=new Array(t.length),i=qs2obj(nav.params);for(var a in delete i.z,t){var o=g[a],r="",s="";o.hash&&(s=obj2qs({hash:o.hash,mp4:!0})),o.isDoc?(r="doc"+o.id+s,n[a]={id:o.id,photo_url:"/"+r,src:o.original_src,isDoc:!0,hasVideo:o.hasVideo}):(r="photo"+o.id+"?list="+b+(y?"&rev=1":"")+(k?"&from="+k:""),n[a]={id:o.id,photo_url:"/"+r,like_url:"/like?act="+(o.likes_me?"del":"add")+"&object=photo"+o.id+"&from="+encodeURIComponent(r)+"&list="+b+"&hash="+o.like_hash,likes_me:o.likes_me,src:o.original_src,max_src:o.max_src,tags:o.tags,caption:o.caption,likes_cnt:o.likes_cnt,replies_cnt:o.replies_cnt,market_tags:o.market_tags})}return n}function B(e,t){for(var n in t||(t=g),t)if(g[n].id==e)return+n;return-1}function L(){nav.hash||onDOMReady(function(){if(geByClass1("photo_view")){var e=scrollTop();a&&getY(a)<e&&scrollToEl(a)}})}function R(n,i,o){var m=window.cur,v=window.lang,b=g[n],O=1==g.length;if(b){nav.hash?scrollToHash(nav.hash):L();var E={};w&&(E.list=w),y&&(E.rev=1),k&&(E.from=k);var j=obj2qs(E),T="photo"+b.id+j,I=b.photo,M=(H(n-1)||{}).id,x=(H(n+1)||{}).id;if(O||(r.href="/photo"+x+j,d&&(d.href="/photo"+M+j),_&&(_.href="/photo"+x+j),ajax.prepare_click([d,_,r])),h){var P="photo"+b.id+"/"+w+(y?"/rev":""),B=extend({},E,{z:P}),R="/photo"+b.id+obj2qs(B);if(zlayer._lastNav){var D=zlayer._lastNav;(B=qs2obj(D.params)).z=P,R=D.path+obj2qs(B)+D.hash}f&&(f.href=R),ajax.prepare_click(f),attr(f,"onclick","return photo.fullscreen('"+escapeAttr(R)+"', event);")}if(s&&s.src!=I){s.onload=null,remove(s);var N="";each(b.tags,function(e,t){if(!e||0==e)return!0;var n=t[0][0],i=t[0][1],a=t[0][2],o=t[0][3];N+='<div class="pv_tag" style="left: '+n+"%; top: "+i+"%; width: "+a+"%; height: "+o+'%;" id="pv_tag'+e+'" onclick="return photo.selectTag('+e+', event, true);"><div class="fill"></div></div>'}),val(l,'<img src="'+I+'" alt="" class="ph_img" />'+N),s=geByTag1("img",l)}toggleClass("photo_deleted",e,!!b.deleted),toggleClass("pv_one_photo",a,1==g.length),val(t,(v.mobile_photos_photo_header||"").replace("%s",C+1).replace(/%s|{count}/,g.length)),val(u,b.tag_info||"");var F="",U=(m.sticker_panel||"").split("photo-0_0").join("photo"+b.id),$=(b.comments_html||"").split("\x3c!--stickers_panel--\x3e").join(U);if(b.caption&&(F+='<div class="mv_description">'+b.caption+"</div>"),b.tags_list&&(F+='<dl class="pv_tags_list si_row"><dt>'+v.mobile_photos_on_this_photo+"</dt><dd>"+b.tags_list+"</dd></dl>"),b.was_edited&&(F+='<dl class="si_row"><dt>'+v.mobile_photos_photo_was_edited+"</dt></dl>"),b.album_link&&(F+='<dl class="si_row"><dt>'+v.mobile_photos_photo_album_label+"</dt><dd>"+b.album_link+"</dd></dl>"),b.author_link&&(F+='<dl class="si_row"><dt>'+v.mobile_photos_photo_author_label+"</dt><dd>"+b.author_link+"</dd></dl>"),(b.date||b.likes||b.publish)&&(F+='<div class="vi_values">'+(b.date||"")+(b.likes||"")+(b.publish||"")+"</div>"),val(c,'<div class="like_box bl_cont"><div class="photo_msg bl_none">'+(b.deleted||"")+'</div><div class="mv_details">'+F+'</div><ul class="mv_actions">'+(b.actions||"")+'</ul></div><div class="comments_wrap bl_cont">'+$+"</div>"),post.stickersInit(),m.replyTo=0,ajax.refreshLinks(b.fv_link,b.app_link),photo.closeTags(),!i){var q="/"+T;nav.go(q,null,{no_push:i,push_only:!0,replace:o}),page.save(q,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}}S||(V(),function(){for(var e=0,t=C+1;e<p;e++){var n=H(e+t),i=n&&n.photo;if(i&&!A[i]){var a=A[i]=new Image;a.src=i,a.onload=function(){A[i]=!0}}}}())}function D(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,o=n.hasVideo,r=window.photoview,s=g[e];g.length;if(s){var l=qs2obj(nav.params);if(l.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+w+(y?"/rev":""),t.no_open||r.open(e,P(g),{local:t.local,isDoc:i,hasVideo:o}),!t.local&&!t.crop){var c=nav.path+obj2qs(l)+nav.hash;nav.go(c,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0})}}t.local||t.crop||V(!0,i)}var N=!1;function H(e){return e>0?e%=g.length:e=(100*g.length+e)%g.length,g[e]}function V(e,t){if(void 0===t&&(t=!1),!N){for(var i=window.photoview,a=!1,o=1,r=0;r<5;r++){if(!(l=H(s=r+C))||!l.owner_id){a=s,o=1;break}}if(!1===a)for(r=-1;r>-3;r--){var s,l;if(!(l=H(s=r+C))||!l.owner_id){a=s,o=-1;break}}if(!1!==a){var c=H(C);if(c){N=!0,show(n);var u=window.cur,d=c.owner_id||(c.id||"").split("_")[0],_=Gif.isMp4Supports()&&c.hasVideo,f=s==C&&c.id?(t?"/doc":"/photo")+c.id+(c.hash?"?hash="+c.hash:"")+(_?(c.hash?"&":"?")+"mp4":""):"/photos.php",p={_ajax:1,oid:d,list:b,offset:a,direction:o,rev:y?1:0};u.stickers||(p.need_stickers=1),nav.getQuery("community")&&(p.community=nav.getQuery("community")),ajax.post(f,p,{onDone:function(t,a,o,r){hide(n),N=!1,o&&(u.replyNames||(u.replyNames={}),extend(u.replyNames,o)),r&&extend(u,r),M(b,t,a||g.length),e?i&&i.saveSource(P(b),!1,!0):R(C,!0)}})}}}}function F(e,t,n,i,a){if(g=[],e){var o=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e);o&&each(geByTag("img",o),function(){var e=attr(this,"data-id"),t=attr(this,"data-src_big");if(!e||!t)return!0;var n=(t=t.split("|"))[0],i=+t[1]||0,a=+t[2]||0;g.push({id:e,original_src:n,width:i,height:a})})}g.length||g.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a})}function U(){addClass("pv_icons_hide",a)}return{save:T,get:I,saveSource:M,getSource:x,clear:function(){removeEvent(window,"orientationchange",L)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!E())return!0;if(y=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),y=!0),k=i||null,t)b=t;else{var o=I(e);b=o.album?"album"+o.album:""}if(w=b,g=x(b),-1===(C=B(e,g))){if(!(o=I(e)).id)return!1;g=[o],C=0}S=g.length<2,!1;var r=g[C]&&e!=g[C].id;return R(C,a&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(N&&!H(C-1))&&(!E()||(S?photo.close():(--C<0&&(C=g.length-1),R(C),U(),!1)))},next:function(e){return!!checkEvent(e)||!(N&&!H(C+1))&&(!E()||!S&&(++C>=g.length&&(C=0),R(C),U(),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",a)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("photo_view","m");if(!e)return!1;var t=geByClass1("pv_body",e);if(!t)return!1;setTimeout(function(){removeClass("pv_hidden_icons",t),setTimeout(function(){addClass("pv_icons_hide",t)},2e3)},10)},selectTag:function(e,t,n){if(n&&!hasClass("pv_photo_tags_selected",a))return!0;var i=ge("pv_tag"+e),o=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),r=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",i)||(removeClass("pv_tag_selected",o),addClass("pv_tag_selected",i)),hasClass("pv_tag_label_selected",r)?nav.go(r,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",r),addClass("pv_photo_tags_selected",a),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",a))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),n=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),n&&removeClass("pv_tag_label_selected",n),removeClass("pv_photo_tags_selected",a),cancelEvent(e),!1},init:function(e,t,n,i,a,o,r){p=isUndefined(r.preload)?1:r.preload,y=!!a,photo.saveSource(e,t,n),onDOMReady(function(){photo.open(i,e+(a?"/rev":""),null,o,!0)})},zopen:function(e,t,n,i,a){if(void 0===a&&(a={}),checkEvent(t))return!0;var o=a,r=o.isDoc,s=o.hasVideo,l=o.hash;if(j(),y=!1,"/rev"==i.substr(-4)&&(i=i.slice(0,-4),y=!0),delete qs2obj(nav.params).z,k=a.from||!1,i)b=i;else{var c=I(n);b=c.album?"album"+c.album:""}if(w=b,(g=x(b))[0]&&g[0].isDoc&&g[0].hasVideo!==s&&(g=[]),g.length||F(e,n,r,s,l),-1===(C=B(n,g))&&(F(e,n,r,s,l),C=B(n,g)),-1===C){if(!(c=I(n)).id)return!0;g=[c],C=0}S=g.length<2,!1;var u=g[C]&&n!=g[C].id;return D(C,{no_push:a.no_push&&!u,replace:u,local:a.local,isDoc:r,hasVideo:s,hash:l}),uRegisterFloatBtn.hide(),cancelEvent(t),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}(),window.photo=Me?function(){var e,t,n,i,a,o,r,s,l,c,u,d=4,_=!1,f={},p={},h={},m=null,v=null,A=!1,g=null,b=null,y=!0,w=0,k=!1;function S(){if(!(e=$(".PhotoviewPage")))return nav.al_go(nav.cur),!1;if(geByClass1("pv_summary",e),geByClass1("photo_msg",e),s=geByClass1("pv_tag_wrap",e),i=geByClass1("PhotoviewPage__thumb",e),n=geByClass1("pv_nav",i),r=geByClass1("PhotoviewPage__photo",e),o=$(".PhotoviewPage__photo img",i),geByClass1("pv_footer",e),_=hasClass("pv_touch_full",e),n){var t=geByClass1("pv_nav_left",n),d=geByClass1("pv_nav_z",n),f=geByClass1("pv_nav_right",n);l=geByClass1("pv_nav_link",t),u=geByClass1("pv_nav_link",d),c=geByClass1("pv_nav_link",f),attr(l,"onclick","return photo.prev(event);"),attr(c,"onclick","return photo.next(event);"),attr(a,"onclick",!_&&"return photo.next(event);"),ajax.prepare_click([l,c,a])}return removeEvent(window,"orientationchange",x),addEvent(window,"orientationchange",x),removeEvent(window,"keydown",P),addEvent(window,"keydown",P),!0}function C(){var t=window.photoview;return!!t&&(!!k||(k=!0,t.onPhotoChange=function(e,t){w=e,L(e,t)},t.onUpdate=function(){},t.onClose=function(t){if(uRegisterFloatBtn.show(),!function(e){var t=qs2obj(nav.params);if(delete t.z,!e.local&&!e.crop){if(nav.tryHistoryBack())return!1;var n=nav.path+obj2qs(t)+nav.hash;nav.go(n,null,{push_only:!0})}return!0}(t))return!0;var n=qs2obj(nav.params);e&&n.list==v&&B(w,!0)},!0))}function O(e){var t=window.photoview,n=[];return each(e,function(e,t){if(!t)return!0;n.push(f[t.id]=t)}),m&&t&&t.saveSource(I(m)),n}function E(e){return f[e]||{}}function j(e,t,n){if(null!==t){p[e]||(p[e]=new Array(n||len(t))),O(t);var i=p[e];A&&i.reverse(),extend(i,t),A?(m=copy(i),i.reverse()):m=i}else delete p[e]}function T(e){if("string"!=typeof e)return e;var t=p[e]||[];return A?copy(t).reverse():t}function I(e){var t=T(e),n=new Array(t.length),i=qs2obj(nav.params);for(var a in delete i.z,t){var o=m[a],r="",s="";o.hash&&(s=obj2qs({hash:o.hash,mp4:!0})),o.isDoc?(r="doc"+o.id+s,n[a]={id:o.id,photo_url:"/"+r,src:o.original_src,isDoc:!0,hasVideo:o.hasVideo}):(r="photo"+o.id+"?list="+v+(A?"&rev=1":"")+(b?"&from="+b:""),n[a]={id:o.id,photo_url:"/"+r,like_url:"/like?act="+(o.likes_me?"del":"add")+"&object=photo"+o.id+"&from="+encodeURIComponent(r)+"&list="+v+"&hash="+o.like_hash,likes_me:o.likes_me,src:o.original_src,max_src:o.max_src,tags:o.tags,caption:o.caption,likes_cnt:o.likes_cnt,replies_cnt:o.replies_cnt,market_tags:o.market_tags})}return n}function M(e,t){for(var n in t||(t=m),t)if(m[n].id==e)return+n;return-1}function x(){nav.hash||onDOMReady(function(){if(geByClass1("photo_view")){var e=scrollTop();i&&getY(i)<e&&scrollToEl(i)}})}function P(e){if(zlayer.opened())return!1;switch(e.which){case 37:e.preventDefault(),photo.prev();break;case 39:e.preventDefault(),photo.next()}}function B(t,n,f){var p=window.cur,v=window.lang,k=m[t],S=1==m.length;if(k){nav.hash?scrollToHash(nav.hash):x();var C={};g&&(C.list=g),A&&(C.rev=1),b&&(C.from=b);var O=obj2qs(C),E="photo"+k.id+O,j=k.photo,T=(D(t-1)||{}).id,I=(D(t+1)||{}).id;if(S||(r&&(r.href="/photo"+I+O),l&&(l.href="/photo"+T+O),c&&(c.href="/photo"+I+O),ajax.prepare_click([l,c,a])),_){var M="photo"+k.id+"/"+g+(A?"/rev":""),P=extend({},C,{z:M}),B="/photo"+k.id+obj2qs(P);if(zlayer._lastNav){var L=zlayer._lastNav;(P=qs2obj(L.params)).z=M,B=L.path+obj2qs(P)+L.hash}u&&(u.href=B),ajax.prepare_click(u),attr(u,"onclick","return photo.fullscreen('"+escapeAttr(B)+"', event);")}if(o&&o.src!=j){o.onload=null,remove(o);var R;R=Wd.html(Object(Te._PhotoviewPage_tags)(k.tags)),val(r,'<img src="'+j+'" alt="" class="ph_img" />'+R),o=geByTag1("img",r)}toggleClass("photo_deleted",e,!!k.deleted),toggleClass("pv_one_photo",i,1==m.length),val(s,k.tag_info||"");var H=(p.sticker_panel||"").split("photo-0_0").join("photo"+k.id);(k.comments_html||"").split("\x3c!--stickers_panel--\x3e").join(H);e.classList.toggle("PhotoviewPage--deleted",!!k.isDeleted),e.childNodes[0].setAttribute("id","photo"+k.id);var V=$(".wi_like_wrap",e);V&&(V.innerHTML=k.liked_people||"",V.classList.toggle("is_empty",!k.liked_people));var F=$(".wi_buttons",e);val(F,k.like_buttons||"");var U=$(".AlbumInfoRow",e);U&&(U.outerHTML=Wd.html(Object(Oe.default)({url:k.album_href,author_url:k.author_href,avatar:k.avatar,title:Wd.wrap(k.album_title),subtitle:Wd.wrap(k.album_info_subtitle),withoutBottomBorder:!k.has_replies})));var q=$(".PhotoviewPage__description",e);if(q){var W="";k.description&&(W+=Wd.html(Object(Ee.default)({inner:[k.description.full],short:k.description.short}))),val(q,W)}var z=$(".PhotoviewPage__caption",e);if(z){var Q="";k.caption&&(Q+=k.caption),val(z,Q)}var Y=$(".Replies");Y&&(Y.outerHTML=k.replies_html);var G=$(".ReplyField");G&&(G.outerHTML=k.repliy_field_html);var X=$("#mhead .HeaderSubtitle__subtitle");X&&(X.innerHTML=v.mobile_photos_photo_header.replace("%s",w+1).replace(/%s|{count}/,m.length));var K=ge("photo_actions");if(K&&(K.innerHTML=Wd.render(k.actions)),post.stickersInit(),p.replyTo=0,ajax.refreshLinks(k.fv_link,k.app_link),photo.closeTags(),!n){var J="/"+E;nav.go(J,null,{no_push:n,push_only:!0,replace:f}),page.save(J,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}setTimeout(function(){var e=Object(je.getState)("autoload")||{};Replies.init(e.enable||!1)})}y||(N(),function(){for(var e=0,t=w+1;e<d;e++){var n=D(e+t),i=n&&n.photo;if(i&&!h[i]){var a=h[i]=new Image;a.src=i,a.onload=function(){h[i]=!0}}}}())}function L(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,o=n.hasVideo,r=window.photoview,s=m[e];m.length;if(s){var l=qs2obj(nav.params);if(l.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+g+(A?"/rev":""),t.no_open||r.open(e,I(m),{local:t.local,isDoc:i,hasVideo:o}),!t.local&&!t.crop){var c=nav.path+obj2qs(l)+nav.hash;nav.go(c,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0})}}t.local||t.crop||N(!0,i)}var R=!1;function D(e){return e>0?e%=m.length:e=(100*m.length+e)%m.length,m[e]}function N(e,n){if(void 0===n&&(n=!1),!R){for(var i=window.photoview,a=!1,o=1,r=0;r<5;r++){if(!(l=D(s=r+w))||!l.owner_id){a=s,o=1;break}}if(!1===a)for(r=-1;r>-3;r--){var s,l;if(!(l=D(s=r+w))||!l.owner_id){a=s,o=-1;break}}if(!1!==a){var c=D(w);if(c){R=!0,show(t);var u=window.cur,d=c.owner_id||(c.id||"").split("_")[0],_=Gif.isMp4Supports()&&c.hasVideo,f=s==w&&c.id?(n?"/doc":"/photo")+c.id+(c.hash?"?hash="+c.hash:"")+(_?(c.hash?"&":"?")+"mp4":""):"/photos.php",p={_ajax:1,oid:d,list:v,offset:a,direction:o,rev:A?1:0};u.stickers||(p.need_stickers=1),nav.getQuery("community")&&(p.community=nav.getQuery("community")),ajax.post(f,p,{onDone:function(n,a,o,r){hide(t),R=!1,o&&(u.replyNames||(u.replyNames={}),extend(u.replyNames,o)),r&&extend(u,r),j(v,n,a||m.length),e?i&&i.saveSource(I(v),!1,!0):B(w,!0)}})}}}}function H(e,t,n,i,a){if(m=[],e){var o=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e);o&&each(geByTag("img",o),function(){var e=attr(this,"data-id"),t=attr(this,"data-src_big");if(!e||!t)return!0;var n=(t=t.split("|"))[0],i=+t[1]||0,a=+t[2]||0;m.push({id:e,original_src:n,width:i,height:a})})}m.length||m.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a})}function V(){addClass("pv_icons_hide",i)}return{save:O,get:E,saveSource:j,getSource:T,clear:function(){removeEvent(window,"orientationchange",x),removeEvent(window,"keydown",P)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!S())return!0;if(A=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),A=!0),b=i||null,t)v=t;else{var o=E(e);v=o.album?"album"+o.album:""}if(g=v,m=T(v),-1===(w=M(e,m))){if(!(o=E(e)).id)return!1;m=[o],w=0}y=m.length<2,!1;var r=m[w]&&e!=m[w].id;return B(w,a&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(R&&!D(w-1))&&(!S()||(y?photo.close():(--w<0&&(w=m.length-1),B(w),V(),!1)))},next:function(e){return!!checkEvent(e)||!(R&&!D(w+1))&&(!S()||!y&&(++w>=m.length&&(w=0),B(w),V(),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",i)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("PhotoviewPage","m");if(!e)return!1;setTimeout(function(){removeClass("pv_hidden_icons",e),setTimeout(function(){addClass("pv_icons_hide",e)},2e3)},10)},selectTag:function(e,t,n){if(n&&!hasClass("pv_photo_tags_selected",i))return!0;var a=ge("pv_tag"+e),o=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),r=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",a)||(removeClass("pv_tag_selected",o),addClass("pv_tag_selected",a)),hasClass("pv_tag_label_selected",r)?nav.go(r,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",r),addClass("pv_photo_tags_selected",i),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",i))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),n=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),n&&removeClass("pv_tag_label_selected",n),removeClass("pv_photo_tags_selected",i),cancelEvent(e),!1},init:function(e,t,n,i,a,o,r){d=isUndefined(r.preload)?1:r.preload,A=!!a,photo.saveSource(e,t,n),onDOMReady(function(){photo.open(i,e+(a?"/rev":""),null,o,!0)})},zopen:function(e,t,n,i,a){if(void 0===a&&(a={}),checkEvent(t))return!0;var o=a,r=o.isDoc,s=o.hasVideo,l=o.hash;if(C(),A=!1,"/rev"==i.substr(-4)&&(i=i.slice(0,-4),A=!0),delete qs2obj(nav.params).z,b=a.from||!1,i)v=i;else{var c=E(n);v=c.album?"album"+c.album:""}if(g=v,(m=T(v))[0]&&m[0].isDoc&&m[0].hasVideo!==s&&(m=[]),m.length||H(e,n,r,s,l),-1===(w=M(n,m))&&(H(e,n,r,s,l),w=M(n,m)),-1===w){if(!(c=E(n)).id)return!0;m=[c],w=0}y=m.length<2,!1;var u=m[w]&&n!=m[w].id;return L(w,{no_push:a.no_push&&!u,replace:u,local:a.local,isDoc:r,hasVideo:s,hash:l}),uRegisterFloatBtn.hide(),cancelEvent(t),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}():window.photo;var xe=function(){function e(){}return e.follow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.add("ArtistCover__followBtn__followed"),a.onclick=function(o){o.preventDefault(),e.unfollow(t,n,i,a)}},onFail:function(){return unlockButton(a)}})},e.unfollow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.remove("ArtistCover__followBtn__followed"),a.classList.contains("ArtistCover__followBtn__canFollow")&&(a.onclick=function(o){o.preventDefault(),e.follow(t,n,i,a)})},onFail:function(){return unlockButton(a)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}(),Pe=n("lkNA"),Be={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init"},Le={AUDIO_ITEM_INDEX_ID:0,AUDIO_ITEM_INDEX_OWNER_ID:1,AUDIO_ITEM_INDEX_URL:2,AUDIO_ITEM_INDEX_TITLE:3,AUDIO_ITEM_INDEX_PERFORMER:4,AUDIO_ITEM_INDEX_DURATION:5,AUDIO_ITEM_INDEX_ALBUM_ID:6,AUDIO_ITEM_INDEX_AUTHOR_LINK:8,AUDIO_ITEM_INDEX_LYRICS:9,AUDIO_ITEM_INDEX_FLAGS:10,AUDIO_ITEM_INDEX_CONTEXT:11,AUDIO_ITEM_INDEX_EXTRA:12,AUDIO_ITEM_INDEX_HASHES:13,AUDIO_ITEM_INDEX_COVER_URL:14,AUDIO_ITEM_INDEX_ADS:15,AUDIO_ITEM_INDEX_SUBTITLE:16,AUDIO_ITEM_INDEX_MAIN_ARTISTS:17,AUDIO_ITEM_INDEX_FEAT_ARTISTS:18,AUDIO_ITEM_INDEX_ALBUM:19,AUDIO_ITEM_INDEX_TRACK_CODE:20,AUDIO_ITEM_INDEX_RESTRICTION:21,AUDIO_ITEM_INDEX_ALBUM_PART:22,AUDIO_ITEM_ACCESS_KEY:24,AUDIO_ITEM_CHART_INFO_INDEX:25,AUDIO_ITEM_HAS_LYRICS_BIT:1,AUDIO_ITEM_CAN_ADD_BIT:2,AUDIO_ITEM_CLAIMED_BIT:4,AUDIO_ITEM_HQ_BIT:16,AUDIO_ITEM_LONG_PERFORMER_BIT:32,AUDIO_ITEM_UMA_BIT:128,AUDIO_ITEM_REPLACEABLE:512,AUDIO_ITEM_EXPLICIT_BIT:1024,AUDIO_ENOUGH_LOCAL_SEARCH_RESULTS:500,AUDIO_RECOMS_TYPE_LISTENED:"recoms6",AUDIO_PLAYING_CLS:"audio_row__playing",AUDIO_CURRENT_CLS:"audio_row__current",AUDIO_DURATION_CLS:"audio_row__duration",AUDIO_LAYER_HEIGHT:550,AUDIO_LAYER_MIN_WIDTH:400,AUDIO_LAYER_MAX_WIDTH:1e3,AUDIO_HQ_LABEL_CLS:"audio_hq_label_show",AUDIO_MAX_AUDIOS_IN_SNIPPET:5,AUDIO_ROW_COVER_SIZE:40,AUDIO_ROW_PLAY_SIZE:24,AUDIO_ROW_ACTION_ROW_ITEM:'<a role="button" class="audio_row__more_action audio_row__more_action_%0% _audio_row__more_action_%0% %3%">%2%</a>',LOG_LS_KEY:"audiolog"};function Re(e){if(!e)return!1;var t=isObject(e)?e.extra:e[Le.AUDIO_ITEM_INDEX_EXTRA];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}function De(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}var Ne=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,i=function(e){return t&&t(e)};if(this._admanLoaded)i();else{var a=0;Object(Pe.loadScript)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,i()},onError:function(){window.abp?(n._admanLoaded=!0,i()):(3===(a+=1)&&(n._admanLoaded=!0),i("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,o){var r=this;this.loadAdman(function(s){if(!window.AdmanHTML)return r._sendEvent("no_adman",n,e.AD_TYPE,s),a&&a();r._adman=new AdmanHTML;var l={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:He(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other};extend(l,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(l.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(l.preview=1,l.vk_id=398724832),r._adman.setDebug(!!l.preview),r._adman.onError(function(){return a&&a()}),r._adman.onReady(function(){if(r._adman){var t=r._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(r._play(!0,n),a&&a()):(r._sendEvent("received",n),i?(r._sendEvent("rejected",n,e.AD_TYPE,o),r.deinit(),a&&a()):(r._sendEvent("ready",n),r.player.notify(Be.AD_READY),r._play(!1,n,a))):(i||r._sendEvent("not_received",n),a&&a())}}),r._adman.init({slot:3514,wrapper:r.isMvk?ce("div"):se("<div></div>"),params:l,browser:{adBlock:!!window.abp,mobile:!1}}),r._sendEvent("requested",n)})},t._sendEvent=function(e,t,n,i){var a=this,o=n?"/"+n:"",r=i?"/"+i:"";this._adEvents.push(e+"/"+t+o+r),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout(function(){ajax.post(a.adsStatUrl,{act:"ad_event",events:a._adEvents.join(","),v:a.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),a._adEvents=[]},500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted(function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(Be.PROGRESS,0),a.player.notify(Be.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())}),this._adman.onStarted(function(){t||(a.player.setIsPlaying(!0),a.player.notify(Be.PLAY),a.player.notify(Be.PROGRESS,0),a.player.notify(Be.AD_STARTED),a.updateVolume(),a._sendEvent("started",n),window.statlogsValueEvent&&statlogsValueEvent("audio_web_ad_link","show"))}),this._adman.onPaused(function(){a.player.setIsPlaying(!1),a.player.notify(Be.PAUSE)}),this._adman.onPlayed(function(){a.player.setIsPlaying(!0),a.player.notify(Be.PLAY)});var o=[.25,.5,.75];if(this._adman.onTimeRemained(function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(Be.PROGRESS,a._adsCurrentProgress,a._duration),each(o,function(e,t){if(a._adsCurrentProgress>=t)return o.shift(),a._sendEvent("progress_"+intval(100*t),n),!1})}),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(Be.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(Be.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),a=this._isAllowed(t),o=a.type,r=a.reason,s=function(){return n&&n()};switch(o){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,r),s()}},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if(Re(t))return{type:e.ALLOW_DISABLED};if(window.browser&&window.browser.safari)return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled)return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t,n){var i=this;this._startAdsTO&&function(e){if(!e)return!1;isFinite(e)?clearTimeout(e):e.terminate()}(this._startAdsTO),t?this._startAdsTO=De(function(){return i.checkPlay(e,n)},0):this.checkPlay(e,n)},e}();function He(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}Ne.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",Ne.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},Ne.AD_TYPE="preroll",Ne.ALLOW_DISABLED=1,Ne.ALLOW_ALLOWED=2,Ne.ALLOW_REJECT=3,Ne.REJECT_REASON_UNKNOWN="unknown",Ne.REJECT_REASON_LIMIT="track_limit_exceeded",Ne.REJECT_REASON_SECTION="section_not_allowed";var Ve=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case Be.AD_COMPLETED:case Be.AD_STARTED:this.audioplayer.notify(e,n);break;case Be.PAUSE:case Be.PLAY:this.audioplayer.notify(e,n.fullId);break;case Be.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=Object(i.ssGet)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}(),Fe=n("Po+v");function Ue(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function i(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function o(e,t){0>e?e=0:e>v-1&&(e=v-1);for(var n=k.dots.length-1;n>=0;n--)a(k.dots[n],E.activeDot);return i(k.dots[e],E.activeDot),C=e,r(-e*k.width,void 0===t?O.speed:t),_(),O.onSlideChange&&O.onSlideChange(e),e}function r(e,t){var n=t?t+"ms":"";g.style.webkitTransitionDuration=g.style.MozTransitionDuration=g.style.msTransitionDuration=g.style.OTransitionDuration=g.style.transitionDuration=n,l(e)}function s(e,t){if(w&&clearInterval(w),t){var n=+new Date,i=k.left;w=setInterval(function(){function a(e,t){return(t-e)*s+e}var o,r,s=(+new Date-n)/t,c=[0,.7,1,1];return s>=1?(l(e),void clearInterval(w)):(o=e-i,r=a(a(a(c[0],c[1]),a(c[1],c[2])),a(a(c[1],c[2]),a(c[2],c[3]))),void l(Math.floor(r*o+i)))},15)}else l(e)}function l(e){g.style.webkitTransform="translate("+e+"px,0) translateZ(0)",g.style.msTransform=g.style.MozTransform=g.style.OTransform=g.style.transform="translateX("+e+"px)",k.left=e}function c(e){g.style.left=e+"px",k.left=e}function u(){var e=C+1;return e>v-1&&(e=0),o(e)}function d(){y=!0,_()}function _(){y&&(b&&clearTimeout(b),b=setTimeout(function(){u()},O.slideshowInterval))}function f(){b&&clearTimeout(b)}function p(){y=!1,b&&clearTimeout(b)}function h(){k.width=e.offsetWidth,g.style.width=k.width*v+"px";for(var t=0;v>t;t++)k.slides[t].style.width=k.width+"px";r(-C*k.width)}function m(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var v,A,g,b,y,w,k={slides:[],dots:[],left:0},S=200,C=0,O={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(O,t);var E={inactive:O.cssPrefix+"inactive",active:O.cssPrefix+"active",mouse:O.cssPrefix+"mouse",drag:O.cssPrefix+"drag",slides:O.cssPrefix+"slides",dots:O.cssPrefix+"dots",activeDot:O.cssPrefix+"active-dot",mouseClicked:O.cssPrefix+"mouse-clicked"},j={transforms:n("transform"),transitions:n("transition")};return function(){var t=O.slidesContainer||e,n=O.dotsContainer||e;if(!(O.disableIfOneSlide&&t.children.length<=1)){(!j.transforms||window.opera)&&(l=c),(!j.transitions||window.opera)&&(r=s),i(g=O.slidesContainer||document.createElement("div"),E.slides);for(var u=0,_=t.children.length;_>u;u++){var b=t.children[u],y=document.createElement("li");k.slides.push(b),y.setAttribute("tabindex","0"),y.setAttribute("role","button"),y.innerHTML="<span></span>",function(t,n){m(n,"click",function(){o(t),O.stopSlideshowAfterInteraction&&p()}),m(n,"keyup",function(e){13==e.keyCode&&(o(t),O.stopSlideshowAfterInteraction&&p())}),m(n,"mouseup",function(){i(n,E.mouseClicked)}),m(n,"blur",function(){a(n,E.mouseClicked)},!0),m(b,"focus",b.onfocusin=function(){e.scrollLeft=0,setTimeout(function(){e.scrollLeft=0},0),o(t)},!0)}(u,y),k.dots.push(y)}v=k.slides.length,100/v,i(e,E.active),a(e,E.inactive),O.mouseDrag&&i(e,E.mouse),k.width=e.offsetWidth,g.style.width=k.width*v+"px";for(u=0;v>u;u++)k.slides[u].style.width=k.width+"px",g.appendChild(k.slides[u]);if(O.slidesContainer||e.appendChild(g),O.dots&&v>1){i(A=document.createElement("ul"),E.dots);for(u=0,_=k.dots.length;_>u;u++)A.appendChild(k.dots[u]);O.dotsPrepend?n.insertBefore(A,n.firstChild):n.appendChild(A)}m(window,"resize",h),m(window,"orientationchange",h),setTimeout(function(){o(O.startSlide,0)},0),O.slideshow&&d(),$e(g,{mouse:O.mouseDrag,start:function(){i(e,E.drag)},move:function(e,t,n){f(),n.x=n.x/(!C&&n.x>0||C==v-1&&n.x<0?Math.abs(n.x)/k.width*2+1:1),r(n.x-k.width*C)},end:function(t,n,i){if(i.x){var r=Math.abs(i.x)/k.width,s=Math.floor(r)+(r-Math.floor(r)>.25?1:0);s+=i.time<S+S*s/1.8&&Math.abs(i.x)-s*k.width>(s?-k.width/9:20)?1:0,i.x<0?o(C+s,O.touchSpeed):o(C-s,O.touchSpeed),O.stopSlideshowAfterInteraction&&p()}a(e,E.drag)}}),setTimeout(function(){O.onSetup&&O.onSetup(v)},0)}}(),{slideTo:function(e,t){return o(parseInt(e,10),t)},next:u,prev:function(){var e=C-1;return 0>e&&(e=v-1),o(e)},start:d,stop:p,pause:f,getCurrentPos:function(){return C},getSlidesNumber:function(){return v},recalcWidth:h}}function $e(e,t){function n(e,t,n,a){return t?(e.addEventListener?e.addEventListener(t,n,!!a):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,a)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function a(e){}function o(e){if((m={x:(_?e.clientX:e.touches[0].clientX)-h.x,y:(_?e.clientY:e.touches[0].clientY)-h.y,time:Number(new Date)-h.time}).time-A[A.length-1].time){for(var t=0;t<A.length-1&&m.time-A[t].time>80;t++);v={x:(m.x-A[t].x)/(m.time-A[t].time),y:(m.y-A[t].y)/(m.time-A[t].time)},A.length>=5&&A.shift(),A.push({x:m.x,y:m.y,time:m.time})}}function r(e,t){b=!0,k[_=t](e)||(n(document,w[_][1],s),n(document,w[_][2],l),n(document,w[_][3],l),u.preventDefault,h={x:_?e.clientX:e.touches[0].clientX,y:_?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,m={x:0,y:0,time:0},v={x:0,y:0},A=[{x:0,y:0,time:0}],u.start(e,h))}function s(e){!u.preventScroll&&d||k[_](e)||(o(e),(Math.abs(m.x)>u.clickTolerance||Math.abs(m.y)>u.clickTolerance)&&(b=!1),void 0===d&&3!==_&&(d=Math.abs(m.x)<Math.abs(m.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,h,m,v)))}function l(e){_&&o(e),!b&&e.target&&e.target.blur&&e.target.blur(),i(document,w[_][1],s),i(document,w[_][2],l),i(document,w[_][3],l),u.end(e,h,m,v)}var c=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:c,move:c,end:c,click:c};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,_,f=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,h={},m={},v={},A=[],g=[],b=!0,y=f?1:p?2:0,w=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],k=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return g.push(n(e,w[y][0],function(e){r(e,y)})),g.push(n(e,"dragstart",a)),u.mouse&&!y&&g.push(n(e,w[3][0],function(e){r(e,3)})),g.push(n(e,"click",function(e){b&&u.click(e)})),{getClicksAllowed:function(){return b},kill:function(){for(var e=g.length-1;e>=0;e--)g[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each(function(){e(this).data("Peppermint",Ue(this,t))}),this}}(window.jQuery),window.Peppermint=Ue,window.EventBurrito=$e;var qe=Ue,We=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){Object(i.statlogsValueEvent)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=Fe.default.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach(function(n){n.addEventListener("click",function(n){gpeByClass("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):gpeByClass("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()})}),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",function(){return e.sendStat("click_more")}),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",function(){e.sendStat("continue_free"),t.close()}),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",function(){t.slider.next(),e.sendStat("next_1screen")}),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",function(){return e.sendStat("get_offer")})},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=qe(this.screens,{dots:!0,speed:500})},t.close=function(){Fe.default.close(this.popup)},e}(),ze=n("r/ag"),Qe=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=_.default.version.split(".")[0];if(_.default.safari_mobile&&n<=7)return window.addEventListener("pagehide",function(){return e._hidden()}),void window.addEventListener("pageshow",function(){return e._visible()});var i=_.default.android&&_.default.safari&&n<5,a=!i&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",function(){return e._nativeSwitch(t)}),window.addEventListener(this.visibilityPrefix+"visibilitychange",function(){return e._nativeSwitch(t)})):document.addEventListener?(window.addEventListener("focus",function(){return e._visible()},1),window.addEventListener("blur",function(){return e._hidden()},1)):(document.attachEvent("onfocusin",function(){return e._visible()}),document.attachEvent("onfocusout",function(){return e._hidden()}))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach(function(e){return e()})},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach(function(e){return e()})},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();function Ye(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var i=["AudioPopup"];e.popupClass&&i.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new ze.default({content:a,class:i.join(" ")})}Qe.prefixes=["webkit","o","ms","moz",""];var Ge=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt(Object(Ie.getCookie)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(Ye({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,Object(Ie.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(ze.default.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new Qe,this.pageVisibility.onVisible(function(){e.isIdle=!1}),this.pageVisibility.onHidden(function(){e.isIdle=!0,e.onIdle()})},e}();Ge.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",Ge.REMOVE_RESTRICTION_LINK="/offermusic",Ge.EXPLANATION_LINK="https://vk.cc/9uFgyl";var Xe,Ke=n("L9Nh"),Je=(Xe=function(e,t){return(Xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Xe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ze=function(e){function t(t){return e.call(this,t)||this}return Je(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,Ke.QueueManager.addQueue({key:e.key,ts:e.timestamp},function(e,n){return t.queueHandler(n)}),Ke.QueueManager.start())},t}(function(e){this.queueHandler=e});var et=0,tt=function(){function e(){this.audioQueueListener=new Ze(this.handleAudioQueueMessage),this.subscriptionQueueListener=new Ze(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),Ke.QueueManager.initialized){var n=window.audio.getCurrent(),i=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);n&&!i&&window.ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(e){var n,i,a=(i={},(n=e)&&n.length&&n.filter(function(e){return!!e}).map(function(e){return e.queues&&e.queues[0]}).forEach(function(e){return i[e.type]=e}),i);a.audio&&t.audioQueueListener.connect(a.audio),a.subscription&&t.subscriptionQueueListener.connect(a.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout(function(){return t.connect(!0)},3e4))},onFail:function(){return et<3&&(et++,setTimeout(function(){return t.connect()},5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var n=window.audio.playing(),i=0;i<t.events.length;i++){var a=t.events[i].data;if("start"===a.type&&window.audio.getDeviceId()!==a.uuid&&!e.startPlaybackBox&&n){window.audio.pause(),e.showMultipleStreamPopup(a);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach(function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}})},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);ze.default.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",function(){ze.default.close()}),e.startPlaybackBox=!0},e.createPopup=function(e){return l.default.elem(Ye({title:Object(je.getLang)("mobile_audio_start_playback_title"),description:Object(je.getLang)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:Object(je.getLang)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}(),nt="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",it=n("xk4V"),at=n.n(it),ot=function(){function e(){this.subscriptions=null,this.precheck=null,this.onAnyCallBack=null,this.subscriptions={}}var t=e.prototype;return t.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach(function(e){return n.subscribe(e,t)}),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},t.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},t.emit=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.precheck&&!this.precheck.apply(this,[e].concat(n))||(this.onAnyCallBack&&this.onAnyCallBack.apply(this,[e].concat(n)),this.subscriptions[e]&&this.subscriptions[e].forEach(function(e){return e.apply(void 0,n)}))},e}(),rt="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",st={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var i=rt+rt,a=e.length;a--;)~(n=i.indexOf(e[a]))&&(e[a]=i.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var a=n;for(t=Math.abs(t);a--;)t=(n*(a+1)^t+a)%n,i[a]=t}return i}(e,t),a=0;for(e=e.split("");++a<n;)e[a]=e.splice(i[n-1-a],1,e[a])[0];e=e.join("")}return e},i:function(e,t){return st.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))}),n.join("")}};function lt(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":ct(i[1]);if(i=ct(i[0]),"string"!=typeof a||!i)return e;for(var o=(a=a?a.split(String.fromCharCode(9)):[]).length;o--;){if(t=(n=a[o].split(String.fromCharCode(11))).splice(0,1,i)[0],!st[t])return e;i=st[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function ct(e){if(!e||e.length%4==1)return!1;for(var t,n,i=0,a=0,o="";n=e.charAt(a++);)~(n=rt.indexOf(n))&&(t=i%4?64*t+n:n,i++%4)&&(o+=String.fromCharCode(255&t>>(-2*i&6)));return o}function ut(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}var dt,_t=function(){function e(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t.getCurrentTime=function(){return this._currentAudioEl.currentTime},t.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode(nt)},t._setAudioNodeUrl=function(e,t){var n=lt(t);return domData(e,"setUrlTime",n===nt?0:vkNow()),e===this._currentAudioEl&&this._currentHls&&(this._currentHls.destroy(),this._currentHls=null),this._isHlsUrl(n)&&!browser.safari&&"function"==typeof window.MediaSource?this._initHls(e,n):(e.src=n,Promise.resolve())},t._isHlsUrl=function(e){return/\.m3u8/.test(lt(e))},t._loadHls=function(){return new Promise(function(e,t){window.Hls&&e(),window.isMVK?Object(Pe.loadScript)("/js/lib/hls.min.js",{onLoad:e}):stManager.add("hls.min.js",e)})},t._initHls=function(e,t){var n=this;return this._loadHls().then(function(){return new Promise(function(i){var a=!!(window.isMVK?window.lsGet("_audio_hls_debug"):ls.get("_audio_hls_debug")),o=new window.Hls({debug:a,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});o.on(Hls.Events.ERROR,function(e,t){(a||t.fatal)&&console.log("audio hls error",e,t),t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(o.stopLoad(),o.startLoad()),t.fatal&&(n._hlsError={type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0},n.opts.onFail&&n.opts.onFail())}),o.loadSource(t),o.attachMedia(e),n._currentHls=o,n._hlsError=null,i()})})},t._createAudioNode=function(e){var t=this,n=new Audio;return this.opts.onBufferUpdate&&(addEvent(n,"pause",this.opts.onpause),addEvent(n,"play",this.opts.onplay),addEvent(n,"progress",function(){t._currentAudioEl===n&&t.opts.onBufferUpdate(t.getCurrentBuffered());var e=n.buffered;1===e.length&&0===e.start(0)&&e.end(0)===n.duration&&(n._fullyLoaded=!0)})),this.opts.onProgressUpdate&&addEvent(n,"timeupdate",function(){t._currentAudioEl===n&&t.opts.onProgressUpdate(t.getCurrentProgress(),t.getPlayedTime(),t.getCurrentTime())}),this.opts.onEnd&&addEvent(n,"ended",function(){t._currentAudioEl===n&&t.opts.onEnd()}),this.opts.onSeeked&&addEvent(n,"seeked",function(){t._currentAudioEl===n&&t.opts.onSeeked()}),this.opts.onSeek&&addEvent(n,"seeking",function(){t._currentAudioEl===n&&t.opts.onSeek()}),addEvent(n,"error",function(){t._prefetchAudioEl===n?t._prefetchAudioEl=t._createAudioNode():t._currentAudioEl===n&&n.src!==nt&&t.opts.onFail&&t.opts.onFail()}),addEvent(n,"canplay",function(){var e=domData(n,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),domData(n,"setUrlTime",0)),t._currentAudioEl===n&&t.opts.onCanPlay&&t.opts.onCanPlay(),domData(n,"canplay",!0)}),addEvent(n,"durationchange",function(){t._currentAudioEl===n&&t._seekOnReady&&isFinite(n.duration)&&(t.seek(t._seekOnReady),t._seekOnReady=!1)}),n.crossOrigin="anonymous",e&&this._setAudioNodeUrl(n,e).then(function(){n.preload="auto",n.volume=t.hasOwnProperty("_volume")?t._volume:.4761515102104643,n.load()}),this._audioNodes.push(n),this._audioNodes.length>10&&this._audioNodes.splice(0,5),n},t.onReady=function(e){e()},t.prefetch=function(e){this._isHlsUrl(e)||(this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,nt),this._prefetchAudioEl=this._createAudioNode(e))},t.seek=function(e){var t=this._currentAudioEl;isFinite(t.duration)&&t.src&&t.src!==nt?t.currentTime=t.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t.setPlaybackRate=function(e){this._currentAudioEl.playbackRate=e},t.getCurrentProgress=function(){var e=this._currentAudioEl;return isNaN(e.duration)?0:Math.max(0,Math.min(1,e.currentTime/e.duration))},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.getDuration=function(){return this._currentAudioEl&&isFinite(this._currentAudioEl.duration)?this._currentAudioEl.duration:0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(e,t){var n,i=this;if(void 0===t&&(t=function(){}),!e)return t&&t(!1);var a=lt(e),o=this._currentAudioEl;if(o.src&&o.src!==nt&&(this._seekOnReady=!1),o.src===a||this._currentHls&&this._currentHls.url===a)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));this._prefetchAudioEl&&this._prefetchAudioEl.readyState>0&&(this._prefetchAudioEl.src===a?(this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,nt),this._prefetchAudioEl.readyState>=3&&setTimeout(function(){return i.opts.onCanPlay&&i.opts.onCanPlay()}),this._currentAudioEl=this._prefetchAudioEl,o=this._currentAudioEl,this._prefetchAudioEl=!1,t&&t(!0)):this._prefetchAudioEl.src&&(n=this._setAudioNodeUrl(o,a),this._setAudioNodeUrl(this._prefetchAudioEl,nt))),o.src!==a&&(n=this._setAudioNodeUrl(o,a).then(function(){o.load(),domData(i._currentAudioEl,"canplay",null),i._stopFrequencyAnalise()})),n?n.then(function(){return t(!0)}).catch(function(){return t(!1)}):t(!0)},t.playAudioEl=function(e){return ut(e).catch(function(e){switch(e.code){case e.ABORT_ERR:break;default:throw e}})},t.play=function(e){this._stopFrequencyAnalise(),this._prefetchAudioEl.src===lt(e)&&this._prefetchAudioEl.readyState>0&&(this._setAudioNodeUrl(this._currentAudioEl,nt),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var t=this._currentAudioEl;if(t.src){var n=this.playAudioEl(t);return this._startFrequencyAnalise(),n}return Promise.resolve()},t.preparePlay=function(){if(browser.safari){var e=this._currentAudioEl;return this.playAudioEl(e)}},t._startFrequencyAnalise=function(){var e=this;function t(e,t,n,i){return(n-t)*e/i+t}function n(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,o=null;this._freqUpdateInterval=setInterval(function(){var r;e._currentAudioEl.paused||!domData(e._currentAudioEl,"canplay")?r=[0,0,0,0]:(++i>3&&(i=0,a=o,o=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)],a||(a=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)])),r=[t(i,a[0],o[0],3),t(i,a[1],o[1],3),t(i,a[2],o[2],3),t(i,a[3],o[3],3)]),e.opts.onFrequency&&e.opts.onFrequency(r)},50)},t._stopFrequencyAnalise=function(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])},t.pause=function(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()},t.stop=function(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){var n=this;e=Math.max(0,Math.min(1,e));var i=this._currentAudioEl,a=0;if(a=e<i.volume?-.06:.001,Math.abs(e-i.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var o=i.volume;this._setFadeVolumeInterval(function(){a>0&&(a*=1.35),o+=a;if(a<0?o<=e:o>=e)return n.setVolume(e),n._setFadeVolumeInterval(),t&&t();n.setVolume(o)})},t.getErrorData=function(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentHls?1:0,url:this._currentHls?this._currentHls.url:this._currentAudioEl.currentSrc,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},e}();!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(dt||(dt={}));var ft=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var n,i,a=this,o=new Promise(function(e,t){n=e,i=t});return this.tasks.push({name:e,fn:function(){return t.call(a).then(n).catch(i)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),o},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter(function(t){return t.name!==e})},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then(function(){return t.fn()}).then(function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null}))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise(function(t){return e.impl.onReady(t)})},e.prototype.delay=function(e){return this.newTask(dt.DELAY,function(){return new Promise(function(t){return De(t,e)})})},e.prototype.setUrl=function(e){var t=this;return this.newTask(dt.URL,function(){return new Promise(function(n){return t.impl.setUrl(e,n)})})},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(dt.SEEK),this.newTask(dt.SEEK,function(){return new Promise(function(n){t.seekImmediate(e),n()})})},e.prototype.pause=function(){var e=this;return this.newTask(dt.PAUSE,function(){return new Promise(function(t){e.impl.pause(),t()})})},e.prototype.play=function(e){var t=this;return window.browser.safari&&this.impl.play(nt),this.newTask(dt.PLAY,function(){return new Promise(function(n,i){t.impl.play(e).then(n).catch(i)})})},e.prototype.setVolume=function(e,t){var n=this;if(t){var i=e?dt.VOL_UP:dt.VOL_DOWN;return this.newTask(i,function(){return new Promise(function(t){return n.impl.fadeVolume(e,function(){return t()})})})}return this.newTask(dt.VOL_SET,function(){return new Promise(function(t){n.impl.setVolume(e),t()})})},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(dt.PLAYBACK_RATE,function(){return new Promise(function(n){t.impl.setPlaybackRate(e),n()})})},e}();function pt(e,t){var n="";return e.forEach(function(i,a){var o="/audio?performer=1&q="+encodeURIComponent(i.name),r=window.getWebHost?window.getWebHost():"";i.id&&(o="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+r+o+'">'+i.name+"</a>":i.name,a<e.length-1&&(n+=", ")}),n}function ht(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[Le.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),n=(e[Le.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),i=function(e,t){void 0===t&&(t=!0);var n="",i=!Re(e)&&t;if(isArray(e[Le.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(n=pt(e[Le.AUDIO_ITEM_INDEX_MAIN_ARTISTS],i)),isArray(e[Le.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(n+=" feat. ",n+=pt(e[Le.AUDIO_ITEM_INDEX_FEAT_ARTISTS],i)),!n){var a=e[Le.AUDIO_ITEM_INDEX_PERFORMER]?e[Le.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,""):"";if(i)n='<a class="artist_link" data-performer="'+a+'" href="'+("/audio?performer=1&q="+encodeURIComponent(a))+'">'+a+"</a>";else n=a}return n}(e,!1);return{id:intval(e[Le.AUDIO_ITEM_INDEX_ID]),owner_id:intval(e[Le.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:e[Le.AUDIO_ITEM_INDEX_OWNER_ID],fullId:e[Le.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[Le.AUDIO_ITEM_INDEX_ID],title:e[Le.AUDIO_ITEM_INDEX_TITLE]||"",subTitle:e[Le.AUDIO_ITEM_INDEX_SUBTITLE],performer:i,mainArtists:e[Le.AUDIO_ITEM_INDEX_MAIN_ARTISTS],featArtists:e[Le.AUDIO_ITEM_INDEX_FEAT_ARTISTS],authorLink:e[Le.AUDIO_ITEM_INDEX_AUTHOR_LINK],duration:intval(e[Le.AUDIO_ITEM_INDEX_DURATION]),lyrics:intval(e[Le.AUDIO_ITEM_INDEX_LYRICS]),url:e[Le.AUDIO_ITEM_INDEX_URL],flags:e[Le.AUDIO_ITEM_INDEX_FLAGS],context:e[Le.AUDIO_ITEM_INDEX_CONTEXT],extra:e[Le.AUDIO_ITEM_INDEX_EXTRA],accessKey:e[Le.AUDIO_ITEM_ACCESS_KEY],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_CLAIMED_BIT),isExplicit:!!(e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(e[Le.AUDIO_ITEM_INDEX_FLAGS]&Le.AUDIO_ITEM_REPLACEABLE),ads:e[Le.AUDIO_ITEM_INDEX_ADS],album:e[Le.AUDIO_ITEM_INDEX_ALBUM],albumId:intval(e[Le.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:intval(e[Le.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:e[Le.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:e[Le.AUDIO_ITEM_INDEX_RESTRICTION],chartInfo:e[Le.AUDIO_ITEM_CHART_INFO_INDEX]}}var mt=function(){var e={onpause:function(){if(o.emit(Be.PAUSE,M()),p)return void(p=!1);w&&(w=!1,ssSet("audio_play","0"),clearTimeout(C))},onplay:function(){w||(w=!0,ssSet("audio_play","1"),clearTimeout(C),C=setTimeout(P,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void mt.pause();o.emit(Be.PLAY,M())},onBufferUpdate:function(e){o.emit(Be.BUFFERED,M(),e,mt.duration())},onEnd:function(){if(c>0)return;o.emit(Be.ENDED,M()),S?(S=!1,mt.next()):k=!0},onProgressUpdate:function(e,t,i){if(p||vt.isPlaying())return;if(!e&&i)try{e=i/mt.duration()}catch(e){}o.emit(Be.PROGRESS,M(),e,mt.duration(),t),e>.01&&(j=t);ssSet("audio_pos",e),!S&&n.getDuration()-n.getCurrentTime()<.5&&(S=!0);k&&(k=!1,mt.next())}},t=!(browser.safari||browser.chrome&&browser.version<50),n=new _t(e),a=new ft(n),o=new ot,r=Object(i.ssGet)("audio_vol"),l="number"==typeof r?r:.8,c=0,u=null,d={},_=new tt,f=!1,p=!1,h=srand(),m=[],A=null,g={},b="",y=null,w=!1,k=!1,S=!1,C=null,O=!1,E=!1,j=0;function T(e){if(!mt.support)return!1;w&&mt.pause(),o.emit(Be.DESELECT,I());var t=A+e;(t>=m.length||t<0)&&(t=0),!0;var n=m[t];mt.play(n.fullId)}function I(){return m[A]||!1}function M(){return I().fullId||!1}function x(e){return function(e){return new Promise(function(t,n){u&&u(),u=n;var i=[];if(d=d||{},e)if(e.url)t(e);else{var a=g[e.fullId];if(a>=0)for(var o=a;o<a+3;o++){var r=m[o];!r||r.url||d[r.fullId]||(i.push(r.fullId+"_"+r.actionHash+"_"+r.urlHash),d[r.fullId]=!0)}ajax.post("/audio",{act:"reload_audio",ids:i.join(",")},{onDone:function(i){i||n(),i.forEach(function(n){var i=ht(n);m[g[i.fullId]]=i,window.audioplayer.getAudioElementsById(i.fullId).forEach(function(e){return e.dataset.audio=JSON.stringify(n)}),i.fullId===e.fullId&&t(i),delete d[i.fullId]}),n()},onFail:n})}else n()}).catch(function(){return d={}})}(e).then(function(e){a.clearTask(dt.URL);var t=e.url;return a.setUrl(t).then(function(t){t?c=0:(a.clearAllTasks(),o.emit(Be.FAILED),w&&c<2&&(e.pause(),e.next(),c++))})}).catch(function(){return Promise.reject()})}function P(){if(w){var e=lsGet("audio_current_player");h!=e?mt.pause():C=setTimeout(P,100)}}return{onInit:Object(s.default)(),init:function(e){!E&&mt.support&&(E=!0,e.cookie&&(O=e.cookie,e.cookie_path||"/"),onDOMReady(function(){!function(e){var t=Object(i.ssGet)("audio_id"),n=Object(i.ssGet)("audio_pos"),a=l;e.playlist&&mt.playlist((e.playlist||[]).map(ht),{q:e.playlist_q||""}),t&&mt.select(t).then(function(){n<1&&mt.setPosition(n,!0),mt.volume(a)}).catch(function(){})}(e),mt.onInit()}))},support:!0,subscribe:function(e,t){return o.subscribe(e,t)},unsubscribe:function(e,t){return o.unsubscribe(e,t)},notify:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];o.emit.apply(o,[e].concat(n))},getCurrent:I,getCurrentId:M,operate:function(e){if(!mt.support)return!1;!e||m[A]&&e==m[A].fullId?w?mt.pause():mt.play():mt.play(e)},playing:function(){return w},select:function(e){if(!mt.support)return Promise.reject();if(!e)return Promise.reject();if(!m.length)return o.emit(Be.EMPTY_PLAYLIST,e),Promise.reject();var t=m[g[e]];return t?x(t).then(function(){M()&&o.emit(Be.DESELECT,I()),A=g[e],o.emit(Be.SELECT,m[A]);var t,n=window.audioplayer.getPlaylistByAudioId(e);y!==n&&o.emit(Be.PLAYLIST_CHANGED),y=n,t=M(),ssSet("audio_id",t),O&&(Object(Ie.setCookie)(O,t,1),Object(Ie.setCookie)(O+"_playlist",y,1))}):(o.emit(Be.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){mt.play(e)},getCurrentPlaylistId:function(){return y},play:function(e){var i=this;if(!mt.support)return!1;var r=e===M();w&&r?mt.pause():vt.isPlaying()?e&&!r?(mt.select(e),vt.resume()):w?vt.pause():vt.resume():(w=!0,e&&!r?(n.setUrl(nt),mt.select(e).then(function(){o.emit(Be.PLAY_REQUESTED,e),Object(v.partConfigEnabled)("mvk_audio_ads")&&t?(a.clearAllTasks(),vt.startPlay(m[g[e]],!1,function(){i._play()})):i._play()}).catch(function(){})):this._play())},_play:function(){var e=I();e&&(a.play(e.url).then(function(){ssSet("audio_play","1"),_.connect()}).catch(function(){w=!1,o.emit(Be.PAUSE)}),lsSet("audio_current_player",h))},pause:function(){if(!mt.support)return!1;w&&(vt.isPlaying()?vt.pause():n.pause(),w=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=at()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return mt.isAdsPlaying()?vt.getCurrentProgress()*vt.getDuration():n.getCurrentTime()},getCurrentProgress:function(){return mt.isAdsPlaying()?vt.getCurrentProgress():n.getCurrentProgress()},setPosition:function(e,t){if(!mt.support)return!1;var n=0;t?n=e:e&&mt.duration()&&(n=e/mt.duration()),a.seek(n).then(function(){ssSet("audio_pos",n),o.emit(Be.SEEK,M(),n,mt.duration())})},volume:function(e){if(!mt.support)return!1;if(void 0===e)return l;var t=Math.min(1,Math.max(0,e));l=t,a.setVolume(l),ssSet("audio_vol",l),vt.updateVolume(),o.emit(Be.VOLUME,M(),l)},loaded:function(){return n.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return vt.getDuration();var e=n.getDuration(),t=m[A]&&m[A].duration;return e||t||0},played:function(){return n.getPlayedTime()},getListenedTime:function(){return j},next:function(){return T(1)},prev:function(){return T(-1)},playlist:function(e,t){return!!mt.support&&(void 0===e?m:(w&&!vt.isPlaying()&&mt.pause(),I()&&o.emit(Be.DESELECT,I()),m=e,b=t&&t.q||"",A=null,g={},each(e,function(e,t){return g[t.fullId]=e}),void function(e){ssSet("audio_query",e),O&&Object(Ie.setCookie)(O+"q",encodeURIComponent(e),1)}(b)))},addToPlaylist:function(e,t){var n={},i=t||m.length;m.forEach(function(e){return n[e.fullId]=!0}),e.forEach(function(e){n[e.fullId]||(t?m.splice(i,0,e):m.push(e))})},playlist_q:function(){return b},setIsPlaying:function(e){w=e},isAdsPlaying:function(){return vt.isPlaying()},isPlaying:function(){return w},initSplash:function(){f||(window.audioRestrictionSplash=new We,f=!0)},playNothing:function(){n.setUrl(nt,function(){})},events:Be}}();window.Artist=xe;var vt=new Ne(new Ve(mt),null,!0);mt.ads=vt,window.audio=mt,window.AudioBackgroundRestriction=Ge,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",function(){Object(v.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new Ge)}),document.addEventListener("DOMContentLoaded",function(){"audio"===cur.module&&mt.initSplash()}),window.page.onChange(function(){"audio"===cur.module?mt.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()});var At,gt,bt=n("wx14"),yt=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,function(i,a){if(a.event===e&&a.listener===t)return n=i,!1}),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(Be.PLAY,e,t)},t.listenPause=function(e,t){this.listen(Be.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(Be.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(Be.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(Be.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(Be.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(Be.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(Be.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(Be.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}(),wt=n("BJj/"),kt=n("DM2o"),St=((At={}).start=1,At.stop=2,At.volume=3,At.rewind=4,At.play_further=5,At.added=6,At.removed=7,At.recommendation_removed=8,At.show_album=9,At.share_audio=10,At),Ct=((gt={}).default=1,gt.next_track=2,gt.prev_track=3,gt.auto=4,gt.interruption=5,gt.pause=6,gt.new=7,gt.close_app=8,gt.queue=9,gt.pause=10,gt.upload=11,gt),Ot=300,Et=function(){function e(e){this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,this.debug=e.isDebug(),this.onVolume=Object(wt.debounce)(this.onVolume.bind(this),Ot),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return"auto";var e=this.playerAdapter.getSequence();if(e)return e>0?"next_track":"prev_track";var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?"pause":"new"},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.currentAudioId!==this.pausedAudioId,a=this.playerAdapter.getListenedTime();!n&&i&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,a=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=a,this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition,listened:a}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this,t=this.playerAdapter.getAudioId();if(this.canOperate()&&t){var n=this.collectListenedData();this.sendListenedDataDelayed(1e3,n),setTimeout(function(){if(!(e.currentAudio&&t!==e.currentAudio.fullId||vkNow()-e.playedTime<150)){e.pausedAudioId=t;var n=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:"stop",subtype:n?"queue"===n?"queue":"interruption":"pause"})}},100)}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:"volume",subtype:"default"})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent(Object(bt.default)({type:"rewind",subtype:"default"},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason="session_end"),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:"stop",subtype:"auto"}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],a=n[1];this.sendAudioEvent({type:"play_further",subtype:"default",ownerId:i,audioId:a})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n="new",i=this.playerAdapter.getSequence(),a=e.fullId.split("_"),o=a[0],r=a[1];this.playerAdapter.isAutoPlayed()?n="auto":i&&(n=i>0?"next_track":"prev_track"),this.sendCurrentAudioEvent({type:"stop",subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:o,audioId:r}),this.wasEnded=!0,this.collectListenedData(),this.collectListenedDataSwitch();var s=this.listenedData;this.listenedData=null,this.sendListenedData(s)}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:"stop",subtype:"close_app"}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if("session_end"===this.listenedData.end_stream_reason)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(){if(this.canOperate()&&this.currentAudio){var e=this.currentAudio.fullId,t=this.playerAdapter.getAudioTrackCode(),n=this.getListenedTime(),i=this.currentAudio.urlHash;if(i||console.log("no url hash"),n&&i){var a={audio_id:e,listened:n,context:this.playerAdapter.getContext(),hash:i};return window.cur&&vk.widget&&(a.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(a.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(a.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(a.shuffled=1)),t&&(a.track_code=t),this.playerAdapter.isRepeatCurrentAudio()?a.repeat="one":this.playerAdapter.isRepeatAll()&&(a.repeat="all"),this.playerAdapter.isAutoPlayed()&&(a.auto=1),this.playerAdapter.hasPrevAudio()&&(a.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(a.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(a.end_stream_reason="stop_btn"),a.state=document.hidden?"background":"app",this.listenedData=a,this.sendListenedDataDelayed(1e4,a),a}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&this.playerAdapter.sendListenedData(t)},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout(function(){return n.sendListenedData(t)},e)},t.serializeEvent=function(e){var t=[St[e.type],Ct[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(0),e.positionTo&&t.push(e.positionTo),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),kt.statlogsValueEvent.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent(Object(bt.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),this.getCurrentAudioParams(),e))},t.sendAudioEvent=function(e){this.sendEvent(Object(bt.default)({},e,this.getEnvParams()))},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}(),jt=n("dI71"),Tt=function(e){function t(){return e.apply(this,arguments)||this}Object(jt.default)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?2:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return window.audioplayer.getPlaylistByAudioId(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],a=t[2],o=t[3];return n&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+o:a:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);"other"===t&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context="other"},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?"search":"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?"group_list":"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?"search":0===e.indexOf("wall")?"group_list":0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":"other"},n.getContext=function(){return this.context||"other"},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,end_stream_reason:e.end_stream_reason,auto:e.auto})},t}(yt),It=n("jE6c"),Mt="ad_placeholder",xt="ad_mode",Pt=window.audio,Bt=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},i=!1,a=!1,o=!1,c=[];window.playerAdapter=new Tt(Pt);new Et(window.playerAdapter);function u(e,t){e&&cancelEvent(e);var n=Pt.getCurrent(),i=gpeByClass("_audioPlaylist",t),a=n?n.fullId:null;if(!a||!geByClass1("ai_current",i)){var o=(i||ge("mcont")).$(".audio_item");a=o&&o.getAttribute("data-id")}a&&H(e,a)}function d(e){if(e){$$("#lm_player").forEach(function(e){show(e)}),$$("#lm_audio").forEach(function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),Pt.isAdsPlaying()&&U(e,!0)});var t=A(e.fullId);t&&each(t,function(t,n){Pt.isAdsPlaying()?(F(e,!0),addClass("ai_playing",n)):(T(n,0),I(n,0),j(n,P(0,Pt.duration()))),M(n,Pt.volume()),addClass("ai_current",n)})}else $$("#lm_player").forEach(function(e){hide(e)})}function f(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)});var a=A(t);a&&(each(a,function(e,t){j(t,x(i)),removeClass("ai_playing",t),removeClass("ai_current",t)}),n[t]&&delete n[t],Pt.isAdsPlaying()&&F(e,!1))}function p(e,t,i,a){var o=A(e);if(o.length){var r=t*(i||0);each(o,function(e,n){w||I(n,t),j(n,Bt.getFormatedTime(r,i))}),r>1&&(n[e]=1)}}function h(e){var t=b(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=gpeByClass("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var i=n.dataset.playlistId;return i||(console.log("no playlist Id found"),null)}function m(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(e){if(e){var n=e.map(function(e){return ht(e)});Pt.playlist(n),t&&t(n)}}})}function A(e){return geByClass("audio_item_"+e)}function b(e){return A(e)[0]}function y(e){var t=b(e),n=gpeByClass("audios_list",t)||gpeByClass("AudioBlock",t),i=geByClass("audio_item",n),a=[],o=!1;each(i,function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var r=ht(i);a.push(r),r.fullId===e&&(o=!0)}}),Pt.playlist(a,{q:attr(n,"data-query")}),o&&Pt.play(e)}Pt.subscribe(Be.PLAY,function(e){var t=Pt.getCurrent();t&&Pt.playing()&&!Pt.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:Pt.getDeviceId()});e,$$("#lm_audio").forEach(function(e){addClass("ai_playing",e)});var n=A(e);if(!n)return;each(n,function(e,t){Pt.isAdsPlaying()||(addClass("ai_playing",t),addClass("ai_current",t))}),c[c.length-1]!==e&&c.push(e);o?o=!1:(a=i,i=!1,Bt.onPlay(e));N()}),Pt.subscribe(Be.PLAY_REQUESTED,function(e){V(e)}),Pt.subscribe(Be.PAUSE,function(e){$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)});var t=A(e);if(!t.length)return;each(t,function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)}),o||(Bt.onPause(e),N())}),Pt.subscribe(Be.SELECT,d),Pt.subscribe(Be.DESELECT,f),Pt.subscribe(Be.PROGRESS,p),Pt.subscribe(Be.SEEK,p),Pt.subscribe(Be.BUFFERED,function(e,t,n){V(e,t,n)}),Pt.subscribe(Be.AD_STARTED,function(e){F(e,!0),U(e,!0)}),Pt.subscribe(Be.AD_COMPLETED,function(e){F(e,!1),U(e,!1),p(e.id,0,0)}),Pt.subscribe(Be.NOT_FOUND_PLAYLIST,y),Pt.subscribe(Be.EMPTY_PLAYLIST,y),Pt.subscribe(Be.ENDED,function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,function(e,t){I(t,1)}),i=!0,Bt.onEnded(e))}),Pt.subscribe(Be.VOLUME,function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,function(e,n){M(n,t)}),Bt.onVolume(e,t))});var w=null,k=null,S=!1,C=!1;function O(e){if(w){var t=gpeByClass("audio_item",w),n=E(w,e);e&&cancelEvent(e);var i=A(attr(t,"data-id"));each(i,function(e,t){S&&I(t,n),C&&(M(t,n),Pt.volume(n))}),k=n}}function E(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,a=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,o=e.offsetWidth-i;return o?Math.max(0,Math.min(a/o,1)):0}function j(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function T(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function I(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function M(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function x(e){var t,n,i,a=e<0;return t=(n=(e=Math.round(a?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),a&&(t="-"+t),t}function P(e,n){return x(t&&n?e-n:e)}function B(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function L(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function R(e,t){t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var n=geBySel('.audio_item[data-id="'+e+'"]');each(n,function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)});var i=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_add",i);val(a,t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function D(e,t){t?B(e):L(e);var n=geBySel('.audio_item[data-id="'+e+'"]');each(n,function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)});var i=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_del",i);val(a,t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function N(){var e=window.audio.getCurrentId(),t=A(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach(function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)}),each(geByClass("_AudioPlayStatus"),function(e,t){toggleClass(t,"playing",i&&t.dataset.playlistId===Pt.getCurrentPlaylistId())})}function H(e,t,n){if(window.isArticleWebView)return Article.audioPlay(Pt.getCurrentId(),Pt.playlist()),cancelEvent(e),!1;var i=window.lang;if(Pt.support){var a=b(t);if(a&&hasClass("ai_deleted",a)&&!hasClass("ai_current",a))return!0;n&&t!=Pt.getCurrentId()||h(t)!==Pt.getCurrentPlaylistId()?y(t):Pt.operate(t)}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function V(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=A(e);Pt.playing()?(each(i,function(e,t){addClass("ai_playing",t)}),$$("#lm_audio").forEach(function(e){addClass("ai_playing",e)})):(each(i,function(e,t){removeClass("ai_playing",t)}),$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)})),null!==t&&null!==n&&each(i,function(e,i){T(i,t/n),addClass("ai_current",i)})}function F(e,t){var n=b(e.fullId);toggleClass(xt,n,t);var i=geByClass1("ai_title",n);val(i,t?getLang("global_audio_ad"):e.title),toggleClass(Mt,i,t)}function U(e,t){geBySel(".audio_item.al_player").forEach(function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?getLang("global_audio_ad"):e.title),toggleClass(Mt,i,t),toggleClass(xt,n,t),toggle(geByClass1("ai_artist"),!t)}})}return addEvent(document,_.isTouch?"touchend touchcancel":"mouseup",function(e){if(!w)return;var t=gpeByClass("audio_item",w),n=E(w,e)||k;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,function(e,i){S&&(I(i,n),Pt.setPosition(n,!0)),C&&M(t,n)}),S&&(o=Pt.playing(),Bt.onSeek(n));w=k=null,S=C=!1}),addEvent(document,_.isTouch?"touchmove":"mousemove",O),{init:function(t){e||(e=!0,onDOMReady(function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&Pt.playlist().length&&Bt.openPlayer(ge("lm_audio"),!0)}))},initAudio:function(){each(geByClass("ai_current"),function(e,t){f(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return ht(t)}(t))});var e=Pt.loaded(),t=Pt.getPosition(),n=Pt.duration(),i=n?t/n:0;V(Pt.getCurrentId(),e,n),d(Pt.getCurrent()),p(Pt.getCurrentId(),i,n),setTimeout(function(){N()},1)},getDOMFromAudio:function(e,t,n){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var i=ht(e);if(!i)return"";var a=Object(It.htsc)(i.ownerId+"_"+i.id),o=Object(It.htsc)(i.url||""),s=i.duration,c=i.performer,u=i.title,d=i.subTitle,f=i.isExplicit,p=i.canAdd,h=i.canDelete,m=u?'<span class="divider"> &ndash; </span>':"",v=_.isTouch?"ontouchstart":"onmousedown",A=["audio_item_"+a],g="",b=i.coverUrl_p||i.coverUrl_s,y=b?"background-image: url("+b+")":"",w=i.isClaimed,k=r.default.class("audio_item"),S=Object(It.escapeAttr)(JSON.stringify(e)),C="audioplayer.playPause(event, '"+a+"' "+(t?", true":"")+");";if(w&&(A.push("audio_item_disabled"),C=""),function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(a)){if(n)return"";A.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(a)&&A.push("ai_added"),vk.id&&(h?(A.push("ai_has_btn"),g='<div class="ai_del wia_item" onclick="audioplayer.del(\''+a+"', event);\">"+lang.global_delete_audio+"</div>"):p&&(A.push("ai_has_btn"),g='<div class="ai_add wia_item" onclick="audioplayer.add(\''+a+"', false, event);\">"+lang.global_add_to_audio+"</div>")),a===Pt.getCurrentId()&&(Pt.playing()&&A.push("ai_playing"),A.push("ai_current")),f&&A.push("audio_item_explicit");var O="";g?O='<div class="ai_menu_wrap"><i class="i_pointer"></i><a href="#" class="ai_menu_toggle_button" onclick="ActionMenu.toggleMenu(event, this);"></a>\n  <div class="ai_menu wi_actions" id="ai_menu_'+a+'">'+g+"</div>\n</div>":A.push("ai_no_menu");var E=d?" "+l.default.html({tag:"span",class:"ai_subtitle",inner:d}):"";return'<div\n      data-id="'+a+'"\n      data-audio="'+S+'"\n      class="'+A.join(" ")+" "+k+'"\n      onclick="'+C+'">\n  <div class="ai_info">\n    <div class="ai_play" style="'+y+'">\n      <i class="i_play"></i>\n    </div>\n    '+O+'\n    <div class="ai_body">\n      <div class="ai_dur" data-dur="'+s+'" onclick="audioplayer.switchTimeFormat(this, event);">\n        '+x(s)+'\n      </div>\n      <div class="ai_label">\n        <span class="ai_title">'+u+E+"</span>"+m+'<span class="ai_artist">'+c+'</span>\n      </div>\n      <input type="hidden" value="'+o+'">\n    </div>\n  </div>\n  <div class="ai_controls">\n    <table class="row_table">\n      <tr>\n        <td class="aic_progress_wrap">\n          <div class="aic_line" '+v+'="audioplayer.setPosition(this, event);" onclick="cancelEvent(event);">\n            <div class="aic_ln aic_back_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_load_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_pl_wrap" onclick="cancelEvent(event);">\n              <div class="aic_ln aic_progress_line" onclick="cancelEvent(event);">\n                <div class="aic_slider" onclick="cancelEvent(event);"></div>\n              </div>\n            </div>\n          </div>\n        </td>\n        <td class="aic_volume_wrap">\n          <div class="aic_line" '+v+'="audioplayer.setVolume(this, event);" onclick="cancelEvent(event);">\n            <div class="aic_ln aic_back_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_pl_wrap" onclick="cancelEvent(event);">\n              <div class="aic_ln aic_progress_line" onclick="cancelEvent(event);">\n                <div class="aic_slider" onclick="cancelEvent(event);"></div>\n              </div>\n            </div>\n          </div>\n        </td>\n      </tr>\n    </table>\n  </div>\n</div>'},add:function(e,t,n){void 0===t&&(t=null);var i=b(e);if(!hasClass("ai_ajax",i)){var a=ht(JSON.parse(i.dataset.audio)),o=hasClass("ai_added",i);R(e,!o),addClass("ai_ajax",i),Bt.onAdd(),ajax.post("/audio",{_ajax:1,act:o?"delete":"add",audio:o?attr(i,"data-deleteid"):e,hash:o?attr(i,"data-delete-hash"):a.addHash,access_key:t,track_code:a.trackCode},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",i),t?(attr(i,"data-deleteid",t),attr(i,"data-delete-hash",n)):R(e,o)},onFail:function(){removeClass("ai_ajax",i),R(e,o);var n=Array.prototype.slice.call(arguments),r=n.shift();switch(r){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(o?a.deleteHash:a.addHash)+"&access_key="+t)}}}),n&&cancelEvent(n)}},del:function(e,t){var n=b(e);if(n){var i=hasClass("ai_deleted",n);D(e,!i);var a=ht(JSON.parse(n.dataset.audio));i?L(e):B(e),Bt.onDel(),ajax.post("/audio",{_ajax:1,act:i?"restore":"delete",audio:e,playlist_id:h(e),hash:i?a.restoreHash:a.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||D(e,i)},onFail:function(){D(e,i);var t=Array.prototype.slice.call(arguments),n=t.shift();switch(n){case 2:nav.go("/audio?act="+(i?"restore":"delete")+"&audio="+e+"&hash="+(i?a.restoreHash:a.deleteHash))}}}),t&&cancelEvent(t)}},playPause:H,getFormatedTime:P,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),j(b(Pt.getCurrentId()),P(Pt.getPosition(),Pt.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){w||Pt.isAdsPlaying()||(w=e,S=!0,O(t))},setVolume:function(e,t){w||(w=e,C=!0,O(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,a=n.getCurrentPlaylistId(),o=nav.params;a&&!o.includes("playlist_id")&&(o=(o?o+"&":"")+"playlist_id="+a);var r=i+(o?"?":"")+o+"#player";return nav.al_go(r,null,{local:!0,target:e,nav:{push:r,path:i,params:o,hash:"#player"},no_push:t})},getCurrentElem:function(){return Object(g.$)(".ai_current")},playFirst:u,hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return c},isAutoPlayed:function(){return a},playBlock:function(e,t,n){n.dataset.id?u(t,n):m(e,function(e){if(e.length){var t=e[0].fullId;Pt.select(t).then(function(){Pt.play(t),n.classList.add("playing"),n.dataset.id=t})}})},playShuffledBlock:function(e,t){e.preventDefault(),m(t.dataset.blockId,function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}})},getPlaylistByAudioId:h,getAudioElementsById:A,onAdd:Object(s.default)(),onDel:Object(s.default)(),onPlay:Object(s.default)(),onPause:Object(s.default)(),onProgress:Object(s.default)(),onVolume:Object(s.default)(),onSeek:Object(s.default)(),onPlaylistChanged:Object(s.default)(),onEnded:Object(s.default)(),searchCatalogEnabled:function(){return Object(v.partConfigEnabled)("audio_search_new_catalog")}}}();window.audioplayer=Bt;var Lt=n("Y6JH");var Rt=function(e){var t=e.y<.5,n=100*e.x,i=100*e.y;return{class:"Photo__marketTag",attrs:{"data-url":e.url,style:"left: "+n+"%; top: "+i+"%"},inner:[{class:"Photo__marketTagInner "+(t?"Photo__marketTagInner--down":""),inner:[{class:"Photo__marketTagTitle",inner:e.title},{class:"Photo__marketTagPrice",inner:Wd.wrap(e.price)},{class:"Photo__marketTagIcon",inner:Object(Lt.default)("market","goto_arrow_black")}]},{class:"Photo__marketTagArrow "+(t?"Photo__marketTagArrow--down":"")}]}};var Dt=function(e){return{class:"Photo__marketShowMoreButton",attrs:{"data-items-json":e.items},inner:[{class:"Photo__marketShowMoreButtonIcon",inner:Object(Lt.default)("market","market_16")},getLang("mobile_photos_show_market_items")]}};var Nt=function(e){return{tag:"a",attrs:{"data-is-fave":e.isFave?"fave":""},class:"PhotoMarketItem__fave "+(e.isFave?"PhotoMarketItem__fave--added":""),onclick:["ItemsList._toggleFave","event","this",e.type,e.typeInt,e.ownerId,e.itemId,e.href,e.faveHash]}};var Ht=function(e){return{class:"PhotoMarketItem",attrs:{"data-item-id":e.item_id},inner:[{class:"PhotoMarketItem__thumb",tag:"img",src:e.thumb},{class:"PhotoMarketItem__title",inner:e.title},{class:"PhotoMarketItem__price",inner:Wd.wrap(e.price)},Nt({type:e.type,typeInt:e.type_int,isFave:e.is_fave,itemId:e.item_id,ownerId:e.owner_id,href:e.href,faveHash:e.fave_hash})]}};var Vt=function e(t){var n=[],i=JSON.parse(unescape(t.itemsJSON)),a=Array.isArray(i),o=0;for(i=a?i:i[Symbol.iterator]();;){var r;if(a){if(o>=i.length)break;r=i[o++]}else{if((o=i.next()).done)break;r=o.value}var s=r,l=e._faveCache[s.item_id];void 0===l&&(l=s.is_fave),n.push({onclick:["ItemsList._goToItem",s],class:"PhotoItemsList__item",inner:Ht(Object.assign({},s,{is_fave:l}))})}for(var c=0;c<10;c++)n.push({class:"PhotoItemsList__item PhotoItemsList__item--filler"});return{class:"PhotoItemsList",inner:[{class:"PhotoItemsList__header",inner:[{class:"PhotoItemsList__closeIcon",onclick:t.onClose},getLang("mobile_photos_market_items_title")]},{class:"PhotoItemsList__body",inner:n}]}},Ft=n("wTbK");Vt._faveCache={},Vt._onClose=function(){Vt._itemsPopup&&(ze.default.close(Vt._itemsPopup),delete Vt._itemsPopup)},Vt._goToItem=function(e){-1===cur.destroy.indexOf(Vt._onClose)&&cur.destroy.push(Vt._onClose),nav.go(e.url)},Vt._toggleFave=function(e,t,n,i,a,o,r,s){e.stopPropagation();var l=t.dataset.isFave;ajax.post("/bookmarks.php",{_ajax:1,item_type:i,act:l?"bookmark_remove":"bookmark_add",hash:s,item_oid:a,item_id:o,link_url:r},{onDone:function(e){e&&(Vt._faveCache[o]=!l,Object(g.$)(".PhotoItemsList").$$(".PhotoMarketItem").forEach(function(e){e.dataset.itemId===o.toString()&&(e.$(".PhotoMarketItem__fave").outerHTML=Wd.html(Nt({type:n,typeInt:i,isFave:!l,ownerId:a,itemId:o,href:r,faveHash:s})))}))}})},Vt._openItemsPopup=function(e){var t=Object(Ft.default)({class:"Photo__marketItemsModal",body:Vt({itemsJSON:e,onClose:["ItemsList._onClose"]})});Vt._itemsPopup=ze.default.open(Wd.elem(t),!0)},window.ItemsList=Vt;var Ut=Vt,$t=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,qt=!$t&&!!o.default.getFlag(o.FLAG_MP4);onDOMReady(function(){zt.onUpdate(),page.onChange(function(){zt.onUpdate()})});var Wt={gifs:[],currentAutoplayElement:null,ignore:[]},zt={isBadBrowser:$t,isMp4Supports:function(){return qt},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var a=function(e){return Object(i.ceFromString)(l.default.html(Object(Fe.default)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[Qt(getLang("mobile_continue"),"regular",'Gif.confirm(this, "'+e.raw+'")'),Qt(getLang("mobile_cancel"),"secondary","Popup.close(this)")]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(a,t),void Fe.default.open(a,!0)}var o=Object(bt.default)({},nav.getQuery(),{z:"doc"+n.raw+"/"+(n.hash||"")});nav.path,Object(i.obj2qs)(o),nav.hash;photo.zopen(null,null,n.raw,"",{no_push:!1,isDoc:!0,hasVideo:n.hasVideo,hash:n.hash})},init:function(e){zlayer.create(Yt()),zlayer.open()},close:function(){var e=Object(bt.default)({},nav.getQuery());delete e.z;var t=nav.path+Object(i.obj2qs)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,Fe.default.close(e),Object(i.geBySel1)('[data-media="'+t+'"]').click()},autoplayTest:function(){o.default.detectAutoplay().then(function(e){qt=o.default.getFeatures().mp4&&e&&o.default.getFlag(o.FLAG_MP4)&&!$t})},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from(Wt.gifs||[]).forEach(function(a){var o=getXY(a)[1],r=o>=e&&o<=t,s=Math.abs(n-o);r&&(i[s]=a)});var a=i[Math.min.apply(Math,Object.keys(i))];a?a.classList.contains("current_gif")||-1===Wt.ignore.indexOf(a)&&(post.toggleGif(a,!1,!1,!0),Wt.currentAutoplayElement=a):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){o.default.getFlag(o.FLAG_GIF_AUTOPLAY)&&(Wt.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll(Object(i.throttle)(zt.activateGIF,200)))},getState:function(){return Wt},setState:function(e,t){Wt[e]=t}};function Qt(e,t,n){return{class:["Popup__button",r.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}function Yt(e){void 0===e&&(e=!1);var t='<img class="zpv_img" alt="">';return e&&(t='<video class="zpv_img" alt="" autoplay preload="metadata" crossorigin="anonymous" poster="/images/blank.gif" webkit-playsinline playsinline controls loop muted>'),'\n    <div id="z_photoview">\n      <div class="zpv_siblings">\n        <div id="zpv_left" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n        <div id="zpv_right" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n      </div>\n      <div class="zpv_body">\n        <div id="zpv_center" class="zpv_thumb_item">\n          '+t+'\n        </div>\n      </div>\n      <div class="zpv_close_msg_wrap">\n        <div class="zpv_close_msg"> '+lang.mobile_zphoto_move_to_close+'</div>\n      </div>\n      <div class="zpv_controls">\n        <div class="mhead zpv_header">\n          <a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a>\n          <div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div>\n        </div>\n      </div>\n      <div class="zpv_tags"></div>\n      <div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div>\n    </div>\'\n  '}window.Gif=zt;function Gt(e){return void 0===e&&(e={}),Object(ze.default)({on_overlay_click_native:"QRPhotoPosting.back();",class:"QRPhotoPosting",content:[{class:"QRPhotoPosting__img",inner:Wd.wrap(e.svg)},{class:"QRPhotoPosting__title",inner:Wd.wrap(e.title)}]})}function Xt(){return{inner:[Object(Lt.default)({sprite:"common",name:"qr_24"})],class:"QRPhotoPosting__button",onclick:"QRPhotoPosting.show();",tag:"div"}}var Kt,Jt=n("wZQE"),Zt=n.n(Jt);function en(e){var t=/photo(-?\d+)_(\d+)/i.exec(e||nav.cur);return Array.isArray(t)||(t=["",0,0]),{album:Object(i.intval)(t[1]),photo:Object(i.intval)(t[2])}}function tn(e){return-86529522===en(e).album&&Object(v.partConfigEnabled)("mvk_photo_fest_qr_sharing")?Xt():""}function nn(e){var t=Object(g.$)("#z_photoview .zpv_values"),n=l.default.elem(tn(e));Object(i.append)(n,t)}window.QRPhotoPosting=Gt,extend(Gt,{show:function(){var e=en(),t="https://vk.com/fest?publish_photo="+e.photo,n=Zt.a.createQR(t,271,"QRPhotoPosting__svg",{isShowLogo:!0});Kt=ze.default.open(l.default.elem(Gt({svg:n,title:lang.mobile_photo_qr_popup_title})),!0),nav.go(nav.path+"?z=publish_photo"+e.photo,null,{push_only:!0,nav_init:!1,nav_incr:!0})},close:function(){Kt&&ze.default.close(Kt)},back:function(){window.history?window.history.back():window.location="/"},getQRPhotoButton:tn,QRPhotoPosting:Gt,QRPhotoPostingButton:Xt,appendQRPhotoButton:nn});var an=2,on=window.ajax,rn=window.thover,sn=window.nav,ln=(window.page,window.PhotoLike),cn=window.zlayer,un=window.photo,dn=300,_n=function(){var e=!1,t=!1,n=!1,i=!1,a=!1,o=!1,r=!1,c=!1,u=!1,d=!1,_=!1,f=!1,p=!1,h=!1,m=!1,v=!1,A=!1,g=!1,b=!1,y=!1,w=!1,k=!1,S=!1,C={},O={min_scale:1,max_scale:3,min_scale_limit:.5,max_scale_limit:5,anim_duration:dn,inertia_duration:300,bounce_diff:1.5,crop_padding:20,crop_size:250,fps:0};function E(e){var t=getCw()/2,n=getCh()/2;if(e.touches){for(var i=0,a=0,o=0,r=Math.min(2,e.touches.length);i<r;i++)a+=e.touches[i].pageX,o+=e.touches[i].pageY,0;return r?{pageX:a/r-t,pageY:o/r-n}:{pageX:-t,pageY:-n}}return{pageX:e.pageX-t,pageY:e.pageY-n}}function j(e,t){var n=null,i=t?attr(_,"data-original-src")||_.src:e.src;if(C[i])return C[i];if(t&&(e=function(){var e=ce("img");return e.src=attr(_,"data-original-src")||_.src,e}()),void 0!==e.naturalWidth)n={width:e.naturalWidth,height:e.naturalHeight};else if("VIDEO"===e.tagName)n={width:e.clientWidth,height:e.clientHeight};else{(new Image).src=e.src,n={width:e.width,height:e.height}}return n.width&&n.height&&(C[i]=n),n}function T(e){var t=attr(e,"data-id");return I((zt(Ht).tags||{})[t]||[])}function I(e){return e[0]?{coords:{x:e[0][0],y:e[0][1],w:e[0][2],h:e[0][3]},name:e[1],href:e[2],al:e[3]}:{}}function M(e){setStyle(t,"overflow",e?"visible":"hidden")}var x=null,P=null;function B(e,n,i,o,r,s,l,c,u){if(!O.fps||u){var d=!1,f=!!c&&function(){d||(d=!0,c())};s?(t&&setStyle.animate(t,"transform",{duration:s,func:l},f),_&&setStyle.animate(_,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),h&&setStyle.animate(h,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),m&&setStyle.animate(m,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),a&&setStyle.animate(a,!1===r?"transform":"transform, opacity",{duration:s,func:l},f),Te=!0):Te&&(t&&setStyle.animate(t),_&&setStyle.animate(_),h&&setStyle.animate(h),m&&setStyle.animate(m),a&&setStyle.animate(a),Te=!1),setStyle.transform(t,{translate:[n,0]}),setStyle.transform(_,e,[i,o]),Ct(e,i,o),!1!==r&&(setStyle(_,"opacity",r),de||_e?(setStyle(h,"opacity",r),fe=!0):(setStyle(m,"opacity",r),me=!0),function(e,t){var n=window.lang;if(e){var i=cn.height,o=i/5,r=i/3.5,s=Math.abs(e),l=s>20?e+(e>0?20-e:-20-e)/O.bounce_diff:e,c=0===t?0:Math.max(0,Math.min((s-20)/o,.75));t>0&&setStyle.transform(a,{translate:[0,l]}),setStyle(a,"opacity",c);var u=s>r,d=u?"":e>0?" zpv_close_move_down":" zpv_close_move_up",_=u?n.mobile_zphoto_release_to_close:n.mobile_zphoto_move_to_close;val(a,'<div class="zpv_close_msg'+d+'">'+_+"</div>"),(a.is_down&&e<0||!a.is_down&&e>0)&&yt(e>0)}else setStyle.transform(a,{translate:[0,0]}),setStyle(a,"opacity",0)}(o,r)),bt(e)}else x=[e,n,i,o,r,s,l,c,!0],P||L()}function L(){x&&(B.apply(window,x),x=null),clearTimeout(P),P=O.fps?setTimeout(L,1e3/O.fps):null}function R(e,t,n){at(!0),B(J,z,X,K,Ie,e,t,n),Ie=!1}function D(e,t,n,i){B(e.currentScale,e.curBodyX,e.currentX,e.currentY,!1,t,n,i)}function N(e){e=function(e){if(!e)return e;var t={width:_.width||_.clientWidth,height:_.height||_.clientHeight},n=t.width/2,i=t.height/2;return[e[0]+n,e[1]+i]}(e||[0,0]),setStyle.transformOrigin(_,e)}function H(){(S=Ft.max_src&&J>2)?_.src!==Ft.max_src&&(attr(_,"data-original-src",Ft.src),attr(_,"data-src",Ft.max_src),Gt(Ft.max_src)):!S&&_.src!==Ft.src&&_&&(attr(_,"data-src",Ft.src),Xt(Ft.src),_.style.width="")}var V,F,U,$,q,W,z,Q,Y,G,X,K,J,Z,ee,te,ne,ie,ae,oe,re,se,le,ue,de,_e,fe,pe,he,me,ve,Ae,be,ye,we,ke,Se,Ce,Oe,Ee,je,Te,Ie,Me=!1,xe=!1,Pe=null;function Be(e){var t=e[1].pageX-e[0].pageX,n=e[1].pageY-e[0].pageY;return{distance:Math.sqrt(t*t+n*n),angle:180*Math.atan2(n,t)/Math.PI}}function Le(e){var t=Be(e);if(Me){var n=t.distance/Me.scale,i=t.angle-Me.rotation;i<-180&&(i+=360),i>180&&(i-=360),extend(Me,{startDistance:n,startAngle:i})}else Me={startDistance:t.distance,startAngle:t.angle,scale:1,rotation:0}}function Re(e){return extend({originalEvent:e},e,function(e){if(!Me)return{scale:1,rotation:0};if(e.length<2)return{scale:Me.scale,rotation:Me.rotation};var t=Be(e),n=t.distance/Me.startDistance,i=t.angle-Me.startAngle;i<-90&&(i+=360),i>270&&(i-=360);var a={scale:n,rotation:i};return extend(Me,a),a}(e.touches),E(e))}function De(e){var t=e.touches;t&&(t.length>5||t.length<2?Me&&(gt(Re(e)),Me=!1):Me?Le(t):(vt(Re(e)),Le(t)))}function Ne(e){var t=e.touches;t&&(t.length>5||t.length<2?Me&&(gt(Re(e)),Me=!1):Me&&At(Re(e)))}function He(e){var t=e.touches;t&&((t.length>5||t.length<2)&&Me&&(gt(Re(e)),Me=!1),Me&&Le(t))}function Ve(e){preventEvent(e);var t=(e.detail?e.detail:e.wheelDelta)>0?1.05:.95,n=extend({originalEvent:e},e);xe||(xe=1,pt(e),vt(extend(n,{scale:xe}))),xe*=t,At(extend(n,{scale:xe})),clearTimeout(Pe),Pe=setTimeout(function(){gt(extend(n,{scale:xe})),mt(e),xe=!1},200)}function Fe(){V=0,F=0,U=0,$=0,q=1,W=!0,z=0,Q=0,Y=0,G=1,X=0,K=0,J=1,Z=!1,ee=!1,te=!1,ne=!1,ie=!1,ae=!1,oe=!1,re=!1,se=!1,fe=!1,pe=!1,he=!1,me=!1,ve=!1,Ae=!1,be=!1,!1,Ce=!1,Oe=!1,Ee=!1,je=!1}function Ue(){return{lastScale:q,deltaX:V,deltaY:F,pointX:U,pointY:$,curScale:G,currentScale:J,curX:Q,curY:Y,currentX:X,currentY:K,curBodyX:z}}function $e(e,t,n){n=n||Ue(),e=e||{};var i=extend({},n,e);if(isUndefined(e.deltaX)||isUndefined(e.deltaY)?isUndefined(e.pointX)||isUndefined(e.pointY)?isUndefined(e.lastScale)?isUndefined(e.currentScale)?isUndefined(e.curScale)||(i.currentScale=i.lastScale*i.curScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=i.currentScale/i.lastScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=1,i.currentScale=i.curScale*i.lastScale):(i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.pointX=i.curX+i.deltaX*i.curScale,i.pointY=i.curY+i.deltaY*i.curScale),isUndefined(e.curX)||(i.curX=e.curX,i.currentX=i.curX/i.currentScale),isUndefined(e.curY)||(i.curY=e.curY,i.currentY=i.curY/i.currentScale),t)return i;V=i.deltaX,F=i.deltaY,U=i.pointX,$=i.pointY,q=i.lastScale,G=i.curScale,J=i.currentScale,Q=i.curX,Y=i.curY,X=i.currentX,K=i.currentY,z=i.curBodyX}function qe(){var e=cn.width||getCw(),t=cn.height||getCh();if(k)var n=e,i=Math.min(O.crop_size,n-2*O.crop_padding),a=i,o=i;else a=e,o=t;return{width:a,height:o}}function We(e){var t=qe().width,n=((_.width||_.clientWidth)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function ze(e){var t=qe().height,n=((_.height||_.clientHeight)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function Qe(){var e=1,t=O.max_scale;if(k){e=1,t=(Lt?Lt[0]:{max_scale:O.max_scale}).max_scale}else{var n=j(_,!0);e=O.min_scale,t=Math.max(O.max_scale,n.width/getCw(),(n.height||n.clientHeight)/getCh())}return{min:e,max:t}}function Ye(e){var t=cn.height||getCh(),i=Math.abs(Vt)>=10,a=Math.abs(e)>1,o=t/3.5,r=Math.abs(Y);return Y*e<0&&(i=!0),e=e||0,r>o||!i&&a?(function(e){var t=cn.height||getCh(),i=2*Math.abs(K)>t?.85:1.7;$e({curY:(e>1?t:e<-1?-t:Y>0?t:-t)/i}),Ie=0,R(150,"ease-in",Ge),setStyle(n,"width",0),ke=!0}(e),!0):(_t()&&(Ie=1,R(300),ne=!1,_e&&(_e=!1,Et(!0))),!1)}function Ge(){b&&_n.close()}function Xe(){!1!==ye&&(M(!1),en(ye),setStyle.transform(f),setStyle.transform(p),B(1,0,0,0,1),N(),ye=!1)}function Ke(){var e=1.05*(cn.width||getCw());X-=(e+z)/J,z=-e,ye=Ht+1,Vt--,R(dn,"ease-out",Xe),xt(!1,!0),_e=!1,_n.onPhotoChange&&_n.onPhotoChange(Ht+1,{no_open:!0,local:y,crop:k})}function Je(){var e=1.05*(cn.width||getCw());X+=(e-z)/J,z=e,ye=Ht-1,Vt++,R(dn,"ease-out",Xe),xt(!1,!0),_e=!1,_n.onPhotoChange&&_n.onPhotoChange(Ht-1,{no_open:!0,local:y,crop:k})}function Ze(){if(!Oe)return!1;var e=function(){if(!Oe||Oe.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=Oe.pop(),i=Oe.length-1;i>=0;i--){if((a=e-Oe[i][0])>150)break;t=Oe[i]}if(!t||!n)return[0,0,0];var a,o=n[1].pageX-t[1].pageX,r=n[1].pageY-t[1].pageY,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}(),t=e[0],n=e[1],i=e[2];if(tt(),!t)return!1;var a=te||ne?5.1:4.7,o=t/a,r=n*o-a*o*o/2,s=i*o-a*o*o/2;if(o*=530,r*=140,s*=140,t<.1||!r&&!s)return!1;if(!ne){var l={};te||(l.curX=Q+r,l.curY=Y+s),$e(l);var c=We(J);l={},Q<c.min?l.curBodyX=W?Q-c.min:0:Q>c.max&&(l.curBodyX=W?Q-c.max:0),$e(l)}return te?4.7*n:ne?4.7*i:o}function et(e){Oe||(Oe=[]),Oe.push([vkNow(),e]),Oe=Oe.slice(-20)}function tt(){Oe=!1}function nt(e,t){var n,i,a,o,r,s,l,c,u,d=(n=[e.curX,e.curY],i=e.currentScale,a=[t.curX,t.curY],o=t.currentScale,r=n[0],s=n[1],l=a[0],c=a[1],1!=(u=o/i)&&[r+(r-l)/(u-1),s+(s-c)/(u-1)]);if(!d)return!1;var _=d[0],f=d[1];return e.deltaX=_-e.curX,e.deltaY=f-e.curY,e.currentX=e.curX/e.currentScale+_-_/e.currentScale,e.currentY=e.curY/e.currentScale+f-f/e.currentScale,t.deltaX=_-t.curX,t.deltaY=f-t.curY,t.currentX=t.curX/t.currentScale+_-_/t.currentScale,t.currentY=t.curY/t.currentScale+f-f/t.currentScale,d}function it(e,t,n){var i,a,o,r,s,l,c,u,d,f,p,h,m,v,A,g=cn.width||getCw(),b=cn.height||getCh(),y=!1,w=(Math.min(50,g/7),j(_)),k=g/w.width,S=b/w.height,C=Math.min(1,k,S),O=T(e).coords,E=geByClass1("zpv_tl",e),I=getW(E),M=getH(E),x=(Math.min((g-30)/Math.max(O.w*w.width*C/100,I),(b-30)/(O.h*w.height*C/100+M+5)),function(){a=w.width*C*n.currentScale,o=w.height*C*n.currentScale,r=g/2-a/2+n.currentX*n.currentScale,s=b/2-o/2+n.currentY*n.currentScale,u=r+O.x*a/100,d=s+O.y*o/100,l=O.w*a/100,c=O.h*o/100,i=u+l/2-I/2,d+c+5,p=Math.min(u,i),f=Math.max(l,I),m=p+f,v=(h=d)+(c+M+5),A={}});return n=(n=$e(A,t,n))||Ue(),x(),p<15?(A.curX=n.curX+(15-p),y=!0):m>g-15&&(A.curX=n.curX-(m-g+15),y=!0),h<15&&(A.curY=n.curY+(15-h),y=!0),n=(n=$e(A,t,n))||Ue(),x(),v>b-15&&(A.curY=n.curY-(v-b+15),y=!0),n=$e(A,t,n),t?n:y}function at(e){je&&(je=!1,N(),e||R(),wt(de,!0),kt(!de,!0),setTimeout(function(){H()},300))}function ot(e,t,n){var i={};return n=n||Ue(),i.lastScale=e,n=$e(i,t,n),!!t&&n}function rt(e,t,n){var i={};if(n=n||Ue(),!ft())return!!t&&n;i.curScale=e,n=(n=$e(i,t,n))||Ue();var a=Qe();return i={currentScale:n.currentScale},n.currentScale<a.min?i.currentScale=n.currentScale+(a.min-n.currentScale)/O.bounce_diff:n.currentScale>a.max&&(i.currentScale=n.currentScale+(a.max-n.currentScale)/O.bounce_diff),n=$e(i,t,n),!!t&&n}function st(e,t){if(!ft())return!1;var n=!1,i={};t=t||Ue();var a=Qe();return t.currentScale<a.min?(i.currentScale=a.min,n=!0):t.currentScale>a.max&&(i.currentScale=a.max,n=!0),t=$e(i,e,t),e?t:n}function lt(e){if(!ft())return!1;var t={pageX:0,pageY:0},n=Ue(),i=null,a=nt(n,i=_t(!0,i=dt(t,!0,i=st(!0,i=rt(e=1==e?1/q:e,!0,i=ut(t,!0,n))))));a&&(N(a),D(n),je=!0),je&&(wt(!1,!0),kt(!1,!0)),ut(t),rt(e),st(),dt(t),_t(),je?D(i,dn,!1,at):R(300),ot(J)}function ct(e){if(!ft())return!1;var t=Ue(),n=null,i=nt(t,n=_t(!0,n=st(!0,n=it(e,!0,t))));i&&(N(i),D(t),je=!0),it(e)&&(he||(he=t)),je&&(wt(!1,!0),kt(!1,!0)),st(),_t(),je?D(n,dn,!1,at):R(dn),ot(J)}function ut(e,t,n){var i={};return n=n||Ue(),i.deltaX=(e.pageX-n.curX)/n.curScale,i.deltaY=(e.pageY-n.curY)/n.curScale,n=$e(i,t,n),!!t&&n}function dt(e,t,n){var i={};n=n||Ue(),i.pointX=e.pageX,i.pointY=e.pageY;var a=We(n.currentScale),o=ze(n.currentScale),r=(!Z&&!o.max&&!o.min||te||!ft())&&!ne;(ne||k&&!Z&&!a.max&&!a.min)&&(i.curX=0),r&&(i.curY=n.curY),n=$e(i,t,n),i={};var s=!1;return(n=n||Ue()).curX<=a.min?ie?(s=!0,i.curBodyX=n.curX-a.min):(i.curX=n.curX+(a.min-n.curX)/O.bounce_diff,i.curBodyX=W?i.curX-a.min:0):n.curX>=a.max&&(ae?(s=!0,i.curBodyX=n.curX-a.max):(i.curX=n.curX+(a.max-n.curX)/O.bounce_diff,i.curBodyX=W?i.curX-a.max:0)),n.curY<o.min?r?i.curY=o.min:ne||(i.curY=n.curY+(o.min-n.curY)/O.bounce_diff):n.curY>o.max&&(r?i.curY=o.max:ne||(i.curY=n.curY+(o.max-n.curY)/O.bounce_diff)),n=$e(i,t,n),t?n:s}function _t(e,t){var n=!1,i={},a=We((t=t||Ue()).currentScale),o=ze(t.currentScale),r=!Z&&!o.max&&!o.min||te||!ft()&&!ne;return ne&&(i.curX=0),r&&(i.curY=t.curY),t.curX<a.min?(i.curX=a.min,i.curBodyX=0,n=!0):t.curX>a.max&&(i.curX=a.max,i.curBodyX=0,n=!0),t.curY<o.min?(i.curY=o.min,n=!0):t.curY>o.max&&(i.curY=o.max,n=!0),t=$e(i,e,t),e?t:n}function ft(){return!g&&(!!k||Nt[Ft.src])}function pt(e){if(scrollTop()||scrollTop(0),!ke){if(e&&"mousedown"==e.type&&preventEvent(e),e.touches&&e.touches.length||!v){if(Xe(),!ee&&!Z){Ce=E(e);var t=We(J);Q<=t.min&&(ie=!1!==zt(Ht+1)),Q>=t.max&&(ae=!1!==zt(Ht-1))}if(ee||g)oe=re=se=!1,le=!1;else{clearTimeout(ue);var n=E(e);oe&&vkNow()-oe<500&&re&&(i=n,o=(a=re).pageX-i.pageX,r=a.pageY-i.pageY,Math.sqrt(o*o+r*r)<50)?(se=vkNow(),le=!1):(oe=vkNow(),re=n,le=vkNow())}g||(ee=!0)}var i,a,o,r;Z||(W=!0,M(!0)),Ae=E(e),tt(),et(Ae),ut(Ae)}}function ht(e){if(!ke&&(preventEvent(e),ee)){if(oe=re=se=!1,le=!1,et(Ae=E(e)),Ee){if(!(Ee<vkNow()))return void tt();Ee=!1,ut(Ae),R()}if(Ce&&!te&&!ne){var t=Math.abs(Ae.pageX-Ce.pageX),n=Math.abs(Ae.pageY-Ce.pageY),i=ze(J);if(!(n>5||t>5))return;n>5&&t<=5&&(1!=J||Z||g||k?(i.max||i.min)&&(ie=ae=!1):(ne=!0,de&&(_e=!0),Et(!1),yt(Ae.pageY-Ce.pageY>0))),Ce=!1,ut(Ae)}!dt(Ae)||te||ne||g||(te=!0,Ae.pageX),function(){if(!ne)return;var e=Math.abs(Y),t=cn.height/2;Ie=1-.5*e/t}(),R(),te&&Math.abs(z)>getCw()&&mt(extend({originalEvent:e},e,{touches:[]}))}}function mt(e){if(!ke)if(Se)Se=!1;else{if(preventEvent(e),e.touches&&!e.touches.length||!v){var t=Ze();if(te)l=t,c=(cn.width||getCw())/2,l=l||0,((z<-c||l<-1)&&ie?(Ke(),1):(z>c||l>1)&&ae?(Je(),1):(_t()&&R(300),0))&&(Fe(),M(!0));else if(ne)Ye(t);else if(se&&vkNow()-se<1e3){!function(e){if(!ft())return!1;var t=Qe(),n={pageX:U,pageY:$},i=(J>1?1:t.max)/q,a=Ue(),o=null;o=_t(!0,o=dt(n,!0,o=rt(i,!0))),e&&(o=_t(!0,o=it(e,!0,o)));var r=nt(a,o);r&&(N(r),D(a),je=!0),je&&(wt(!1,!0),kt(!1,!0)),rt(i),dt(n),_t(),e&&(it(e),_t()),je?D(o,dn,!1,at):R(dn),ot(J),jt()}(o=e&&fe&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target))),oe=re=se=!1}else _t()?R(300):t&&(_t(),R(t,"cubic-bezier(0, 1, 1, 1)"));if(setTimeout(function(){H()},300),le)if(vkNow()-le>700||e&&"touchcancel"==e.type)le=!1;else{if(le=!1,e)var n=hasClass("zpv_header",e.target)?e.target:gpeByClass("zpv_header",e.target),i=hasClass("zpv_zoom_btns",e.target)?e.target:gpeByClass("zpv_zoom_btns",e.target),a=hasClass("zpv_bottom_body",e.target)?e.target:gpeByClass("zpv_bottom_body",e.target),o=fe&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target)),r=me&&e.target.closest(".Photo__marketTag"),s=fe&&e.target.closest(".Photo__marketShowMoreButton");e&&(n||i||a||o||r||s)?o?function(e,t){if(!we)return!1;if(!fe)return!0;T(e);if(hasClass("zpv_tag_selected",e))return hasClass("zpv_tl_wrap",t.target)||gpeByClass("zpv_tl_wrap",t.target)?sn.go(e,t):(ct(e),cancelEvent(t),!1);pe&&(oe=re=se=!1),removeClass("zpv_tag_selected",pe),pe=e,Ot(e),addClass("zpv_tag_selected",pe);de&&(_e=!0);Et(!1),ct(e),cancelEvent(t)}(o,e):i?(oe=re=se=!1,hasClass("zpv_zoomin",e.target)||gpeByClass("zpv_zoomin",e.target)?function(e){!!we&&(rn.highlight=!1,rn.end(e),!Z&&!te&&(!(Qe().max<=J)&&(cancelEvent(e),lt(k?1.25:1.45))))}(e):function(e){!!we&&(rn.highlight=!1,rn.end(e),!Z&&!te&&(!(Qe().min>=J)&&(cancelEvent(e),lt(k?.8:1))))}(e)):r?sn.go(r.dataset.url):s&&Ut._openItemsPopup(s.dataset.itemsJson):pe?xt(e):k||(ue=setTimeout(function(){Et(),wt(de),kt(!de)},500))}ee=!1,te=ie=ae=!1,tt()}var l,c;e.touches&&(e.touches.length>1||1==e.touches.length&&te)&&ut(Ae=E(e)),(e.touches&&!e.touches.length||!v)&&(Ce=!1)}}function vt(e){if(!ke&&(preventEvent(e),oe=re=se=!1,le=!1,tt(),!te&&!ne)){G=1,q=J,Z=!0,ie=ae=!1;var t=We(J);(t.min>=-5||t.max<=5)&&(W=!1,M(!1)),ut(E(e)),wt(!1,!0),kt(!1,!0)}}function At(e){ke||(preventEvent(e),oe=re=se=!1,le=!1,tt(),te||ne||(be=E(e),rt(e.scale),dt(be),R(),jt()))}function gt(e){ke||(preventEvent(e),oe=re=se=!1,le=!1,tt(),te||ne||(st()&&((e.touches&&e.touches.length||!v)&&dt(be),_t(),R(100),Ee=vkNow()+100),Z=!1,wt(de,!0),kt(!de,!0)))}function bt(e){var t=Qe(),n=e<t.max,i=e>t.min;toggleClass("zpv_zb_disabled",u,!n),toggleClass("zpv_zb_disabled",d,!i)}function yt(e){e?setStyle(a,{top:-35,bottom:"auto"}):setStyle(a,{top:"auto",bottom:-35}),a.is_down=e}function wt(e,t){var n=fe;if(e){if(!ft())return;if(!de&&!_e||Z)return}fe=e,e&&Ct(J,X,K,t||n!==e),n!==e&&(e&&Ot(pe),St(h,e,t))}function kt(e,t){var n=me;me=e,e&&Ct(J,X,K,t||n!==e),St(m,e,t)}function St(e,t,n){e&&setStyle.animate(e,!n&&"opacity",{duration:200,func:"linear"},function(){setStyle(e,"visibility",t?"visible":"hidden")}),e&&setStyle(e,"visibility",t||!n?"visible":"hidden"),e&&setStyle(e,"opacity",t?1:0)}function Ct(e,t,n,i){if(!Z){var a=cn.width||getCw(),o=cn.height||getCh(),r=j(_),s=a/r.width,l=o/r.height,c=Math.min(1,s,l),u=r.width*c*e,d=r.height*c*e,f=a/2-u/2+t*e,p=o/2-d/2+n*e;fe&&(i&&h&&setStyle.animate(h),setStyle(h,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(h,{translate:[Math.round(f),Math.round(p)]})),me&&(i&&m&&setStyle.animate(m),setStyle(m,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(m,{translate:[Math.round(f),Math.round(p)]}),ve||(!function(){function e(e,t){var n=e.getBoundingClientRect(),i=m.getBoundingClientRect();n.left<i.left+t?e.style.left=i.left-n.left+t+"px":n.right>i.left+i.width-t&&(e.style.left=i.left+i.width-n.right-t+"px")}Array.from(m.children).forEach(function(t){if(t.classList.contains("Photo__marketTag")){var n=t.$(".Photo__marketTagInner"),i=t.$(".Photo__marketTagArrow");e(n,10),e(i,20)}})}(),ve=!0))}}function Ot(e){if(e){var t=j(_),n=cn.width||getCw(),i=cn.height||getCh(),a=n/t.width,o=i/t.height,r=Math.min(1,a,o),s=t.width*r*J,l=t.height*r*J,c=T(e).coords,u=geByClass1("zpv_tl",e),d=getW(u),f=getH(u),p=c.x*s/100,h=c.y*l/100,m=c.w*s/100,v=c.h*l/100,A=p+m/2-d/2,g=h+v+5,b=n>s?0-(n-s)/2:0,y=n>s?s+(n-s)/2:s,w=i>l?l+(i-l)/2:l,k=0,S=0;A<b+2?k=b+2-A:A+d>y-2&&(k=y-2-A-d),g+f>w-5&&(S=v>3*f?w-5-g-f:-v-f-10),setStyle.transform(u,{translate:[Math.ceil(k),Math.ceil(S)]})}}function Et(e){if(void 0!==e){if(de===e)return;de=!e}else _e=!1;setStyle(n,"width","auto"),n&&setStyle.animate(n,"opacity",{duration:200,func:"linear"},function(){setStyle.animate(n),setStyle(n,"width",de?"auto":0)}),de?(setStyle(n,"opacity",0),de=!1):(setStyle(n,"opacity",1),de=!0)}function jt(){cn.height<604&&!pe&&!k&&(J>1.25?(de&&(_e=!0),Et(!1)):_e&&(_e=!1,Et(!0)))}function Tt(e){we&&(ee||Z||te||e&&e.touches&&e.touches.length>1||(cancelEvent(e),_n.close()))}function It(e){if(!(ee||Z||te||!e||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=We(J);37==e.keyCode?(cancelEvent(e),Q>=t.max&&!1!==zt(Ht-1)&&(M(!0),Je())):39==e.keyCode?(cancelEvent(e),Q<=t.min&&!1!==zt(Ht+1)&&(M(!0),Ke())):27==e.keyCode&&Tt(e)}}function Mt(){k?fn():(wt(fe,!0),kt(me,!0))}function xt(e,t){return!(!we&&!t)&&(!pe||(removeClass("zpv_tag_selected",pe),pe=!1,_e&&J<=1.25&&(_e=!1,Et(!0)),cancelEvent(e),!1))}function Pt(e){"touchstart"==e.type?we=!e.touches||1==e.touches.length:"touchmove"==e.type?(we=!1,preventEvent(e)):"click"==e.type&&(we||(cancelEvent(e),we=!0))}function Bt(e){"touchstart"==e.type?ke=!0:"touchmove"==e.type?(ke=!0,preventEvent(e)):(ke=e.touches&&e.length,Se=!ke)}var Lt=!1,Nt={},Ht=!1,Vt=!1,Ft=!1,$t=!1,qt=!1;function Wt(e,t,n,i){var a=t||len(e);if(e&&!n||(Lt=null),Lt||(Lt=new Array(a)),Lt.length!=a){var o=Lt;Lt=new Array(a),extend(Lt,o)}extend(Lt,e);var r=function(e){for(var t in Lt)if(Lt[t].id==e)return+t;return-1}(Ft.id);-1==r&&(r=Ht),i||en(r)}function zt(e){return!(e>=Lt.length)&&(!(e<0)&&(Lt[e]||{src:!0}))}function Qt(e,t,n){var i=j(e),a=qe();k&&(Lt[0].loaded=t,t&&(i.width>i.height?setStyle(e,{height:a.height}):setStyle(e,{width:a.width}),setStyle(e,{minWidth:0,maxWidth:"none"})),fn(!0));if(Zt()){if(i.width*an>=a.width){var o=a.width/(i.width||i.clientWidth);if(i.height*o>=a.height)return;G=o,q=o,J=o,setStyle.transform(_,o)}"VIDEO"===e.tagName&&e.play()}show(e),_===e&&(wt(t,!t),kt(t&&!de,!t))}function Gt(e,t){if(void 0===t&&(t=!1),Nt[e])Xt(e);else if(t){var n=ce("video",{src:e}),i=!1,a=function(){i||(i=!0,Nt[e]=!0,Xt(e),n=null)};addEvent(n,"canplay",a),addEvent(n,"onload",a),n.load()}else{var o=new Image;o.addEventListener("load",function t(){Nt[e]=!0,Xt(e),o.removeEventListener("load",t),o=null},!1),o.src=e}}function Xt(e){[_,f,p].forEach(function(t){var n=gpeByClass("zpv_thumb_item",t),i=attr(t,"data-src");i===e&&(t.src=i,Qt(t,!0),"VIDEO"!==t.tagName&&removeClass("zpv_ti_loading",n),attr(t,"data-src",!1),Zt()&&statlogsValueEvent("gif_play",0,"VIDEO"===t.tagName?"mp4":"gif"))})}function Kt(e,t,n,i){void 0===i&&(i=!1);var a=gpeByClass("zpv_thumb_item",e);i&&(addClass("zpv_ti_loading",a),setTimeout(function(){setStyle(_,{display:"block"})})),i&&(n=!1),t?!0!==t?e.src===t?Qt(e,!0):Nt[t]?(e.src=t,Qt(e,!0)):(n?(e.src=n,Qt(e,!1)):hide(e),attr(e,"data-src",t),Gt(t,i),addClass("zpv_ti_loading",a)):(n?(e.src=n,Qt(e,!1)):hide(e),addClass("zpv_ti_loading",a)):hide(e)}function Jt(){if(b){!function(){window.lang;var e="";if(Zt())e=getLang("mobile_gif_popup_title");else{e=getLang("mobile_photos_photoview_header")||"";var t=!1!==ye?ye:Ht;e=(e=e.replace("%s",t+1)).replace(/%s|{count}/,Lt.length)}val("zpv_summary",e)}(),bt(J);var e=zt(!1!==ye?ye:Ht);if(e&&!0!==e.src){var t="";each(e.tags,function(e,n){if(!e||0==e)return!0;var i=I(n),a=i.coords,o=i.href?' data-href="'+i.href+'" data-name="'+escapeAttr(i.name)+'"':"",r=i.al?(i.href?" al"+i.al:"")+" "+i.al:"";t+='<div class="zpv_tag'+r+'" style="left: '+a.x+"%; top: "+a.y+"%; width: "+a.w+"%; height: "+a.h+'%;" data-id="'+e+'"'+o+'><div class="fill"></div><div class="zpv_tl_wrap" id="zpv_tl_wrap"><div class="zpv_tl'+(i.href?"":" zpv_tl_plain")+'">'+htsc(i.name)+"</div></div></div>"});var n="",a=e.market_tags&&e.market_tags.tags,s=a&&a.length,c="";s&&(c=l.default.html(Dt({items:escape(JSON.stringify(a))})),a.forEach(function(e){n+=l.default.html(Rt(e))})),val(h,t),val(m,n),val(o,'<div class="zpv_photo_desc">'+(e.caption||"")+"</div>"+c+'<div class="zpv_bottom_bg"></div>'),toggle(o,!!e.caption||s);var u="";if(y||sn.getQuery("community"))u="";else{var d=e.tags&&e.tags[0]||0;u="<tr>"+('<td class="row_table_column"><a href="'+e.like_url+'" class="item_button item_like'+(e.likes_me?" item_likes_me":"")+'" onclick="return photoview.likePhoto(this, \''+e.id+'\');"><i class="i_icon i_like"></i>'+(e.likes_cnt?'<b class="v_value v_like">'+formatNum(e.likes_cnt)+"</b>":"")+"</a></td>")+('<td class="row_table_column"><a href="'+e.photo_url+'#comments" class="item_button item_replies al_photo" onclick="return photoview.openPhoto(this, event, true);"><i class="i_icon i_replies"></i>'+(e.replies_cnt?'<b class="v_value v_replies">'+e.replies_cnt+"</b>":"")+"</a></td>")+('<td class="row_table_last_column"><a href="'+e.photo_url+'" class="item_button item_tags al_photo" onclick="return photoview.openPhoto(this, event);"><i class="i_icon i_tags"></i>'+(d?'<b class="v_value v_tags">'+d+"</b>":"")+"</a></td>")+"</tr>"}val(r,u),nn(e.photo_url),show(i)}else hide(i)}}function Zt(){return Ft.isDoc}function en(e){b&&(Ht=Math.max(0,Math.min(e||0,Lt.length)),Ft=zt(Ht),qt=zt(Ht-1),$t=zt(Ht+1),Kt(_,Ft.src,"/images/mobile/blank.gif",Ft.hasVideo),Kt(p,$t.src),Kt(f,qt.src),Jt(),_n.onUpdate&&_n.onUpdate())}function tn(){if(b&&w&&Lt){var e=Lt[0];if(!e.loaded&&e.progress){var t=geByClass1("zpvu_progress","zpv_center");setStyle(t,{width:100*e.progress+"%",visibility:"visible"})}if(!e.read&&e.thumb){e.read=!0;var n=geByClass1("zpv_upload_box","zpv_center"),i=geByClass1("zpv_upload_img",n);setStyle(i,{backgroundImage:"url("+e.thumb+")"}),removeClass("zpv_thumb_uploading",n)}}}function fn(t){if(b&&k&&Lt){var n=Lt[0],i=!!n.saving;if(toggleClass("item_disabled","zpv_save_button",i||!n.loaded),toggleClass("item_disabled","zpv_cancel_button",i),toggleClass("zpv_crop_saving",e,i),g=i,t||Kt(_,n.src,"/images/mobile/blank.gif"),n.loaded&&n.rect&&!n.rect_inited){n.rect_inited=!0;var a=qe(),o=n.rect[0],r=n.rect[1],s=n.rect[2],l={};l.currentScale=1/s,$e(l),st(),_t(),l={};var c=(_.width||_.clientWidth)*J,u=(_.height||_.clientHeight)*J,d=o*c,f=r*u;l.curX=(c-a.width)/2-d,l.curY=(u-a.height)/2-f,$e(l),_t(),R(0)}}}function pn(s,l){void 0===s&&(s=!1),void 0===l&&(l=!1),b||(le=!1,ue=!1,de=!0,_e=!1,ye=!1,we=!0,ke=!1,Se=!1,Te=!1,Ie=!1,g=!1,y=!1,w=!1,k=!1,Fe(),function(s,l){void 0===s&&(s=!1),void 0===l&&(l=!1);var v=window.lang,A="";A=s?Yt(l):'<div id="z_photoview"><div class="zpv_siblings"><div id="zpv_left" class="zpv_thumb_item"><img class="zpv_img" alt=""></div><div id="zpv_right" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_body"><div id="zpv_center" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_close_msg_wrap"><div class="zpv_close_msg">'+v.mobile_zphoto_move_to_close+'</div></div><div class="zpv_controls"><div class="mhead zpv_header"><a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a><div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div></div><div class="zpv_zoom_btns"><a class="zpv_zoom_btn zpv_zoomin"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a><a class="zpv_zoom_btn zpv_zoomout"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a></div><div class="zpv_bottom"><div class="zpv_photo_desc_wrap"></div><div class="zpv_bottom_body"><table class="zpv_values like_box row_table"></table></div></div></div><div class="zpv_tags"></div><div class="zpv_market_tags"></div><div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div></div>';var g="/images/mobile/zpv_icons"+(hasClass("x2",window.bodyNode)?"_2x":"")+".png?2";(new Image).src=g,cn.create(A,hn),e=ge("z_photoview"),geByClass1("zpv_body",e),t=geByClass1("zpv_siblings",e),n=geByClass1("zpv_controls",e),c=geByClass1("zpv_zoom_btns",e),a=geByClass1("zpv_close_msg_wrap",e),i=geByClass1("zpv_bottom",e),o=geByClass1("zpv_photo_desc_wrap",e),r=geByClass1("zpv_values",i),u=geByClass1("zpv_zoomin",c),d=geByClass1("zpv_zoomout",c),h=geByClass1("zpv_tags",e),m=geByClass1("zpv_market_tags",e),geByClass1("zpv_crop",e),_=geByClass1("zpv_img","zpv_center"),f=geByClass1("zpv_img","zpv_left"),p=geByClass1("zpv_img","zpv_right"),"VIDEO"===_.tagName&&(_.controls=!1)}(s,l),function(){if(v=void 0!==document.ontouchmove,A=!1,v){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);addEvent(t,"touchstart touchmove touchend touchcancel",Bt),addEvent(n,"touchstart touchmove touchend touchcancel",Bt),addEvent(e,"touchstart touchmove click",Pt),addEvent(e,"touchstart",pt),addEvent(e,"touchmove",ht),addEvent(e,"touchend touchcancel",mt),A?(addEvent(e,"gesturestart",vt),addEvent(e,"gesturechange",At),addEvent(e,"gestureend",gt)):(addEvent(e,"touchstart",De),addEvent(e,"touchmove",Ne),addEvent(e,"touchend touchcancel",He),addEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else addEvent(e,"mousedown",pt),addEvent(e,"mousemove",ht),addEvent(window,"mouseup",mt),addEvent(window,"mousewheel",Ve),addEvent(window,"keydown",It)}(),b=!0,reflow(e),scrollTop()||scrollTop(0))}function hn(){b&&(!function(){if(v){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);removeEvent(t,"touchstart touchmove touchend touchcancel",Bt),removeEvent(n,"touchstart touchmove touchend touchcancel",Bt),removeEvent(e,"touchstart touchmove click",Pt),removeEvent(e,"touchstart",pt),removeEvent(e,"touchmove",ht),removeEvent(e,"touchend touchcancel",mt),A?(removeEvent(e,"gesturestart",vt),removeEvent(e,"gesturechange",At),removeEvent(e,"gestureend",gt)):(removeEvent(e,"touchstart",De),removeEvent(e,"touchmove",Ne),removeEvent(e,"touchend touchcancel",He),removeEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else removeEvent(e,"mousedown",pt),removeEvent(e,"mousemove",ht),removeEvent(window,"mouseup",mt),removeEvent(window,"mousewheel",Ve),removeEvent(window,"keydown",It)}(),e=t=n=a=!1,i=r=!1,c=u=d=!1,_=f=p=h=!1,b=!1,Lt=null)}return{onShow:Object(s.default)(),onHide:Object(s.default)(),likePhoto:function(e,t){return!!we&&(rn.highlight=!1,rn.end(),Ft.likes_me?(Ft.likes_me=!1,--Ft.likes_cnt):(Ft.likes_me=!0,++Ft.likes_cnt),Jt(),on.click(e,extend({photo_id:t},ln)))},openPhoto:function(e,t,n){var i=window.cur;if(!we)return!1;var a=i.replyNames,o=i.sticker_panel,r=i.stickers,s=sn.go(e,t,{local:!0,fast:!0,beforeAppend:function(e){val(geByClass1("mcont",e),'<div class="pcont"><div class="media_view photo_view"><div class="pv_summary"><div class="summary_loading" style="display: none;"><i class="i_loading"></i></div></div><div class="pv_tag_wrap"></div><div class="pv_body pv_touch pv_touch_full pv_hidden_icons"><a class="thumb_item"><div class="pv_photo_wrap" id="pv_photo_tags" onclick="return photo.closeTags(event);"><img src="/images/mobile/blank.gif" class="ph_img" alt="" /></div></a><div class="pv_nav"><table class="row_table pv_nav_cont"><tr><td class="pv_nav_left"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_z"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_right"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td></tr></table></div></div><div class="pv_footer"></div></div></div>'),val("m",e.innerHTML)}});if(extend(i,{replyNames:a,sticker_panel:o,stickers:r,processNav:function(e){var t;if(t=/^\/photo(-?\d+_\d+)$/i.exec(e.nav.path)){var n=qs2obj(e.nav.params),i=qs2obj(sn.params);if(n.act)return!1;if(n.offset!=i.offset)return!1;if(n.list!=i.list&&!i.z)return!1;if(n.reply!==i.reply)return!1;if(n.reply_to!==i.reply_to)return!1;e.onPreNav&&e.onPreNav();var a=n.list||"",o=n.rev?"/rev":"";return!un.open(t[1],a+o,null,n.from,!0)}return!1}}),i.destroy.push(function(){un.clear()}),window.lang,!s&&!(s=sn.go(e,t,{force:!0}))){if(cn._lastNav){var l=cn._lastNav,c=qs2obj(l.params);delete c.z,l.path+obj2qs(c)+l.hash}un.showIcons()}return!0},closePhoto:Tt,savePhoto:function(e,t){if(!we)return!1;if(rn.highlight=!1,rn.end(),hasClass("item_disabled",e))return!1;if(!k||!Lt)return!1;var n=Lt[0],i=qe(),a=_.width*J,o=(_.height||_.clientHeight)*J,r=(a-i.width)/2-Q,s=(o-i.height)/2-Y,l=1/J,c=r/a,u=s/o;return n.onSelect&&n.onSelect(c,u,l),!1},cancelPhoto:function(e,t){return!!we&&(rn.highlight=!1,rn.end(),!hasClass("item_disabled",e)&&Tt())},onClose:null,onUpdate:null,onPhotoChange:null,saveSource:Wt,opened:function(){return b},openCrop:function(t,n){n=n||{};var a=!b;w?w=!1:pn(),k=!0,g=!1,Lt=[t],a&&(cn.open(),cn.onResize=Mt),function(){if(b&&k){var t=window.lang;val("zpv_summary",t.mobile_zphoto_owner_crop_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_crop",e),bt(J),_.parentNode||(val("zpv_center",""),append(_,"zpv_center"));var n='<tr><td class="row_table_column"><a class="item_button" id="zpv_save_button" onclick="return photoview.savePhoto(this);"><i class="i_icon i_save"></i><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" id="zpv_cancel_button" onclick="return photoview.cancelPhoto(this);"><i class="i_icon i_cancel"></i><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),show(i),fn()}}()},updateCrop:function(e){if(!Lt)return!1;e=extend(Lt[0]||{},e),Lt=[e],fn()},openUpload:function(t,n){n=n||{},pn(),w=!0,g=!0,Lt=[t],cn.open(),cn.onResize=Mt,function(){if(b&&w){var t=window.lang;val("zpv_summary",t.mobile_zphoto_upload_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_upload",e);remove(_),val("zpv_center",'<div class="zpva zpv_upload_box zpv_thumb_uploading"><div class="zpv_upload_img"></div><div class="zpvu_progress_wrap"><div class="zpvu_progress"></div></div></div>');var n='<tr><td class="row_table_column" width="50%"><a class="item_button item_disabled" onclick="return false;"><i class="i_icon i_save"></i><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" onclick="return photoview.cancelPhoto(this);"><i class="i_icon i_cancel"></i><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),show(i),tn()}}()},updateUpload:function(e){if(!Lt)return!1;e=extend(Lt[0]||{},e),Lt=[e],Ft=!1,tn()},open:function(e,t,n){var i,o;_n.onShow(),pn((n=n||{}).isDoc,n.hasVideo),y=n.local||!1,t&&Wt(t,!1,!1,!0),en(e),Vt=0,cn.open(),cn.onResize=Mt,i=geByClass1("zpv_close_msg",a),o=getW(i),setStyle(a,{width:o||250})},close:function(){_n.onHide(),_n.onClose&&_n.onClose({local:y})||cn.close()}}}();window.photoview=_n;n("ldCb");window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,a){var o=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:a},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(o)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,a,o,r,s,l){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,i,a,o,r,s){var l={_ajax:1,act:"hide_internal_notification",reason:i,id:t,hash:n},c={},u=gpeByClass("_block",e),d=!0;if("decline"==i){var _=this.webActionsDeclineHandlers[o];d=this.runActionHandler(_,e,l,c,r,n),hide(u)}else{var f=this.webActionsAcceptHandlers[o];d=this.runActionHandler(f,e,l,c,r,n),lockButton(e),"add_custom_newsfeed"==o&&(Object(Ie.setCookie)("remixcustom_feed_added",r),l.action=o,l.action_section=r.section,l.action_hash=r.hash)}return c.onDone=function(){"compact"===s&&"accept"===i||cur.destroy.push(function(){return remove(u)}),~this.withoutNavActions.indexOf(o)||nav.go(e,a)}.bind(this),c.onFail=function(){unlockButton(e)},Promise.resolve(d).then(function(e){(e||isUndefined(e))&&ajax.post("/index.php",l,c)}),!1}),runActionHandler:function(e,t,n,i,a,o){return!isFunction(e)||e(t,n,i,a,o)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}},function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?Object(Ie.setCookie)("remixm_tabs_expanded","",-1):Object(Ie.setCookie)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}(),window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",a=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!a,hash:n,audio_id:t,ref:cur.module}),a?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),i="";cur&&cur.module?i=cur.module:nav&&"/feed"===nav.cur?i="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(i="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,i),ze.default.open(n,!0)}};var fn=n("p5n7");function pn(e,t){var n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option"),o=$(".Btn__text",a);e?(n.style.display="inline-block",n.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},a.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},o.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):(a.onclick=function(n){return posting.openCopyright(n,!1,t,encodeURIComponent(e))},setStyle(a,"display","table"),o.innerHTML=getLang("mobile_wall_post_copyright_add_button"),hide(n)),val(i,e),post.checkCopyright()}var hn={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var a=new RegExp("{link}(.*){/link}"),o=a.exec(getLang("mobile_wall_post_copyright_mb_text"))[1],r="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),s=getLang("mobile_wall_post_copyright_mb_text").replace(a,"<a onclick=\"Popup.close(this); nav.go('"+r+'\', null)" href="'+r+'">'+o+"</a>"),l=Object(Fe.default)({class:"AddCopyrightPopup",header:{title:e?getLang("mobile_wall_post_copyright_mb_title_text_edit"):getLang("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(s)},Object(fn.default)({class:"AddCopyrightPopup__input",placeholder:getLang("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:e?getLang("mobile_wall_post_copyright_edit_button"):getLang("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?Btn({class:"Popup__button",inner:getLang("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});Fe.default.open(Wd.elem(l),!0);var c=$(".AddCopyrightPopup__input input");c&&Object(i.elfocus)(c)},submit:function(e,t,n){var i=$(".Btn",n.parentNode);i.disabled=!0,ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(a){var o=$(".AddCopyrightPopup__error");a.status?(n.classList.remove("TextInput_error"),hide(o),pn(e,t),Fe.default.close(n)):(n.classList.add("TextInput_error"),show(o),val(o,a.error)),post.saveDraft(null,t),i.disabled=!1}})},remove:function(e,t){t&&Fe.default.close(t),pn("",e),e&&post.saveDraft(null,e)}};window.AddCopyrightPopup=hn;var mn=hn,vn={getHash:function(){var e=Object(g.$)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,i){cancelEvent(e);var a=!1;if("BUTTON"===e.target.tagName)a=e.target.disabled;else if("LABEL"===e.target.tagName){a=Object(g.$)("button",e.target).disabled}a||mn.open(t,n,i)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=Object(g.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),i=n.querySelector("input");mn.submit(i.value,e,n)},deleteSource:function(e,t,n){var i=Object(g.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),mn.remove(n,i)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,vn.getHash(),""+nav.path+obj2qs(n))}};window.posting=vn;n("wyHI");var An={},gn=function(e,t,n,i){delete An[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var bn,yn={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var a=attr(e,"data-sticker-id"),o=attr(e,"data-hash");return!(!a||!o)&&(!An[a]&&(An[a]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:a,hash:o},{onDone:gn.pbind(n,a,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};return window.isMVK?rs(window.store.stickers.url_template,n):getTemplate("stickers_sticker_url",n)}},wn=function(){var e,t,n,i=!1,a=!1,o={},r={},s={},l={};function c(e){var t=_(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",function a(o){var r=!0;i>=++n&&(r=!1),r&&(d(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",a),t.stop())})}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function d(e,t){l[u(e)]=t}function _(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=r[t];return n||!1}function f(e,t){var i=_(e);if(i)"function"==typeof t&&t(i);else{var a=attr(e,"data-uniq-id");if(!l[u(e)]){d(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),f=!1;if(c&&(f=o[c]?h(e):s&&h(e)),f){var p={container:e,renderer:"svg",loop:!0,autoplay:!1,name:a,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};o[c]?p.animationData=o[c]:p.path=s;var m=geByClass1("svg_sticker_animation",e);if(m&&re(m),i=n.loadAnimation(p),!o[c])return void i.addEventListener("data_ready",function(){o[c]=i.animationData,r[a]=i,"function"==typeof t&&t(i)})}"function"==typeof t&&(r[a]=i,"function"==typeof t&&t(i))}}}function p(){return t().then(function(e){return n=e,e})}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);wn.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");wn.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(n));wn.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,function(e,t){f(t,function(){c(t)})}),i=!1}}else p().then(function(){wn.loadAutoplayAnimationStickers(e)})},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame(function(){f(e,function(){c(e)})}):p().then(function(){wn.loadAndPlaySticker(e)}))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!s[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(s[e]=setTimeout(function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(wn.loadAndPlaySticker(n),clearTimeout(s[e]),s[e]=!1)},t))}},reloadStickers:function(){r={}},touchStartSticker:function(t){t.addEventListener("contextmenu",wn.preventContextMenu,!1),e=setTimeout(function(){wn.loadAndPlaySticker(t)},500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function h(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}(),kn={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return kn.autoplay}};function Sn(){return qs2obj(nav.params)}function Cn(e){return"dialogs"===e.tab||!e.q}function On(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function En(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,a){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(a?'<div class="si_slabel">'+a+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:_.default.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}wn.init({animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then(function(e){return e.default})}}),window.Stickers=yn,window.StickersAnimation=wn,window.StickersSettings=kn,im.clearSearchInput=function(e){if(preventEvent(e),Cn(Sn())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+On(!0))},im.onFilterKeyDown=function(e){setTimeout(function(){var t=window.lang,n=encodeURIComponent(e.value),i=Sn();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+On():"/mail"+On(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+On()),Cn(i)){var a,o=ge("mail_tabs"),r=ge("ma_search_items"),s=ge("dialogs"),l=i.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),bn&&clearTimeout(bn),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(o),show(r),hide(s),bn=setTimeout(function(){a="/mail?tab=dialogs&q="+n+(l?"&offset="+l:"")+On(),"/mail"!==nav.path||Sn().act||nav.go(a,null,{push_only:!0})},200);else{if(hide(o),hide(r),show(s),!nav.getQuery("community")){var c=geByClass1("mhb_back"),u=geByClass1("mh_header");val(u,t.mobile_mail_head_title),removeClass("mhi_back",u),c.outerHTML=c.outerHTML.replace("<a","<div").replace("</a>","</div>")}a="/mail"+(l?"?offset="+l:"")+On(!l),nav.go(a,null,{push_only:!0})}}},40)},mail.onShowWritePageFromCache(En),mail.onShowDialogsPageFromCache(En);var jn=n("vuIU"),Tn="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",In=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(e=e||'audio/mpeg; codecs="mp3"',!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==Tn?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)}),addEvent(t,"stalled",function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))}),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())}),this.opts.onEnd&&addEvent(t,"ended",function(){n._currentAudioEl==t&&n.opts.onEnd()}),this.opts.onSeeked&&addEvent(t,"seeked",function(){n._currentAudioEl==t&&n.opts.onSeeked()}),this.opts.onSeek&&addEvent(t,"seeking",function(){n._currentAudioEl==t&&n.opts.onSeek()}),addEvent(t,"error",function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()}),addEvent(t,"canplay",function(){if(window.data){var e=window.data(t,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),window.data(t,"setUrlTime",0))}n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))}),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,Tn),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,Tn);var a=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout(function(){a.opts.onCanPlay&&a.opts.onCanPlay()}),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,Tn);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,Tn),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;n.src&&ut(n).catch(function(){debugLog("Audio: url set failed (html5 impl)")})},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,Tn)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var a=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),a+=i;if(i<0?a<=e:a>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(a)}.bind(this))},Object(jn.default)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();In.STATE_HAVE_NOTHING=0,In.STATE_HAVE_FUTURE_DATA=3,In.HAVE_ENOUGH_DATA=4,In.AUDIO_EL_ID="ap_audio";var Mn=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout(function(){n._checkFlashLoaded()},50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout(function(){i._checkFlashLoaded()},100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},Object(jn.default)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=Mn,Mn.PLAYER_EL_ID="flash_voice";var xn=35;void 0===window.isTouch&&(window.isTouch=!1);var Pn,Bn=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=xn),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var o=e.classList,r=0,s=o.length;r<s;r++)addClass(this._el,o[r]);else this._el.className=e.className;each(this._el.attributes,function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)}),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=debounce(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),a=this._width;if((i=t?Math.min(Math.max(0,i),a):i)>=0&&i<=a){var o=i/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,o):o;var r=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var a=n?e:this._unlogf(e);a=100*a+"%",setStyle(this._amountEl,{width:a}),setStyle(this._handlerEl,{left:a}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},Object(jn.default)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}(),Ln=n("Xrg9"),Rn=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window&&Object(v.partConfigEnabled)("chrome_global_media_controls");var Dn=!1,Nn=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var i={onEnd:function(){t.detach()},onFail:function(){i.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};Pn=!1,In.isSupported()?(In.isSupported('audio/ogg;codecs="opus"')&&!In.isSupported('audio/ogg;codecs="codec_check"')&&(Pn=!0),this._impl=new In(i)):browser.flash&&window.renderFlash&&(this._impl=new Mn(i)),this.onPlayPause=function(e){return cancelEvent(e),t._clearMediaSession(),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new Bn(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var t=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(t.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(t.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.appendChild(this._el),this._clearMediaSession()},t._clearMediaSession=function(){var e=this;Rn&&(navigator.mediaSession.setActionHandler("play",function(){return e.play()}),navigator.mediaSession.setActionHandler("pause",function(){return e.pause()}),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise(function(n,i){t._impl.onReady(function(){t._impl.setUrl(attr(e,Pn?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})})});this._impl.setUrl(attr(e,Pn?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&Object(kt.statlogsValueEvent)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval(function(){var t=e._impl.getCurrentProgress();e._updateProgress(t)},100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[Be.PLAY_REQUESTED,Be.PLAY],function(){delete window.ap.pausedByMsg,e.pause()}):window.audio&&window.audio.subscribe([Be.PLAY_REQUESTED,Be.PLAY],function(){delete window.audio.pausedByMsg,e.pause()}),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",function(){e.pause()}),window.Notifier.addRecvClbk("video_start","audio_msg",function(){e.pause()}))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(Dn=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&Dn&&(Dn=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&(ut(window.audio).catch(function(){}),delete window.audio.pausedByMsg)},Object(jn.default)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!Ln.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==Ln.default.get("audio_time_left")},set:function(e){window.AudioPlayer?Ln.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):Ln.default.set("audio_time_left",e?"1":"0")}}]),e}(),Hn={avg:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}(),peak:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}(),quad:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},Vn=function(){function e(e){this._normalizeAlgorithm=!1,Hn[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new Hn[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,Hn[e.algorithm]||(e.algorithm="peak"),this._algorithm=new Hn[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var a=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),a>0)for(var o=0;o<n.length;o++)n[o]=n[o]/a,this._truncateTo>0&&(n[o]=Math.min(this._truncateTo,Math.abs(n[o])))}return n},e}();var Fn=null,Un=4;function $n(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=0,i=0;i<t.length;i++){try{n=parseInt(window.getComputedStyle(t[i],null).getPropertyValue("width"))}catch(e){n=parseInt(t[i].currentStyle.width)}if(n>0)break}return n}function qn(e,t){var n,i,a;t=Math.round(t),e.length!=t&&(i=t,void 0===a&&(a="peak"),e=new Vn({srcSampleRate:(n=e).length,dstSampleRate:i,normalizeAlgorithm:a,truncateTo:0}).push(n));for(var o="",r=0,s=0;s<e.length;s++)0===(r=Math.floor(8*e[s]*.95))&&(r=.5),o+="M"+(s*Un+1)+","+(10-r)+"v"+2*r+"Z";return'<svg class="audio-msg-track--wave" width="'+e.length*Un+'px"><path d="'+o+'"></path></svg>'}function Wn(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=Object(i.attr)(e[t],"data-wave");Object(i.hasClass)(e[t],"audio-msg-player")&&t>0&&(n=Object(i.attr)(e[t-1],"data-wave"));var a=$n(e[t]);if(n&&a){n=n.split(",");for(var o=geByClass("audio-msg-track--wave",e[t]),r=qn(n,a/Un),s=0;s<o.length;s++){var l=Object(i.ce)("div",{innerHTML:r}).firstChild;o[s].parentNode.replaceChild(l,o[s])}}}}function zn(){return Fn||(Fn=new Nn({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),Fn}addEvent(window,"orientationchange",function(){return setTimeout(Wn,500)}),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(Wn),window.mail.onMessagesRepainted(Wn)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t){var n=zn(),i=n.attachTo(e);!0===i?n.play():i.then(function(){n.play()})},detachPlayer:function(e){zn().detach(e)},pauseGlobalMedia:function(){Nn.pauseGlobalMedia()},resumeGlobalMedia:function(){Nn.resumeGlobalMedia()},redrawWaves:Wn,getWave:qn};n("G0UO"),n("Mc5h"),n("O5lf");var Qn=n("9y81"),Yn=(n("AXyT"),n("gy8s"),n("KMpi"),n("AgBx"),{_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),remove(geByClass1(Yn.class.btn))},class:{btn:"FloatBtn"}});Yn.class=Object(bt.default)({},Yn.class,{open:Yn.class.btn+"_open"});var Gn=Yn;window.Pad={addContent:function(e,t){t&&Object(g.$$)(Xn.pad(e)).forEach(function(e){var n=e.$(Xn.content)||e;e.classList.remove(Kn.empty),n.insertAdjacentHTML("beforeend",t)})}};var Xn={pad:function(e){return'.Pad[data-id="'+e+'"]'},content:".Pad__content"},Kn={empty:"Pad_empty"};var Jn=n("29dZ"),Zn=Object(i.need)("scrollToEl");Object(i.need)("page").onChange(ti);var ei={anchorByHash:function(e){return".Anchor#"+e}};function ti(){var e=window.nav&&window.nav.cur;if(e){var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&Object(g.$)(ei.anchorByHash(t));n&&Zn(n)}}window.Select={},Select._onChange=ii;var ni={optionByValue:function(e){return'.Select__option[value="'+e+'"]'}};function ii(e,t){var n=e.value,i=e.$(ni.optionByValue(n));l.default.handle(t,{$select:e,$option:i,value:n,name:e.name,label:i.textContent})}var ai=n("Q8gl"),oi=(n("DG1x"),n("v+Uj"));window.SliderTabs={},SliderTabs._onClick=pi,onDOMReady(fi),page.onChange(ui),page.onRestore(di);var ri={container:"SliderTabs",scroll:"Slider__scroll",active:"SliderTabs__tab_selected"},si={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+ri.scroll,container:"."+ri.container},li="",ci=0;function ui(){var e=ge(li),t=$(si.container);e?$(si.scroll,e).scrollLeft=ci:t?_i():(li="",ci=0)}function di(){setTimeout(function(){var e=ge(li);if(e){var t=Array.from($$(si.tab,e));if(t)t.some(function(e){return e.getAttribute("href")===nav.cur})&&t.forEach(function(e){e.getAttribute("href")===nav.cur?e.classList.add(ri.active):e.classList.remove(ri.active)})}})}function _i(){var e=$$(si.container),t=Math.min(Object(i.getCw)(),882);e.forEach(function(e){var n=$(si.scroll,e),a=$(si.active,e);if(a){var o=a.offsetWidth,r=Object(i.getX)(a);r+o>t&&(n.scrollLeft=r-t+o,console.log("$scroll.scrollLeft scrollAllToActiveTab",n.scrollLeft))}})}function fi(){_i()}function pi(e,t){var n=Object(i.gpeByClass)(ri.container,t),a=Object(i.gpeByClass)(ri.scroll,t),o=$(si.active,n);return o&&o.classList.remove(ri.active),t.classList.add(ri.active),ci=a.scrollLeft,li=attr(n,"id"),!0}window.SearchPanel={setQuery:function(e,t){var n=Object(g.$)(mi.inputById(e));t=t||"",n.value!==t&&(n.value=t,bi(n,t))}},SearchPanel._onInput=Ai,SearchPanel._onClearClick=gi,SearchPanel._onFocus=vi;var hi={hasQuery:"SearchPanel_hasQuery"},mi={searchPanel:".SearchPanel",input:".SearchPanel__input",inputById:function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'}};function vi(){}function Ai(e,t){var n=e.value;bi(e,n),l.default.handle(t,{query:n})}function gi(e){var t=e.closest(mi.searchPanel).$(mi.input);t.value="",t.oninput()}function bi(e,t){e.closest(mi.searchPanel).classList.toggle(hi.hasQuery,!!t)}window.TabRow={setSelectedTab:function(e,t){var n=Object(g.$)(wi.tabRowById(e)),i=Object(g.$)(wi.tabSelected,n),a=Object(g.$)(wi.tabById(t),n);i&&i.classList.remove(yi.selected),a&&a.classList.add(yi.selected)},setTabUrl:function(e,t,n){var i=Object(g.$)(wi.tabRowById(e)),a=Object(g.$)(wi.tabById(t),i);a&&a.setAttribute("href",n)}};var yi={selected:"TabRow__tab_selected"},wi={tabRowById:function(e){return'.TabRow[data-id="'+e+'"]'},tabById:function(e){return'.TabRow__tab[data-id="'+e+'"]'},tabSelected:".TabRow__tab_selected"};window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=Ci,SwitcherConfirm._onConfirmClick=Oi,SwitcherConfirm._onCancelClick=function(e){return Ei(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return Ei(e.$popup)};var ki={checked:function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")}},Si={switcher:".SwitcherConfirm",popup:".SwitcherConfirm__popup",confirm:".SwitcherConfirm__confirm",cancel:".SwitcherConfirm__cancel"};function Ci(e){var t=e.$control,n=t.closest(Si.switcher),i=Object(g.$)(Si.popup,n);ze.default.open(i),n.$popup=i,n.$control=t,n.checked=e.checked}function Oi(e,t){var n=t.$btn.closest(Si.switcher),i=Object(g.$)(Si.confirm,n),a=Object(g.$)(Si.cancel,n),o=n.checked;n.isSaving=!0,Jn.default.setLoading(i,!0),Jn.default.setDisabled(a,!0),Wd.handle(e,{checked:o,onSuccess:function(){n.isSaving=!1,ze.default.close(n.$popup),Jn.default.setLoading(i,!1),Jn.default.setDisabled(a,!1),n.classList.toggle(ki.checked(!0),o),n.classList.toggle(ki.checked(!1),!o)}})}function Ei(e){var t=e.closest(Si.switcher);t.isSaving||(ai.default.setChecked(t.$control,!t.checked),ze.default.close(t.$popup))}var ji=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,i=e.title?e.title:"",a=e.subtitle?e.subtitle:"",o=e.verified?e.verified:"",s=e.mix?e.mix:"",l=e.online?e.online:"",c=!!e.actions&&e.actions,u=!!e.attrs&&e.attrs,d=!!e.linkAttrs&&e.linkAttrs;return{attrs:u,class:[r.default.class("OwnerRow",{actions:!!c}),s],inner:[{class:"OwnerRow__content al_artist",href:n,attrs:d,inner:[{class:"OwnerRow__left",inner:{style:t?"background-image: url('"+t+"')":null,class:"OwnerRow__img",inner:l?{class:r.default.class("OwnerRow__online",l)}:null}},{class:"OwnerRow__right",inner:[{class:r.default.class("OwnerRow__header",{verified:o}),inner:[{class:"OwnerRow__title",inner:i},o?{class:"OwnerRow__verified"}:null]},{class:"OwnerRow__subtitle",inner:a}]}]},c?{class:"OwnerRow__actions",inner:c}:null]}};var Ti=ji;window.OwnerRow=ji;var Ii=function(e){var t=e.items?e.items:[];return{inner:[(t=t.filter(function(e){return e})).map(function(e){var t=r.default.class("OwnerInfo__row",{extraMargin:e.extraMargin,gray:e.gray,black:e.black});return{inner:[e.href?{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],href:e.href,class:"OwnerInfo__rowInfo",tag:"a"}:{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],class:"OwnerInfo__rowInfo",tag:"div"},e.right?{inner:[e.right],class:"OwnerInfo__rowRight",tag:"div"}:null],class:t,tag:"div"}})],class:"OwnerInfo",tag:"div"}};window.OwnerInfo=Ii;var Mi=function(e){return{inner:[{inner:[{inner:[(e.items?e.items:[]).map(function(e){return{inner:[Wd.wrap(e)],class:"OwnerPhotoGallery__item",tag:"div"}})],class:"OwnerPhotoGallery__table",tag:"div"}],class:"OwnerPhotoGallery__wrap",tag:"div"}],class:"OwnerPhotoGallery",tag:"div"}};window.OwnerPhotoGallery=Mi;n("tlMv"),n("UWnA");var xi=function(){function e(){}return e.findButtonInEvent=function(e){return e.target.closest(".Btn")},e.onChange=function(t,n){if(void 0===n&&(n=""),"file"===n){var a=t.target.files;if(a&&a[0]){var o=Object(It.replaceEntities)(a[0].name),r=e.findButtonInEvent(t),s=$(".MobileInput__text",r);Object(i.val)(s,o)}}},e}();window.MobileInput=xi;n("QQoL"),n("rKUZ");var Pi=Object(i.need)("ajax"),Bi=Object(i.need)("onDOMReady"),Li=Object(i.need)("onBodyResize");window.CookiePolicy={},Bi(Di),CookiePolicy._onHideClick=Hi;var Ri={body:"body",fixedHeader:"._hfixed",cookiePolicy:".CookiePolicy"};function Di(){Object(g.$)(Ri.cookiePolicy)&&(Ni(),Li(Ni))}function Ni(){if(Object(g.$)(Ri.fixedHeader)){var e=Object(g.$)(Ri.body),t=Object(g.$)(Ri.cookiePolicy).offsetHeight,n=parseInt(getComputedStyle(e).paddingBottom,10);e.style.paddingBottom=n+t+7+"px"}}function Hi(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(Ri.cookiePolicy).style.display="none",Li("__clear",Ni),Pi.post(n,{_ajax:1})}var Vi=Object(i.need)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=Ui;var Fi={submit:".PrivacyPolicy__submit"};function Ui(e){var t=e.checked,n=Object(g.$)(Fi.submit);Vi.setDisabled(n,!t)}onDOMReady(function(){addEvent(window,"click",function(e){Object(g.$$)(".Tooltip").forEach(function(e){return re(e)});var t=e.target&&e.target.classList.contains("Tooltip")?e.target:e.target.closest(".Tooltip");if(t&&e.target.classList.contains("Tooltip_onboarding")){var n=t.getAttribute("tooltip-id");n&&ajax.post("/?act=tooltip_click&id="+n)}})});var $i=function(){function e(){}return e.hideDisclaimerAndPlay=function(){Object(g.$)(".VideoRestriction__boxWrap").remove(),Object(g.$)(".VideoRestriction__thumb").remove(),Object(g.$)(".vv_inline_video").play(),Object(g.$)(".VideoRestriction").setAttribute("class","")},e}();window.VideoRestriction=$i;n("Qg0H");var qi=function(e){var t=e.bcg,n=t.type;return{class:r.default.class("VotingBcg",{type:n}),style:"photo"===n?Wi(t):"gradient"===n?zi(t):"tile"===n?Qi(t):null,inner:"photo"===n?Yi(e):null}};function Wi(e){return Gi({"background-color":e.color})}function zi(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var a=e.points[t];n.push(a.color+" "+a.percent+"%")}return Gi({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function Qi(e){return Gi({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function Yi(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:Gi({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:Gi({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:Gi({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function Gi(e){var t,n=[],i=Object.keys(e),a=i.length;for(t=0;t<a;t++){var o=i[t],r=e[o];n.push(o+": "+r+";")}return n.join(" ")}var Xi=qi;window.VotingBcg=qi;var Ki=function(e,t){return{tag:"label",class:r.default.class("VotingForm__bcg",{light:"default"===t.type}),inner:[{class:"VotingForm__bcgPreview",inner:[Xi({bcg:t,photoHeight:48}),{class:r.default.class("VotingForm__bcgTextGhost",{0:!0})},{class:r.default.class("VotingForm__bcgTextGhost",{1:!0})},{class:r.default.class("VotingForm__bcgTextGhost",{2:!0})},{class:r.default.class("VotingForm__bcgTextGhost",{3:!0})},{class:r.default.class("VotingForm__bcgTextGhost",{4:!0})},{class:r.default.class("VotingForm__bcgTextGhost",{5:!0})}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}};var Ji=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[Object(fn.default)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:l.default.wrap(Object(Qn.default)({icon:"close16"}))}]}};var Zi=Object(i.need)("Slider");window.VotingForm={},VotingForm._onInit=la,VotingForm._onAddOptionClick=sa,VotingForm._onExpireChange=ua,VotingForm._onOptionRemoveClick=da,VotingForm._onTitleKeyDown=aa,VotingForm._onTitleInput=oa,VotingForm._onOptionKeyDown=ra,mediaUpload.onComplete(pa),mediaUpload.onStart(ha),mediaUpload.onError(ma);var ea={uploading:"VotingForm_uploading",withExpire:"VotingForm_withExpire",maxOptions:"VotingForm_maxOptions"},ta={form:".VotingForm",maxOptions:".VotingForm_maxOptions",option:".VotingForm__option",options:".VotingForm__options",upload:".VotingForm__upload",bcg:".VotingForm__bcg",bcgRadioChecked:".VotingForm__bcgRadio:checked"},na=13,ia=8;function aa(e){e.keyCode===na&&e.preventDefault()}function oa(e){var t=+attr(e,"maxlength"),n=Object(g.$)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function ra(e){if(aa(e),e.keyCode===na){if(!Object(g.$)(ta.maxOptions))if(Object(g.$)(".VotingForm__option:last-child input")===document.activeElement)return ca(),void Object(g.$)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(e.keyCode===ia){if(1===Object(g.$$)(".VotingForm__option").length)return;var i=e.target;i.value||setTimeout(function(){var e=i.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",fa(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}})}}function sa(){ca(),Object(g.$)(".VotingForm__option:last-child input").focus()}function la(){var e=Object(g.$)(ta.bcgRadioChecked).closest(ta.bcg);Zi.scrollToElem(e)}function ca(){var e=Object(g.$)(ta.options),t=Ji({});e.insertAdjacentHTML("beforeend",Wd.html(t)),_a(),fa()}function ua(e){var t=e.$control,n=e.checked;t.closest(ta.form).classList.toggle(ea.withExpire,n)}function da(e){e.closest(ta.option).outerHTML="",_a(),fa()}function _a(){Array.from(Object(g.$$)('.VotingForm__option[data-created="0"] input')).forEach(function(e,t){e.setAttribute("name","answers["+t+"]")})}function fa(){var e=Object(g.$)(ta.form),t=Number(e.getAttribute("data-max-options")),n=Object(g.$$)(ta.option).length;e.classList.toggle(ea.maxOptions,n===t)}function pa(e){if(Object(g.$)(ta.form)){var t=Object(g.$)(ta.upload),n=Wd.html(Ki("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),va()}}function ha(){var e=Object(g.$)(ta.upload);e&&e.classList.add(ea.uploading)}function ma(e){var t=Object(g.$)(ta.form);if(t){var n=t.getAttribute("data-upload-error-msg");va(),alert(n)}}function va(){var e=Object(g.$)(ta.form);Object(g.$)(ta.upload).outerHTML=e.getAttribute("data-upload-html")}window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=ga;var Aa={countrySection:".VotingStatsFilters__section_country",citySection:".VotingStatsFilters__section_city"};function ga(e){var t=e.$option,n=Object(g.$)(Aa.countrySection),i=Object(g.$)(Aa.citySection),a=t.getAttribute("data-city-section-html");i&&(i.outerHTML=""),a&&n.insertAdjacentHTML("afterend",a)}var ba=window.Popup,ya=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=Sa,AuthCheck._onResetSessionSubmit=Ca,AuthCheck._onCurBrowserDropClick=Oa;var wa={popupByIndex:function(e){return".AuthCheck__popup_index_"+e},dropConfirmation:function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},dropConfirmationSubmit:".AuthCheck__dropConfirmationSubmit"},ka={dropConfirmationSuccess:"AuthCheck__dropConfirmation_success"};function Sa(e){var t=Object(g.$)(wa.popupByIndex(e));ba.open(t)}function Ca(e,t){e.preventDefault();var n=e.target,i=Object(g.$)('iframe[name="'+e.target.target+'"]'),a=n.$(wa.dropConfirmationSubmit);n.submit(),ya.setLoading(a,!0),addEvent(i,"load",function(){Object(g.$)(wa.dropConfirmation(t)).classList.toggle(ka.dropConfirmationSuccess),ba.close(),ya.setLoading(a,!1)})}function Oa(e){var t=e.$btn;ya.setLoading(t,!0),ajax.click(t,{onDone:function(){Object(g.$)(wa.dropConfirmation("0")).classList.toggle(ka.dropConfirmationSuccess),ba.close(),ya.setLoading(t,!1)}})}function Ea(){var e=Object(g.$)(ja.intro),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push(function(){return t.destroy()})}window.AppPasswords=new function(){this.showPopup=function(){return Popup.open(Object(g.$)(".AppPasswordsPopup"))},this.hidePopup=function(){return Popup.close(Object(g.$)(".AppPasswordsPopup"))}},window.AuthCheckIntro={},AuthCheckIntro._onMount=Ea;var ja={intro:".AuthCheckIntro"};function Ta(){Object(g.$)(Ia.self).classList.toggle(Ma.restCodesShown)}window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=Ta;var Ia={self:".ReservedCodes"},Ma={restCodesShown:"ReservedCodes_restCodesShown"};window.Settings={_privacy:{}},Settings._privacy.onRadioChange=Ba;var xa={pad:function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},submit:".Settings__privacySubmitRow",form:".Settings__privacyForm",forbid:".Settings__privacySelectForbiddenLink"},Pa={padVisible:"Settings__privacyPad_visible",submitVisible:"Settings__privacySubmitRow_visible"};function Ba(e,t){if("none"===e)La("allowed",!1),La("forbidden",!1),Ra(!0);else if("allowed"===e)La("allowed",!0),La("forbidden",!1),Ra(!1);else if("forbidden"===e){La("allowed",!1),La("forbidden",!0),Ra(!0);var n=Object(g.$)(xa.form),i=Object(g.$)(xa.forbid),a=t.name,o=t.value,r=n.getAttribute("action")+"&"+a+"="+o+"&forbid";i.setAttribute("href",r)}}function La(e,t){Object(g.$)(xa.pad(e)).classList.toggle(Pa.padVisible,t)}function Ra(e){Object(g.$)(xa.submit).classList.toggle(Pa.submitVisible,e)}window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),Object(i.statlogsValueEvent)("settings_menu_click",e),t?A.default.hard_go(e):A.default.go(e),!1}};n("0hva");var Da=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(Lt.default)({sprite:"common",name:"cancel_24"})],class:"ModalMenuHeader__close","aria-label":Object(je.getLang)("mobile_close"),onClick:e.onClose,tag:"button"},{inner:[e.inner],class:"ModalMenuHeader__title",tag:"div"}],class:"ModalMenuHeader",tag:"div"}},Na=n("t7Ww"),Ha=n("GtpT"),Va=n("k+Df"),Fa=n("j80l");var Ua=function(e){var t=window.lang,n=(e.albums||[]).map(function(e){var t=Object(Fa.makeUrl)(e.url,{act:"add"});return Object(Ha.default)({onClick:["AddPhotoModal.go",t,"this"],album:e})});return{inner:[Da({inner:[t.mobile_photos_choose_album_modal_title],onClose:"AddPhotoModal.close(this)"}),n.length?Object(Na.ModalMenuContent)({inner:[Object(Jn.default)({inner:[t.mobile_photos_choose_album_modal_create_album],class:"AddPhotoModal__createAlbum",theme:"secondary",stretch:!0,onClick:["AddPhotoModal.go",e.link.createAlbum]}),{inner:[n],class:"ScrollView",tag:"div"}],class:"AddPhotoModal__content"}):Object(Va.default)({text:t.mobile_photos_choose_album_modal_empty_text})],class:"AddPhotoModal",tag:"div"}},$a={modal:"AddPhotoModal"};function qa(e){var t=e.closest("."+$a.modal);Ft.default.close(t)}window.AddPhotoModal={open:function(){var e=Object(je.getState)("upload_albums"),t=Object(Ft.default)({on_overlay_click:"AddPhotoModal.close(this)",class:$a.modal,attached:!0,body:Ua({link:{createAlbum:"/photos?act=select_album"},albums:e})});return Ft.default.open(Wd.elem(t),!0,"",{expandable:!0})},close:qa,go:function(e,t){void 0===t&&(t=null),nav.go(e),t&&t.hasOwnProperty("$btn")?qa(t.$btn):qa(t)}},window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";Object(i.statlogsValueEvent)("lovina_promotion",t?1:0),window.nav.hard_go(n)}},window.AudioSerp={setView:function(e){return Qa("view",e)},setTab:function(e){audioplayer.searchCatalogEnabled()||Qa("tab",e)},toggleTabs:function(e){Object(g.$)(za.serp).classList.toggle(Wa.noTabs,!e)},setFoundHtml:function(e){Object(g.$)(za.found).outerHTML=e},getFoundHtml:function(){return Object(g.$)(za.found).outerHTML}};var Wa={serpMod:function(e){return"AudioSerp_"+e},noTabs:"AudioSerp_noTabs"},za={serp:".AudioSerp",found:".AudioSerp__found"};function Qa(e,t){var n=Object(g.$)(za.serp);r.default.setMod(n,Wa.serpMod(e),t)}window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=Object(g.$)(Ya.special);t&&t.classList.toggle(Ga.playing,e)}};var Ya={special:window.AudioSpecialForYou.selector},Ga={playing:"AudioSpecialForYou_playing"};var Xa=function(){function e(e){this.store=Stories.getStore(),this.data=e,this.raw_id=e.raw_id,this.can_remove=e.can_remove,this.can_report=e.can_report,this.can_bookmark=e.can_bookmark,this.is_bookmarked=e.is_bookmarked,this.is_narrative=!!e.narrative}var t=e.prototype;return t.needMenu=function(){return this.can_remove||this.can_report},t.render=function(){var e=window.lang;return l.default.html({class:"StoryMenu",inner:[{class:"StoryMenu__trigger",onclick:"Stories.showMenu();",inner:{class:"Story__icon Story__icon_menu"}},{class:"StoryMenu__container",inner:[this.can_bookmark?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:"Stories.toggleBookmark(this);",inner:this.is_bookmarked?e.mobile_stories_menu_bookmarked_title:e.mobile_stories_menu_bookmark_title}}:null,this.can_remove?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:"Stories.removeCurrentStory();",inner:this.is_narrative?e.mobile_stories_menu_remove_narrative_title:e.mobile_stories_menu_remove_title}}:null,this.can_report?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:'Stories.reportCurrentStory("'+this.raw_id+'");',inner:e.mobile_stories_menu_report_title}}:null]}]})},e}(),Ka=function(){function e(e,t,n,i){if(this.store=Stories.getStore(),this.state={authorIndex:n,storyIndex:i},this.date=e.date,this.preview=e.preview_url,this.type=e.type,this.photo_url=e.photo_url,this.video_url=e.video_url,this.first_frame=e.first_frame,this.videoSupport=!!window.HTMLVideoElement,this.views=e.views,this.answers=e.answers,this.link=e.link,this.unread=e.unread,this.raw_id=e.raw_id,this.is_expired=e.is_expired,this.isAds=e.isAds,this.isPromo=e.isPromo,this.promoCaption=e.promoCaption,this.track_code=e.track_code,this.can_comment=e.can_comment,this.canLike=e.canLike,this.can_share=e.can_share,this.can_remove=e.can_remove,this.can_report=!e.can_manage,this.can_ask=e.can_ask,this.can_ask_anonymous=e.can_ask_anonymous,this.isNewQuestions=e.isNewQuestions,this.isLiked=e.isLiked,this.name=t.name,this.authorId=t.id,this.showPin=t.showPin,this.isOwnerPinned=t.isOwnerPinned,this.firstName=t.firstName,this.avatar=t.photo,this.href=t.href,this.prometheus=t.verify.includes("page_top_author"),this.verified=t.verify.includes("page_verified"),this.authorIcon=this.prometheus||this.verified,this.content=null,this.paused=!0,this.stats=e.stats,this.narrative=e.narrative,this.app=e.app,this.isNarrativeSlide=this.narrative&&!this.narrative.is_cover,this.isNarrativeMetaStory=!!e.isNarrativeMetaStory,this.isMetaStory=!!e.is_groups_meta_story||!!e.is_apps_meta_story,this.isGroupsMetaStory=!!e.is_groups_meta_story,this.isAppsMetaStory=!!e.is_apps_meta_story,this.isOpenNarrativeFromFeed=!!e.isOpenNarrativeFromFeed,this.onAutoPlay=Object(s.default)(),this.onDestroy=Object(s.default)(),this.onVideoBuffering=Object(s.default)(),this.onVideoData=Object(s.default)(),this.onVideoPlayEvent=Object(s.default)(),this.onVideoPauseEvent=Object(s.default)(),this.onVideoEndedEvent=Object(s.default)(),this.reply=e.reply_to,this.reply){var a=this.reply.list;this.reply=extend(this.reply,{onclick:'Stories.openReplies("'+a+'");'})}this.duration=8e3,this.views&&(this.viewsText=this.views),this.answers&&(this.answersText=this.answers.count),this.bookmark_add_hash=e.bookmark_add_hash,this.is_bookmarked=e.is_bookmarked,this.clickable_stickers=e.clickable_stickers,this.stickers=[],this.narrative&&(this.bookmark_add_hash=this.narrative.bookmark_hash,this.is_bookmarked=this.narrative.is_bookmarked),this.StoryMenu=new Xa(extend(e,{can_report:this.can_report,can_bookmark:!!this.bookmark_add_hash,is_bookmarked:this.is_bookmarked})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=Stories.getCurrentStoryIndex(),n=Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),Stories.setHistory(this.raw_id)):(this.destroy(),val(e,""))},t.getDuration=function(){return this.duration},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=Stories.getFrom(!1);return Fa.default.make(e,{from:t})},t.loadContent=function(e){var t=window.lang;if(this.is_expired){Stories.hideLoading();var n={class:"Story__content_expired",inner:l.default.wrap(t.mobile_stories_error_expired)};val(e,l.default.html(n)),Stories.restoreAudio()}else if("photo"===this.type){this.isNarrativeMetaStory||this.isMetaStory||Stories.showLoading(),this.img=new Image,this.onLoadImgBind=this.onLoadImg.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.img,"load",this.onLoadImgBind),addEvent(this.img,"load",this.onLoadStory),this.img.src=this.photo_url;var i={style:"background-image: url("+this.photo_url+")",class:"Story__content_image"};this.narrative&&this.narrative.is_cover?val(e,l.default.html(this.renderNarrativeCover())):this.isNarrativeMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",l.default.html(this.renderNarrativeMetaStory())),addEvent(geByClass1("MetaStory__recommendations"),"scroll wheel touchmove",this.handleRecommendationsScroll.bind(this))):this.isGroupsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",l.default.html(this.renderGroupsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):this.isAppsMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",l.default.html(this.renderAppsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):val(e,l.default.html(i)),Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&Stories.isAutoplaySupport())Stories.showLoading(),this.video=ce("video",{src:this.video_url,className:"Story__content_video"}),attr(this.video,"autoplay","autoplay"),attr(this.video,"playsinline","playsinline"),attr(this.video,"webkit-playsinline","webkit-playsinline"),attr(this.video,"muted","muted"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.video,"ended",this.onVideoEndedBind),addEvent(this.video,"play",this.onVideoPlayBind),addEvent(this.video,"pause",this.onVideoPauseBind),addEvent(this.video,"canplaythrough",this.onCanPlayBind),addEvent(this.video,"waiting",this.onVideoWaitingBind),addEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),addEvent(this.video,"canplaythrough",this.onLoadStory),append(this.video,e),Stories.restoreAudio(),Stories.pauseAudio();else{var a=Stories.getAuthorElems()[this.state.authorIndex];this.renderError(a,e,t.mobile_stories_inline_video_error)}this.isMetaStory||this.markSeen()},t.onLoadStory=function(){if(this.clickable_stickers){var e=geByClass1("Story",this.authorElem);e&&this.renderStickersLayer.call(this,e)}if(this._loadingStartTime){this.loadingTime=Date.now()-this._loadingStartTime,Stories._sendViewerStartTime(this.raw_id,this.loadingTime),this._loadingStartTime=0;var t=this.isMetaStory?"group_feed_view":"view_story";Stories.sendAnalyticsEvent(t,{preloading_duration:this.loadingTime})}},t.markSeen=function(){var e=this.raw_id;this.track_code&&(e+="_"+this.track_code),this.store.readedStories[e]=!0,this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){this.paused||(this.paused=!0,this.video&&this.video.pause())},t.play=function(){this.paused&&(this.paused=!1,this.video&&this.video.play())},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onLoadImg=function(){Stories.hideLoading(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoBuffer=function(){this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onCanPlay=function(){Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var i=this,a={class:"Story__content_expired",inner:l.default.wrap(n)};val(t,l.default.html(a)),Stories.hideLoading(),this.type="broken",addClass(e,eo),requestAnimationFrame(function(){i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})})},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!isArray(t))&&t.some(function(t){return t.type===e})},t.render=function(){var e,t,n=window,i=n.lang,a=n.winToUtf;addEvent(window,"resize",this._onResizeHandle.bind(this));var o=_.isTouch?"ontouchstart":"onmousedown",r=_.isTouch?"ontouchend":"onmouseup";this._onLoadingStart();var s=this.hasSticker(to.storyReply);return l.default.html({class:"Story",inner:[{class:"Story__header",inner:[this.reply&&!s?{class:"Story__reply",inner:this.reply.is_deleted||this.reply.is_private||this.reply.is_expired?{class:"Story__replyDeleted",inner:{class:"Story__replyDeletedContainer",inner:[{class:Bem.class("Story__icon",{deleted:this.reply.is_deleted,private:this.reply.is_private||this.reply.is_expired})},{class:"Story__replyDeletedTitle",inner:this.reply.is_deleted?i.mobile_stories_reply_deleted_title:this.reply.is_expired?i.mobile_stories_reply_expired_title:i.mobile_stories_reply_private_title}]}}:{class:"Story__replyPreview",onclick:this.reply.onclick,style:"background-image: url("+this.reply.photo_url+")",inner:{class:"Story__replyTitle",inner:a(this.reply.name)}}}:null,{class:"Story__table",inner:[this.isGroupsMetaStory?{tag:"div",onclick:"Stories.openGroupsSettings();",class:"Story__settings"}:{class:"Story__cell Story__cell_header",inner:[{class:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[this.isNarrativeSlide?null:{class:"Story__cell Story__cell_avatar",inner:{class:"Story__avatar",src:this.avatar,tag:"img"}},{class:"Story__cell Story__cell_title",inner:[{class:"Story__title",inner:[{class:"Story__name",inner:this.isNarrativeSlide?a(this.narrative.title):a(this.name)},this.authorIcon?{class:"Story__verified",inner:{class:Bem.class("Story__icon",{verified:this.verified,prometheus:this.prometheus})}}:null]},this.isNarrativeSlide?{class:"Story__date",inner:this.name+" · "+i.global_type_narrative}:{class:"Story__date",inner:this.isPromo?this.promoCaption:this.isAds?i.mobile_stories_is_promo_title:this.date}]}]}]},!this.isMetaStory&&this.authorId<0&&this.showPin?{class:"Story__cell",inner:{tag:"span",onclick:'Stories.togglePin(this, "'+this.authorId+'")',class:Bem.class("Story__pinBtn",{unpin:this.isOwnerPinned},"--"),inner:[{tag:"div",class:"StoriesFeatureTooltip StoriesFeatureTooltip--pin",inner:[i.mobile_stories_groups_tooltip,{tag:"span",class:"StoriesFeatureTooltip__arrow"}]}]}}:null,this.isGroupsMetaStory?{class:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:i.mobile_stories_groups_grid_title}:null,{class:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{class:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{class:"Story__icon Story__icon_close"}}}]}]},{class:"Story__footer",inner:this.isNarrativeMetaStory||this.isMetaStory||this.is_expired?null:{class:"Story__table",inner:[this.isNarrativeSlide?null:{class:Bem.class("Story__cell",{empty:!!this.link&&!this.answers&&!this.views,hidden:!this.answers&&!this.views&&!this.link,stats:!0}),inner:this.answers||this.views?{class:Bem.class("Story__stats",{new_questions:this.isNewQuestions}),inner:[this.answers?{class:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_replies Story__repliesIcon"}},{class:"Story__cell Story__repliesText",inner:this.link?this.answers.count:this.answersText}]}:null,this.views?{class:"Story__views Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_views Story__viewsIcon"}},{class:"Story__cell Story__viewsText",inner:this.link?this.views:this.viewsText}]}:null]}:null},this.link&&this.link.text?{class:"Story__cell Story__cell_moreLink",inner:{class:"Story__moreLink",inner:[{class:"Story__moreLinkText",inner:a(this.link.text)},{class:"Story__icon Story__icon_topArrow"}],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}:this.can_comment?{class:"Story__cell Story__cell_comment",inner:{class:"Story__commentButton",inner:{class:"Story__commentButtonText",inner:i.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}:null,this.canLike?{class:"Story__cell Story__cell--like",inner:{class:"Story__like"+(this.isLiked?" Story__like--set":""),onclick:"Stories.toggleLikeForCurrentStory(this)",inner:Object(Lt.default)("stories",this.isLiked?"like_shadow_48":"like_outline_shadow_48")}}:null,this.can_share?{class:"Story__cell Story__cell_share",inner:{class:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.raw_id:this.raw_id)+'", '+!!this.narrative+");",inner:{class:"Story__icon Story__icon_share","data-skiponclick":1}}}:null,this.needMenu?{class:"Story__cell Story__cell_menu",inner:l.default.wrap(this.storyMenuHTML)}:null]}},this.can_comment?{class:"Story__form Story__form_comment",inner:[(e={class:"Story__formOverlay"},e[o]="cancelEvent(event);",e[r]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:this.isNarrativeSlide?i.mobile_stories_comment_narrative_title:i.mobile_stories_comment_title},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:i.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{class:"Story__formFooter",inner:[{class:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:i.mobile_stories_comment_ok},{class:"Story__formCancel",inner:i.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={class:"Story__overlay"},t[o]="cancelEvent(event);",t[r]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{class:"Story__stickers"}:null,{class:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderAskForm=function(){var e,t=window.lang,n=_.isTouch?"ontouchstart":"onmousedown",i=_.isTouch?"ontouchend":"onmouseup";return{class:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={class:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:{class:"Story__formHeaderInner",inner:[{tag:"button",class:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_author_only,onclick:"Stories.changeAskAnonymous(event);","data-selected":1},{class:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{class:"QuestionSupport__tooltip"}}]}},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{class:"Story__formFooter",inner:[Object(Jn.default)({class:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),Object(Jn.default)({class:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,a=n.original_height,o=e.top,r=e.left,s=e.width,l=e.height,c=e.rotate,u=getSize(t),d=u[0],_=u[1],f=d,p=_;return _/d>1.77?f=i*_/a:p=a*d/i,"\n      top: "+(o*p-(p-_)/2)+"px;\n      left: "+(r*f-(f-d)/2)+"px;\n      width: "+s*f+"px;\n      height: "+l*p+"px;\n      transform: rotate("+c+"deg);\n    "},t.renderStickersLayer=function(e){var t,n,a=this,o=geByClass1("Story__stickers",e),r=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers,s=_.isTouch?"ontouchstart":"onmousedown",c=_.isTouch?"ontouchend":"onmouseup";o&&(o.innerHTML=""),o.appendChild(l.default.elem(((t={class:"Story__stickersDisableArea Story__stickersDisableArea--left"})[s]="Stories.onTouchStart(event);",t[c]="Stories.onTouchEnd(event, true);",t.ontouchcancel="Stories.onTouchEnd(event, true);",t))),o.appendChild(l.default.elem(((n={class:"Story__stickersDisableArea Story__stickersDisableArea--right"})[s]="Stories.onTouchStart(event);",n[c]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n))),r.forEach(function(t){var n,r=t.type,u=t.style,d=void 0===u?"":u;if([to.hashtag,to.mention,to.question,to.place,to.music,to.storyReply,to.owner,to.link,to.marketItem,to.post,to.poll,to.app].includes(r)){var _=l.default.elem(((n={class:"Story__sticker"})[s]="Stories.onTouchStart(event);",n[c]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n.style=""+a._getStickerStyle(t,e),n));switch(Object(i.domData)(_,"type",r),Object(i.domData)(_,"style",d),r){case to.hashtag:Object(i.domData)(_,"hashtag",t.hashtag);break;case to.mention:Object(i.domData)(_,"mention",t.mention);break;case to.question:Object(i.domData)(_,"question",t.question);break;case to.place:if(a.store.list==="place"+t.placeId)return;Object(i.domData)(_,"place_id",t.placeId);break;case to.music:var f=Stories.getCurrentStory(),p=t.audioId,h=t.audioData,m=t.audioRestriction;if(m){var v=a.getVideo();if(v&&f.needMute){var A=Stories.getAuthorElems()[a.state.authorIndex];removeClass(A,Za),v.muted=!0}o.appendChild(l.default.elem({class:"StoryRestriction",inner:{class:"StoryRestriction__inner",inner:[{class:"StoryRestriction__title",inner:m.title},m.buttonUrl?{class:"StoryRestriction__link",href:m.buttonUrl,inner:m.buttonText}:null]}})),Object(i.domData)(_,"disabled",1)}addClass(_,"audio_item"),addClass(_,"audio_item_"+p),Object(i.domData)(_,"id",p),Object(i.domData)(_,"audio",h);try{Object(i.domData)(_,"track-code",JSON.parse(h).track_code)}catch(e){}_.setAttribute("id","audio"+p);break;case to.storyReply:Object(i.domData)(_,"owner-id",t.ownerId),Object(i.domData)(_,"story-id",t.storyId),Object(i.domData)(_,"link",t.link);break;case to.owner:Object(i.domData)(_,"owner-id",t.ownerId),Object(i.domData)(_,"link",t.link);break;case to.link:Object(i.domData)(_,"link",t.link),Object(i.domData)(_,"tooltip-text",t.tooltipText);break;case to.marketItem:Object(i.domData)(_,"photoUrl",t.photoUrl),Object(i.domData)(_,"link",t.link),t.isRestricted&&Object(i.domData)(_,"isRestricted","isRestricted");break;case to.post:Object(i.domData)(_,"post-owner-id",t.postOwnerId),Object(i.domData)(_,"post-id",t.postId);break;case to.poll:Object(i.domData)(_,"pollId",t.pollId),Object(i.domData)(_,"pollOwnerId",t.pollOwnerId);break;case to.app:Object(i.domData)(_,"app-id",t.appId)}o.appendChild(_),a.stickers.push(_)}})},t._onResizeHandle=function(){var e=this,t=geByClass1("Story",this.authorElem),n=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers;isArray(n)&&n.forEach(function(n,i){e.stickers[i]&&setStyle(e.stickers[i],e._getStickerStyle(n,t))})},t._createStickerLink=function(e){var t=intval(Object(i.domData)(e,"type")),n=intval(Object(i.domData)(e,"disabled"));if(t&&!n){var a,o,r,s="a",c=!0,u=function(){},d={type:t,style:Object(i.domData)(e,"style")};switch(t){case to.hashtag:var _=Object(i.domData)(e,"hashtag")||"",f=_.replace("#","%23");a="/feed?section=search&q="+f,o=lang.mobile_stories_show_hashtag_link,r="search",d.text=_;break;case to.mention:var p=(Object(i.domData)(e,"mention")||"").slice(1,-1).split("|");a="/"+p[0],o=p[0].startsWith("id")?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,r="profile";break;case to.place:var h=Object(i.domData)(e,"place_id"),m=Stories.getFrom();a="/place"+h,o=lang.mobile_stories_go_to_place,this.store.list.includes("place")?c=!0:(a+="?from="+m,u=function(){s="div",c=!1,Stories._hideTooltips(!0),Stories.showLoading(),nav.go(a)}),r="place";break;case to.music:s="div",o=lang.mobile_stories_music_more,u=function(){var t=Object(i.domData)(e,"id"),n=Object(i.domData)(e,"audio");Stories.openMusicStickerActions(t,n)};break;case to.storyReply:case to.owner:var v=this.reply,A=v.is_expired,g=v.list;if(t===to.owner||A)o=Object(i.domData)(e,"owner-id")>0?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,a=Object(i.domData)(e,"link"),r="profile";else s="div",o=lang.mobile_stories_go_to_story,u=function(){Stories.openReplies(g)};break;case to.link:o=Object(i.domData)(e,"tooltip-text"),a=Object(i.domData)(e,"link");break;case to.marketItem:var b=Object(i.domData)(e,"photoUrl"),y=!!Object(i.domData)(e,"isRestricted");y&&(u=function(e){e.preventDefault(),window.AlertBox(getLang("mobile_stories_market_access_error_text"),getLang("mobile_stories_market_access_error_title"))}),o=l.default.html([b&&!y?{class:"Stories__marketItemThumb",tag:"img",src:b}:{class:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:Object(Lt.default)("market","item_stub")},{class:"Stories__marketItemText",tag:"span",inner:getLang("mobile_stories_market_item_more")}]),a=Object(i.domData)(e,"link");break;case to.post:var w=Object(i.domData)(e,"post-owner-id"),k=Object(i.domData)(e,"post-id");o=lang.mobile_stories_go_to_post,a="/wall"+w+"_"+k}return Stories._requestStickerStat("click",d),Stories.sendAnalyticsEvent("click_on_clickable_sticker"),ce(s,{href:"a"===s?a:null,target:c?"_blank":null,innerHTML:o,className:"Stories__tooltip-link",onclick:function(e){u&&u(e),r&&Stories._requestStickerStat(r,d)}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderNarrativeCover=function(){var e=this.photo_url||this.first_frame,t=this.narrative.views?" · "+this.narrative.views:"";return{class:"NarrativeCover",inner:[{style:"background-image: url("+e+")",class:"NarrativeCover__image",onclick:"Stories._showTooltip(event, Stories._createNarrativeTooltipLink());"},{class:"NarrativeCover__views",inner:[{tag:"span",class:"NarrativeCover__label",inner:""+lang.global_type_narrative},{tag:"span",inner:""+t}]},{class:"NarrativeCover__title",innerHTML:""+this.narrative.title},{class:"NarrativeCover__author",inner:""+this.narrative.owner_name}]}},t.renderAppsMetaStory=function(){var e="apps";window.store.stories.apps||(window.store.stories.apps=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists.apps));var t=window.store.stories.apps&&window.store.stories.apps.authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach(function(t){var n=t.items.filter(function(e){return e.unread}),a=!!n.length,o=t.items[0];a&&(o=n[0]);var r={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'")',inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(r)})),{class:"MetaStory MetaStory--apps",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{tag:"a",href:this.app.url,target:"_blank",class:"MetaStory__appWrapper",inner:[{class:"MetaStory__appIcon",style:"background-image: url("+this.app.photoUrl+")"},{class:"MetaStory__appName",innerHTML:this.app.name},{class:"MetaStory__separator"},{tag:"span",class:"MetaStory__appLink",innerHTML:lang.mobile_stories_go_to_app}]}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.renderGroupsMetaStory=function(){var e="groups";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach(function(t){var n=t.items.filter(function(e){return e.unread}),a=!!n.length,o=t.items[0];a&&(o=n[0]);var r={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'")',inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(r)})),{class:"MetaStory MetaStory--groups",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{class:"MetaStory__infoTitle",inner:lang.mobile_stories_groups_grid_title},{class:"MetaStory__infoDescription",inner:lang.mobile_stories_groups_grid_text}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.renderNarrativeMetaStory=function(){var e=this.store.list+"_recommendations",t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return this.store.list.match(/narrative-?\d+_\d+$/)&&t&&(this.coverItems=t.map(function(e){return e.narrative_cover}),this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elemOffset=0,1===this.coverRowsCount?this.elemOffset=26.4:this.coverRowsCount>1&&(this.elemOffset=26.4*1.5),this.scrollOffset=n/100*this.elemOffset+53,this.coverItems.forEach(function(n){var a={tag:"span",class:"GridStoryPreview",style:"background-image: url("+n.preview_url+")",onclick:'Stories.openNarrative("'+n.raw_id+"/"+e+'", { narrativeId: '+n.narrative.id+", source: 'narrative_recommendations' })",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+n.photo_url+")",inner:[{tag:"a",href:t[0].author.href,class:"GridStoryPreview__author",style:"background-image: url("+t[0].author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:n.narrative.title}]}]};i.push(a)})),{class:"MetaStory",inner:[{class:"MetaStory__buttons",style:"padding-bottom: "+this.elemOffset+"vh",inner:[{class:"MetaStory__button",onclick:"Stories.narrativeReply();",inner:[{class:"MetaStory__circle MetaStory__circle_replay"},{class:"MetaStory__text",inner:lang.mobile_narratives_repeat_bottom}]},this.isOpenNarrativeFromFeed?{class:"MetaStory__button",onclick:"Stories.narrativeGoToStories();",inner:[{class:"MetaStory__circle MetaStory__circle_back"},{class:"MetaStory__text",inner:lang.mobile_narratives_back_bottom}]}:null]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-title",inner:lang.mobile_narratives_more_bottom,style:"margin-top: calc(100vh - "+this.elemOffset+"vh - 70px - 53px)"},{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.handleRecommendationsScroll=function(){event.stopPropagation&&event.stopPropagation(),event.stopImmediatePropagation&&event.stopImmediatePropagation();var e=geByClass1("MetaStory__recommendations"),t=geByClass1("MetaStory__recommendations-inner");if(t&&e){var n=Math.min(t.scrollTop/(this.scrollOffset/100),70)/100;setStyle(e,{backgroundColor:"rgba(0, 0, 0, "+n+")"}),t.scrollTop?(addClass(e,"scroll"),Stories.pauseStory()):(Stories.playStory(),removeClass(e,"scroll")),this.isGroupsMetaStory&&(this.blockHeaderEl||(this.blockHeaderEl=geByClass1("Story__gridTitle")),t.scrollTop>this.metaStoryGridMarginTop?removeClass(this.blockHeaderEl,"Story__gridTitle--hide"):addClass(this.blockHeaderEl,"Story__gridTitle--hide"))}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&removeEvent(this.video,"load",this.onLoadImgBind),this.video&&(removeEvent(this.video,"ended",this.onVideoEndedBind),removeEvent(this.video,"play",this.onVideoPlayBind),removeEvent(this.video,"pause",this.onVideoPauseBind),removeEvent(this.video,"canplaythrough",this.onCanPlayBind),removeEvent(this.video,"waiting",this.onVideoWaitingBind),removeEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),Stories._hideTooltips()},e}(),Ja=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval(function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)},this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}(),Za="StoryAuthor_videoMuted",eo="StoryAuthor_error",to={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,app:13},no=function(){function e(e,t){var n=this;this.store=Stories.getStore(),this.data=t,this.state={authorIndex:e};var i=this.getCurrentStoryIndex();this.setCurrentStoryIndex(i),this.story=new Ka(this.data.items[i],this.data.author,e,i),this.authorStoriesHTML=l.default.html(this.story.render()),this.progressItemElems=null,Stories.onRender(function(){n.updateStory()})}var t=e.prototype;return t.getCurrentStory=function(){if(this.story)return this.story},t.destroy=function(){this.story&&this.story.destroy()},t.update=function(){var e=this.data.index;this.destroy(),this.story=new Ka(this.data.items[e],this.data.author,this.state.authorIndex,e),this.authorStoriesHTML=l.default.html(this.story.render())},t.updateHeader=function(){this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.progressItemElems=Array.from(geByClass("StoryAuthor__progressItem",this.authorElem)),this.drawFilledProgressItems()},t.updateStory=function(){var e=this;this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var t=geByClass1("Story__body",this.authorElem);this.story.update(t),this.story.onVideoData(function(n){n.authorIndex,n.storyIndex;var i=e.story.getDuration(),a=e.story.getType(),o=e.store.isStopped;if(e.countdown=new Ja(i,{tick:13,onTick:function(t){var n=(100-Math.min(t/i*100,100))/100;e.drawCurrentProgress(n)},onEnd:function(){"video"!==a&&(e.drawCurrentProgress(100),Stories.nextStory(!0),removeClass(e.authorElem,"StoryAuthor_paused"))},onPause:function(){e.story.pause(),addClass(e.authorElem,"StoryAuthor_paused")},onStart:function(){e.story.play(),removeClass(e.authorElem,"StoryAuthor_videoHold"),removeClass(e.authorElem,"StoryAuthor_paused")}}),"photo"!==a&&"broken"!==a||o){if("video"===a){var r=e.story.getVideoState(),s=e.story.getVideo();addClass(t,"Story__body_video"),4!==r||o||s.paused||e.countdown.start()}}else e.countdown.start()}),this.story.onVideoEndedEvent(function(){e.drawCurrentProgress(100),Stories.nextStory(!0)}),this.story.onVideoPauseEvent(function(){e.countdown&&e.countdown.pause()}),this.story.onVideoBuffering(function(){e.countdown&&e.countdown.pause()}),this.story.onVideoPlayEvent(function(){e.countdown&&!e.store.isStopped&&e.countdown.start()}),this.story.onAutoPlay(function(){var t=window.lang,n=e.story.getVideo();Stories.pauseAudio();var i=geByClass1("Story__body",e.authorElem),a=Stories.isGoodBrowser();n.play(),n.paused&&!a?e.story.renderError(e.authorElem,i,t.mobile_stories_inline_video_error):!e.countdown||e.store.isStopped||n.paused?a&&n.paused&&addClass(e.authorElem,"StoryAuthor_videoHold"):e.countdown.start(),n.muted&&addClass(e.authorElem,Za),Stories._showFeatureTooltipIfNeeded()}),this.story.onDestroy(function(){e.countdown&&(e.countdown.stop(),e.countdown=null)}),Stories._showFeatureTooltipIfNeeded()},t.getCountDown=function(){if(this.countdown)return this.countdown},t.getFirstUnreadStoryIndex=function(){if(Stories._hasContext("all"))return 0;var e=this.data.items.findIndex(function(e){return!0===e.unread});return-1!==e?e:0},t.getCurrentStoryIndex=function(){if(!this.data.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.data.index},t.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.data.index];setStyle.transform(geByClass1("StoryAuthor__progressItemCurrent",t),[e,1])}},t.drawFilledProgressItems=function(){var e=this.data.index;if(this.progressItemElems)for(each(this.progressItemElems,function(e,t){removeClass(t,"StoryAuthor__progressItem_filled")});e>=0;)addClass(this.progressItemElems[--e],"StoryAuthor__progressItem_filled")},t.setCurrentStoryIndex=function(e){this.data.index=e,this.drawFilledProgressItems()},t.renderEmpty=function(){var e=this.story.getPreview(),t=Stories.getWidth();return l.default.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},t.render=function(){var e,t,n,i=window.lang,a=Stories.getWidth(),o=_.isTouch?"ontouchstart":"onmousedown",r=_.isTouch?"ontouchend":"onmouseup";return l.default.html({class:"StoryAuthor StoryAuthor_inited",style:"width: "+a+"px;",inner:[{class:"StoryAuthor__header",inner:{class:"StoryAuthor__progress",inner:this.data.items.map(function(){return{class:"StoryAuthor__progressItem",inner:{class:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}}}})}},(e={class:"StoryAuthor__muted"},e[o]="Stories.unMute(this, event);",e.inner=[{class:"Story__icon Story__icon_unmute"},{class:"StoryAuthor__muted_text",inner:i.mobile_stories_unmute}],e),(t={class:"StoryAuthor__next"},t[o]="Stories.onTouchStart(event);",t[r]="Stories.onTouchEnd(event);",t.ontouchcancel="Stories.onTouchEnd(event);",t),(n={class:"StoryAuthor__prev"},n[o]="Stories.onTouchStart(event);",n[r]="Stories.onTouchEnd(event, true);",n.ontouchcancel="Stories.onTouchEnd(event, true);",n),{class:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}(),io=function(){function e(e){var t=window.lang;this.store=Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[];var n=this.viewersState,i=n.count,a=n.repliesCountText,o=n.authorCountText,r=n.hiddenReason;this.raw_id=e,this.count=i,this.countText=langNumeric(this.count,t.mobile_stories_views_title),this.hiddenReason=r,this.repliesCountText=a,this.repliesAuthorCountText=o,this.questions.length?this.title=t.mobile_stories_views_title_interactions:this.count&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.count?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}var t=e.prototype;return t.render=function(){var e=this,t=window.winToUtf,n=this.store.questions[this.raw_id]||[],i=this.needShowOnlyHiddenViewersInfo();return l.default.html({class:Bem.class("Views",{short:!(this.viewers.length||!this.replies.length||this.hiddenReason)}),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView"+(i?" Views__body--centerAlign":""),onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.replies.length?{class:"Views__replies",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map(function(n){return{class:"Views__reply "+(n.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+n.owner_id+"/"+n.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:n.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:n.name?t(n.name):lang.mobile_stories_reply_you}]}})}}]}:null,n.length?{class:"Views__questions",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:lang.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:lang.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:n.slice(0,10).map(function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}})}}]}:null,{class:"Views__viewers",inner:[this.count&&(n.length||this.replies.length)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:[this.viewers.map(function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",inner:[{class:"Views__avatarPhoto",src:e.photo,tag:"img"},e.isLiked?l.default.wrap(Object(Qn.default)({mix:"Views__avatarBadgeIcon",icon:"notify_mini_like"})):null]}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}}),this.hiddenReason?{class:"Views__viewersHiddenReason",inner:[{class:"Views__viewersHiddenReasonIcon",inner:Object(Lt.default)("stories","hide_outline_56")},{class:"Views__viewersHiddenReasonText",inner:this.hiddenReason}]}:null]}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},t.needShowOnlyHiddenViewersInfo=function(){var e=this.store.questions[this.raw_id]||[];return this.count&&this.hiddenReason&&!this.viewers.length&&!this.replies.length&&!e.length},e}(),ao=function(){function e(e){this.store=Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){return l.default.elem({class:Bem.class("Questions",{}),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:lang.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map(function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}})}]}]})},e}();function oo(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}var ro=[];var so=[];var lo=0,co=1,uo=3,_o={opened:!1,init:function(e,t){var n=this;void 0===t&&(t={}),this.params=extend({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0,isOpenNarrativeFromFeed:!1},t);var a=this._parseList(e).split("/"),o=a[0],r=a[1],s=a[2],l=o.split("_")[0];t&&t.narrativeId&&(l=t.narrativeId.toString()),this.initRaw=e,this.storyOwner=Object(i.intval)(l),this.storyRaw=o,this.storyExtra=s,this.storyList=r,this.extra=this.parseExtra(this.storyExtra),this.needAudioRestore=audio.playing(),this.Views={},this.popoutOpen=!1,this.slideTimer=null,this.createLayer(),this._initStore(),this.detectAutoplay().then(function(){n.isRestored?n._init():n._checkPreloadedList()?(n._initPreloadedList(),n._init()):n._requestList().then(function(e){var t=e.items,i=e.list;t&&(n.store.authors=t,n.store.listLoaded=!0,n.store.list=i,n.store.inited=!0,n._init())},function(){})})},parseExtra:function(e){var t={},n=String(e).split(";");for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].split(":"),o=a[0],r=a[1];o&&r&&(t[o]=r)}return t},_checkPreloadedList:function(){return!!(window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList])},_initPreloadedList:function(){var e=window.store.storiesLists[this.storyList];e&&(this.store.authors=e,this.store.listLoaded=!0,this.store.list=this.storyList,this.store.inited=!0)},pushPreloadedList:function(e){var t=Object(i.parseJSON)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),extend(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach(function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]})},_createMetaStory:function(){var e=this;Object(i.each)(this.store.authors,function(t,n){var i=n.items[n.items.length-1];i.isNarrativeMetaStory||n.items.push({type:"photo",raw_id:i.raw_id,preview:i.preview,preview_url:i.preview_url,narrative:i.narrative,photo_url:i.photo_url,isNarrativeMetaStory:!0,isOpenNarrativeFromFeed:e.params.isOpenNarrativeFromFeed})})},_init:function(){var e=this;this.createAuthors(),this.storyList.match(/narrative-?\d+_\d+/)&&this._createMetaStory();var t=this.getFirstStoryIndex();this.setCurrentStory(t);var n=this.getCurrentStory();this.params.restore||this.setHistory(n.raw_id,{nav_init:!0,replace:this.params.replace}),this.sliderEl=ge("StoriesSlider"),this.slider=qe(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(t){t=e.slider&&Object(i.intval)(e.slider.getCurrentPos());var n=e.getCurrentAuthorIndex(),a=e.getCurrentAuthor().data;a.is_groups||a.is_apps||e.setAllAuthorStoriesReaded(n),clearTimeout(e.slideTimer),void 0!==t&&t!==n&&(e.markSeenAllOwners(),!1===e.isTap&&(t>n?e.sendAnalyticsEvent("go_to_next_author"):e.sendAnalyticsEvent("go_to_previous_author")),e.setCurrentAuthor(t),e.slideTimer=setTimeout(function(){e.renderStory()},300)),delete e.isTap},onSetup:function(){Object(i.addClass)(e.layer,"Stories_inited"),e.renderStory()}}),this.Authors&&1===this.Authors.length&&(Object(i.addClass)(this.layer,"Stories_inited"),this.renderStory()),this.store.showViews&&this.showViews(n.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},_initStore:function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},likedStoriesMap:{},_requests:[],viewers:{},questions:{},viewersState:{},replies:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:this.params.reply,replyTo:this.params.replyTo,inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},_initViewerSource:function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=cur.module;break;default:this.viewerSource=e}},_sendOpeningEvents:function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=(this.getCurrentStory()||{}).narrative||{},a=n.owner_id,o=n.id;if(!a||!o)return;statlogsValueEvent("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:Object(i.intval)(a),item_id:Object(i.intval)(o),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}},_abortRequests:function(){isArray(this.store._requests)&&Object(i.each)(this.store._requests,function(e,t){t&&t.readyState<4&&t.abort()}),this.store._requests=[]},_saveRequest:function(e){this.store._requests.push(e)},getStore:function(){return this.store},setAllAuthorStoriesReaded:function(e){var t=this;this.store.authors[e].items.forEach(function(e){if(e.unread){var n=e.raw_id;e.track_code&&(n+="_"+e.track_code),t.store.readedStories[n]=!0}})},markSeenAllOwners:function(){var e=this.getCurrentAuthor().data;if(e.is_groups||e.is_apps){var t=window.store.stories[e.is_groups?"groups":"apps"];if(t){t.authors.forEach(function(e){return e.items.forEach(function(e){return e.unread=!1})});var n=t.authors.map(function(e){return e.author.id});ajax.post("stories.php",{_ajax:1,act:"mark_owners_seen",hash:this.store.authors[0].read_hash,owners_ids:n.join(",")}),this._needFeedUpdate=!0}}},togglePin:function(e,t){if(e){this._hideFeatureTooltip();var n=hasClass(e,"Story__pinBtn--unpin"),a=_o.getCurrentAuthor();this.sendAnalyticsEvent(n?"unpin":"pin"),Object(i.toggleClass)(e,"Story__pinBtn--unpin",!n),ajax.post("stories.php",{_ajax:1,act:"toggle_pin",owner_id:t,need_pin:Object(i.intval)(!n),hash:this.store.authors[0].stories_pin_hash},{onDone:function(t){1!==t?Object(i.toggleClass)(e,"Story__pinBtn--unpin",n):a&&a.data&&a.data.author&&(a.data.author.isOwnerPinned=!n)}})}},createAuthors:function(){var e=this,t="";this.Authors=[];var n=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(n=this.getFirstAuthorIndex());var a=this.store.authors[n],o=a.items[a.items.length-1].unread;if(this.extra)switch(this.extra.context){case"new":o=!0;break;case"all":o=!1}Object(i.each)(this.store.authors,function(n,i){var a=i.items;if(!n||!o||a[a.length-1].unread){var r=new no(n,i);e.Authors.push(r),t+=r.renderEmpty()}}),Object(i.val)(Object(i.geByClass1)("Stories__authors",this.layer),t),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),Object(i.each)(this.Authors,function(e,t){t.updateHeader()}),this.setCurrentAuthor(n)},getFirstStoryIndex:function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex(function(t){return t.raw_id===e.storyRaw});if(-1!==n)return n}return this.getCurrentStoryIndex()},getFirstAuthorIndex:function(){var e=this,t=this.store.authors.findIndex(function(t){return t.author.index===e.storyOwner});return-1!==t?t:0},getCurrentAuthorIndex:function(){return this.store.authorIndex},getCurrentStoryIndex:function(){return this.store.authors[this.getCurrentAuthorIndex()].index},getCurrentStory:function(){return this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()]},setCurrentAuthor:function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},setCurrentStory:function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},drawSiblingPreview:function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},drawPreview:function(e){setStyle(e,"background-image","url("+attr(e,"data-src")+")")},updateCurrentAuthor:function(){var e=this.authors[this.store.authorIndex];Object(i.each)(this.authors,function(e,t){Object(i.removeClass)(t,"StoryAuthor_current")}),Object(i.addClass)(e,"StoryAuthor_current")},getSizes:function(){var e,t,n=window.innerHeight,a=window.innerWidth;return a<540?(e=a,t=n,zlayer.open(),zlayer.onResize=this.onResize.bind(this)):(e=Math.floor(Math.min(540,Math.max(320,.563*n))),t=Math.floor(1.78*e),Object(i.addClass)(document.body,"vk__story_open")),[e,t]},createLayer:function(){window.innerWidth<540?(zlayer.open(),zlayer.onResize=this.onResize.bind(this)):Object(i.addClass)(document.body,"vk__story_open"),_o.opened=!0;var e=this.getSizes(),t=e[0],n=e[1];this.storyW=t;var a=l.default.html({id:"StoriesView",class:"Stories__layer _preventMenuOpen",style:"max-width: "+t+"px; max-height: "+n+"px",inner:[{class:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",class:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{class:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{class:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=Object(i.append)(Object(i.ce)("div",{className:"Stories",innerHTML:a}),document.body),attr(this.layer,"ontouchmove","event.preventDefault();"),this.loader=Object(i.geByClass1)("Stories__loading",this.layer),this.popout=Object(i.geByClass1)("Stories__popout",this.layer),this.swipeTextTop=Object(i.geByClass1)("Stories__swipeText_top",this.layer)},onResize:function(){var e=ge("StoriesView"),t=this.getSizes(),n=t[0],i=t[1];attr(e,"style","max-width: "+n+"px; max-height: "+i+"px"),this.storyW=n,this.authors.forEach(function(e){setStyle(e,"width",n+"px")}),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},getWidth:function(){return this.storyW},renderStory:function(){var e=this.store.authorPrevIndex,t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var a=this.Authors[e],o=this.authors[e];a.update();var r=a.renderEmpty(),s=ceFromString(r);replace(s,o)}var l=ceFromString(i.render());replace(l,n),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.extra.replies&&this.showViews(this.getCurrentStory().raw_id)},getCurrentAuthor:function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},getCurrentAuthorEl:function(){return this.getCurrentAuthor().authorElem},getAuthorElems:function(){return this.authors},prevStory:function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame(function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()})},nextStory:function(e){var t=this;this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,requestAnimationFrame(function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),a=t.getCurrentAuthorIndex(),o=n.items.length,r=t.Authors.length;o-1<=i?r-1<=a?requestAnimationFrame(function(){t.sendAnalyticsEvent("close_auto_by_time"),t.close()}):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(a+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())})},stopStory:function(){this.store.isStopped=!0,this.pauseStory()},pauseStory:function(e){var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();e&&Object(i.addClass)(this.layer,"Stories_paused"),n&&n.pause()}},playStory:function(e){this.store.isStopped=!1;var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();Object(i.removeClass)(this.layer,"Stories_paused"),n&&n.start()}},pauseAudio:function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},restoreAudio:function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},showMenu:function(){this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),Object(i.addClass)(this.layer,"Stories_menuOpened")},hideMenu:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_menuOpened"),e&&this.playStory()},showLoading:function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout(function(){show(e.loader)},100))},hideLoading:function(){this.loader&&(clearTimeout(this.loaderTimer),hide(this.loader))},onRepliesScroll:function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},showViews:function(e,t){var n=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){this.store.viewersState[e];var a=this.Views[e].render();this.popoutOpen=!0,Object(i.val)(this.popout,a);var o=Object(i.geByClass1)("Views__repliesBody",this.popout);o&&(o.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var r=this.store.viewersState[e],s=this.store.viewers[e];if(r&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then(function(){n.markQuestionsAsViewed(),n.createViews(e,t),n.hideLoading()})}},markQuestionsAsViewed:function(){(this.getCurrentStory()||{}).isNewQuestions=!1,Object(i.removeClass)(Object(i.geByClass1)("Story__stats"),"Story__stats_new_questions")},createViews:function(e,t){void 0===t&&(t=!1);var n=this.store.viewersState[e],a=new io(e),o=a.render();this.popoutOpen=!0,Object(i.val)(this.popout,o),this.Views[e]=a;var r=Object(i.geByClass1)("Views__repliesBody",this.popout);r&&(r.scrollLeft=n.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},hideViews:function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,Object(i.val)(this.popout,"")},loadViews:function(e){var t=this,n=this.store.viewersState[e],a=n.loading,o=n.nextFrom;!a&&o&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,o).then(function(){var a=new io(e),o=a.render();t.popoutOpen=!0;var r=Object(i.geByClass1)("Views__body",t.layer).scrollTop;Object(i.val)(t.popout,o),Object(i.geByClass1)("Views__body",t.layer).scrollTop=r,t.Views[e]=a,t.hideLoading(),n.loading=!1}))},showComment:function(){var e=this,t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentTextarea",t);this.store.showComment=!0,this.stopStory(),Object(i.addClass)(this.layer,"Stories_commentOpened"),this._hideTooltips(),requestAnimationFrame(function(){e.sendAnalyticsEvent("comment_tap"),n&&n.focus()})},hideComment:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_commentOpened"),e&&this.playStory()},onInputComment:function(e){var t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentSend",t),a=Object(i.val)(e);Object(i.toggleClass)("Story__commentSend_active",n,!!a)},sendComment:function(){var e=this.authors[this.store.authorIndex],t=Object(i.geByClass1)("Story__commentTextarea",e),n=Object(i.geByClass1)("Story__commentSend",e),a=Object(i.val)(t);if(hasClass("Story__commentSend_active",n)){Object(i.val)(t,""),Object(i.removeClass)(n,"Story__commentSend_active");var o,r=this.getCurrentAuthorIndex(),s=this.getCurrentStory(),l=s.raw_id,c=s.narrative,u=this.store.authors[r],d=u.send_hash,_=u.author.id;o=c?"narrative"+c.raw_id:"story"+l,this._sendMessage(d,o,a,_),this.hideComment()}},showFlashPopup:function(e,t){var n=this;void 0===t&&(t=!0);this.stopStory();var a=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.val)(Object(i.geByClass1)("Stories__flashText",a),e),setTimeout(function(){Object(i.addClass)(a,"Stories__flash_show")}),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout(function(){Object(i.removeClass)(a,"Stories__flash_show"),n.flashHideTimer=setTimeout(function(){n.hideFlashPopup(t)},1500)},1500)},hideFlashPopup:function(e){e&&this.playStory(),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer);var t=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.removeClass)(t,"Stories__flash_show")},removeCurrentStory:function(){var e=this,t=window.lang,n=this.getCurrentAuthor();if(n){var i=n.getCurrentStory(),a=i.narrative?t.mobile_stories_delete_narrative:t.mobile_stories_delete_story;if(confirm(a.replace(/(<([^>]+)>)/gi,"\n"))){var o=n.data.remove_hash,r=i.can_remove,s=i.raw_id;if(r){this.pauseStory();var l=function(){e._requestFeedBlock(),i.isNarrativeSlide&&e.close(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};if(i.narrative){var c=i.narrative,u=c.owner_id+"_"+c.id;this._requestRemoveNarrative(u,o).then(function(){l()},function(){})}else this._requestRemoveStory(s,o).then(function(){e.sendAnalyticsEvent("delete"),l()},function(){})}}}},onScrollViews:function(e,t){var n=this.store.viewersState[t],i=n.loading,a=n.nextFrom;if(!i&&a){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},unMute:function(e,t){var n=this.getCurrentAuthor().story.getVideo();Object(i.cancelEvent)(t),n&&n.muted&&(n.muted=!1,Object(i.removeClass)(gpeByClass(Za,e),Za))},onTouchStart:function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var a=n.getVideo();if(a&&a.paused)return void(this.preventedTap=!0)}this.pauseStory(!0),this.isTap=!0,"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),clearTimeout(this.isTapTimer),this.isYmove=null,Object(i.removeClass)(this.layer,"Stories_touchMove"),this.isTapTimer=setTimeout(function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")},200)},onTouchMove:function(e){var t=0,n=0;"touchmove"===e.type&&(t=this.tapStartX-e.changedTouches[0].clientX,n=this.tapStartY-e.changedTouches[0].clientY),null===this.isYmove&&(this.isYmove=Math.abs(t)<Math.abs(n),this.isYmove&&Object(i.addClass)(this.layer,"Stories_touchMove")),this.isYmove?this.onVerticalSwipe(-n/1.5):this.onVerticalSwipe(0)},onTouchEnd:function(e,t){clearTimeout(this.isTapTimer);var n=this.getCurrentAuthor().story;this.isTap||this.sendAnalyticsEvent("resume_release");var a,o;if("touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY),(Math.abs(this.tapStartX-a)>20||Math.abs(this.tapStartY-o)>20)&&(this.isTap=!1),Object(i.removeClass)(this.layer,"Stories_touchMove"),setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]),this.needGoToLink){var r=this.getCurrentAuthor().story;if(this.needGoToLink=!1,r&&r.hasLink())return void this.openCustomButton(e)}if(this.needClose)return this.sendAnalyticsEvent("close_swipe_down"),void this.close();if(this.featureTooltip)this._hideFeatureTooltip();else if(this.tooltip)this._hideTooltips();else{if(this.isTap){if(hasClass(e.target,"Story__sticker")){var s=Object(i.domData)(e.target,"app-id"),l=Object(i.domData)(e.target,"pollId"),c=Object(i.domData)(e.target,"pollOwnerId");if(Object(i.removeClass)(this.layer,"Stories_paused"),Object(i.domData)(e.target,"question"))this.askQuestionBox(e);else if(s)window.open("/app"+s);else if(l&&c){var u="/poll"+c+"_"+l+"?from=story"+n.raw_id+"&story_raw="+n.raw_id;this.sendAnalyticsEvent("click_on_clickable_sticker",{clickable_sticker:{type:"poll"}}),nav.go(u),_o.showLoading()}else this.tooltip?this._hideTooltips():this._showTooltip(e,n._createStickerLink(e.target));return}t?(this.sendAnalyticsEvent("go_to_previous_story"),this.prevStory()):(this.sendAnalyticsEvent("go_to_next_story_tap"),this.nextStory())}this._hideTooltips(!0),this.hideMenu()}},openCustomButton:function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var a={ownerId:i[1],narrativeId:i[2]},o=a.ownerId,r=a.narrativeId;if(!o||!r)return!1;this.openNarrative(o+"/narrative"+o+"_"+r,{source:"narrative_story",isOpenNarrativeFromFeed:!0})}else if(this.stopStory(),this.showLoading(),t.stats&&t.stats.url_view){var s=t.stats.url_view,l=s.event_type,c=s.rhash,u=t.raw_id;this._requestClickStat(u,l,c,function(){nav.go(n)})}else nav.go(n);return!1},onVerticalSwipe:function(e){var t=window.lang;if(this.needClose=!1,this.needGoToLink=!1,e){var n=e>0,a=this.sliderEl.offsetHeight,o=a/3.5,r=Math.abs(e)>o;if(n){var s=r?t.mobile_zphoto_release_to_close:t.mobile_zphoto_move_to_close,l=r?"":n?"zpv_close_move_down":"zpv_close_move_up",c=Math.max(1-.75*e/a,.6);Object(i.val)(this.swipeTextTop,'<div class="zpv_close_msg '+l+'">'+s+"</div>"),setStyle(this.sliderEl,"opacity",c),setStyle.transform(this.sliderEl,1,[0,e/1.5]),setStyle(this.swipeTextTop,"opacity",Math.abs(c-1-.6)),setStyle.transform(this.swipeTextTop,1,[0,e/1.5*.85]),this.needClose=r}else{var u=Math.min(1-.5*e/a,1.1);setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),u,[0,Math.max(e/(1.5*1.6),-90)]),this.needGoToLink=r}}else setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},preventScroll:function(){return this.popoutOpen},_requestRemoveStory:function(e,t){return new Promise(function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){i()}})})},_requestRemoveNarrative:function(e,t){return new Promise(function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){i()}})})},_requestList:function(){var e=this;return new Promise(function(t,n){var i={storyOwner:e.storyOwner,list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra};if(!e.storyRaw)return n();var a=ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra},{onDone:function(e){if(i.items=e.list,e.recommendations){var n=i.list+"_recommendations";window.store.stories[n]=_o._forceSetStore(i.storyRaw,n,e.recommendations)}t(i)},onFail:function(){n()}});e._saveRequest(a)})},_forceSetStore:function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},likedStoriesMap:{},_requests:[],questions:{},viewers:{},viewersState:{},replies:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:!1,inited:!0}},_requestFeedback:function(e,t){var n=this;void 0===t&&(t=0);var i=this.store;return new Promise(function(a,o){var r=ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,o,r,s,l,c,u){var d;(r&&r.length&&(i.replies[e]=r),i.viewers[e])?o&&(d=i.viewers[e]).push.apply(d,t):i.viewers[e]=t;i.viewersState[e]?o&&extend(i.viewersState[e],{count:n,nextFrom:o}):i.viewersState[e]={count:n,nextFrom:o,repliesCountText:s,authorCountText:l,repliesScrollLeft:0,hiddenReason:u},c.length&&(i.questions[e]=c),s&&(i.viewersState[e].repliesCountText=s),l&&(i.viewersState[e].authorCountText=l),a({viewers:t,count:n,nextFrom:o,repliesCountText:s,authorCountText:l,questions:c})},onFail:function(){o()}});n._saveRequest(r)})},_requestReadStories:function(){var e=this.store,t=Object.keys(e.readedStories),n=Object.keys(e.likedStoriesMap),i=this._getSource();if(t.length){var a,o,r=ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:this.store.authors[0].read_hash,stories:t.join(","),liked_stories:n.join(","),source:i,navigation_stats:(o=ro.map(function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")}).join(";"),ro=[],o),loading_stats:(a=so.map(function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")}).join(";"),so=[],a),connection_type:oo()},{onDone:function(){e.readedStories={},"feed"===i&&_o._requestFeedBlock()}});this._saveRequest(r)}else this._needFeedUpdate&&(this._needFeedUpdate=!1,setTimeout(function(){_o._requestFeedBlock()}))},_getSource:function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},_sendNavigationStatEvents:function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;n&&function(e){var t=e.storyRawId,n=e.source,i=e.action,a=t.split("_");"reply"===n&&(n="replies_list");var o={ownerId:a[0],storyId:a[1],source:n,action:i};ro.push(o)}({storyRawId:n,source:this._getSource(),action:e})},_sendViewerStartTime:function(e,t){!function(e){var t=e.storyRawId,n=e.source,i=e.time,a=t.split("_"),o={ownerId:a[0],storyId:a[1],source:n,time:i};so.push(o)}({storyRawId:e,source:this.viewerSource,time:t})},_requestFeedBlock:function(){var e=nav.getQuery();if(!window.store.storiesLayers.length)ajax.post("stories.php",{_ajax:1,act:"feed_block",q:e.q},{onDone:function(e,t){var n=ge("StoriesFeedBlock");n&&replace(ceFromString(e),n),_o.pushPreloadedList(t)}})},_requestClickStat:function(e,t,n,i){ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n},{onDone:function(){i&&i()}})},_requestStickerStat:function(e,t){var n=this.getCurrentStory(),i=n.raw_id,a=n.clickable_stickers;i&&a&&ajax.post("stories.php",extend({act:"stickers_stat",story_raw_id:i,action:e,hash:a.hash},t))},_sendMessage:function(e,t,n,i){var a=ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:e,media:t,message:n,to:i},{onDone:function(){var e=window.lang;_o.showFlashPopup(e.mobile_stories_comment_success),_o.sendAnalyticsEvent("comment_send")}});this._saveRequest(a)},_requestFave:function(e,t,n,i){ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:cur.module})},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=t[1],i=t[2],a=t[4],o=t[6],r=n+"_"+i;return e.match(/from_feed\=1/)?a="feed":e.match(/profile\=1/)?a="profile":a||(a=r),r+"/"+a+"/"+o}return e},setHistory:function(e,t){void 0===t&&(t={nav_init:!1,replace:!0});var n=window.nav,i=this.getHistoryURL(e),a=n.getQuery();i.match(/narrative-\d+_\d+/)&&(i="narrative"+this.getCurrentStory().narrative.raw_id),a.z=i;var o=n.path+obj2qs(a)+n.hash,r={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};n.go(o,null,r)},getFrom:function(e){void 0===e&&(e=!0);var t=window.nav,n=this.store.list,i=t.getQuery(),a="z="+i.z,o="";return"/write"===t.path.substr(0,6)?o="write"+t.path.substr(0,6)+"?"+a:"/mail"===t.path?o="write"+i.peer+"?"+a:"/feed"===t.path?o=i.section&&"notifications"===i.section?"feed?section=notifications&"+a:"feed?"+a:n.startsWith("archive")?o=t.path+"?act=stories":i.from&&(o=i.from),e?encodeURIComponent(o):o},getHistoryURL:function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},getParams:function(){return this.params||{}},reportCurrentStory:function(e){var t=window.nav,n=this.getHistoryURL(e),i=(t.getQuery(),"/reports?act=add&object="+n+"&refrom="+this.getFrom());t.go(i)},openGroupsSettings:function(){var e=window.nav,t=this.getFrom(),n="/settings?act=groups_stories&story_raw_id="+this.getCurrentStory().raw_id+"&from="+t+"&hash="+this.getCurrentAuthor().data.stories_get_groups_settings_hash;this.sendAnalyticsEvent("set_group_view"),this.pauseStory(),e.go(n)},toggleBookmark:function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor();if(n){var a=n.getCurrentStory(),o=a.bookmark_add_hash,r=window.store,s=(a.narrative?a.narrative:a).is_bookmarked;Object.keys(r.stories).forEach(function(e){var t=r.stories[e];if(t.authors){var n=!1;t.authors.forEach(function(e){n||(n=e.items.find(function(e){return!!e.narrative&&(e.narrative.bookmark_hash===o&&e.raw_id===a.raw_id)}))}),n&&(n.narrative?n.narrative.is_bookmarked=!s:n.is_bookmarked=!s)}}),Object(i.val)(e,s?lang.mobile_stories_menu_bookmark_title:lang.mobile_stories_menu_bookmarked_title);var l=s?"bookmark_remove":"bookmark_add",c=a.narrative,u=c.owner_id,d=c.id;t||this._requestFave(l,u,d,o),a.narrative&&Share.setBookmarkState(a.narrative.raw_id,!s)}},share:function(e,t){var n=this,i=this.getCurrentAuthor();if(i){var a=i.getCurrentStory(),o=a.bookmark_add_hash,r=(a.narrative?a.narrative:a).is_bookmarked;this.stopStory();this.getFrom();var s=t?"narrative":"story";this.stopStory(),Share(e,{mail_hash:this.getCurrentStory().share_hash,object:s+e,is_bookmarked:r,bookmark_hash:o,bookmark_type:31,can_bookmark:t,can_to_own:t,can_to_club:t}),cur.share.onClose(function(){n.playStory()})}},openReplies:function(e,t){void 0===t&&(t=!1),this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,{reply:!0,replyTo:t});else this.close()},openNarrative:function(e,t){this.playStory(),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,t);else this.close()},clickClose:function(){var e=this;requestAnimationFrame(function(){e.sendAnalyticsEvent("close_tap"),e.close()})},close:function(e){if(void 0===e&&(e={}),extend({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var t=window.nav,n=t.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var i=window.store.storiesLayers[window.store.storiesLayers.length-1-1],a=window.store.stories[i],o=a.authorIndex,r=a.authors[o].index,s=a.authors[o].items[r];n.z=this.getHistoryURL(s.raw_id)}else delete n.z;var l=t.path+obj2qs(n)+(t.hash||"");t.go(l,null,{push_only:!0})}if(this.destroy(),e.isPopState&&e.storyRaw){var c=this._parseList(e.storyRaw).split("/")[1];this.store?this.restore(this.store.storyList,c,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,!1,!1,e)},hideAllViews:function(){var e=window.store;e&&(e.storiesLayers=[],e.stories&&Object.keys(e.stories).forEach(function(t){e.stories[t].showViews=!1,e.stories[t].isStopped=!1}))},restore:function(e,t,n,a){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===a&&(a={}),window.store.storiesLayers){var o=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(o,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var r=window.store.stories[e],s=window.store.stories[t];if(r&&s){var l=Object.keys(r.readedStories);Object(i.each)(l,function(e,t){var n=t.split("_"),i=n[0],a=(n[1],n[2],s.replies[r.replyTo]);if(a){var o=a.filter(function(e){return e.owner_id==i})[0];o&&(o.has_new=!1)}}),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();a.closeAll&&window.store.storiesLayers.length&&this.close(a)},clearStore:function(){this.store=this._initStore()},destroy:function(){var e=this;if(this.restoreAudio(),this.store){this.slider=null,this.hideMenu(!1),this._abortRequests(),this._requestReadStories(),Object(i.removeClass)(this.layer,"Stories_inited");var t=this.getCurrentAuthorIndex();if(void 0!==t&&this.Authors)this.Authors[t].destroy();this.onRender.off(),Object(i.remove)(this.layer),Object.keys(this).forEach(function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])}),zlayer.close(),Object(i.addClass)(ge("StoriesFeedBlock"),"StoriesFeedBlock_been-open"),Object(i.removeClass)(document.body,"vk__story_open"),_o.opened=!1;var n=Object(i.geByClass1)("Question__popup"),a=Object(i.geByClass1)("Popup__overlay",n);a&&Na.default.close(a)}},isAutoplaySupport:function(){return this.supportAutoplay},isGoodBrowser:function(){return _.default.ios&&_.default.safari_mobile&&parseInt(_.default.version,10)>=10},detectAutoplay:function(){var e=this;return new Promise(function(t){if(e.supportAutoplay)t();else{if(e.isGoodBrowser())return e.supportAutoplay=!0,void t();e.supportAutoplay=!1;var n=Object(i.ce)("video"),a=Object(i.ce)("source");a.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var o=Object(i.ce)("source");o.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",Object(i.append)(o,n),Object(i.append)(a,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),Object(i.append)(n,document.body);var r=ge("base64testvideo");if(_.default.android&&_.default.chrome)return e.supportAutoplay=!0,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(_.default.mobile&&_.default.ios&&_.default.ios<10)return e.supportAutoplay=!1,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(!_.default.safari_mobile||_.default.safari_mobile&&parseInt(_.default.version,10)>=10){var s=n.play();void 0!==s&&s.then(function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)}).catch(function(e){})}r.onplay=function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout(function(){r.paused||(e.supportAutoplay=!0),Object(i.remove)(n),t()},250)}})},narrativeReply:function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},narrativeGoToStories:function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},_showTooltip:function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n=this.getCurrentAuthorEl();this.tooltip=Object(i.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=Object(i.ce)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),n.appendChild(this.tooltip);var a=0,o=0;"touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY);var r=n.getBoundingClientRect(),s=r.top,l=r.left,c=r.width,u=getSize(this.tooltip),d=u[0],_=o-(s+u[1]+10),f=a-(l+d/2);setStyle(this.tooltip,{top:Math.max(_,2),left:Math.min(Math.max(f,2),c-d-2)}),setStyle(this.tooltipArrow,{left:Math.max(Math.min(a-l-Math.min(Math.max(f,0),c-d),d-15),15)}),this.pauseStory()}else this.playStory()},_showFeatureTooltipIfNeeded:function(){var e=this,t=window.store.storiesLists;if(t&&t.needShowFeatureTooltip){var n=_o.getCurrentAuthorEl(),a=Object(i.geByClass1)("StoriesFeatureTooltip",n);if(a){var o=setTimeout(function(){e.pauseStory(),Object(i.addClass)("StoriesFeatureTooltip--show",a),e.featureTooltip=a,e.featureTooltipHash=t.needShowFeatureTooltipHash},2e3);t.needShowFeatureTooltip=!1,cur&&isArray(cur.destroy)&&cur.destroy.push(function(){clearTimeout(o)})}}},_hideFeatureTooltip:function(e){if(this.featureTooltip){var t=_o.getCurrentAuthorEl(),n=Object(i.geByClass1)("StoriesFeatureTooltip",t);n&&(e||this.playStory(),Object(i.removeClass)("StoriesFeatureTooltip--show",n),this.featureTooltip=null,ajax.post("stories.php",{_ajax:1,act:"hide_feature_tooltip",type:"stories_pin",hash:this.featureTooltipHash}),this.featureTooltip=null,this.featureTooltipHash=null)}},_hideTooltips:function(e){this._hideFeatureTooltip(e),this.tooltip&&(e||this.playStory(),Object(i.remove)(this.tooltip),delete this.tooltip)},_createNarrativeTooltipLink:function(){var e=this.getCurrentStory().narrative||{};return Object(i.ce)("div",{className:"Stories__tooltip-link",innerHTML:lang.mobile_stories_narrative_show,onclick:function(){_o._hideTooltips(!0),_o.openNarrative(e.owner_id+"/narrative"+e.raw_id,{source:"narrative_story",isOpenNarrativeFromFeed:!0})}})},_hasContext:function(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)},sendAnalyticsEvent:function(e,t){void 0===t&&(t={});var n=_o.getCurrentStory(),i=_o.getCurrentAuthor(),a=_o.getCurrentStoryIndex(),o=_o._getSource(),r=n.is_groups_meta_story,s=n.raw_id.split("_"),l=s[0],c=s[1],u=0;r&&(l=0,c=0),"groups"===this.storyList&&(u=1);var d={event_type:e,story_owner_id:l,story_id:c,time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3),view_entry_point:o,nav_screen:cur.module,story_type:r?"group_feed":"",is_grouped:u};if(i){var _=i.data,f=i.getCountDown();f&&_&&extend(d,{stories_author_before:a,stories_author_after:_.items.length-a,view_event_timeline_position:f.initialTime-f.left})}Object.assign(d,t),statlogsValueEvent("story_product_analytics",d)},clickAuthor:function(){this.sendAnalyticsEvent("go_to_author")},askQuestionBox:function(e){Object(i.cancelEvent)(e);var t=this.getCurrentStory().can_ask;if(this.hideFlashPopup(!1),this.sendAnalyticsEvent("click_on_clickable_sticker"),this._hideTooltips(),!t)return _o.showFlashPopup(lang.mobile_stories_ask_question_forbidden),!1;this.stopStory(),Object(i.addClass)(this.layer,"Stories_questionOpened");var n=this.authors[this.store.authorIndex],a=Object(i.geByClass1)("Story__questionTextarea",n);requestAnimationFrame(function(){a&&a.focus()})},changeAskAnonymous:function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+Object(i.domData)(t,"selected"),a=this.getCurrentStory();if(a){var o=[Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",co],class:n===co?"selected":""}),Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",lo],class:n===lo?"selected":""})];a.can_ask_anonymous&&o.splice(1,0,Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",uo],class:n===uo?"selected":""}));var r=Object(Na.default)({class:"Story__questionSelectModal",close:!0,closeText:lang.mobile_stories_ask_question_cancel,items:o});ze.default.open(l.default.elem(r),!0)}}},changeQuestionMode:function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case lo:Object(i.val)(n,lang.mobile_stories_ask_question_public),Object(i.domData)(n,"selected",lo);break;case co:Object(i.val)(n,lang.mobile_stories_ask_question_author_only),Object(i.domData)(n,"selected",co);break;case uo:Object(i.val)(n,lang.mobile_stories_ask_question_anonymous),Object(i.domData)(n,"selected",uo)}Na.default.close(e)},hideAskQuestion:function(e){void 0===e&&(e=!0),_o.store.showMenu=!1,Object(i.removeClass)(_o.layer,"Stories_questionOpened"),e&&_o.playStory()},onInputQuestion:function(e){$(".Story__questionSend").disabled=!Object(i.trim)(Object(i.val)(e))},sendQuestion:function(){var e=_o.getCurrentAuthorEl();if(e){var t=Object(i.geByClass1)("Story__questionTextarea",e),n=Object(i.geByClass1)("Story__questionSend",e),a=_o.getCurrentStory(),o=a.raw_id,r=a.askQuestionHash,s=a.accessKey,l=o.split("_"),c=l[0],u=l[1],d=Object(i.trim)(Object(i.val)(t)),_=document.querySelector(".Story__questionSelect"),f=+Object(i.domData)(_,"selected"),p=!1,h=!1;f===lo?p=!0:f===uo&&(h=!0),Object(i.val)(t,""),n.disabled=!0;var m=ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:u,question_text:d,is_anonymous:+h,with_mention:+p,hash:r,access_key:s},{onDone:function(e){if(!e)return _o.showFlashPopup(lang.mobile_stories_question_error),!1;var t=_o.getCurrentAuthor().data.author;switch(_o.showFlashPopup(lang.mobile_stories_question_sent.replace("{name}",t.first_name_ins)),f){case lo:_o.sendAnalyticsEvent("question_reply_publish");break;case co:_o.sendAnalyticsEvent("question_reply");break;case uo:_o.sendAnalyticsEvent("question_reply_anonymous")}}});_o._saveRequest(m),_o.hideAskQuestion()}},getQuestionById:function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find(function(t){return t.id===e})},openQuestionActions:function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,o=[Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(o.push(Object(Na.ModalMenuBtn)({inner:i?lang.mobile_stories_question_unban:lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),o.push(Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&o.unshift(Object(Na.ModalMenuBtn)({inner:lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var r=Object(Na.default)({class:"Question__popup",items:o});ze.default.open(l.default.elem(r),!0)}},removeQuestion:function(e,t){var n=this,a=this.getQuestionById(t),o=a.storyOwnerId,r=a.storyId,s=a.id,l=a.removeHash;ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:o,story_id:r,question_id:s,remove_hash:l},{onDone:function(a){var l=o+"_"+r;if(Na.default.close(e),!a)return requestAnimationFrame(function(){return n.showFlashPopup(lang.mobile_stories_question_error)}),!1;$$('.Question[data-id="'+t+'"]').forEach(function(e){return re(e)}),n.store.questions[l]=n.store.questions[l].filter(function(e){return e.id!==t}),$$(".Question").length<1&&re(Object(i.geByClass1)("Views__questions")),_o.sendAnalyticsEvent("question_delete",{questionId:s})}})},replyQuestionBox:function(e,t){var n=this.getCurrentStory(),i=this.getQuestionById(t),a=i.author,o=i.text,r=lang.mobile_stories_question_reply_title.replace("{name}",a.nameGen),s=l.default.elem({class:"QuestionReplyPopup",inner:[{class:"QuestionReplyPopup__inner",inner:[{class:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+n.small_preview+")"},{class:"QuestionReplyPopup__top",inner:[{class:"QuestionReplyPopup__title",inner:r},{class:"QuestionReplyPopup__question",inner:o}]}]},{class:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{class:"QuestionReplyPopup__footer",inner:[Object(Jn.default)({class:"QuestionReplyPopup__send",theme:"regular",inner:lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",t],disabled:!0}),Object(Jn.default)({class:"QuestionReplyPopup__cancel",theme:"link",inner:lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});this.popout.appendChild(s),Na.default.close(e)},hideReplyQuestion:function(){re(Object(i.geByClass1)("QuestionReplyPopup",_o.popout))},onInputReplyQuestion:function(e){$(".QuestionReplyPopup__send").disabled=!Object(i.trim)(Object(i.val)(e))},sendReplyQuestion:function(e){var t=Object(i.trim)(Object(i.val)(Object(i.geByClass1)("QuestionReplyPopup__textarea"))),n=_o.getQuestionById(e),a=n.id,o=n.ownerId,r=n.storyOwnerId,s=n.storyId,l=n.sendHash,c="story"+r+"_"+s,u=t+"\n\n🗣 "+n.text,d=ajax.post("mail.php",{_ajax:1,act:"send",hash:l,media:c,message:u,to:o},{onDone:function(e){var t=e&&e.error?e.message:lang.mobile_stories_comment_success;_o.showFlashPopup(t,!1),_o.sendAnalyticsEvent("question_send_message",{questionId:a})}});_o._saveRequest(d),_o.hideReplyQuestion()},showQuestions:function(e){var t=new ao(e).render();this.popout.appendChild(t),_o.sendAnalyticsEvent("question_show_all")},hideQuestions:function(){re(Object(i.geByClass1)("Questions",this.popout))},banQuestion:function(e,t){var n=this.getQuestionById(t),i=n.storyOwnerId,a=n.storyId,o=n.banHash,r=n.isOwnerBlocked;ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:i+"_"+a,question_id:t,ban_hash:o,is_blocked:+r},{onDone:function(i){if(!i)return Na.default.close(e),void _o.showFlashPopup(lang.mobile_stories_question_error,!1);if(!r){var a="question_ban_author";n.isAnonymous&&(a="question_ban_anonymous_author"),_o.sendAnalyticsEvent(a,{questionId:t})}Na.default.close(e),n.isOwnerBlocked=!r,_o.showFlashPopup(r?lang.mobile_stories_question_author_unblocked:lang.mobile_stories_question_author_blocked,!1)}})},reportQuestion:function(e,t){var n=this.getQuestionById(t),i=this.getFrom();Na.default.close(e);var a="story_question"+n.storyOwnerId+"_"+n.id;nav.go("/reports?act=add&object="+a+"&refrom="+i)},toggleQuestionTooltip:function(e,t){var n=this.getCurrentAuthor().getCurrentStory(),a=$(".QuestionSupport"),o=$(".Story__questionSelect"),r=+Object(i.domData)(o,"selected");if(Object(i.cancelEvent)(e),a){var s=n.firstName;n.authorId<0&&(s=lang.mobile_stories_ask_question_group_owner);var l="";switch(r){case lo:l=lang.mobile_stories_ask_question_public_tooltip;break;case co:l=lang.mobile_stories_ask_question_author_only_tooltip;break;case uo:l=lang.mobile_stories_ask_question_anonymous_tooltip}$(".QuestionSupport__tooltip").innerText=l.replace("{name}",s),t?Object(i.removeClass)(a,"QuestionSupport--active"):Object(i.toggleClass)(a,"QuestionSupport--active")}},openMusicStickerActions:function(e,t){var n=ge("audio"+e),i=hasClass("ai_added",n),a=Object(Na.default)({close:!0,items:[Object(Na.ModalMenuBtn)({class:"ai_add",inner:i?lang.global_delete_audio:lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),Object(Na.ModalMenuBtn)({class:"ai_add",inner:lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),o=l.default.elem(a);o.setAttribute("id","ai_menu_"+e),ze.default.open(o,!0)},addMusic:function(e,t,n){audioplayer.add(t),Na.default.close(e),_o._hideTooltips(!0),_o.showFlashPopup(n?lang.mobile_stories_music_deleted:lang.mobile_stories_music_added)},nextMusic:function(e,t){var n=window,i=n.audio,a=n.audioplayer,o=ht(t);if(i.getCurrentId()){var r=i.playlist().map(function(e){return e.id}).indexOf(i.getCurrentId())+1;i.addToPlaylist([o],r)}else a.playPause(!1,o.fullId,!0),i.pause();Na.default.close(e),_o._hideTooltips()},toggleLikeForCurrentStory:function(e){var t=this.store,n=_o.getCurrentStory(),a=_o.getCurrentAuthor().story,o=n.raw_id,r=n.isLiked,s=n.likeHash,c=n.accessKey,u=!!t.likedStoriesMap[o],d=o+":"+c;this._sendNavigationStatEvents("click_to_like");var _={act:r?"delete_like":"like",hash:s,story_raw_id:o};a.isLiked=!r,n.isLiked=!r,r?(delete t.likedStoriesMap[d],e.innerHTML=l.default.html(Object(Lt.default)("stories","like_outline_shadow_48"))):(t.likedStoriesMap[d]=!0,e.innerHTML=l.default.html(Object(Lt.default)("stories","like_shadow_48"))),Object(i.toggleClass)("Story__like--set",e,n.isLiked),u||r&&ajax.post("stories.php",_,{onDone:function(t){t&&(a.isLiked=r,n.isLiked=r,e.innerHTML=r?l.default.html(Object(Lt.default)("stories","like_shadow_48")):l.default.html(Object(Lt.default)("stories","like_outline_shadow_48")),Object(i.toggleClass)("Story__like--set",e,n.isLiked))}})},onRender:Object(s.default)()};page.onChange(function(){window.store.storiesLayers=[],window.store.stories={}}),window.Stories=_o;var fo="_si_container_loading",po="StoriesArchive--loaded",ho={};function mo(e){var t=$$(".StoryThumb[data-time]",e);if(t)return t.forEach(function(e){var t=1e3*e.getAttribute("data-time"),n=new Date(t);if(ho[n.toDateString()]&&ho[n.toDateString()]!==t){var i=geByClass1("StoryThumb-date",e);re(i)}else ho[n.toDateString()]=t}),e}window.initStoriesArchive=function(){var e=0,t=!1,n=$(".StoriesArchive"),a=n.classList.contains(po);mo(n),Object(i.initAutoScroll)(function(){var t=$$(".StoryThumb");return e=t.length,t[t.length-1]},function(){if(t||a)return!1;var i=$(".StoriesArchive-stories");i.classList.add(fo),t=!0,ajax.post("/stories_archive",{offset:e,_ajax:!0},{onDone:function(e){var o=ce("div");o.innerHTML=e.html,o=mo(o),i.innerHTML+=o.innerHTML,i.classList.remove(fo),e.more||(a=!0,n.classList.add(po)),t=!1}})})};var vo={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var i=ge(n+"__message-archived");if(t){var a=n+"__message-rollback",o=ce("div",{className:["post_message_item",i.className].join(" "),innerHTML:t,id:a});hide(i),ge(o)||after(o,i)}else{var r=ge(n+"__message-rollback");show(i),remove(r)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&addClass(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,i=e.restored,a=e.rollback_hash,o=this.link;cur.restored||(cur.restored=0),i&&"profile"===cur.module&&cur.restored++,removeClass(o,"wia_item--loading");var r=ge(n),s=ge(n+"_replies");if(t){if(cur.restored>3){var l=r.id+"?act=rollback_archive&hash="+a;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:l,onclick:"return ajax.click(this, Archive.rollback)",inner:getLang("mobile_archive_restore_bulk")}})}var c=r.id+"__message-archived",u=ce("div",{className:["post_message_item",r.className].join(" "),innerHTML:t,id:c});hide(r),hide(s),ge(c)||after(u,r)}else if(n){var d=ge(n+"__message-archived"),_=ge(n+"_replies");show(n),show(_),remove(d)}}}};window.Archive=vo;var Ao=function(e,t){cancelEvent(e);var n=t.getAttribute("href"),i=getLang("mobile_wall_prometheus_edit_warn");Confirm(i,'Popup.close(this); nav.go("'+n+'");',"",{title:getLang("mobile_prometheus_edit_warn_popup_title")})};window.PrometheusEditConfirm=Ao,window.CopyrightPopup={open:function(e,t,n,i){var a=Object(Fe.default)({class:"CopyrightPopup",header:{title:getLang("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:getLang("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(i?1:0)+")"})]}]}});Fe.default.open(Wd.elem(a),!0)},go:function(e,t,n){var i;if(Fe.default.close(e),t.startsWith("/story"))Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(\/?([a-z0-9_-]+))?$/i.exec(t))Stories.init(i[1]+"/narrative"+i[1]+"_"+i[2],{source:"view_source"});else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}};var go=n("UvyM");function bo(){var e=window.lang,t=Object(g.$)(".pcont .service_msg_box");if(t){var n=Object(g.$)(".service_msg",t).innerHTML;Object(i.remove)(t);var a=Object(Fe.default)({class:"CopyrightPopup",content:[{inner:l.default.wrap(n)},{class:"Popup__buttons",inner:[Object(go.default)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});Fe.default.open(l.default.elem(a),!0)}}window.ZeroVKPopup={open:bo,init:function(){onDOMReady(function(){bo()})}};n("B9v3");window.initSharePage=function(e,t){var n=ge("SharePageInput__to"),i="";n&&(i=n.value);var a={};if("mail"===e&&""!==n.value&&(a=i.split(",").reduce(function(e,t){return e[t]=!0,e},{})),"club"===e){var o=Object(g.$)(".SharePage .qsearch_wrap"),r=Object(g.$)(".hp_block",o);show(o),show(r)}var s=Object(g.$)(".SharePage .SharePanel.MessagePanel"),l=Object(g.$)(".SharePage .SharePanel.ActionsPanel");extend(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),isUndefined(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=ge("club"+e):"mail"===t&&(a=ge("peer"+e));var o=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!o:o),cur.like_search.toggleAttach(e,!o),i&&(cur.selectedMap[e]=!o),n.value=Object.keys(cur.selectedMap).filter(function(e){return cur.selectedMap[e]}).join(","));var r=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some(function(e){return!!cur.selectedMap[e]});return s.classList.toggle("SharePanel--active",r),l.classList.toggle("SharePanel--active",!r),!1},selectedMap:a,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(a).forEach(function(t){cur.refreshSelected(t,e,!1)})};var yo=function(e,t,n,i,a,o,r){n?Confirm(t,"ReportConfirm.submit('"+a+"', false, "+i+", '"+o+"', "+JSON.stringify(r)+")","",{title:e,id:"confirm-"+i}):wo(a,!0,i,o,JSON.stringify(r))};function wo(e,t,n,i,a){"string"==typeof a&&(a=JSON.parse(a));var o=$("#mcont");setStyle(o,{"pointer-events":"none"}),ajax.post(e,Object(bt.default)({_ajax:1,reason:n},a)),"story"===a.type&&Stories.sendAnalyticsEvent("claim"),Object(v.partConfigEnabled)("mvk_new_info_snackbar")||Snackbar.init({text:getLang("mobile_msg_reported")}),$$(".Confirm").forEach(function(e){return Fe.default.close(e)})}Object(i.extend)(yo,{submit:wo}),window.ReportConfirm=yo;var ko=function(e){return{class:"ModalMenuUserList",inner:Object(oi.default)({inner:e.users})}};var So=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[Object(Lt.default)({sprite:"wall",name:"cancel_16"}),{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}},Co=2;window.Replies={init:function(e){!function(e){e&&function(){var e=Object(i.geByClass1)("wall_replies"),t=Object(i.domLC)(e);if(!t||!Object(i.hasClass)("RepliesThreadNext",t))return;var n=Object(i.geByClass1)("RepliesThreadNext__link",t);Object(i.autoScroll)(function(){if(Object(i.domPN)(t)&&!Object(i.hasClass)("RepliesThreadNext_loading",t))return n},RepliesNext,{no_cache:!0})}();(function(){var e=Object(i.ge)("reply_field");if(!e||Object(i.hasClass)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t(Object(i.throttle)(function(t){var a=t+Object(i.getCh)(),o=Object(i.getH)(e),r=a<Object(i.getY)(e)+o;r&&!n?(Object(i.setStyle)(e,{height:o}),Object(i.addClass)("RepliesField_fixed",e)):!r&&n&&(Object(i.removeClass)("RepliesField_fixed",e),Object(i.setStyle)(e,{height:null})),n=r},10)),Object(i.onBodyScrollForce)()})(),function(e){var t=Object(i.ge)("replies_to_last"),n=Object(i.geByClass1)("RepliesWrap");if(!t||!n)return;var a=Object(i.ge)("reply_field"),o=Object(i.hasClass)("RepliesField_static",a),r=Object(i.getY)(n),s=window.onBodyScroll,l=!1;xo(),s(Object(i.throttle)(function(e){var s=e+Object(i.getCh)(),c=a&&!o?Object(i.getY)(a)-Oo:r+Object(i.getH)(n)-Oo,u=r<e&&s<c;u!==l&&(Object(i.toggleClass)("Replies_last_shown",t,u),t.setAttribute("tabindex",u?0:-1),l=u)},10))}()}(e);var t=Object(i.ge)("reply_field"),n=Object(i.ge)("reply_field_text");mediaUpload&&t&&(mediaUpload.onStart(Po),mediaUpload.onRemove(function(){Po(),n.focus()}));if(t){var a=window.cur;a.onStickersToggleCallbacks=a.onStickersToggleCallbacks||[],a.onStickersToggleCallbacks.push(function(e){if(Object(i.onBodyScrollForce)(),Mo(),e){var t=Object(i.geByTag1)("a","stickers_panel");t&&t.focus()}else n.focus()}),Io()}},replyTo:function(e,t,n,a,o){void 0===o&&(o="wall_reply");if(Object(i.checkEvent)(e))return!0;if(window.cur.replyTo!==n&&Ho)return Qo(),!0;n=n||0,Object(i.geByClass)("ReplyItem_active").forEach(function(e){Object(i.removeClass)("ReplyItem_active",e)});var r,s=Object(i.ge)("reply_field"),l=Object(i.ge)("reply_field_text"),c=Object(i.hasClass)("RepliesField_static",s),u=!!window.post&&window.post.replyNamesRE(),d=Object(i.val)(l),_="";if(n){if(r=Object(i.ge)(o+t+"_"+n))if(c||Object(i.addClass)("ReplyItem_active",r),!Object(i.hasClass)("ReplyItem_deleted",r)&&a){var f=window.cur.replyNames[a]||{},p=f[0]||"";_=f[1]||"",d=d?u?d.replace(u,p):d:p,window.post&&window.post.onReplyClick(!0,p)}else d=u?d.replace(u,""):d}else d=u?d.replace(u,""):d;Object(i.val)(l,replaceEntities(d));var h=Object(i.ge)("reply_field_to"),m=Object(i.geByClass1)("RepliesField__infoName",h);Object(i.val)(m,Object(i.htsc)(_)),Object(i.toggleClass)("RepliesField__infoItem_shown",h,n&&_),Object(i.toggleClass)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!_);var v=Object(i.ge)("reply_field_info"),A=Object(i.ge)("reply_field_from");if(Object(i.toggleClass)("RepliesField__info_shown",v,n||A),Object(i.toggleClass)("RepliesField__info_single",v,n&&!A||!n&&A),Object(i.val)("field_reply_to",n),Object(i.val)("field_reply_to_name",n&&_?"1":""),window.cur.replyTo=n,Object(i.val)("field_timestamp",$o()),c)if(r)Unfold.changePosition(Unfold.getByName("attaches"),!0,!1),domInsertAfter(s,r);else{Unfold.changePosition(Unfold.getByName("attaches"),!0,!0);var g=Object(i.geByClass1)("wall_replies");domInsertBefore(s,g)}return Mo(),Io(),elfocus(l),Object(i.cancelEvent)(e)},showMoreActions:function(e,t){var n=Object(i.ge)("reply_more_"+e);if(!n)return;var a=Object(i.geByClass)("ReplyItem__action",n),o=[];a.forEach(function(e){o.push(Object(Na.ModalMenuBtn)({inner:Object(i.val)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))});var r=Object(Na.default)({close:!0,items:o}),s=Object(i.ceFromString)(l.default.html(r));s=ze.default.open(s,!0,{oncloseCallback:function(){var t=Object(i.ge)("reply_more"+e);t&&t.focus()}});var c=Object(i.geByClass1)("ModalMenu__btn",s);c&&c.focus();return Object(i.cancelEvent)(t)},onClickMoreAction:function(e,t){t&&ze.default.close(t.target);var n=Object(i.ge)(e);if(!n)return;n.click()},onFieldInput:Io,toggleStickers:function(e,t){if(Ho)return Object(i.cancelEvent)(t);return window.post.stickersToggle(e),Object(i.cancelEvent)(t)},replyAsShow:function(e,t,n){void 0===n&&(n=!1);var a,o=!!window.cur.replyAs;Wo(Eo),o?a=Ro(window.cur.replyAs):(a=l.default.wrap(Object(b.default)({large:!0})),function(e,t){void 0===t&&(t=!1);if(window.cur.replyAsLoading)return;var n=window.ajax;window.cur.replyAsLoading=!0,n.post("/wall.php",{act:"get_reply_clubs_list",only_this_group:t?1:0,post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=Object(i.ge)("reply_as_users_list");if(t){var n=Ro(e);Object(i.val)(t,l.default.html(n));var a=Object(i.geByClass1)("ModalMenuUserList__item",t);a&&a.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t,n));var r=Object(Na.default)({title:Object(i.getLang)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:a}]}),s=Object(i.ceFromString)(l.default.html(r));if(ze.default.open(s,!0),o){var c=Object(i.geByClass1)("ModalMenuUserList__item",Object(i.ge)("reply_as_users_list"));c&&c.focus()}return Object(i.cancelEvent)(e)},replyAsChange:function(e,t,n,a){var o=Object(i.ge)("reply_field_from"),r=Object(i.geByClass1)("RepliesField__infoName",o);return Object(i.val)(r,Object(i.htsc)(a)),Object(i.val)("field_from_oid",n),Na.default.close(t),Object(i["ge"])("reply_field_text").focus(),Object(i.cancelEvent)(e)},checkSendButton:function(e){if(!Lo())return Object(i.cancelEvent)(e)},onClickLastReplies:function(e,t){var n=Object(i.geByClass1)("wall_replies"),a=Object(i.domLC)(n),o=a&&Object(i.hasClass)("RepliesThreadNext",a);if(o){var r=Object(i.geByClass1)("Loading",a);r||(r=Object(i.ceFromString)(Object(b.default)({})),append(r,a)),Object(i.addClass)("RepliesThreadNext_loading",a)}if(Object(i.removeClass)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),o)return a.focus(),ajax.click(e,window.RepliesLast);a&&(Object(i.hasClass)("RepliesThread",a)&&(a=Object(i.domPS)(a)),Object(i.hasClass)("ReplyItem",a)&&Object(i.geByClass1)("ReplyItem__name",a).focus());return Object(i.cancelEvent)(t)},onSubmitForm:function(e,t){if($o())Qo();else{if(e.preventDefault(),Vo)return;Vo=!0;var n=$('textarea[name="message"]',t),a=n?n.value:"",o=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),r=o[1],s=o[2];ajax.post("/wall.php",{act:"check_comment",oid:r,post_oid:s,text:a},{onDone:function(e){Vo=!1;var t=e.timestamp;if(e.delay){var n=1e3*e.delay;qo(t);var a,o=$("#reply_field");Object(i.hasClass)("RepliesField_fixed",o)?a=Object(i.getH)(o)+5:Object(i.hasClass)("RepliesField_static",o)||(a=Object(i.getH)($("body"))-Object(i.getY)(o)+5),No=Snackbar.init({type:y.SNACKBAR_TYPE_BULLYING,text:e.description,bottom:a,duration:n}),Do=setTimeout(function(){zo(),Qo()},n),function(e){var t=$("#nc_submit"),n=$(".RepliesField__field"),a=l.default.elem({class:"RepliesField__action RepliesField__action_cancel",inner:So({duration:e/1e3}),onclick:["Replies.abortTimer",jo]});Ho=!0;var o=$(".RepliesField__action_attach"),r=$(".RepliesField__action_smile");o&&o.classList.add(To),r&&r.classList.add(To),n.appendChild(a),Object(i.hide)(t)}(n)}else qo(t),Qo()},onFail:function(){Vo=!1,Qo()}})}},abortTimer:Wo,setCurrentTimestamp:qo};var Oo=50,Eo="editing",jo="button",To="RepliesField__action_disabled";function Io(){var e=Object(i.ge)("reply_field_text"),t=Object(i.ge)("reply_field_text_fake"),n=e.value;t.innerText=n,"\n"===Object(i.last)(n)&&(t.innerHTML+="&nbsp;");var a=Object(i.getH)(t);Object(i.getH)(e)!==a&&(Object(i.setStyle)(e,{height:a}),Mo()),Bo(),Wo(Eo)}function Mo(){var e=Object(i.ge)("reply_field");Object(i.hasClass)("RepliesField_static",e)||Object(i.hasClass)("RepliesField_fixed",e)&&(Object(i.setStyle)(e,{height:Object(i.getH)(Object(i.geByClass1)("RepliesField_wrap",e))}),xo(),Object(i.onBodyScrollForce)())}function xo(){var e=Object(i.ge)("replies_to_last"),t=Object(i.ge)("reply_field");if(e&&t&&!Object(i.hasClass)("RepliesField_static",t)){var n=domData(e,"bottom");n||(n=parseInt(getStyle(e,"bottom"))||20,domData(e,"bottom",n)),Object(i.setStyle)(e,"bottom",Object(i.getH)(t)+parseInt(n))}}function Po(){Bo(),Mo();var e=(mediaUpload?mediaUpload.getAttachesCount():0)<Co;["photo_device","photo","video","audio","doc"].forEach(function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})}function Bo(){var e=Object(i.ge)("nc_submit");e&&Object(i.toggleClass)("RepliesField__action_send_active",e,Lo())}function Lo(){var e=(Object(i.ge)("reply_field_text")||{}).value;return trim(e)||mediaUpload&&mediaUpload.getAttachesCount()}function Ro(e){var t=[];return e.forEach(function(e){var n;t.push({class:"ModalMenuUserList__item",href:(n={href:e[2],image:e[1],name:e[3],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}).href,onclick:n.onclick?n.onclick:null,inner:[{tag:"img",class:"ModalMenuUserList__itemAvatar",src:n.image},{class:"ModalMenuUserList__itemName",inner:n.name}]})}),ko({users:t})}var Do,No,Ho=!1,Vo=!1,Fo={};function Uo(){Ho=!1,clearTimeout(Do),Snackbar.close(No),zo()}function $o(){return Fo[""+window.cur.replyTo]}function qo(e){Fo[""+window.cur.replyTo]=e,Object(i.val)("field_timestamp",e)}function Wo(e){if(Ho){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],a=$o();ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:a})}Uo()}function zo(){var e=$("#nc_submit"),t=($(".RepliesField__field"),$(".RepliesField__action_cancel")),n=$(".RepliesField__action_attach"),a=$(".RepliesField__action_smile");n&&n.classList.remove(To),a&&a.classList.remove(To),Object(i.remove)(t),Object(i.show)(e)}function Qo(){var e=$("#nc_submit");nav.go(e,event),qo(0)}nav.onBeforeGo(function(e,t){var n=location.pathname.substr(1,4);isString(e)&&e.substr(1,4)!==n&&"wall"===n&&(Fo={})}),page.onChange(function(e,t){Uo()});n("vOib");window.PostAttachVideoLink={},PostAttachVideoLink._onInit=Jo,PostAttachVideoLink._onPlayClick=er,PostAttachVideoLink._onReplayClick=er,PostAttachVideoLink._onSoundClick=Zo,PostAttachVideoLink._onVideoClick=tr,PostAttachVideoLink._onVideoPlay=function(e){return nr(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return nr(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return nr(e.target,"end")};var Yo={muted:"PostAttachVideoLink_muted",state:function(e){return"PostAttachVideoLink_state_"+e}},Go={attach:".PostAttachVideoLink",video:".PostAttachVideoLink__video"},Xo=window.MutationObserver,Ko=null;function Jo(){Xo&&!Ko&&(Ko=new Xo(ir)).observe(document.body,{childList:!0,subtree:!0})}function Zo(e){var t=e.closest(Go.attach),n=Object(g.$)(Go.video,t);n.muted=!n.muted,t.classList.toggle(Yo.muted,n.muted)}function er(e){var t=e.closest(Go.attach);Object(g.$)(Go.video,t).play()}function tr(e){e.paused||e.pause()}function nr(e,t){var n=e.closest(Go.attach);n.classList.remove(Yo.state("play")),n.classList.remove(Yo.state("pause")),n.classList.remove(Yo.state("end")),n.classList.add(Yo.state(t))}function ir(e){e.forEach(function(e){e.removedNodes.forEach(function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&Object(g.$$)(Go.video,e).forEach(function(e){e.src="",e.load()})})}),Object(g.$)(Go.video)||(Ko.disconnect(),Ko=null)}var ar,or,rr,sr,lr;n("bRFj"),n("eyw1");window.FeedAssistanceStats=((ar={register:Ns,forceRegister:function(e,t){e[yr]=Vs(e),e[kr]=t,ys.push(e)},onScroll:throttle(Us,50),onStartViewElement:Object(s.default)("element"),onEndViewElement:Object(s.default)("element"),onStopTrackElement:Object(s.default)("element"),onViewedElement:Object(s.default)("element"),onBeforePageChange:zs,onPageChanged:Qs,getElementType:Vs,registerElements:Rs,registerTrackingCls:function(e){Ps.push(e)},unregisterTrackingCls:Ls}).unregisterTrackingCls=Ls,ar.setParenViewableX=function(e,t){e[Br]=t},ar.forceProcessTrack=Hs,ar.dispatchElementEvent=function(e,t){var n=function(e){return fs[e]}(vl(t[yr]||Vs(t),e));Xs({type:e,data:n(t)})},ar.dispatchEvent=function(e){Xs(e)},ar.serializeEventData=Fs,ar.clearElemsCache=function(){ys.forEach(function(e){e[Er]=!1,e[jr]=!1})},ar._debug=function(){return{started:ws,tracking:ys,events:xs,blindTop:Ss,blindBottom:Cs}},ar.getFromRef=Ol,ar.getRoot=El,ar.BLOCKS={},ar.EVENTS={},ar);var cr=.5,ur=.25,dr=500,_r=3e5,fr=2500,pr=1e4,hr=6e3,mr=2e4,vr=3e4,Ar=5e3,gr=36e4,br=100,yr="_feedAssistanceStatsType",wr="_feedAssistanceStatsIdled",kr="_feedAssistanceStatsModule",Sr="_feedAssistanceStatsStarted",Cr="_feedAssistanceStatsProcessed",Or="_feedAssistanceStatsEventTs",Er="_feedAssistanceStatsCachedY",jr="_feedAssistanceStatsCachedX",Tr="_feedAssistanceStatsLeft",Ir="_feedAssistanceStatsHeight",Mr="_feedAssistanceStatsWidth",xr="_feedAssistanceStatsTop",Pr="_feedAssistanceStatsBottom",Br="_feedAssistanceStatsParentViewableX",Lr="BLOCK_TYPE_RECOMMENDED_SLIDER",Rr="BLOCK_TYPE_DEFAULT",Dr="BLOCK_TYPE_EXPLORE_BAIT",Nr="BLOCK_TYPE_PROFILE_PHOTO",Hr="BLOCK_TYPE_PROMO_BUTTON",Vr="BLOCK_TYPE_IMPORT_CONTACTS",Fr="BLOCK_TYPE_PUSH_SWITCH",Ur="explore_bait",$r="feed_assistance",qr="hide",Wr="promo_button",zr="SUB_EXPLORE_BAIT",Qr="view",Yr="like",Gr="comment",Xr="opened",Kr="subscribe",Jr="unsubscribe",Zr="open_user",es="open_group",ts="hide",ns="report",is="seen",as="filled",os="enable_push",ss="decline_push",cs="SUB_PROMO_BUTTON",us="clicked",ds=((or={})[Lr]="view_block",or[Hr]="view_block",or[Dr]=Ur,or[Nr]=$r,or[Vr]=$r,or[Fr]=$r,or),_s=((rr={})[Lr]=500,rr[Dr]=dr,rr[Nr]=dr,rr[Vr]=dr,rr[Fr]=dr,rr),fs=((sr={})[vl(Lr,"view_block")]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code");return Fs("view_block","",e,domData(t,"ref"),n)},sr[vl(Hr,"view_block")]=function(e){return Fs("view_block",geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button",e)},sr[vl(Dr,Ur)]=function(){return Fs(zr,Qr)},sr[vl(Nr,$r)]=function(e){return Fs($r,e,"m_ph",is)},sr[vl(Vr,$r)]=function(e){return Fs($r,e,"m_mp",is)},sr[vl(Fr,$r)]=function(e){return Fs($r,e,"m_push_switch",is)},sr),ps=((lr={}).view_block=function(e,t,n,i){return n=n||Ol(t),[e,domChildIndex(t),jl(t),n,i].join("|")},lr[zr]=function(e){return e},lr[$r]=function(e,t,n){return[t,n,Ol(e)].join("|")},lr[qr]=function(e,t){return[e,jl(t),domChildIndex(t),Ol(t)].join("|")},lr[cs]=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},lr),hs="feed_other",ms="feedAssistance",vs="feedAssistanceStat.events",As="feedAssistanceStat.idled",gs="/feed",bs="assistance_stats",ys=[],ws=[],ks=Date.now(),Ss=0,Cs=0,Os=!1,Es=null,js=null,Ts=null,Is=null,Ms=null,xs=[],Ps=[],Bs=!1;function Ls(e){yl(Ps,e)}function Rs(){var e=[];each(Ps,function(){e=e.concat(geByClass(this))}),each(e,function(){Ns(this,"feed")})}function Ds(){Rs();var e=fl();e.length&&(cl(e),pl()),Hs(),nl()}function Ns(e,t){!e[yr]&&function(e){return!~ys.indexOf(e)}(e)&&(e[yr]=Vs(e),e[kr]=t,ys.push(e))}function Hs(){Ys(scrollGetY(),getCh())}function Vs(e){return e[yr]?e[yr]:hasClass("feedAssistance_recommendedFriends",e)?Lr:hasClass("post_exploreBait",e)?Dr:hasClass("feedAssistance_profilePhoto",e)?Nr:hasClass("feedAssistance_promoButton",e)?Hr:hasClass("feedAssistance_importContacts",e)?Vr:hasClass("feedAssistance_pushNotificationsSwitch",e)?Fr:Rr}function Fs(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ps[e].apply(ps,n)}function Us(e,t){var n,i=Us;Ys(e||scrollGetY(),t||getCh()),Os||Bs?(clearTimeout(i.timer),i.timer=setTimeout($s,150),Bs=!1):(Os=!0,tl(),n=ge("vk_head"),Ss=n&&n.offsetHeight,Cs=0)}function $s(){tl(),el(),Os=!1}function qs(){tl(),Cl(ws),cl(xs.concat(ml(ws))),kl(ws),xs=[],ws=[],il()}function Ws(){ws.forEach(function(e){e[Sr]=Date.now()}),ul(null),dl(null),el(),il(),nl()}function zs(){tl(),Cl(ws),xs=xs.concat(ml(ws)),kl(ws),ws=[],Bs=!0,el()}function Qs(){Rs(),Hs()}function Ys(e,t){var n=[];ys.forEach(function(i){bl(i)?n.push(i):!function(e,t,n){return!e[Sr]&&Js(e,cr,t,n)&&Zs(e,cr)}(i,e,t)?!function(e,t,n){return e[Sr]&&(!Js(e,ur,t,n)||!Zs(e,ur))}(i,e,t)?Ks(i)&&(Gs(i),FeedAssistanceStats.onViewedElement(i)):(i[wr]?delete i[wr]:(Gs(i),FeedAssistanceStats.onEndViewElement(i)),delete i[Sr]):(i[Sr]=Date.now(),ws.push(i),FeedAssistanceStats.onStartViewElement(i))}),n.forEach(function(e){yl(ys,e),FeedAssistanceStats.onStopTrackElement(e)})}function Gs(e){yl(ws,e),Sl(e),Xs(gl(e)),wl(e)}function Xs(e){e&&xs.push(e)}function Ks(e){return!!e[Sr]&&Math.min(_r,Date.now()-e[Sr])>function(e){var t=Vs(e);return _s[t]||dr}(e)}function Js(e,t,n,i){if(!e)return!1;e[Er]||(e[Er]=!0,e[Ir]=e.offsetHeight,e[xr]=n+e.getBoundingClientRect().top,e[Pr]=e[xr]+e[Ir]);var a=i-Ss-Cs,o=n+Ss,r=n+i-Cs,s=e[Ir],l=e[xr],c=e[Pr];return(c>o&&l<r?Math.min(r,c)-Math.max(o,l):0)>=Math.min(a*t,s*t)}function Zs(e,t){var n=e[Br];n&&!n[jr]&&~ys.indexOf(n)&&(n[jr]=!0,n[Mr]=n.clientWidth,n[Tr]=n.getBoundingClientRect().left+n.clientLeft),e[jr]||(e[jr]=!0,e[Mr]=e.offsetWidth);var i=n?n[Mr]||n.clientWidth:getCw(),a=n?n[Tr]||n.getBoundingClientRect().left+0:0,o=i+a,r=e[Mr],s=e.getBoundingClientRect().left,l=r+s,c=r*t,u=r*Math.max(0,1-t);return s+c>=a&&l-u<=o}function el(){Es=setTimeout(al,fr),js=setTimeout(ol,pr),Ts=setTimeout(rl,hr),Is=setTimeout(sl,mr)}function tl(){clearTimeout(Es),clearTimeout(js),clearTimeout(Ts),clearTimeout(Is)}function nl(){Ms=setInterval(ll,vr)}function il(){clearInterval(Ms)}function al(){xs.length&&ul(xs)}function ol(){cl(xs),xs=[],ul(null)}function rl(){ws.length&&(dl(ml(ws)),Ts=setTimeout(rl,Ar))}function sl(){clearTimeout(Ts),Cl(ws),cl(ml(ws)),kl(ws),ws.forEach(function(e){e[wr]=!0}),ws=[],dl(null)}function ll(){xs.length>=br&&ol()}function cl(e){if(e&&e.length){var t={act:bs};t=extend(t,function(e){var t={};return each(e,function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]}),t}(e)),ajax.post(gs,t)}}function ul(e){_l(vs,e)}function dl(e){_l(As,e)}function _l(e,t){var n=lsGet(e)||{};t?n[ks]=t:delete n[ks],lsSet(e,n)}function fl(){var e=fl,t=[],n=lsGet(vs)||{},i=lsGet(As)||{};return e.iterator||(e.iterator=function(e){return function(n){hl(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function pl(){var e=pl,t=lsGet(vs)||{},n=lsGet(As)||{};e.iterator||(e.iterator=function(e){return function(t){hl(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(vs,t),lsSet(As,n)}function hl(e){var t=Number(e);return t!==ks&&Date.now()-t>=gr}function ml(e){var t=[];return e.forEach(function(e){var n=gl(e);n&&t.push(n)}),t}function vl(e,t){return e+"_"+t}function Al(e,t){return(0,fs[vl(e[yr],t)])(e)}function gl(e){if(bl(e))return null;if(!Ks(e))return null;var t=function(e){return ds[e[yr]]}(e);return{type:t,data:Al(e,t)}}function bl(e){return e[Cr]||!document.body.contains(e)}function yl(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function wl(e){bl(e)||Ks(e)&&(e[Cr]=!0)}function kl(e){each(e,function(){wl(this)})}function Sl(e){e[Or]=Date.now()}function Cl(e){e.forEach(Sl)}function Ol(e){return(e=El(e))&&domData(e,"from-ref")||hs}function El(e){return hasClass(e,ms)||(e=domCA(e,"."+ms)),e}function jl(e){var t=(new Date).getTime();return e&&(e[Or]||e[Sr])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:Lr,BLOCK_TYPE_EXPLORE_BAIT:Dr,BLOCK_TYPE_PROFILE_PHOTO:Nr,BLOCK_TYPE_PROMO_BUTTON:Hr,BLOCK_TYPE_IMPORT_CONTACTS:Vr},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:Ur,EVENT_EXPLORE_BAIT_SUB:zr,EVENT_FEED_ASSISTANCE:$r,SUB_EVENT_EXPLORE_BAIT_VIEW:Qr,SUB_EVENT_EXPLORE_BAIT_LIKE:Yr,SUB_EVENT_EXPLORE_BAIT_COMMENT:Gr,SUB_EVENT_EXPLORE_BAIT_OPENED:Xr,SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:Kr,SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:Jr,SUB_EVENT_EXPLORE_BAIT_OPEN_USER:Zr,SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:es,SUB_EVENT_EXPLORE_BAIT_HIDE:ts,SUB_EVENT_EXPLORE_BAIT_REPORT:ns,SUB_EVENT_SEEN:is,SUB_EVENT_FILLED:as,EVENT_HIDE_BLOCK:qr,SUB_EVENT_ENABLE_PUSH:os,SUB_EVENT_DECLINE_PUSH:ss,EVENT_PROMO_BUTTON:Wr,EVENT_PROMO_BUTTON_SUB:cs,SUB_EVENT_PROMO_BUTTON_CLICK:us},addEvent(window,"blur",qs),addEvent(window,"focus",Ws),onDOMReady(function(){setTimeout(Ds,500)}),addEvent(window,"scroll",function(){Us(scrollGetY(),getCh())}),nav.onBeforeGo(function(){return zs()}),page.onChange(function(){return Qs()});n("yuVR");var Tl=56;function Il(e){return Object.keys(e).map(function(t){return t+":"+e[t]+";"}).join("")}function Ml(e){return e+"-"+Date.now()+"-"+Math.round(999999*Math.random())}var xl=[];function Pl(e){xl.push(e),Bl()}var Bl=debounce(function(){var e=xl.map(function(e){return $("#"+e)}).filter(function(e){return e}).map(function(e){var t=Math.round(e.getBoundingClientRect().left),n="skeleton-gradient-slide-"+t;return function(e,t){if(Rl[e])return;var n=function(e,t){return["@"+Ll()+"keyframes "+e+" {",t.map(function(e,n){return["\t"+n/(t.length-1)*100+"% {",Object.keys(e).map(function(t){return"\t\t"+t+": "+e[t]+";"}).join("\n"),"\t}"].join("\n")}).join("\n"),"}"].join("\n")}(e,t);Rl[e]=n,Dl.appendChild(document.createTextNode(n))}(n,[{"background-position-x":-600-t+"px"},{"background-position-x":window.innerWidth-t+"px"}]),{el:e,prop:n+" 1.2s infinite cubic-bezier(0.4, 0.0, 0.2, 1)"}});requestAnimationFrame(function(){e.forEach(function(e){var t=e.el,n=e.prop;t.style[Ll()+"animation"]=n}),xl=[]})},100);function Ll(){var e="";document&&(e=null!=(document.documentElement||document.createElement("div")).style.animation?"":"-webkit-");return e}var Rl={},Dl=document.createElement("style");function Nl(e){void 0===e&&(e={});var t=Ml("skeleton-circle"),n=Il({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=[r.default.class("SkeletonCircle",{header:e.header}),e.class].filter(function(e){return e}).join(" ");return Pl(t),{id:t,class:i,style:n,tag:"div"}}document.head.appendChild(Dl);function Hl(e){void 0===e&&(e={});var t=Ml("skeleton-line"),n=Il({})+(e.style||""),i=[r.default.class("SkeletonLine",{small:e.small,header:e.header}),e.class].filter(function(e){return e}).join(" ");return Pl(t),{id:t,class:i,style:n,tag:"div"}}function Vl(e){void 0===e&&(e={});var t=[r.default.class("SkeletonRow",{"justify-content":e.justify,"align-items":e.align}),e.class].filter(function(e){return e});return{inner:[e.inner],class:t.join(" "),tag:"div"}}function Fl(e){void 0===e&&(e={});var t=[r.default.class("SkeletonCol",{auto:e.auto,grow:e.grow,"flex-column":e.flexColumn}),e.class].filter(function(e){return e}).join(" ");return{inner:[e.inner],class:t,tag:"div"}}function Ul(e){void 0===e&&(e={});var t=[r.default.class("SkeletonOffset",{small:e.small}),e.class].filter(function(e){return e});return{inner:[e.inner],class:t.join(" "),tag:"div"}}function $l(e){void 0===e&&(e={});var t,n,a=Il({opacity:e.opacity});return{inner:[Vl({inner:[Fl({inner:[Nl({size:(t={s:32,modern:40,l:48},n=null,Object(i.getCw)()<=270&&null!=t.xs&&(n=t.xs),Object(i.getCw)()<=319&&null!=t.s&&(n=t.s),Object(i.getCw)()>=320&&null!=t.modern&&(n=t.modern),Object(i.getCw)()>=400&&null!=t.l&&(n=t.l),Object(i.getCw)()>=480&&null!=t.xl&&(n=t.xl),Object(i.getCw)()<=881&&null!=t.mobile&&(n=t.mobile),Object(i.getCw)()>=882&&null!=t.xxl&&(n=t.xxl),Object(i.getCw)()>=882&&null!=t.desktop&&(n=t.desktop),n),style:a})],auto:!0}),Fl({inner:[Vl({inner:[Fl({inner:[Hl({style:a})],grow:3}),Fl({grow:4})]}),Vl({inner:[Fl({inner:[Hl({small:!0,style:a})]}),Fl({grow:3})]})],flexColumn:!0})]}),Ul(),Vl({inner:[Fl({inner:[Hl({style:a})],grow:4}),Fl({inner:[Hl({style:a})],grow:3})]}),Ul(),Vl({inner:[Fl({inner:[Hl({style:a})],grow:4}),Fl({grow:1})]}),Ul(),Vl({inner:[Fl({inner:[Hl({style:a})],grow:4}),Fl({grow:3})]}),Ul(),Ul(),Vl({inner:[Fl({inner:[Nl({size:24,style:a})],auto:!0}),Ul(),Fl({inner:[Nl({size:24,style:a})],auto:!0}),Ul(),Fl({inner:[Nl({size:24,style:a})],auto:!0}),Fl({grow:1}),Fl({inner:[Nl({size:24,style:a})],auto:!0})]})],class:"SkeletonWallBlock Post__rowPadding",tag:"div"}}function ql(e){void 0===e&&(e={});var t=Ml("skeleton-search"),n=Il({})+(e.style||""),i=[r.default.class("SkeletonSearch",{small:e.small,header:e.header}),e.class].filter(function(e){return e}).join(" ");return Pl(t),{id:t,class:i,style:n,tag:"div"}}function Wl(e){return{inner:[Vl({inner:[Fl({inner:[Vl({inner:[Fl({inner:[ql({header:!0})]}),Ul({small:!0}),Fl({inner:[Nl({class:"SkeletonSearchHeader__icon",header:!0,size:28})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonSearchHeader",tag:"div"}}var zl=n("g3t9");function Ql(e){for(var t=Math.ceil((window.innerHeight-Tl)/210),n=[],i=0;i<t;i++)n.push($l());return{inner:[Wl(),Object(zl.Separator)(),n],class:"SkeletonRecommended Skeleton",tag:"div"}}function Yl(e){void 0===e&&(e={});var t=Il({opacity:e.opacity});return{inner:[Vl({inner:[Fl({inner:[Nl({size:50,style:t})],auto:!0}),Fl({inner:[Vl({inner:[Fl({inner:[Hl({style:t})],grow:3}),Fl({grow:4}),Fl({inner:[Hl({style:t})]})],justify:"center"}),Vl({inner:[Fl({inner:[Hl({style:t})]}),Fl({inner:[Hl({style:t})],grow:5}),Fl({grow:3,style:t})]})],flexColumn:!0})]})],class:"SkeletonChatBlock Post__rowPadding",tag:"div"}}function Gl(e){void 0===e&&(e={});var t={};e.hideIcon&&(t.visibility="hidden");var n=Il(t);return{inner:[Vl({inner:[Fl({inner:[Vl({inner:[Fl({inner:[Hl({header:!0})],grow:5}),Fl({grow:5}),Fl({inner:[Nl({class:"SkeletonHeader__icon",header:!0,size:28,style:n})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonHeader Post__rowPadding",tag:"div"}}function Xl(e){return{inner:[ql()],class:"SkeletonSearchBlock Post__rowPadding",tag:"div"}}function Kl(e){for(var t=Math.ceil((window.innerHeight-Tl)/70),n=[],i=0;i<t;i++)n.push(Yl());return{inner:[Gl(),Xl(),n],class:"SkeletonMessages Skeleton",tag:"div"}}function Jl(e){void 0===e&&(e={});var t=Il({opacity:e.opacity});return{inner:[Nl({class:"SkeletonStory__avatar",size:56,style:t}),Vl({inner:[Ul({small:!0}),Fl({inner:[Hl({small:!0,style:t})]}),Ul({small:!0})]})],class:"SkeletonStory",tag:"div"}}function Zl(e){void 0===e&&(e={});for(var t=Math.ceil(window.innerWidth/76),n=[],i=0;i<t;i++)n.push(Fl({inner:[Jl()],auto:!0}));return{inner:[Vl({inner:[n]})],class:"SkeletonStoriesBlock Post__rowPadding",tag:"div"}}function ec(e){return{inner:[Vl({inner:[Fl({inner:[Nl({size:40})],auto:!0}),Fl({inner:[ql()]})],justify:"center"})],class:"SkeletonNewPostBlock Post__rowPadding",tag:"div"}}function tc(e){for(var t=Math.ceil((window.innerHeight-Tl-180)/210),n=[],i=0;i<t;i++)n.push($l());return{inner:[Gl({hideIcon:!0}),ec(),Zl(),n],class:"SkeletonFeed Skeleton",tag:"div"}}function nc(e){void 0===e&&(e={});var t=Ml("skeleton-line"),n=Il({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=[r.default.class("SkeletonSquare",{}),e.class].filter(function(e){return e}).join(" ");return Pl(t),{id:t,class:i,style:n,tag:"div"}}function ic(e){return{inner:[Vl({inner:[Fl({inner:[Nl({size:48}),Nl({size:20,class:"SkeletonNotificationBlock__badge"})],auto:!0,class:"SkeletonNotificationBlock__avatar"}),Fl({inner:[Ul({small:!0}),Vl({inner:[Fl({inner:[Hl()]})]}),Vl({inner:[Fl({inner:[Hl()],grow:2}),Fl()]}),Vl({inner:[Fl({inner:[Hl({small:!0})]}),Fl({grow:5})]})],grow:6}),Fl(),Fl({inner:[nc({size:48})],auto:!0})],align:"flex-start"}),Ul(),Ul(),Vl({inner:[Fl({inner:[Nl({size:48})],auto:!0}),Fl({inner:[Ul({small:!0}),Vl({inner:[Fl({inner:[Hl()]})]}),Vl({inner:[Fl({inner:[Hl({small:!0})]}),Fl({grow:5})]}),Ul()],grow:4}),Fl({inner:[Ul()]})],align:"flex-start"})],class:"SkeletonNotificationBlock Post__rowPadding",tag:"div"}}function ac(e){for(var t=Math.ceil((window.innerHeight-Tl)/170),n=[],i=0;i<t;i++)n.push(ic());return{inner:[Gl({hideIcon:!0}),Object(zl.Separator)(),{inner:[Vl({inner:[Fl({inner:[Hl()],grow:3}),Fl({grow:2}),Fl({inner:[Hl()],grow:2})]})],class:"SkeletonNotifications__info Post__rowPadding",tag:"div"},n],class:"SkeletonNotifications Skeleton",tag:"div"}}var oc=function(){var e,t="_BottomMenu__icon_js",n="BottomMenu__icon_active",a="BottomMenu__counter",o="BottomMenu__updateButton",r="BottomMenu",s="vk_tabbar_hidden",l="data-tabbar",c="data-counter",u="feed",d="recommend",_="messages",f="notification",p="menu",h=Math.max(window.innerHeight,window.innerWidth),m=[u,d,_,f,p],v="",A={},g=((e={})[u]=0,e[d]=0,e[_]=0,e[f]=0,e[p]=0,e);function b(e){var t=geBySel1("["+l+'="'+e+'"]');return attr(t,"data-default")}function y(e){each(geBySel("["+l+"]"),function(n,i){var o=geByClass1(t,i),r=geByClass1(a,o),s=attr(i,c),u=attr(i,l);e({i:n,tabId:u,counter:s,$link:i,$icon:o,$counter:r})})}function w(){y(function(e){var t=e.$counter,n=e.$icon,i=(e.$link,e.tabId),o=g[i];if(o&&0!==o)if(t)val(t,o);else{var r=ce("div",{className:a,innerHTML:o});append(r,n)}else val(n,"")})}function k(e){setTimeout(function(){S()},0);var t=Wd.html({class:"pcont bl_cont",inner:{id:"al_loading",class:"BottomMenu__preloader"}});val(geByClass1("mcont",e),t)}function S(){var e=$("."+o);remove(e)}return{setCurrentId:function(e){v=e},setHistory:function(e){A=extend({},e)},setCounter:function(e,t){g[e]=t?parseInt(t,10):0,w()},getCurrentId:function(){return v},getDefaultURL:b,getTabCounter:function(e){return g[e]?g[e]:0},drawUI:function(){y(function(e){var t=e.$icon,i=e.$link,a=e.tabId,o=A[a];if(o){var r=o.filter(function(e){return!0===e.current})||[];r.length&&a!==_&&attr(i,"href",r[0].a);var s=attr(i,"href");a!==v||!r.length||r[0].a!==s&&r[0].d!==s||attr(i,"href",b(a))}toggleClass(n,t,a===v)}),w()},drawUICounters:w,drawLoader:k,drawSkeletonLoader:function(e,t){if(hasClass(document.querySelector(".vk"),"vk_flex_yes"))switch(setTimeout(function(){S()},0),t){case u:$(".mcont",e).innerHTML=Wd.html(tc());break;case _:$(".mcont",e).innerHTML=Wd.html(Kl());break;case f:$(".mcont",e).innerHTML=Wd.html(ac());break;case d:$(".mcont",e).innerHTML=Wd.html(Ql());break;case p:default:k(e)}else k(e)},showUpdateButton:function(e){var t=window.lang,n=Wd.html({class:o,inner:{class:"BottomMenu__updateButton_container",inner:{class:"BottomMenu__updateButton_wrap",onclick:["nav.updateCurrentPage"],inner:[{class:"BottomMenu__updateButton_icon",inner:{class:"Icon Icon_whiteArrowTop"}},{class:"BottomMenu__updateButton_text",inner:t.mobile_menu_refresh_button}]}}}),i=hasClass("vk_custom_scroll",geByTag1("body")),a=e.$(i?".basis":".upanel");a.$("."+o)||a.insertBefore(ceFromString(n),a.firstChild)},removeUpdateButton:S,onFocusIn:function(e){var t=geBySel1("."+r),n=e&&e.target;if(n&&t&&browser.android){var i=!1;"textarea"===n.tagName.toLowerCase()&&(i=!0),"input"!==n.tagName.toLowerCase()||["checkbox","radio"].includes(n.type)||(i=!0),"select"===n.tagName.toLowerCase()&&(i=!0),i&&t.classList.add(s)}},onFocusOut:function(){var e=geBySel1("."+r);e&&e.classList.remove(s)},onResize:function(){var e=window.bodyNode;$(".Skeleton")&&($(".mcont").innerHTML='<div class="pcont bl_cont"><div id="al_loading"></div></div>',Object(i.alLoadingFix)()),e&&e.classList.contains("vk_tabbar_bottom")&&0===Math.abs(window.orientation)&&h-180>window.innerHeight?e.classList.add(s):e&&e.classList.remove(s)},setDefaultCounters:function(){y(function(e){var t=e.tabId,n=e.counter;g[t]=n?parseInt(n,10):0}),w()},TAB_ID_FEED:u,TAB_ID_RECOMMEND:d,TAB_ID_MESSAGES:_,TAB_ID_NOTIFICATION:f,TAB_ID_MENU:p,TAB_IDS:m}}();window.Tabbar=oc;var rc=oc;page.onRestore(oc.drawUI),page.onChange(oc.drawUI),onDOMReady(function(){var e;oc.setDefaultCounters(),addEvent(window,"resize",function(){oc.onResize(),clearTimeout(e),e=setTimeout(function(){oc.onResize()},300)})}),page.onChange(dc),photoview.onHide(dc),photoview.onShow(_c);var sc,lc="#fff",cc="#000",uc=Object(g.$)('meta[name="theme-color"]');function dc(){fc(lc)}function _c(){fc(cc)}function fc(e){sc||(sc=Object(g.$)("#theme_color_shim")),uc&&uc.setAttribute("content",e),sc&&(sc.style.backgroundColor=e)}n("U34x");var pc,hc,mc,vc,Ac,gc="groupCover-vk_animationYes",bc="groupCover-vk_animationStep",yc=[".basis__header_unauthorized"],wc=function(){return{vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),headerFirstIcon:geByClass1("GroupCoverIcons__icon--back_outline_28",geByClass1("basis__header")),headerSecondIcon:geByClass1("GroupCoverIcons__icon--back_outline_white_28",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}},kc=!1;function Sc(){kc||(pc=wc()).cover&&(kc=!0,addClass(pc.vk,gc),hc=!_.default.chrome||Number(_.default.version.split(".")[0])>50,mc="fixed"===getStyle(pc.header,"position"),vc=getH(pc.header),Ac=getH(pc.cover),onBodyScroll(Oc),onBodyResize(Ec),Oc(),window.cur.destroy=window.cur.destroy.filter(function(e){return e!==Cc}),window.cur.destroy.push(Cc))}function Cc(){(!0||menu.opened())&&(removeClass(pc.vk,bc),removeClass(pc.vk,gc)),onBodyScroll("__clear",Oc),onBodyResize("__clear",Ec),kc=!1}function Oc(){var e=scrollTop();if(mc)if(e<0)setStyle(pc.header,"top",-e),Tc(),setStyle(pc.coverDimmer,"opacity",0),setStyle(pc.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(Ac-vc)),i=t&&t.classList.contains("vk_tabbar_top")&&!pc.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle(pc.header,"top",i),setStyle(pc.headerTitle,"display","block"),setStyle(pc.headerFirstIcon,"display","block"),setStyle(pc.headerSecondIcon,"display","block"),n<=.9?(Tc(),hc&&setStyle(pc.coverImage,"top",.5*e),setStyle(pc.coverDimmer,"opacity",n/.9),setStyle(pc.headerTitle,"opacity",0),setStyle(pc.headerFirstIcon,"opacity",0),setStyle(pc.headerSecondIcon,"opacity",1)):(setStyle(pc.headerTitle,"opacity",1),setStyle(pc.headerFirstIcon,"opacity",1),setStyle(pc.headerSecondIcon,"opacity",0),jc())}else Math.min(1,e/Ac)<1?(Tc(),setStyle(pc.coverDimmer,"opacity",0),hc&&setStyle(pc.coverImage,"top",.5*e),setStyle(pc.headerTitle,"display","none"),setStyle(pc.headerFirstIcon,"display","none"),setStyle(pc.headerSecondIcon,"display","block")):jc()}function Ec(){Cc(),Sc()}function jc(){yc.map(function(e){return $(e)}).some(function(e){return e})||removeClass(pc.vk,bc)}function Tc(){yc.map(function(e){return $(e)}).some(function(e){return e})||addClass(pc.vk,bc)}onDOMReady(function(){(_.default.chrome||_.default.safari&&_.default.ios>=9)&&(Sc(),page.onChange(Sc),zlayer.onClose(function(){setTimeout(Sc,0)}))});n("l51W"),n("BLcx"),n("nXjO");var Ic,Mc,xc="tabs_block",Pc="mhb_back",Bc="TopMenu_open",Lc="TopMenu__switcher_on",Rc=function(){return geByClass1(xc)},Dc=function(){return geByClass1(Pc)},Nc=function(){return geByClass1("TopMenu__switcher")},Hc=function(){return geByClass1("tab_item_top")},Vc=!0,Fc=0;function Uc(){Mc&&Mc(),Ic&&Ic()}function $c(e){stopEvent(e),preventEvent(e),Fc=300,Vc&&(toggleClass(Lc,Nc()),"touchstart"===e.type&&setTimeout(function(){nav.go(Hc(),null)},130))}function qc(e){gpeByClass(xc,e.target)||gpeByClass(Pc,e.target)||(stopEvent(e),preventEvent(e),removeClass(Bc,Rc()),Wc(),Uc())}function Wc(){Uc(),removeEvent(window,"touchstart mousedown",qc)}window.TopMenu={onHeaderClick:function(e){if(!Vc)return;var t=Rc();stopEvent(e),preventEvent(e);var n=Dc();if(hasClass(Bc,t))removeClass(Bc,t),Uc();else{var i=Hc();addClass(Bc,t),geByClass1("_hfixed")&&setStyle(t,"max-height",window.innerHeight-70),append(t,n),addEvent(window,"touchstart mousedown",qc),addEvent(i,"touchstart mousedown",$c),addEvent(i,"click",function(e){stopEvent(e),preventEvent(e)}),Mc=Object(a.expandPopup)(n),(Ic=Object(a.setMenuNavigation)(t))&&(Ic.exitIntent=function(){removeClass(Bc,t),Uc()}),cur.destroy.push(Wc),cur.destroy.push(function(){return removeEvent(i,"touchstart mousedown",$c)})}}},nav.onBeforeGo(function(){Vc=!1,setTimeout(function(){Fc=0,Vc=!0,Uc()},Fc)});var zc=function(){var e,t,n,i="ai_menu_opened",o=!1;function r(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function s(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function l(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))r(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),s(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function c(e){e&&"A"===e.target.tagName&&requestAnimationFrame(function(){l()})}function u(u){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(u),addClass(i,e),append(t,document.body),(n=Object(a.setFocusTrap)(t))&&(n.exitIntent=function(){d()}),o=d,tooltip.addHandler(o),tooltip.show(e,t),addEvent(window,"resize",l),addEvent(t,"click",c);var _=geByClass1("i_pointer",e),f=r(_);f.isOverflowYContainer&&addEvent(f.cursor,"scroll",l);var p=s(_);p.isOverflowXContainer&&addEvent(p.cursor,"scroll",l),l()}function d(){removeClass(i,e),append(t,e),tooltip.removeHandler(o),tooltip.hide(),n&&(n(),n=null),removeEvent(window,"resize",l),removeEvent(t,"click",l);var a=geByClass1("i_pointer",e),c=r(a);c.isOverflowYContainer&&removeEvent(c.cursor,"scroll",l);var u=s(a);u.isOverflowXContainer&&removeEvent(u.cursor,"scroll",l)}return{closeMenu:d,toggleMenu:function(t,n){cancelEvent(t),hasClass(i,e)?d():u(n)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout(function(){removeClass("unhover",n)},100)})}}(),l()}}}();window.ActionMenu=zc;n("zHNa"),n("zouF");function Qc(e,t,n){return{class:["Popup__button",r.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}page.onChange(function(){$$(".AlertBox").forEach(function(e){return Fe.default.close(e)})}),window.AlertBox=function(e,t,n,a){void 0===a&&(a={});var o=Object(i.ceFromString)(l.default.html(Object(Fe.default)({id:a.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[Qc(getLang("mobile_close"),"secondary",n||"Popup.close(this)")]}]})));domInsert(document.body,o),Fe.default.open(o,!0)};var Yc=function(){var e={UP:38,DOWN:40,RETURN:13,ESC:27},t="MentionContainer_opened",n="Mention_inited",i="Mention_noScroll",a="MentionItem_active",o={},r={},l=!1;function c(){o={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},r={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}c();var u=!0;function d(){u=!1}function _(){var e=val(o.input),t=Math.max(e.lastIndexOf("@"),e.lastIndexOf("*")),n=!1;if(t>-1){var i=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),a=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),a.appendChild(i.cloneContents()),val(a).replace(/\n$/,"").length}return 0}(o.input),a=e.substr(0,i);t=Math.max(a.lastIndexOf("@"),a.lastIndexOf("*"));var s=a.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);s&&"."!==s[2].substr(-1)&&(n=s[2])}!1===n&&delete o.ignoredTerm,void 0!==o.ignoredTerm&&n==o.ignoredTerm&&(n=!1),o.curValue=e,o.curTerm=n,o.curPos=t,r.text=n,!1===o.curTerm?h():(w(!1,o.curTerm),p(),function(){var e=ge("mhead").offsetHeight,t=r.container.getBoundingClientRect(),n=o.input.offsetHeight,i=parseInt(getStyle(r.scroll,"maxHeight"),10),a=!1;a=hasClass("Mention_openToBottom",r.container)?t.top-n-i<e:t.bottom-i<e,getXY(o.input)[1]>=e+i&&(a=!1),toggleClass("Mention_openToBottom",r.container,a),toggleClass("Mention_openToBottom",r.opts.appendTo,a)}())}function f(e){o.input=e}function p(){j(),document.addEventListener("click",m,!0),addClass(t,r.opts.appendTo),show(r.container),function(){if(!l){var e=browser.ipad?"touchend":"click";l=!0,addEvent(window,e,h),addEvent(window,"touchmove",d),nav.onBeforeGo(h)}}()}function h(e){!browser.ipad||u?e&&e.target&&gpeByClass(n,e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass(t,r.opts.appendTo)&&(removeClass(t,r.opts.appendTo),hide(r.container),function(){if(l){var e=browser.ipad?"touchend":"click";removeEvent(window,e,h),removeEvent(window,"touchmove",d),nav.onBeforeGo.off(h),l=!1}}()):u=!0}function m(e){var t=e.target;t&&!gpeByClass(n,t)&&(e.preventDefault(),e.stopImmediatePropagation(),h()),document.removeEventListener("click",m,!0)}function v(e){void 0===e&&(e={}),r.opts=extend(r.opts,e),A(),w(!0)}function A(){var e,t,n=r.opts.defaultItems,i=r.opts.items,a=[];for(e=0,t=n.length;e<t;++e)a.push(e);for(r.cache[""]=a,e=0,t=i.length;e<t;++e)g(e,i[e])}function g(e,t){var n,i,a,o="",s=r.opts.searchKeys,l={};for(n=0,a=s.length;n<a;++n)o+=" "+(t[s[n]]||"").replace(r.opts.delimeter," ").replace(/<[^>]*>/g,"");for(o+=(parseLat(o)||"")+(parseCyr(o)||""),o=trim(o.toLowerCase()).split(/\s+/),n=0;n<o.length;n++)for(i=1;i<=r.opts.wholeIndex;i++){var c=o[n].substr(0,i);l[c]||(r.index[c]||(r.index[c]=[]),r.index[c].push(e),l[c]=1)}}function b(){var e=trim(r.text);e&&ajax.post(r.opts.url,extend({str:e,mobile:1},r.opts.params||{}),{onDone:function(t){r.cache[e]=y(e).concat(t),k(r.cache[e],!0)}})}function y(e){if(!(e=trim(e.toLowerCase().replace(r.opts.delimeter," "))))return r.cache[""];var t=r.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return r.index[e]||[];var n,i,a=0,o="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var s=e[n].substr(0,t),l=r.index[s];if((!o||!l||l.length<a)&&(a=l?l.length:0,o=s),!a)return[]}var c=[],u=r.opts.searchKeys,d=u.length,_=e.length;for(n=0,i=r.index[o].length;n<i;++n){for(var f=r.index[o][n],p=r.opts.items[f],h=!1,m="",v=0;v<d;++v)m+=" "+(p[u[v]]||"").replace(r.opts.delimeter," ").replace(/<[^>]*>/g,"");m=(m+=(parseLat(m)||"")+(parseCyr(m)||"")).toLowerCase();for(var A=0;A<_;++A)if(-1===m.indexOf(" "+e[A])){h=!0;break}h||c.push(f)}return c}function w(e,t){if(r.cache[""])if(t=void 0!==t?t:trim(r.text),r.lastQ!==t||e){r.lastQ=t,clearTimeout(r.requestTimer);var n=r.cache[t];n?k(n,!0):(k(n=y(t),!r.opts.url),r.opts.url&&(r.requestTimer=setTimeout(b,r.opts.requestWait)))}else p()}function k(e,t){var n=[];r.shown=[];for(var a=e.slice(0,r.opts.maxItems),o=0,s=a.length;o<s;++o){var l=a[o];isArray(l)||(l=r.opts.items[l]),r.shown[l[0]]||(r.shown[l[0]]=l,n.push(S(l)))}r.container&&r.opts.appendTo.contains(r.container)||(r.container=ce("div"),addClass("Mention",r.container),r.scroll=ce("div"),addClass("ScrollView Mention__scroll",r.scroll),Object(ue.setScrollView)(r.scroll,{topBanner:!1}),r.opts.appendTo.appendChild(r.container),r.container.appendChild(r.scroll),addEvent(r.scroll,"touchmove",function(e){hasClass(i,r.scroll)&&preventEvent(e)})),toggleClass("Mention_empty",r.container,!n.length),val(r.scroll,n.join("")),r.scroll.scrollTop=0,O(),setTimeout(function(){toggleClass(i,r.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(r.scroll.scrollHeight>r.scroll.offsetHeight)return!0;return!1}())},0)}function S(e){var t=e[0],n=e[1],i=e[2];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                <img src="'+e[3]+'" class="MentionItem__img"/>\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function C(){var e=geByClass1(a,r.container),t=e.offsetTop;r.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(r.scroll,"paddingTop"),10)}function O(e){void 0===e&&(e=null);var t=geByClass("MentionItem",r.container);if(t.length){var n=t.find(function(e){return hasClass(a,e)});e?(removeClass(a,n),addClass(a,e)):n||addClass(a,t[0])}}function E(e,t){setTimeout(function(){f(t),_()},0)}var j=Object(s.default)();return{onKeyUp:function(t,n){t.keyCode!==e.UP&&t.keyCode!==e.DOWN&&(w(!0),f(n),_())},onKeyDown:function(n,i){var o;hasClass(t,r.opts.appendTo)&&(n.keyCode===e.UP?(!function(){var e=geByClass1(a,r.container);if(e){var t=domPS(e);t&&(O(t),C())}else O(),C()}(),n.preventDefault()):n.keyCode===e.DOWN?(!function(){var e=geByClass1(a,r.container);if(e){var t=domNS(e);t&&(O(t),C())}else O(),C()}(),n.preventDefault()):n.keyCode===e.RETURN?(o=geByClass1(a,r.container))&&(o.click(),1)&&n.preventDefault():n.keyCode===e.ESC&&(h(),n.preventDefault()))},onFocus:E,onClick:E,onSelect:function(e){var t=r.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=o.curValue.substr(0,o.curPos),a=o.curValue.substr(o.curPos),s=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);r.opts.preferDomain&&e[9]&&(s=!0);s||(t=replaceEntities(e[8]||e[1]));var l=new RegExp("^(@|\\*)"+escapeRE(o.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");a=a.replace(l,function(e,i,a){var o=i+n+" ";return s||(o+="("+t.replace(/[\(\)\]\[]/g,"")+") "),o}),s||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(a=" "+a);h(),val(o.input,i+a),elfocus(o.input),r.opts.afterInsert&&r.opts.afterInsert(o.input)}(t),h()},onItemHover:function(e){O(e)},onOpen:j,init:function(e){void 0===e&&(e={}),c(),r.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",r.opts.appendTo),r.scroll&&removeClass(i,r.scroll),A()},update:v,addItems:function(e){e=r.opts.defaultItems.concat(e);var t={};e.filter(function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)}),v({defaultItems:e,items:e})}}}();window.Mention=Yc;n("OGWK"),n("ciqL");var Gc={cachedProgress:{}},Xc={init:function(e,t){return void 0===e&&(e=Object(i.srand)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,Gc.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);Gc.cachedProgress[e]=t;var o=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",o)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}},Kc=(n("tqja"),n("aiw/")),Jc=function(){function e(){window.isCustomScroll&&(document.body.classList.contains("vk__page_mail")||ue.restoreDocumentScroll())}return{init:function(){if(window.isCustomScroll&&!document.body.classList.contains("vk__page_mail")){var t=ge("mcont");t&&t.classList.contains("ScrollView")?ue.init():e(),Kc.onClose()}},restore:e}}();onDOMReady(function(){Jc.init(),page.onChange(function(){Jc.init()})}),window.ContentScrollView=Jc;var Zc,eu,tu,nu,iu,au,ou,ru=".basis__header",su="basis__header_noshadow",lu="basis__header_noshadowAnim",cu="basis__header_noTransition",uu="basis__header_hidden",du="BottomMenu__updateButton_offset",_u="basis__header_nohide",fu=5,pu=20,hu=200,mu=!1,vu=Object(i.scrollTop)(),Au=56,gu=!1,bu=!1,yu=[];function wu(e){void 0===e&&(e=Ou());var t=document.body;t&&"fixed"===Object(i.getStyle)(t,"position")||e.classList.remove(uu)}function ku(){var e=Object(i.scrollTop)();if(Zc){Cu(Zc,e);var t,n=Object(i.ge)("mcont");if(n){var a=$(".BottomMenu__updateButton"),o=Math.max(n.scrollHeight,parseInt(Object(i.getStyle)(n,"height"),10));if(bu&&e)return;if(Math.abs(vu-e)<=Au)return;Zc.classList.contains(_u)||(e>vu+pu&&e>Au?(void 0===(t=Zc)&&(t=Ou()),t.classList.add(uu),a&&a.classList.add(du),bu=!0,setTimeout(function(){bu=!1},hu)):e+window.innerHeight<o&&(wu(Zc),a&&a.classList.remove(du)))}var r=document.body;r&&"fixed"!==Object(i.getStyle)(r,"position")&&(vu=e)}}function Su(){if(mu&&(clearInterval(iu),Object(i.onBodyScroll)("__clear",eu),removeEvent(window,"touchend",tu),yu.forEach(function(e){removeEvent(e,"blur",tu)}),mu=!1),!mu){Zc=Ou(),Au=parseInt(Object(i.getStyle)(Zc,"height"),10),vu=Object(i.scrollTop)();var e=$(".BottomMenu__updateButton");Zc&&(Zc.classList.add(cu),wu(Zc),e&&e.classList.remove(du)),Cu(Zc,Object(i.scrollTop)()),eu=function(){gu=!0},tu=function(){clearInterval(nu),nu=setTimeout(function(){var t=Object(i.ge)("mcont");if(t){var n=Math.max(t.scrollHeight,parseInt(Object(i.getStyle)(t,"height"),10));window.innerHeight>n&&n&&(wu(Zc),e&&e.classList.remove(du))}},100)},setTimeout(function(){gu=!1},0),setTimeout(function(){Zc&&Zc.classList.remove(cu)},200),mu||(iu=setInterval(function(){gu&&(ku(),gu=!1)},250),Object(i.onBodyScroll)(eu),addEvent(window,"touchend",tu),(yu=Array.from($$("input, textarea")||[])).forEach(function(e){addEvent(e,"blur",tu)}),mu=!0)}}function Cu(e,t){e.classList.contains(_u)||(t<=fu&&e&&e.classList.contains(su)?e.classList.add(lu):e&&e.classList.remove(lu))}function Ou(){return $(ru)}function Eu(){(Zc=Ou())&&(wu(Zc),Cu(Zc,Object(i.scrollTop)()))}onDOMReady(function(){Su(),window.page.onChange(Su),onBodyResize(Eu),addEvent(window,"orientationchange",Eu),addEvent(window,"blur",Eu)}),au="",ou=function(){au=nav.cur,function(){if(Object(v.partConfigEnabled)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],a="http"+("https:"==location.protocol?"s":""),o="vkgalv";if(window.vk&&window.vk.countryISO)switch(window.vk.countryISO){case"BY":o="vkgaby";break;case"MD":o="vkgamd";break;case"EE":o="vkgaee"}n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=a+"://"+o+".hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}()},onDOMReady(function(){ou(),window.page.onChange(function(){au!==nav.cur&&ou()})});var ju={URL:"special-event",ACT:"getPopup",start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(Object(kt.statlogsValueEvent)("special_event","click",this.platform,this.id),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.duration&&(this.hasPopup=Boolean(window.domData(e,"popup")),!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then(function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()})):this._play())}},_getAnimation:function(){var e=this;return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET","/images/stickers/special/"+e.id+"/animation.json?v="+e.v,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}})},_showPopup:function(){},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!1,autoplay:!0,animationData:this.animationData});0,this.timeoutHandle=setTimeout(function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,Object(kt.statlogsValueEvent)("special_event","showed",e.platform,e.id),e._showPopup()},this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n}};ju.init({platform:"mvk",animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then(function(e){return e.default})}}),window.SpecialEvent=ju;var Tu={onIframeReady:Object(s.default)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:Object(s.default)(),onAcceptCookieClick:Object(s.default)()};function Iu(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&Tu.onPostMessage(t.action,t.action_params)}}Tu.onIframeReady(function(){addEvent(window,"message",Iu),window.cur.destroy.push(function(){removeEvent(window,"message",Iu)})}),window.BasisMoneyTransfer=Tu;var Mu=Tu;Mu.onPostMessage(function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()});Mu.onPostMessage(function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)});var xu=["touchstart","touchend","touchmove","touchcancel"];Mu.onIframeReady(function(e){e.is_api&&registeredEvents.forEach(function(e){var t=e[0],n=e[1],i=e[2];xu.indexOf(n)>=0&&removeEvent(t,n,i)})}),Mu.onPostMessage(function(e){"putPixel"!==e&&"addCard"!==e&&window.scrollTop(0)});var Pu,Bu,Lu,Ru="pageMoneyTransfer",Du="pageMoneyTransfer_error",Nu="pageMoneyTransfer__errorText",Hu="pageMoneyTransfer__iframe",Vu=2e3;Mu.onIframeReady(function(e){Uu(),Bu={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},qu(),window.cur.destroy.push(Wu)}),Mu.onPostMessage(function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1(Ru));else if("payError"===e)Wu(),addClass(Du,geByClass1(Ru)),val(geByClass1(Nu),t.descr);else if("session_fail"===e){if(Fu)return void $u();Wu(),addClass(Du,geByClass1(Ru)),addClass("pageMoneyTransfer_errorCookie",geByClass1(Ru))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;Object(i.isVkWebView)()&&(Object(i.isIosWebView)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),Object(i.statlogsValueEvent)("money_transfers",0,"iframe_loaded",n)}});var Fu=0;function Uu(){var e=geByClass1(Hu);if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(Uu,2e3)}function $u(){var e=geByClass1(Hu);if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1(Ru).appendChild(t),ge("payment_form").submit()}else setTimeout($u,2e3)}function qu(){var e=Bu,t=e.checkUrl,n=e.onSuccessUrl;Pu=setInterval(function(){Lu=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(Wu(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(Wu(),addClass(Du,geByClass1(Ru)),val(geByClass1(Nu),t))}})},Vu)}function Wu(){Pu&&(clearInterval(Pu),Pu=null),Lu&&(Lu.abort(),Lu=null)}Mu.onAcceptCookieClick(function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout(function(){e.close();var t=geByClass1(Hu),n=clone(t);removeClass(Du,geByClass1(Ru)),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),qu()},500),Fu++});var zu={_onMouseDown:Object(s.default)(),_onCancelClick:Object(s.default)()};window.MoneyTransferButton=zu;var Qu=zu,Yu="-webkit-tap-highlight-color";Qu._onMouseDown(function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,Yu,"transparent"),setTimeout(function(){return function(e){setStyle(e,Yu,"initial")}(t)},400))});var Gu,Xu,Ku=1500,Ju=!1,Zu=null;function ed(){Zu&&Btn.setLoading(Zu,!1),Gu&&(clearInterval(Gu),Gu=null),Xu&&(Xu.abort(),Xu=null)}Qu._onCancelClick(function(e,t){var n,i;t?(Ju=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(Ju=!0,t=e.$btn,e=null,Zu=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},i=n.cancelUrl,Gu=setInterval(function(){Xu=ajax.post(i,{_ajax:1},{onDone:function(e){if(1===e){if(Ju){var t=arguments[1];return Zu.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void ed()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push(function(){window.scrollTop(n)}),ed()}}})},Ku),window.cur.destroy.push(ed)});need("attr"),need("geByClass1");var td=need("preventEvent"),nd=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=cd,SendMoneyForm._onSubmit=pd,SendMoneyForm._onRecommAmountChange=ud,SendMoneyForm._onAutoAcceptToggle=hd,SendMoneyForm._onNoAmountToggle=md,SendMoneyForm._onChooseCardClick=ld,SendMoneyForm._onChooseCardCancelClick=sd,SendMoneyForm._onChooseCardContinueClick=od,SendMoneyForm._onCardSelect=rd;var id={form:"sendMoneyForm",errorMin:"sendMoneyForm_error_min",errorMax:"sendMoneyForm_error_max",addCardVisible:"sendMoneyForm_addCardVisible",requestedVisible:"sendMoneyForm_requestedVisible",recommErrorMin:"sendMoneyForm_recommErrorMin",recommErrorMax:"sendMoneyForm_recommErrorMax",noAmount:"sendMoneyForm_noAmount",autoAccept:"sendMoneyForm_autoAccept"},ad={form:".sendMoneyForm",cardsPopup:".sendMoneyForm__cardsPopup",amountInput:".sendMoneyForm__input_amount",recommInput:".sendMoneyForm__recommAmountInput input",requestAmount:".sendMoneyForm__amountNote_requestAmount"};function od(){var e=Object(g.$)('.Control__native[name="card"]:checked').value,t=Object(g.$)('.Control__native[name="card"]:checked ~ .Control__label').innerText;Object(g.$)('input[name="accept_card"]').value=e,Object(g.$)('input[name="accept_card"]').setAttribute("data-value",e),Object(g.$)(".sendMoneyForm__chooseCard").innerText=t,nd.close()}function rd(e){var t="-1"===e.value;Object(g.$)(ad.form).classList.toggle(id.addCardVisible,t)}function sd(){nd.close()}function ld(){var e=Object(g.$)(ad.cardsPopup);nd.open(e)}function cd(e){e||(e=Object(g.$)('input[name="amount"]')),_d(e),fd(e,6);var t=e.closest(ad.form),n="1"===t.getAttribute("data-is-chat-request"),i=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(id.errorMin),t.classList.remove(id.errorMax),n||i>a&&t.classList.add(id.errorMax),n){var o=dd(),r=Number(t.getAttribute("data-min-amount"))*(o?2:1),s=function(e,t){var n=Object(g.$)('input[name="amount"]').closest(ad.form),i=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),o=Number(n.getAttribute("data-chat-members-count")),r=Math.ceil(e/(o-(t?0:1)));return Math.min(a,Math.max(i,r))}(i,o);if(Object(g.$)(ad.recommInput).value=s,t.classList.remove(id.recommErrorMax),t.classList.remove(id.recommErrorMin),!r||i>=r){var l=o?i-s:i;Object(g.$)(ad.requestAmount).innerText=l,t.classList.add(id.requestedVisible)}else t.classList.remove(id.requestedVisible)}}function ud(e){_d(e),fd(e,6);var t=e.closest(ad.form),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(id.recommErrorMax),t.classList.remove(id.recommErrorMin),n>i&&t.classList.add(id.recommErrorMax)}function dd(){var e=Object(g.$)('input[name="participiate"]');return e&&e.checked}function _d(e){e.value=parseInt(e.value,10)||""}function fd(e,t){e.value=e.value.slice(0,t)}function pd(e,t){var n=t.$(ad.amountInput).value,i=Number(n),a=Number(t.getAttribute("data-min-amount")),o=Number(t.getAttribute("data-max-amount")),r="1"===t.getAttribute("data-is-chat-request"),s=!1;(t.classList.remove(id.errorMin),t.classList.remove(id.errorMax),r&&(t.classList.remove(id.recommErrorMax),t.classList.remove(id.recommErrorMin)),Object(g.$)(ad.form).classList.contains(id.noAmount))||(i<a*(!!r&&dd()?2:1)||!n||n!==i.toString()?(t.classList.add(id.errorMin),s=!0):i>o&&!r&&(t.classList.add(id.errorMax),s=!0));if(r){var l=t.$(ad.recommInput).value,c=Number(l);c<a||!l||l!==c.toString()?(t.classList.add(id.recommErrorMin),s=!0):c>o&&(t.classList.add(id.recommErrorMax),s=!0)}if(s)td(e),stopEvent(e);else{td(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var u=Object(g.$)("#submit");ajax.click(u)}}function hd(e){Object(g.$)(ad.form).classList.toggle(id.autoAccept,e.checked),e.checked?Object(g.$)('input[name="accept_card"]').value=Object(g.$)('input[name="accept_card"]').getAttribute("data-value"):Object(g.$)('input[name="accept_card"]').value=""}function md(e){Object(g.$)(ad.form).classList.toggle(id.noAmount,e.checked)}window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){if(!MoneyLink.qrcode){var n,i;t?(n=geByClass1("snippet__icon",geByClass1(t)),i=80):(n=ge("money_link_qr"),i=200);val(n,Zt.a.createQR(e,i,"qr-code",{isShowLogo:!0,isShowBackground:!1}))}}};var vd=n("qHA9"),Ad=need("Voting"),gd=function(){var e,t,n=[],i=!1,a=!1,o={};function r(e){return function(){if(!i)return e.apply(this,arguments)}}function s(e){return"A"===e.tagName}function l(){a=n.length>0,toggleClass("vk_messages_actions_visible",document.body,a)}function c(){a&&(o={},each(n,function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))}),i=!1,n=[],l())}function u(){return!!window.getSelection&&window.getSelection().toString().length>0}function d(e,t,a,o){void 0===o&&(o=!1),i=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:o?"spam":"delete",peer:t,hash:a,ids:n.join(","),community:bd()}})}function _(){return Boolean(e)}function f(){ge("dialogs")&&_()?addClass("vk_dialogs_forwarding",document.body):e="",c()}return page.onChange(f),mail.onShowDialogsPageFromCache(f),mail.onShowDialogFromCache(f),mail.onShowDialogsPageFromCache(wu),mail.onShowDialogFromCache(wu),mail.onMessagesRepainted(function(){each(n,function(e,t){addClass("mi_selected",geByClass1("_msg"+t))})}),{onMessageClick:r(function(e){var t=e.target,i=e.currentTarget,a=s(t)||s(t.parentNode);t.closest("."+Ad.cls)?e.stopPropagation():(a&&c(),browser.uc_mini||u()||a||setTimeout(function(){var e,t,a;u()||(e=i,t=attr(e,"data-id"),(a=n.indexOf(t))>=0?(n.splice(a,1),removeClass("mi_selected",e),delete o[t]):(n.push(t),addClass("mi_selected",e),o[t]=hasClass("msg_item_important",e)),l(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())},40))}),remove:r(d),reply:r(function(e,t,a){i=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:a,object:"mail"+n.join(";"),community:bd()}})}),forward:r(function(a,o){i=!0,lockButton(a),e="mail"+n.join(";"),t=o;var r=bd(),s=r?"?community="+r:"";nav.go(location.pathname+s,null,{ignore_cur_process:!0})}),spam:r(function(e,t,n){d(e,t,n,!0)}),close:r(c),toggleImportant:r(function(e){var t,i=n.length,a=0;for(t=0;t<i;t++)if(!o[n[t]]){a=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===a);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:a,hash:e}),c()}),hasFwdMessages:_,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:bd()}}),e=""}}}();function bd(){return nav.getQuery("community")}window.MessagesActions=gd;var yd=n("TxR4"),wd=n("S6+Z"),kd=Object.entries(wd.EMOJI_HINTS).map(function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+Object(It.escapeRE)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]}),Sd={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?Sd["\\"]="ё":Sd["`"]="ё";var Cd=new RegExp("["+Object(It.escapeRE)(Object.keys(Sd).join(""))+"]","gi"),Od=function(e){return e.replace(Cd,function(e){return Sd[e]})},Ed=Object.entries(Sd).reduce(function(e,t){var n=t[0];return e[t[1]]=n,e}),jd=new RegExp("["+Object(It.escapeRE)(Object.keys(Ed).join(""))+"]","gi"),Td=function(e){return e.replace(jd,function(e){return Ed[e]})},Id=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=kd.reduce(function(e,t){var n=t[0],i=t[1];return e.replace(n,function(e,t,n,a){return(t||"")+Object(yd.emojiByteHexToSymbol)(i)+(a||"")})},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(yd.emojiRemoveSkinToneModifiers)(e)],a=0,o=[].concat(i);a<o.length;a++){var r=o[a];i.push(Od(r)),i.push(Td(r))}for(var s=0,l=[].concat(i);s<l.length;s++){var c=l[s];i.push(c.replace(/ё/g,"е")),i.push(c.replace(/е/g,"ё"))}for(var u=0,d=[].concat(i);u<d.length;u++){var _=d[u];i.push(_.replace(/[.!?]+$/,""))}return Object.keys(i.reduce(function(e,t){return e[t]=1,e},{}))},t.isBotLinkEnabled=function(){return Object(v.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"},t.getBotLinkImageUrl=function(e){return"/images/stickers_suggestions_bot_light_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return Object(v.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();window.StickersHints=function(){var e,t,n,a,o,r,s=864e5,l=300,c=64,u=8,d=4,_=!0,f=0,p=new Id({mvk:!0});wd.EMOJI_HINTS;function h(e){var i=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),p.setConfig(e),n&&!n.initialized){var r=function(e){var t=n.value.length;t-f>1,f=t,m(),_&&(!function(){w()&&vkNow()-k()>s*(2+Math.random())&&v();e=function(e){e*=1e3,w()&&e>k()&&v()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),_=!1)};n.initialized=!0,o=geByClass1("stickersHints"),a=geByClass1("stickersHints__content"),addEvent(n,"focus",m),addEvent(n,"input",r),addEvent(document,"click",A),onBodyResize(g),onBodyResize(C),i.destroy.push(function(){o=null,a=null,n=null,removeEvent(n,"focus",m),removeEvent(n,"input",r),removeEvent(document,"click",A),onBodyResize("__clear",g),onBodyResize("__clear",C),t&&t.destroy(),f=0}),document.activeElement===n&&m()}}function m(){var i;n&&(e&&clearTimeout(e),i=function(i){var r=p.getQueries(n.value).find(function(e){return i.hasOwnProperty(e)}),s=r&&i[r];s?e=setTimeout(function(){var e,n=s.userStickers||[],i=s.promotedStickers||[];if(n.length>0||i.length>0){var l=[];each(n,function(e,t){l.push(b({stickerId:t,query:r,isPromoted:!1}))}),each(i,function(e,t){l.push(b({stickerId:t,query:r,isPromoted:!0}))}),p.isBotLinkEnabled()&&l.push((e=Object(vd.getStickerSize)(),Wd.html({inner:[{inner:[{class:"th_img",src:p.getBotLinkImageUrl(e),tag:"img"}],class:"sticker_thumb",href:p.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),a.innerHTML=l.join(""),show(o),g(),C(),(t=new Scroller(o)).init()}},l):(t&&t.destroy(),hide(o))},r?i(r):w()?(r=lsGet("stickers_keywords").keywords,i(r)):y(function(e){r=e,S(e),i(e)}))}function v(){y(function(e){r=e,S(e),m()})}function A(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(o),e&&clearTimeout(e))}function g(){attr(a,"style","")}function b(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(o,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",a=Stickers.getStickerUrl(e.stickerId,Object(vd.getStickerSize)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,a).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function y(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,function(e,n){var i=n.user_stickers,a=n.promoted_stickers;each(n.words,function(e,n){t[n]={userStickers:i,promotedStickers:a}})}),t}(t))}})}function w(){return Boolean(lsGet("stickers_keywords"))}function k(){return lsGet("stickers_keywords").time}function S(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function C(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-d,n=t/c,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var a=Math.round(t/n-u);each(geByClass("sticker_item",e),function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",a),setStyle(t,"height",a),setStyle(n,"width",a),setStyle(n,"height",a),setStyle(i,"height",a)})}}return onDOMReady(function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit(function(){h()}),geByClass1("stickersHints")&&h())}),ajax.onRedirect(function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&v()}),post.onReplyClick(function(e){var t=window.cur;e,setTimeout(m,10),t.destroy.push(function(){;""})}),{actualizeVisibility:m,init:h,onStickerThumbClick:function(t,i,a,r){window.isNewMail&&preventEvent(t);var s=gpeByClass("sticker_item",i),l=geByClass1("th_img",s);return attr(s,"style",""),attr(i,"style",""),attr(l,"style",""),hide(o),n.value="",e&&clearTimeout(e),post.sendSticker(i,a,!0,r)},onCheckboxLabelClick:function(e,t){setTimeout(function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,v)},0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout(function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,v)},0)},onSuggestionsBotLinkClick:function(){i.statlogsValueEvent.apply(void 0,[p.getBotLinkClickStatName(),0].concat(p.getBotLinkClickStatKeys()))}}}();var Md=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return Object(g.$)(xd.pinnedMsg(e))}};var xd={pinnedMsg:function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'}};function Pd(e,t){Md.go(t,e)}PinnedMsg._onClick=Pd,PinnedMsg._onHideClick=PinnedMsg.onHideClick;n("98L6"),n("gunf");window.SettingsRow_select={},SettingsRow_select._onChange=Ld;var Bd={row:".settingsRow",description:".settingsRow__description"};function Ld(e,t){!function(e){var t=e.$select,n=e.label;t.closest(Bd.row).$(Bd.description).textContent=n}(t),l.default.handle(e,t)}n("MzAf"),n("Dh0N"),n("fYoA");var Rd=n("PovR");function Dd(e){pushNotifier.canBeEnabled().then(function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then(function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)}).catch(function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1}):n.checked=!1)})}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=Dd;var Nd=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,a=!1,o=!1,r=vkNow(),s=0,l=this.getTouchX(e),c=getW(this.wrap);function u(e){if(!o)if(!a&&Math.abs(i.getTouchY(e)-n)>20)o=!0;else{i.lock&&(a=!0,t=i.getTouchX(e),r=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||a)&&(cancelEvent(e),a||(t=i.getTouchX(e),d=0,a=!0),s=d,l=u,d=-(100+d/c*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",a=Math.abs(l-t)/(r/vkNow());a+=.2*a;var o=100*i.opts.shownSlidesNum;o="next"==n?100+o:o-100,setStyle(i.helper,{transition:"transform "+a+"ms",transform:"translateX(-"+o+"%)"});var c=i.items.length-1,_="prev"==n?i.pos-1:i.pos+1;_<0?_=c:_>c&&(_=0),i.opts.onStartChange&&i.opts.onStartChange(_,n),i.newPos=_,i.changeTimeout=setTimeout(function(){i.lock=0,i.changeSlide(_)},a)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout(function(){i.lock=0},200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",a=e,o=0;o<t;o++)--a<0&&(a=n),i=this.makeItem(this.items[a])+i;i+=this.makeItem(this.items[e]),a=e;for(var r=0;r<t;r++)++a>n&&(a=0),i+=this.makeItem(this.items[a]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var a="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+a+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var o=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout(function(){a="next"==t?-100:0,setStyle(o.helper,{transition:"transform 200ms",transform:"translateX("+a+"%)"}),o.toSlideTimer=setTimeout(function(){o.lock=0,o.changeSlide(e)},200)},10)},e}();window.landingsSlider=Nd;n("03kU"),n("4qiT"),n("Tjn9"),n("tlL+"),n("w1QQ"),n("DVnk"),n("cLcH"),n("uo4j"),n("Fhlr");var Hd=n("myok");window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,o,r){var s=r.$btn,l=s.getAttribute("href"),c=s.nextElementSibling||s.previousElementSibling,u=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(Hd.default.setLoading(s,!0),ajax.post(l,{_ajax:1},{onDone:function(){Hd.default.setLoading(s,!1),c&&c.remove(),s.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+u+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n){e.preventDefault();var i=e.target,a=i.getAttribute("href"),o=a+"&action=hide",r=a+"&action=restore";(!n||confirm(n))&&ajax.post(o,{_ajax:1},{onDone:function(){var e=i.closest(".notificationList__items")||i.closest(".notificationList"),n=i.closest(".notification"),a=n.getAttribute("id"),o=e.closest(".notificationList");if(hide(n),NotifyItem._onBodyScroll(),o.classList.contains("notificationList_type_unread")){var s=o.$(".Pad__title"),l=parseInt(s.innerText,10)-1;s.innerText=langNumeric(l,lang.mobile_notifications_new)}var c=!0;each(geByClass("notification",e),function(e,t){isVisible(t)&&(c=!1)}),c&&o.classList.add("Pad_empty");var u=window.Snackbar;u&&u.init&&u.init({text:t,action:{url:r,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",a]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,a=n.url;e.preventDefault();var o=ge(t);ajax.post(a,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=o.closest(".notificationList__items")||o.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var a=n.$(".Pad__title"),r=parseInt(a.innerText,10)+1;a.innerText=langNumeric(r,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),function(e,t){isVisible(t)&&(s=!1)}),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach(function(e){e.classList.remove("notification_actionsOpen")}),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach(function(e){e!==t&&e.classList.remove("notification_actionsOpen")}),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,i){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,o={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach(function(e){o["setting_"+e.name]=e.checked?1:0}),ajax.post("feed.php",Object(bt.default)({gid:t,hash:n,unmuted:a,from:i},o,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}};var Vd=n("H5mD");function Fd(e,t,n){if(Vd.isWKWebView){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var i=new Event("click");return t.dispatchEvent(i),void setTimeout(function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n})}_.default.android?location.href="https://vk.com/write"+(2e9+e):Vd.isIOS?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{_ajax:1},{onDone:function(e){Fd(e,t,n)}}),!1},open:function(e,t,n){return setTimeout(function(){Fd(e,t,n)}),!1}};var Ud=n("wkhI"),$d=10,qd={setMaxAttach:function(e){$d=e},checkAttaches:function(){qd.toggleEnableAttaches(mediaUpload.getAttachesCount()<$d)},toggleEnableAttaches:function(e){void 0===e&&(e=!0),Object(g.$$)(".cp_attach_btn",Object(g.$)("#feed_add_form")).forEach(function(t){t.classList.toggle("cp_disabled_btn",!e)}),["photo","video","audio","doc","poll"].forEach(function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)}),["photo","audio"].forEach(function(t){var n=Object(g.$)(".CreatePostButtons__item--"+t);n&&n.classList.toggle("CreatePostButtons__item--disabled",!e)});var t=Object(g.$)(".CreatePostButtons__item--photo .inline_upload");Object(i.attr)(t,"disabled",!e)},toggleDonutDuration:function(e){var t=Object(g.$)("#feed_add_form"),n=Object(g.$)("input",e),i=Object(g.$)("#select-donut-duration"),a=Object(g.$)('[name="donut_duration"]',t),o=!n.checked;Object(Ud.setFieldIgnored)(a),i.classList.toggle("post__select_hidden",o)}};window.CreatePost=qd;var zd="touchstart mousedown",Qd="touchcancel touchend touchmove mouseout mouseup mousemove scroll";function Yd(e,t,n){var a;void 0===t&&(t=350);var o=function(o){var s=o.target;Object(i.addEvent)(e,Qd,r,{passive:!0}),(0===o.button||isUndefined(o.button))&&(a=setTimeout(function(t){var o,s;t.touches?(o=t.touches[0].pageX,s=t.touches[0].pageY):(o=t.pageX,s=t.pageY);n({pageX:o,pageY:s}),Object(i.removeEvent)(e,Qd,r,{passive:!0}),clearTimeout(a)}.bind(s,o),t))},r=function t(){clearTimeout(a),Object(i.removeEvent)(e,Qd,t,{passive:!0})};return Object(i.addEvent)(e,zd,o,{passive:!0}),function(){clearTimeout(a),Object(i.removeEvent)(e,zd,o,{passive:!0})}}!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var Gd="doc",Xd="photo",Kd="video",Jd="album",Zd="market_album",e_=1,t_=1.777,n_=1.5,i_=window.isMVK?200:120,a_=5,o_=6,r_=3,s_=window.isMVK?604:537,l_=window.isMVK?360:343;function c_(e,t,n,i){var a=function(e){var t=0;return each(e,function(e,n){t+=n}),t},o=function(e,t,n){return(t-(e.length-1)*n)/a(e)},r=(i=m_(i)?i:{}).wide,s=[],l=0,c=[],u=[];each(n,function(e,t){p_(t.type)&&(c[c.length]=t[t.type]),t.type===Kd&&s.push(l),l++});var d="",_=[],f=c.length;each(c,function(n,i){var a=f_(i,e,t);d+=a>1.2?"w":a<.8?"v":"q",_[_.length]=a});var p,h,m=_.length>0?a(_)/_.length:1,v=a_;window.isMVK&&(v=window.innerWidth>=480?o_:r_);var A=v;i.force?(p=e,h=t):(r?(p=s_,h=l_):e>=381?(p=381,h=1==f?361:237):(p=337,h=1==f?320:214),e<p&&(p=e,h=t),window.isMVK&&(p=Math.min(s_,window.innerWidth),h=Math.min(l_,p)));var g=p/h,b=0,y=0;if(1==f){var w={lastColumn:1,lastRow:1,single:1};c[0].thumb?(b=279,y=185):_[0]>=1*g?(b=p,y=Math.min(b/_[0],h)):(y=h,b=Math.min(y*_[0],p));var k=u_(c[0],b,y,w);!k.unsized&&(k.image.width<b&&k.image.height<=h||k.image.height<y&&k.image.width<=p)&&(b=k.image.width,y=k.image.height,k=u_(c[0],b,y,w)),u[0]=k}else if(2==f){var S,C;switch(d){case"ww":if(m>1.4*g&&_[1]-_[0]<.2){C=p,S=Math.min(C/_[0],C/_[1],(h-A)/2),u[0]=u_(c[0],C,S,{lastColumn:1}),u[1]=u_(c[1],C,S,{lastColumn:1,lastRow:1}),b=p,y=2*S+A;break}case"vv":case"qv":case"vq":case"qq":C=(p-v)/2,S=Math.min(C/_[0],C/_[1],h),u[0]=u_(c[0],C,S,{lastRow:1}),u[1]=u_(c[1],C,S,{lastRow:1,lastColumn:1}),b=p,y=S;break;default:var O=intval((p-v)/_[1]/(1/_[0]+1/_[1])),E=p-O-v;S=Math.min(h,O/_[0],E/_[1]),u[0]=u_(c[0],O,S,{lastRow:1}),u[1]=u_(c[1],E,S,{lastColumn:1,lastRow:1}),b=p,y=S}}else if(3==f)if((_[0]>1.2*g||m>1.5*g)&&"www"==d){var j,T=p,I=Math.min(T/_[0],.66*(h-A));if(u[0]=u_(c[0],T,I,{lastColumn:1}),"www"==d){var M=intval(p-v)/2;j=Math.min(h-I-A,M/_[1],M/_[2]),u[1]=u_(c[1],M,j,{lastRow:1}),u[2]=u_(c[2],p-M-v,j,{lastColumn:1,lastRow:1})}else{var x=intval((p-v)/_[2]/(1/_[1]+1/_[2])),P=p-x-v;j=Math.min(h-I-A,x/_[2],P/_[1]),u[1]=u_(c[1],x,j,{lastRow:1}),u[2]=u_(c[2],x,j,{lastRow:1,lastColumn:1})}b=p,y=I+j+A}else{var B=h,L=intval(Math.min(B*_[0],.75*(p-v)));u[0]=u_(c[0],L,B,{lastRow:1});var R=_[1]*(h-A)/(_[2]+_[1]),D=h-R-A,N=Math.min(p-L-v,intval(R*_[2]),intval(D*_[1]));u[1]=u_(c[1],N,D,{lastColumn:1}),u[2]=u_(c[2],N,R,{lastColumn:1,lastRow:1}),b=L+N+v,y=h}else if(4==f)if((_[0]>1.2*g||m>1.5*g)&&"wwww"==d){var H=p,V=Math.min(H/_[0],.66*(h-A));u[0]=u_(c[0],H,V,{lastColumn:1});var F=(p-2*v)/(_[1]+_[2]+_[3]),U=intval(F*_[1]),$=intval(F*_[2]),q=H-U-$-2*v;F=Math.min(h-V-A,F),u[1]=u_(c[1],U,F,{lastRow:1}),u[2]=u_(c[2],$,F,{lastRow:1}),u[3]=u_(c[3],q,F,{lastColumn:1,lastRow:1}),b=p,y=V+F+A}else{var W=h,z=Math.min(W*_[0],.66*(p-v)),Q=(h-2*A)/(1/_[1]+1/_[2]+1/_[3]),Y=intval(Q/_[1]),G=intval(Q/_[2]),X=W-Y-G-2*A;z+(Q=Math.min(p-z-v,Q))+v<p&&W*_[0]>z&&(z=Math.min(W*_[0],p-v-Q)),u[0]=u_(c[0],z,W,{lastRow:1}),u[1]=u_(c[1],Q,Y,{lastColumn:1}),u[2]=u_(c[2],Q,G,{lastColumn:1}),u[3]=u_(c[3],Q,X,{lastColumn:1,lastRow:1}),b=z+Q+v,y=h}else{var K=[],J=0;m>(s.length?1.3:1.1)?each(_,function(e,t){K[K.length]=Math.max(1,t)}):each(_,function(e,t){~s.indexOf(J)?K[K.length]=t:K[K.length]=Math.min(1,t),J++});var Z,ee,te={};for(te[f+""]=[o(K,p,v)],Z=1;Z<=f-1;Z++)te[Z+","+(ee=f-Z)]=[o(K.slice(0,Z),p,v),o(K.slice(Z),p,v)];for(Z=1;Z<=f-2;Z++)for(ee=1;ee<=f-Z-1;ee++)te[Z+","+ee+","+(f-Z-ee)]=[o(K.slice(0,Z),p,v),o(K.slice(Z,Z+ee),p,v),o(K.slice(Z+ee),p,v)];var ne,ie=null,ae=0;for(var oe in te)if(te.hasOwnProperty(oe)){var re=te[oe],se=a(re)+A*(re.length-1),le=Math.abs(se-h);if(~oe.indexOf(",")){for(var ce=oe.split(","),ue=0;ue<ce.length;ue++)ce[ue]=intval(ce[ue]);(ce[0]>ce[1]||ce[2]&&ce[1]>ce[2])&&(le+=50,le*=1.5)}(null===ie||le<ae)&&(ie=oe,ae=le,ne=se)}for(var de=h_(c),_e=h_(K),fe=ie.split(","),pe=te[ie],he=fe.length-1,me=0;me<fe.length;me++){var ve=parseInt(fe[me]),Ae=de.splice(0,ve),ge=pe.shift(),be=Ae.length-1,ye={};he==me&&(ye.lastRow=!0);for(var we=p,ke=0;ke<Ae.length;ke++){var Se=Ae[ke],Ce=_e.shift(),Oe=ye,Ee=void 0;be==ke?(Ee=Math.ceil(we),Oe.lastColumn=!0):we-=(Ee=intval(Ce*ge))+v,u[u.length]=u_(Se,Ee,ge,Oe)}}b=p,y=ne}return{width:intval(b),height:intval(y),thumbs:u}}function u_(e,t,n,i){var a={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:d_(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(a,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(a,{title:e.title,msize:e.msize}):e.type===Kd&&e.name&&void 0!==e.name&&extend(a,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),a.unsized?a.ratio=e_:a.ratio=a.image.width/a.image.height,a}function d_(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,o=window.devicePixelRatio||1;if(e.type===Kd||e.type===Gd){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach(function(i){e.sizes[i]&&(!a||t*o<=e.sizes[i][1]&&n*o<=e.sizes[i][2])&&(a=e.sizes[i])})}else{var r=e.thumb?e.thumb.sizes:e.sizes,s=r.x||r[r.length-1],l=s?(s[1]||1)/(s[2]||1):e_,c=0;l>t/n?(c=n,l>1&&(c*=l)):(c=t,l<1&&(c/=l)),n*=o,t*=o;var u=!i&&r.o,d="";d=r.temp?"temp":c<75?"s":c<130?"m":u&&r.o&&r.o[1]>=t&&r.o[2]>=n?"o":u&&r.p&&r.p[1]>=t&&r.p[2]>=n?"p":u&&r.q&&r.q[1]>=t&&r.q[2]>=n?"q":u&&r.r&&r.r[1]>=t&&r.r[2]>=n?"r":"x",a=r[d]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function __(e,t,n){var i=t,a=n,o=0,r=0;if(!e.vid&&e.image.width&&e.image.height){var s=e.image.width/e.image.height;s<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(a=(i=t)/s)>n&&(r=-intval((a-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(a=n)*s)>t&&(o=-intval((i-t)/2)))}return{width:i,height:a,marginLeft:o,marginTop:e.orig&&(e.type===Zd||e.type===Jd)&&e.single?0:r}}function f_(e,t,n){var i;switch(e.type){case Gd:i=e.ratio;break;case Kd:i=e.ratio||t_;break;case Jd:case Zd:i=n_;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,o=a[1],r=a[2];o&&r&&(i=o/r)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,l=s[1],c=s[2];l&&c&&(i=l/c)}}return i||e_}function p_(e){return!!~[Gd,Xd,Kd,Jd,Zd].indexOf(e.toString())}function h_(e,t){var n=m_(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=h_(e[i]):n[i]=e[i]);return n}var m_=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var v_=function(e){var t=e.iconFilename+(e.canPreview?"":"_grey")+"_44",n=[{class:"VideoRestriction__boxWrap",inner:[{class:"VideoRestriction__box",inner:[Object(Lt.default)("video-restrictions",t),{class:"VideoRestriction__title",inner:e.title}]}]}];e.thumb&&n.push({class:"VideoRestriction__thumb",style:"background-image: url("+e.thumb+"); height: 100%; width: 100%;"});e.button&&n[0].inner[0].inner.push({class:"VideoRestriction__button",inner:e.button.text,onclick:["VideoRestriction.hideDisclaimerAndPlay"]});return n};var A_={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady(function(){window.ThumbsEdit.init(!1),page.onChange(function(){window.ThumbsEdit.init(!1,"/wall")})})},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall")&&0!==t.indexOf("/board"))return this.initialized=!1,removeClass(document.body,"te_i"),void(A_.destroyLongpress&&A_.destroyLongpress());if(addClass(document.body,"te_i"),!geByClass1("ThumbsEdit",e)){var a=Object(i.ceFromString)(l.default.html({class:"ThumbsEdit",style:"width: 100%; height: 100%",id:"ThumbsEdit"})),o=Object(i.ceFromString)(l.default.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:a}));o.appendChild(a),e.insertBefore(o,e.firstChild),A_=Object(bt.default)({},A_,{previews:[],loaders:{},attachEl:a});var r=this.parsePreviews(Object(i.getPreloadData)());this.initialized=!0,r.length&&(A_.previews=r,this.draw(),Object(i.onBodyResize)(function(){return n.draw()}))}},parsePreviews:function(e){return e.map(function(e){return function(e,t,n,i){var a=t.split("_"),o=a[0],r=a[1],s=Object(bt.default)({owner_id:o,ownerId:o,itemId:r,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},i);switch(e){case Gd:s.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},s.doc=s.data;break;case Xd:s.data={pid:r,sizes:n.sizes},s.photo=s.data;break;case Kd:s.data={vid:r,duration:n.duration,platform:n.platform,play_icon:n.play_icon,preview:n.preview,active_live:n.active_live,restriction:n.restriction,ratio:n.ratio,sizes:n.sizes,name:n.name},s.video=s.data;break;case Jd:s.data={aid:r,title:n.title,size:n.size,thumb:{sizes:n.sizes}},s.album=s.data;break;case Zd:s.data={type:Zd,aid:r,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},s.market_album=s.data}return s.data.type=e,s.data.id=s.temp?e+"temp_"+o:""+e+s.ownerId+"_"+s.itemId,s}.apply(void 0,e)}).filter(function(e){return p_(e.type)})},draw:function(){var e=this,t=A_,n=t.previews,i=t.attachEl,a=n[0]?f_(n[0]):1.5,o={width:i.parentNode.offsetWidth,height:Math.min(Math.round(i.parentNode.offsetWidth/a),360),wide:!0},r=c_(o.width,o.height,n,o),s=r.thumbs,l=r.height,c=r.width;A_=Object(bt.default)({},A_,{thumbs:s,height:l,options:o});var u=document.createDocumentFragment();s.forEach(function(t,n){u.appendChild(e.createThumbEl(t,n))}),this.updateIds();var d=ce("div");d.id="ThumbsEdit-splitter",val(i,""),i.style.width=c+"px",i.parentNode.style.height=l+"px",i.appendChild(u),ge("ThumbsEdit-splitter")||i.parentNode.appendChild(d),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var a=e.id,o=ge(a),r=A_.thumbs,s=A_.height,c=A_,u=c.options,d=c.drag,_=t[0]?f_(t[0]):1.5,f=u.width,p=u.height;f&&p||(f=e.parentNode.offsetWidth,p=Math.min(Math.round(f/_),360)),u.width=f,u.height=p,u.wide=!0;var h=c_(f,p,t,u),m=h.thumbs,v=h.height,A=h.width,g=Object(i.ceFromString)(l.default.html({class:"ThumbsEdit",style:"width: "+A+"px; height: "+v+"px; position: fixed; left: "+d.wpos[0]+"px; top: "+d.wpos[1]+"px; visibility: hidden"}));m.forEach(function(e,t){g.appendChild(n.createThumbEl(e,t,!0))}),document.body.appendChild(g);var b=this.getCoords(g,d.wpos);re(g),b.forEach(function(e,t){var n=A_.drag.coords.find(function(t){return t.id===e.id});if(n){var a=geByClass1("Thumb",n.node),o=$("img",a),s=r[n.index],l=m.find(function(e){return e.id===s.id});A_.drag.toIndex!==t&&i.setStyle.transform(a,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==A_.drag.i||setTimeout(function(){i.setStyle.animate(a,"margin-left, margin-top, height, width, opacity, transform",{duration:i_+"ms"}),Object(i.setStyle)(a,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),i.setStyle.transform(a,1,[e.x-n.x,e.y-n.y]),i.setStyle.animate(a.parentNode,"background",{duration:i_+"ms"}),Object(i.setStyle)(a.parentNode,{func:"ease-in",background:"transparent"});var t=__(l,e.width,e.height);o&&(i.setStyle.animate(o,Object.keys(t).join(),i_+"ms"),Object(i.setStyle)(o,t))})}}),s!==v&&setTimeout(function(){[o,o.parentNode].forEach(function(e){i.setStyle.animate(e,"height",{duration:i_+"ms"}),Object(i.setStyle)(e,{height:v})})}),A>=f&&(i.setStyle.animate(o,"width",{duration:i_+"ms"}),Object(i.setStyle)(o,{width:A})),setTimeout(function(){Object(i.setStyle)(o,{width:A}),A_.thumbs=m,A_.previews=t,A_.height=v;var e=document.createDocumentFragment();m.forEach(function(t,i){e.appendChild(n.createThumbEl(t,i))}),o.innerHTML="",o.appendChild(e),A_.drag.updating=!1,n.updatePhotos()},i_)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,a=e.width,o=e.height,r=e.type,s=__(e,a,o),c=["Thumb-wrap","Thumb-wrap--"+r],u=0===e.id.indexOf("phototemp_"),d=u||a<=30||o<=60,_=e.orig.restriction;u&&c.push("Thumb-wrap--temp"),e.lastColumn&&c.push("last_column"),e.lastRow&&c.push("last_row");var f=A_.previews[t],p=null;f.label&&(p=l.default.wrap(f.label));var h=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var m=[{class:_?"VideoRestriction__thumb":"",inner:[{tag:"img",src:h?h.src:n.src,width:""+Math.round(s.width),height:""+Math.round(s.height),style:"margin-left: "+s.marginLeft+"px; margin-top: "+s.marginTop+"px;"}]},{class:"Thumb__overlay",inner:[!d&&{class:"Thumb__overlay-closeBtn",onclick:"ThumbsEdit.remove(null, "+t+")"},p]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:r},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(r.length,e.id.length)}];if(u){var v,A=Math.min(Math.min((s.width-24)/2,30),Math.min((s.height-24)/2,30));A_.loaders[e.id]&&(v=A_.loaders[e.id]);var g=Xc.init(v,A),b=g.component,y=g.id;A_.loaders[e.id]=y,m.push(b)}var w=["Thumb"];_&&(w.push("VideoRestriction"),w.push("VideoRestriction--onlyIcon"),e.orig.restriction.canPreview&&w.push("VideoRestriction--canPreview"),e.orig.restriction.needBlur&&w.push("VideoRestriction--blur"));var k=Object(i.ceFromString)(l.default.html({class:w.join(" "),style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px",inner:m})),S=Object(i.ceFromString)(l.default.html({class:c.join(" "),style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px","data-media":e.id,"data-index":t,"data-upload":f.upload}));if(A_.destroyLongpress=Yd(k,350,this.startDrag.bind(this,k)),addEvent(S,"click",this.showPopup.bind(this)),_){var C=l.default.html(v_({canPreview:e.orig.restriction.canPreview,iconFilename:e.orig.restriction.icon,title:e.orig.restriction.title}));k.appendChild(Object(i.ceFromString)(C))}return S.appendChild(k),S},addTempPreview:function(e){var t;if(A_.attachEl){var n=this.parsePreviews([e]);(t=A_.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=A_.previews.findIndex(function(t){return t.ownerId===e}),o=A_.previews[a],r=t.split("_").ownerId,s=t.split("_").itemId;o.ownerId=r,o.owner_id=r,o.itemId=s,o.temp=!1,o.upload=e,o.list=n,o.photo.sizes=i,o.photo.id="photo"+t,o.photo.pid=s,o.data=o.photo,Xc.ready(A_.loaders["phototemp_"+e]),this.draw()},onUploadProgress:function(e,t){Xc.update(A_.loaders["phototemp_"+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains("Thumb")&&!e.classList.contains("Thumb--moving")){window.navigator.vibrate&&navigator.vibrate(50),Object(i.setStyle)(document.body,"overflow","hidden"),Object(i.setStyle)(document.body,"max-height","100%"),Object(i.setStyle)(document.body,"user-select","none");var n=this.onDrag.bind(this),a=this.onDrop.bind(this);addEvent(window,"mousemove touchmove",n),addEvent(window,"mouseup touchend touchcancel",a),statlogsValueEvent("mvk_thumb_edit_interaction",""),A_.drag=Object(bt.default)({},A_.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:a});var o=e.offsetWidth>=40&&e.offsetHeight>=80,r=e.parentNode.parentNode,s=$("img",e),l=intval(e.parentNode.getAttribute("data-index")),c=A_.thumbs[l],u=getXY(r),d=getXY(e.parentNode),_=this.getCoords(r,u);A_.drag.id=r.id,A_.drag.i=l,A_.drag.toIndex=l,A_.drag.x=(t.pageX||t.detail.pageX)-d[0],A_.drag.y=(t.pageY||t.detail.pageY)-d[1],A_.drag.t=c,A_.drag.w=c.width,A_.drag.h=c.height,A_.drag.pos=d,A_.drag.wpos=u,A_.drag.crop=__(c,c.width,c.height),A_.drag.coords=_,A_.drag.needScale=o;var f=o?function(e,t,n,i){n=intval(n),i=intval(i)||n;var a=e,o=t;return e>=t&&e>n?(a=intval(n),o=intval(t/(e/n))):e<t&&t>i&&(o=intval(i),a=intval(e/(t/i))),[a,o]}(c.width,c.height,.9*e.offsetWidth,.9*e.offsetHeight):[c.width,c.height],p=f[0],h=f[1],m=intval((c.width-p)*(browser.android?.5:A_.drag.x/c.width)),v=intval((c.height-h)*(browser.android?.5:A_.drag.y/c.height));addClass(e,"Thumb--moving"),Object(i.setStyle)(e,{zIndex:100}),Object(i.setStyle)(e.parentNode,{zIndex:100});var A=__(c,p,h);Object(i.setStyle)(e,{opacity:.75,width:p,height:h,marginLeft:m,marginTop:v}),s&&Object(i.setStyle)(s,A),A_.drag.state=!0}},onDrag:function(e){var t=A_.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),a=n.x,o=n.y,r=A_.drag,s=a-(r.pos[0]+r.x),l=o-(r.pos[1]+r.y);i.setStyle.transform(t,1,[s,l]);var c=r.wpos;s=r.pos[0]+intval(t.style.marginLeft)+s-c[0],l=r.pos[1]+intval(t.style.marginTop)+l-c[1];var u=s,d=l,_=(t.offsetWidth,t.offsetHeight,r.i),f=!1,p=r.i,h=-1,m=window.innerWidth>=480?o_:r_,v={};if(r.coords.forEach(function(e,t){if(t!==r.i&&t!==h){e.offsetX=e.node.offsetWidth+m,e.offsetY=e.node.offsetHeight+m;var n=r.coords[t-1],a=r.coords[t+1],o=u+r.x,s=d+r.y,l=e.x+e.offsetX/2,c=e.y+e.offsetY/2,A=e.x+e.offsetX,g=e.y+e.offsetY,b=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||a&&a.x===e.x&&a.y!=e.y)&&0!=e.x,y=o>=l&&(a&&(o<=a.x+a.offsetX/2&&(a.offsetY===e.offsetY||o<A)||a.y!=e.y)||!a&&u<=A)&&s>e.y&&s<g,w=o<l&&o>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!a))&&s>e.y&&s<g,k=b&&s>=c&&s<g&&o>e.x&&o<A,S=b&&s<c&&s>=e.y&&o>e.x&&o<A;y=y&&!b,w=w&&!b&&!y,(y||w||k||S)&&(f=!0,p=e.index<r.i&&(y||k)?e.index+1:_<e.index&&(S||w)?e.index-1:e.index),p!==r.i?(i.setStyle.transform(e.node,1,[y?-5:w?5:0,k?-5:S?5:0]),y?(v.side="right",v.toIndex=e.index):w&&(v.side="left"),k?(v.side="down",v.toIndex=e.index):S&&(v.side="up")):i.setStyle.transform(e.node,1,[0,0]),y&&a&&a.y===e.y&&a.x>e.x&&_>e.index&&(i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(a.node,1,[5,0]),h=t+1,v.side="left",v.toIndex=p),k&&a&&a.x===e.x&&a.y>e.y&&s<=c&&(i.setStyle.transform(a.node,1,[0,0]),h=t+1),S&&n&&n.x===e.x&&n.y<e.y&&s<=c&&(i.setStyle.transform(n.node,1,[0,-5]),i.setStyle.transform(e.node,1,[0,0]),v.side="down",v.toIndex=n.index),p===t&&"number"!=typeof v.toIndex&&(v.toIndex=e.index)}}),v&&(!r.split||r.split.toIndex!==v.toIndex||r.split.side!==v.side)){var A=ge("ThumbsEdit-splitter");if(Object(i.setStyle)(A,{opacity:0}),r.split=v,"number"==typeof v.toIndex){var g=r.coords[v.toIndex].node,b=m===r_;"left"===r.split.side&&Object(i.setStyle)(A,{left:Math.max(0,g.offsetLeft-(b?0:1)),top:g.offsetTop+8,height:g.offsetHeight-16,width:"2px",opacity:1}),"right"===r.split.side&&Object(i.setStyle)(A,{left:Math.min(g.offsetLeft+g.offsetWidth-(b?2:1),A_.options.width-2),top:g.offsetTop+8,height:g.offsetHeight-16,width:"2px",opacity:1}),"up"===r.split.side&&Object(i.setStyle)(A,{left:g.offsetLeft+8,top:g.offsetTop,height:"2px",width:g.offsetWidth-16,opacity:1}),"down"===r.split.side&&Object(i.setStyle)(A,{left:g.offsetLeft+8,top:g.offsetTop+g.offsetHeight-1,height:"2px",width:g.offsetWidth-16,opacity:1})}}return r.toIndex=f?p:r.i,cancelEvent(e)},onDrop:function(e){var t=A_.drag;t.state=!1,t.updating=!0;var n=t.curEl,a=$("img",n),o="touchcancel".split(" ").includes(e.type);if(removeEvent(window,"mousemove touchmove",t.dragListener),removeEvent(window,"mouseup touchend touchcancel",t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if(Object(i.setStyle)(document.body,"overflow",null),Object(i.setStyle)(document.body,"max-height",null),Object(i.setStyle)(document.body,"user-select",null),i.setStyle.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge("ThumbsEdit-splitter").removeAttribute("style");if(!hasClass(n,"Thumb--moving"))return t.updating=!1,cancelEvent(e);if(o){var r=t.coords[t.toIndex].node;i.setStyle.transform(r,1,[0,0])}if(t.toIndex===t.i||o){var s=t.crop;i.setStyle.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"},function(){removeClass(n,"Thumb--moving")}),i.setStyle.animate(a,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"});var l=A_.thumbs[t.i];i.setStyle.transform(n,1,[0,0]),Object(i.setStyle)(n,{"margin-top":0,"margin-left":0,width:l.width,height:l.height,opacity:1,zIndex:null}),Object(i.setStyle)(n.parentNode,{zIndex:null}),a&&Object(i.setStyle)(a,s)}else{var c=A_.previews;c=function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}(c,t.i,t.toIndex),this.update(t.id,c)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach(function(e,i){var a=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(a[0]-t[0]),y:intval(a[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}}),n},remove:function(e,t){var n=A_.previews[t];e&&ze.default.close(e.target),mediaUpload.reset(null,null,n.remove,function(){A_.previews=A_.previews.filter(function(e,n){return n!==t}),ThumbsEdit.draw()})},showPopup:function(e){var t=e.target;if(!A_.drag.state&&!t.classList.contains("Thumb--moving")&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),a=Object(i.ceFromString)(l.default.html(this.getPopup(n)));Na.default.open(a,!0)}},getPopup:function(e){var t=A_.previews[e],n=null;switch(t.type){case"doc":t.is_gif&&(n='\n            Gif.openPopup(null, null, {\n              raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n              hasVideo: '+Gif.isMp4Supports()+"\n            });\n            Popup.close(this);\n          ");break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=Object(Na.ModalMenuBtn)({inner:getLang("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),a=null;return n&&!t.temp&&(a=Object(Na.ModalMenuBtn)({inner:getLang("mobile_open"),onclick:""+n})),Object(Na.default)({class:"ThumbsEdit__modal",close:!0,items:[a,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,A_.cachedPhoto[e]){var a=A_.cachedPhoto[e].find(function(e){return e.src===t});a?n&&n(a.src):i.onload=function(){A_.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),A_.cachedPhoto[e].sort(function(e,t){return e.width>t.width?-1:e.width<t.width?1:0}),n&&n(t)}}else A_.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;A_.thumbs.forEach(function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,function(e){n.src=e})})},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:A_.cachedPhoto[e]&&0!==A_.cachedPhoto[e].length?A_.cachedPhoto[e].find(function(e){var t=e.src,n=ce("img");return n.src=t,n.complete}):null},getThumbsCount:function(){return(A_.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach(function(e,n){var i=$$("input",e),a=t+n;i[0].name="attach"+a+"_type",i[1].name="attach"+a})}};var g_=need("Btn"),b_=need("Control"),y_=window.Join||(window.Join={});y_._onCountryChange=S_,y_._onPhoneChange=C_,y_._onTermsAcceptChange=C_;var w_={eu:"Join_eu"},k_={join:".Join",phone:".Join__phone",accept:".Join__accept",submit:".Join__submit"};function S_(e){var t=e.$option,n=Object(g.$)(k_.join),i="1"===t.getAttribute("data-eu");n.classList.toggle(w_.eu,i);var a=Object(g.$)(k_.phone),o=t.value;fn.default.setPrefix(a,o),cur.calledPhoneExcludeCountries&&val(Object(g.$)(".join_desc"),getLang(-1==indexOf(cur.calledPhoneExcludeCountries,t.getAttribute("data-id"))?"mobile_join_about_phone_with_call":"mobile_join_about_phone")),Object(g.$$)(k_.accept).forEach(function(e){return b_.setChecked(e,!1)}),C_()}function C_(){var e=Array.prototype.slice.call(Object(g.$$)(k_.accept)),t=Object(g.$)(k_.phone),n=Object(g.$)(k_.submit);if(n){var i=e.some(b_.isChecked)&&fn.default.getValue(t).trim().length>0;g_.setDisabled(n,!i)}else(n=Object(g.$)('.button[type="submit"]')).disabled=!b_.isChecked(e[0])}n("XLP4");onDOMReady(T_),page.onChange(T_);var O_="feedAssistance_pushNotificationsSwitch",E_="enable_browser_notifications",j_="m_push_switch";function T_(){window.pushNotifier&&pushNotifier.canBeEnabled().then(function(e){return e&&PushNotifier.getPermission()===Rd.PUSH_NOTIFIER_PERMISSION_DEFAULT}).then(function(e){if(e){FeedNotifications.addWebActionAcceptHandler(E_,I_),FeedNotifications.addWebActionDeclineHandler(E_,M_);var t=geByClass1(O_);if(!t)return;FeedAssistanceStats.registerTrackingCls(O_),FeedAssistanceStats.register(t,"feed")}})}function I_(e){return PushNotifier.requestPermission().then(function(t){var n,i=!0;return unlockButton(e),t===Rd.PUSH_NOTIFIER_PERMISSION_DEFAULT?i=!1:(n=t===Rd.PUSH_NOTIFIER_PERMISSION_GRANTED?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,P_(e,n),x_(),i)},function(){return M_(e)})}function M_(e){return unlockButton(e),P_(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),x_(),!0}function x_(){var e=geByClass1(O_);remove(e)}function P_(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,j_,t)})}n("NBPr"),n("zRDV"),n("bYEY");function B_(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find(function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t})}var L_,R_=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function D_(){L_&&L_.classList.remove(Gn.class.open)}function N_(){L_&&L_.classList.add(Gn.class.open)}onDOMReady(function(){!function e(t,n){void 0===n&&(n=!0),Object(i.isIosWebView)()||Object(i.isAndroidWebView)()||Object(i.isVkWebView)()||(n||(L_=geByClass1(Gn.class.btn),page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&D_(),B_(t,R_)||nav.getQuery("z")?(D_(),setTimeout(D_)):N_())}(null,!1)});var H_={_onCloseClick:function(e){Gn._onCloseClick(e),Object(Ie.setCookie)("remixregbtn",0,0)},show:N_,hide:D_};window.uRegisterFloatBtn=H_;var V_,F_=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function U_(){V_&&V_.classList.remove(Gn.class.open)}function $_(){V_&&V_.classList.add(Gn.class.open)}onDOMReady(function(){!function e(t,n){void 0===n&&(n=!0),n||(V_=geByClass1(Gn.class.btn),page.onChange(e.bind(this))),t=t?t.split("?")[0]:A.default.path,!/^\/photo/.test(t)&&U_(),B_(t,F_)||A.default.getQuery("z")?U_():$_()}(null,!1)});var q_={_onCloseClick:function(e){Gn._onCloseClick(e)},show:$_,hide:U_,processOpenInNativeApp:function(e,t,n,a,o){void 0===o&&(o={}),o=o||{},A.default.onMenuItemClick(n),A.default.openInNativeApp(a,t,e),Object(i.statlogsValueEvent)("utm_open_in_native_app_button","clicked",o.utm_source,o.utm_param,o.utm_medium,o.utm_time)}};window.uOpenInNativeAppFloatBtn=q_;var W_=need("nav"),z_=need("page"),Q_=need("ajax"),Y_=need("audioplayer"),G_=need("TabRow"),X_=need("AudioSerp");window.uAudioSerp={},uAudioSerp._onQueryChange=af,uAudioSerp._init=nf;var K_=300,J_={},Z_=!1,ef=null,tf=null;function nf(){var e,t=need("cur");(e=rf(W_.getQuery("q")))&&(J_[e]=X_.getFoundHtml()),t.processNav=of,Y_.onAdd(sf),Y_.onDel(sf)}function af(e){var t=e.query,n=rf(t);function i(){var e=!0;n||(e=!1),!n&&Z_&&(cur.processNav=null,Y_.searchCatalogEnabled()||X_.toggleTabs(!1),X_.setView("spinner"),Z_=!1),W_.go(Fa.default.make(W_.path,{q:n?t:"",tab:e})),cur.processNav=of}tf&&tf.abort(),ef&&clearTimeout(ef),Y_.searchCatalogEnabled()||X_.toggleTabs(!0),n in J_||!n?i():(X_.setView("spinner"),ef=setTimeout(i,K_))}function of(e){var t=W_.path,n=e.nav.path,i=qs2obj(W_.params),a=qs2obj(e.nav.params);if(t!==n||a.act)return z_.save(W_.cur,{title:document.title,bc:Object(g.$)("body").className,html:Object(g.$)(".basis").outerHTML,js:W_.getPageJs()}),J_={},Z_=!0,Y_.onAdd.off(sf),Y_.onDel.off(sf),tf&&tf.abort(),!1;if(!Y_.searchCatalogEnabled()&&i.tab!==a.tab){var o=a.tab||"owned";X_.setTab(o),G_.setSelectedTab("uAudioSerp",o)}var r=a.q||"",s=rf(r);if(t.q!==a.q&&tf&&tf.abort(),!Y_.searchCatalogEnabled()){var l=Fa.default.make(t,{q:r,tab:null}),c=Fa.default.make(t,{q:r,tab:"global"});G_.setTabUrl("uAudioSerp","owned",l),G_.setTabUrl("uAudioSerp","global",c)}return SearchPanel.setQuery("uAudioSerp",r),r?s in J_?(X_.setFoundHtml(J_[s]),X_.setView("found")):(X_.setView("spinner"),tf=Q_.post(t,{q:r,_ajax:1},{onDone:function(e){X_.setFoundHtml(e),X_.setView("found"),J_[s]=e}})):X_.setView("owned"),!0}function rf(e){return(e||"").trim().toLowerCase()}function sf(){J_={},Z_=!0}n("LTt1"),n("mXGF"),n("is+u");var lf=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:l.default.wrap(t.name)},l.default.wrap(Object(Qn.default)({icon:n}))]}};var cf=lf;window.BookmarksFilterListItem=lf;var uf=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map(function(e){return{class:"Owner__tag",inner:l.default.wrap(e.name)}})]:null}};var df=uf;window.BookmarksPageItem=uf;var _f=window.Popup,ff=window.ActionMenu,pf=window.attr,hf=window.val,mf=window.ajax,vf=window.replace,Af=window.scrollTop,gf=window.ceFromString,bf=window.Btn;window.Bookmarks={hideTagsList:Tf,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=Of(yf.tagsListPopup),a=Lf();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var o=t.closest(yf.bookmarkItem),r=Rf(pf(o,"id"));a=a.filter(function(e){return r.includes(e.id)}),n.classList.add("BookmarksPopup__hideCorner")}var s=Object(i.qs2obj)(nav.params),c=Object.keys(a).reduce(function(e,t){var n=a[t];return e.push(cf({tag:n,current_id:parseInt(s.tag)})),e},[]),u=l.default.html(c);hf(n.$(".Popup__scrollContent"),u);var d=Object(g.$$)(yf.tagsListLinks,n);d&&d.forEach(function(e){addEvent(e,"click",Tf)});return!1},hideDeletePopup:If,showDeletePopup:function(e){var t=Of(yf.tagsDeletePopup),n=pf(e,"data-id"),a=pf(e,"data-hash"),o=pf(e,"data-name");return Nf(t,{id:n,hash:a}),hf(t.$("["+wf.deleteName+"]"),Object(i.htsc)(o)),!1},submitDeleteTag:function(){var e=Hf(Array.from(Object(g.$$)(yf.tagsDeletePopup)).pop()),t=e.id,n=e.hash;mf.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){Cf(e),If()}})},hideCreatePopup:Mf,showCreatePopup:function(e){var t=Of(yf.tagsCreatePopup),n=pf(e,"data-hash");Nf(t,{hash:n});var i=Object(g.$)("[name="+wf.createName+"]",t),a=Object(g.$)(yf.tagsSubmitButton,t),o=hf(i).trim();return bf.setDisabled(a,!o),!1},submitCreateTag:function(){var e=Array.from(Object(g.$$)(yf.tagsCreatePopup)).pop(),t=Array.from(Object(g.$$)(yf.tagsSettings)).pop(),n=Hf(e).hash,i=hf(e.$("[name="+wf.createName+"]")),a=+!!Object(g.$)(yf.tagsSettings);mf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:a},{onDone:function(e,n){if(a){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach(function(e){i.push(e.value)}),hf(t,e),i.forEach(function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)})}else Cf(e);!function(e){var t=Bf(),n=e[0],i=e[1];t&&t.tags&&(t.tags[n]={id:n,name:i,order:0})}(n),Mf()}})},hideEditPopup:xf,showEditPopup:function(e){var t=Of(yf.tagsEditPopup),n=pf(e,"data-id"),i=pf(e,"data-hash"),a=pf(e,"data-name")||"",o=t.$("[name="+wf.editName+"]");hf(o,a),Nf(t,{id:n,hash:i,name:a});var r=Array.from(Object(g.$$)(yf.tagsSubmitButton,t)).pop(),s=hf(o).trim();return bf.setDisabled(r,!s),!1},submitEditTag:function(){var e=Array.from(Object(g.$$)(yf.tagsEditPopup)).pop(),t=Hf(e),n=t.id,i=t.hash,a=hf(e.$("[name="+wf.editName+"]"));mf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:a,hash:i,id:n},{onDone:function(e){Cf(e),xf()}})},hideSettingsPopup:Pf,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,a,o=pf(e,"data-item_id"),r=pf(e,"data-item_oid"),s=pf(e,"data-item_type"),c=pf(e,"data-hash"),u=pf(e,"data-raw");t.wrap||(n=Of(yf.tagsSettingsPopup),i=n.$(yf.tagsSettings),a=Rf(u),hf(i,l.default.html({class:"Bookmarks__tagsSettingsLoading"})),Nf(n,{id:o,oid:r,type:s,hash:c,itemRaw:u}));return mf.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:c,item_id:o,item_oid:r,item_type:s,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var l=gf(e);Nf(l=Of(l),{id:o,oid:r,type:s,hash:c,itemRaw:u,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else hf(i,e),a.forEach(function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)})}}),!1},submitSettingsTags:function(){var e=Array.from(Object(g.$$)(yf.tagsSettingsPopup)).pop(),t=Hf(e),n=t.id,i=t.oid,a=t.type,o=t.hash,r=t.itemRaw,s=t.is_from_snackbar,c=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach(function(e){c.push(e.value)});var u=c.join(",");mf.post("/bookmarks",{_ajax:1,act:"tag_set",hash:o,item_id:n,item_oid:i,item_type:a,tag_ids:u,is_from_snackbar:s},{onDone:function(e){Pf();var t=Object(g.$)("#"+r);if(t){var n=Object(g.$)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)hf(n,e);else if(n=Object(g.$)(".Owner__tags",t)){var i=Lf(),a=c.map(function(e){return parseInt(e,10)}),o=i.filter(function(e){return a.includes(e.id)}),s=l.default.html(df({tags:o}));hf(n.parentNode,s)}Uf(r,c,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){Tf(),If(),Mf(),xf(),Pf()},initStore:Df,pushItemsToStore:function(e){var t=Bf();t&&(t.items=Object(bt.default)({},t.items,e))},pushItemToStore:Uf,removeFromBookmarkLink:function(e){var t=pf(e,"data-item_id"),n=pf(e,"data-item_oid"),i=pf(e,"data-item_type"),a=pf(e,"data-hash"),o=pf(e,"data-raw"),r=pf(e,"data-link_url"),s=pf(e,"data-link_title"),l=pf(e,"data-link_img"),c=Object(g.$)("#"+o);return ff.closeMenu(),addClass(c,kf.removed),mf.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(e){Ff(o,[kf.removed]),Share.setBookmarkState(o,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=pf(e,"data-item_id"),n=pf(e,"data-item_oid"),i=pf(e,"data-item_type"),a=pf(e,"data-hash"),o=pf(e,"data-raw"),r=pf(e,"data-link_url"),s=pf(e,"data-link_title"),l=pf(e,"data-link_img"),c=Object(g.$)("#"+o);return ff.closeMenu(),removeClass(c,kf.removed),mf.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(){var e=Vf(o),t=e.indexOf(kf.removed);-1!==t&&e.splice(t,1),Ff(o,e),Share.setBookmarkState(o,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,a=Object(i.geByClass1)("RepliesField_fixed");a&&(t=Object(i.getH)(a)+5);Snackbar.init({type:y.SNACKBAR_TYPE_BOOKMARK,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce(function(t,n){return t["data-"+n]=e[n],t},{})}})},keyupCreateInput:function(e,t){var n=gpeByClass("BookmarksPopup",t),i=Object(g.$)(yf.tagsSubmitButton,n),a=hf(t).trim();bf.setDisabled(i,!a)},openSavedTab:function(e,t){var n=Object(g.$)(".mm_counter",t),i=Object(Ie.getCookie)(Sf.lastTab);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=Object(g.$)(".mm_new",e);Object(i.remove)(t)},getStoreItemDataById:$f,getTagsByItemId:qf,renderSearchItem:function(e,t,n,i,a){var o="";if(!i||isEmpty(i))o=n;else{var r=qf(e),s=Vf(e);i=JSON.parse(i),r&&(t=r.reduce(function(e,t){return[].concat(e,[t.id])},[]),i.subtitle=df({tags:r})),s&&(i.mix=[].concat(s)),i.title=l.default.wrap(a.highlight(i.title)),o=l.default.html(Ti(i))}return Uf(e,t,n),o}};var yf={tagsListPopup:".BookmarksPopup__filter",tagsDeletePopup:".BookmarksPopup__delete",tagsCreatePopup:".BookmarksPopup__create",tagsEditPopup:".BookmarksPopup__edit",tagsSettingsPopup:".BookmarksPopup__settings",tagsSettings:".Bookmarks__tagsSettings",tagsListContainer:".BookmarkListItem__tags",tagsListLinks:".Bookmarks__tagsSelectItem",tagsListWrap:".BookmarksTags",tagsListItem:".BookmarksTags__item",tagsListItemMore:".BookmarksTags__item_more",tagsContainer:".basisDefault",tagsSubmitButton:".BookmarksPopup__buttonSubmit",bookmarkItem:".BookmarksItem"},wf={deleteName:"data-deletetagname",createName:"createtagname",editName:"edittagname"},kf={removed:"BookmarksItem_removed"},Sf={lastTab:"remixblt"};function Cf(e){var t=Af(),n=Object(g.$)(yf.tagsContainer),i=gf(e);vf(i,n),Af(t)}function Of(e){var t;ff.closeMenu(),t="string"==typeof e?Object(g.$)(e):e,t=_f.open(t,!0);var n="popup"+Date.now();return pf(t,"data-popupid",n),t}function Ef(e){return pf(e,"data-popupid")}function jf(e){var t;if(t=!("string"==typeof e)?e:Array.from(Object(g.$$)(e)).pop()){_f.close(t);var n=Hf(t),a=n&&n.needRemove;!function(e){var t=Ef(e);delete Bf().popup[t]}(t),a&&Object(i.remove)(t)}return!1}function Tf(){var e=Array.from(Object(g.$$)(yf.tagsListPopup)).pop(),t=Object(g.$$)(yf.tagsListLinks,e);return t&&t.forEach(function(e){removeEvent(e,"click",Tf)}),jf(e)}function If(){return jf(yf.tagsDeletePopup)}function Mf(){var e=Array.from(Object(g.$$)(yf.tagsCreatePopup)).pop();if(e){var t=e.$("[name="+wf.createName+"]");hf(t,"")}return jf(yf.tagsCreatePopup)}function xf(){var e=Array.from(Object(g.$$)(yf.tagsEditPopup)).pop();if(e){var t=e.$("[name="+wf.editName+"]");hf(t,"")}return jf(yf.tagsEditPopup)}function Pf(){return jf(yf.tagsSettingsPopup)}function Bf(){return window.store.bookmarks||Df(),window.store.bookmarks}function Lf(){var e=Bf();return e.tags?e.tags:{}}function Rf(e){var t=Bf();return t.items[e]?t.items[e][3]:[]}function Df(e){void 0===e&&(e={}),window.store.bookmarks=Object(bt.default)({},e,{popup:{}})}function Nf(e,t){var n=Ef(e);Bf().popup[n]=t}function Hf(e){var t=Ef(e);return Bf().popup[t]}function Vf(e){var t=Bf();return t&&t.items&&t.items[e]&&t.items[e][5]}function Ff(e,t){var n=Bf();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function Uf(e,t,n,i){var a=Bf();a&&a.items&&(t=t.map(function(e){return parseInt(e,10)}),a.items[e]?(a.items[e][3]=t,a.items[e][4]=i):a.items[e]=["",n,e,t,i])}function $f(e){var t=Bf();return t&&t.items&&t.items[e]}function qf(e){var t=$f(e),n=Lf();if(t&&n){var i=t[3]||[];return n.filter(function(e){return i.includes(e.id)})}return!1}window.uCloseProfileSwitcher={},uCloseProfileSwitcher._onConfirmClick=zf;var Wf=null;function zf(e,t){var n=t.checked;A.default.clear();var a={is_closed:n?"1":"0",_ajax:1};f.default.post(e,a,{onDone:function(){A.default.reload();var e=window.cur;Wf=Object(i.scrollTop)(),e.destroy.push(Qf)}})}function Qf(){Object(i.scrollTop)(Wf),requestAnimationFrame(function(){Object(i.scrollTop)(Wf),requestAnimationFrame(function(){Object(i.scrollTop)(Wf)})})}window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,a,o){return Object(i.statlogsValueEvent)("groups_menu_item_click",e,t,n,a,o),!0};var Yf=function(e){void 0===e&&(e={});var t=window.lang;return Object(Ft.default)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:Object(Lt.default)("groups/common","hide_outline_56")},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[Object(Ft.ModalMenuBtn)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:t.mobile_back,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),Object(Ft.ModalMenuBtn)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:t.mobile_groups_warning_notification_proceed,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}})]})};window.WarningModal=Yf,extend(Yf,{close:function(e,t){t&&t.preventDefault(),Na.default.close(e),f.default.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:Object(i.domData)(e,"id"),group_id:Object(i.domData)(e,"gid"),hash:Object(i.domData)(e,"hash")})},leave:function(e,t){t&&t.preventDefault(),Na.default.close(e),Object(g.$)("#m .header__back").click()}});var Gf=function(e){return{class:r.default.class("Tooltip",{pos:e.pos,onboarding:e.onboarding}),"tooltip-id":e["tooltip-id"],inner:e.inner,onclick:e.onclick}};window.Donut={help:function(e,t){var n=geByClass1("Tooltip",e);if(n)return;return n=l.default.elem(Gf({pos:"left",inner:"Some info about donut"})),e.appendChild(n),Object(i.cancelEvent)(t)}};var Xf=!1,Kf={start:function(e,t,n){if("%page_id%"!==e&&!Xf){var a;switch(Xf=!0,n&&"%page_path%"!==n?n:A.default.cur){case"/feed":a=rc.TAB_ID_FEED;break;case"/feed?section=recommended":a=rc.TAB_ID_RECOMMEND;break;case"/mail":a=rc.TAB_ID_MESSAGES;break;case"/feed?section=notifications":a=rc.TAB_ID_NOTIFICATION}a&&innerWidth<882?rc.drawSkeletonLoader(Object(g.$)(".layout__basis"),a):(rc.drawLoader(Object(g.$)(".layout__basis")),Object(i.alLoadingFix)()),setTimeout(function(){var i={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){}};ajax.onNavDone(Kf.onStarted),n&&"%page_path%"!==n?A.default.go(n,{push_only:!0,replace:!0},i):A.default.go(A.default.cur,null,i)})}},onStarted:function(){ajax.onNavDone.off(Kf.onStarted),Object(v.calculateTimeOffsets)()}},Jf=Kf;window.AppShell=Jf;var Zf={reload:function(e){Jn.default.setDisabled(e,!0),!1===navigator.onLine?setTimeout(function(){Jn.default.setDisabled(e,!1)},500):A.default.reload()}};window.OfflinePage=Zf;var ep=n("2mXy");var tp=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map(function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)})],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&Object(Jn.default)({inner:[Object(je.getLang)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}},np=function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map(function(e){return e+": "+t[e]}).join("\n");f.default.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=Object(bt.default)({},t),n}Object(jt.default)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return l.default.preact(tp,Object(bt.default)({},this.state,{onSendClick:this.onSendClick}))},t}(ep.Component);function ip(){var e=$("#DeviceInfo");l.default.hydrate(np,Object(je.getState)("DeviceInfo"),e)}c.default.getRouter().addRoute("/?device",ip),window.initDeviceInfo=ip,Object(u.initStaticManager)(),Object(i.addEvent)(window,"scroll touchmove",function(){Object(i.onBodyScroll)(!0)},{passive:!0});var ap=window,op=ap.thover,rp=ap.ajax;function sp(){if(Object(i.lsGet)("custom_opts"))return Object(i.addClass)("_copts","vk_wrap");var e=Object(i.ce)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});Object(i.append)(e,"vk_utils");var t=Object(i.ge)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&(Object(i.addClass)("_copts","vk_wrap"),Object(i.lsSet)("custom_opts",1)),Object(i.remove)(e)}Object(i.addEvent)(document,"touchmove touchcancel",op.cancel,{passive:!0}),Object(i.addEvent)(document,"touchend",op.end,{passive:!0}),rp._init(),rp.enabled=!!rp._req,rp.enabled&&(onDOMReady(function(){Object(i.remove)("app_go_frame"),rp.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),Object(i.addClass)("_js","vk_wrap")}),page.clear()),page.onChange(function(){return c.default.getRouter().checkRoutes()}),onDOMReady(function(){c.default.getRouter().checkRoutes()}),onDOMReady(d.resizePosters),Object(i.addEvent)(window,"resize",d.resizePosters),Object(i.addEvent)(document,"touchstart",function(e){var t=Object(i.checkTouchHover)(e.target);op.clear(),t&&op.start.call(t,e)},{passive:!0}),Object(i.addEvent)(document,"click",function(e){var t=window.al;if(window.al&&t.ver){var n=Object(i.gpeByClass)("al_after",e.target);if(n){var a=Object(i.attr)(n,"data-target"),o=!!a&&Object(i.geByClass1)(a,n);if(o&&!nav.go_after(o,e)||!nav.go_after(n,e))return}var r=Object(i.checkNav)(e.target,{allow_post_away:!0});if(r&&(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),nav.go(r,e)||Object(i.cancelEvent)(e)),"bookmarks"===cur.module){var s=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!s)return;var l=s.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],c=l[0],u=l[1],d=l[2],_=l[3];if(!(c&&u&&d&&_))return;var f=!1;switch(u){case"link":f=e.target.closest('a[target="_blank"]');break;case"page":f=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!f)return;statlogsValueEvent("bookmarks_product_analytics",{item_type:u,item_owner_id:intval(d),item_id:intval(_),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}),Object(i.addEvent)(document,"submit",function(e){var t=e.target;Object(i.hasClass)("vk_js_yes",geByTag1("html"))&&!Object(i.hasClass)("opera_mini_yes",geByTag1("body"))&&Object(i.hasClass)("qsearch",t)&&Object(i.gpeByClass)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),Object(i.cancelEvent)(e))}),Object(i.addEvent)(document,_.isTouch?"touchstart":"mousedown",function(e){tooltip.closeByTap(e)}),onDOMReady(sp),onDOMReady(v.calculateTimeOffsets),Object(i.sgFix)(),onDOMReady(function(){var e=window.vk;e&&!e.id&&Object(i.lsCheck)()&&localStorage.clear()}),window.optionsTest=sp,zlayer.isReady=!0,window.isNewMail&&(n("sc7o"),n("s0aB"),n("/Id8"),n("DkIl"),n("CkGd"),n("iS9e"),n("fWqt"),n("QBkA"),n("rKp0"),n("u33z"),n("5qQ6"),n("/Rzu"),n("B5sG"),n("M2vk"),n("HPEO"),n("irqS"))},"7jQU":function(e,t,n){"use strict";n.r(t);n("rKUZ");function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function a(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,a=[],o=0;o<i;o++){var r=t[n[o]];if(r){var s=1===i?r.name:r.shortName;a.push(s)}}return a}n.d(t,"uTyping_getPeerTyping",function(){return i}),n.d(t,"uTyping_getNames",function(){return a})},"8ZMO":function(e,t,n){"use strict";n.r(t);var i=function(e){return{class:["Anchor",e.mix],id:e.id,tag:"div"}};t.default=i},"98L6":function(e,t){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,a=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){e.progress=!1,t?val(a,t):hide(a),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,a=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(a),val(a,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},"9y81":function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n=e.icon,o=e.class||e.mix;return Object(a.default)({mix:i.default.class(o,"Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t)),url:e.url,attrs:e.attrs})};function r(e){var t,n=e.icon;return{class:[e.class,Bem.class("Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t))],href:e.url,attrs:e.attrs}}Object.assign(o,{toggleActive:function(e){e.classList.toggle(s.active)}});var s={active:"Icon_active"};n.d(t,"IconWd",function(){return r});t.default=o;window.Icon=o},AXyT:function(e,t,n){"use strict";n.r(t);var i=function(e){return Wd.html({class:[Bem.class("Oval",{type:e.gray?"minor":e.type,hidden:a(e.value)}),e.mix],inner:e.value})};function a(e){return!e||e<=0}Object.assign(i,{setValue:function(e,t){if(!e)return;var n=a(t);e.innerText=t,e.classList.toggle(o.hidden,n)}});var o={hidden:"Oval_hidden"};t.default=i;Object.assign(window,{Oval:i,Oval_isHidden:a})},AeId:function(e,t){var n={_seen:{},_saved:{},_saveTimer:null,_sendTimer:null,_cleanTimer:null,LS_ADS_EVENTS:"ads.events",postsGetRaws:function(e){var t,n=(e=ge(e)).id||"",i=attr(e,"data-copy")||"",a={};if("block_"===n.substr(0,6)){a[n]=1,a.block=n.substr(6);var o=attr(e,"data-contain");o&&(o=o.split(",")).forEach(function(e){e=e.split(":"),a[e[0]]=intval(e[1])||1})}else(t=n.match(/^wall(adsite.*)$/))?a[t[1]]=1:(t=n.match(/^wall(-?\d+_\d+)$/))&&(a[t[1]]=1,(t=i.match(/^(-?\d+_\d+)$/))&&(a[t[1]]=-1));var r=attr(e,"data-ad-view");return r&&(a["ad_"+r]=1),a.height=e.offsetHeight,a.index=indexOf(domPN(e).children,e)-1,a},seen:function(e){var t,i,a,o,r,s,l;window.vk.id&&e.length&&(window._postsExtras||(window._postsExtras={}),e.forEach(function(e,c){r=e.index,l=e.block,s=e.height,Object.keys(e).forEach(function(c){"index"!==c&&"block"!==c&&"height"!==c&&"viewportHeight"!==c&&(i=e[c],a=n._seen[c],-1===(o=n._saved[c])||-1===a||1===i&&(o||a)||(t=n._seen[c]=i,_postsExtras[c]={index:r,block:l,height:s,viewportHeight:getCh()}))})}),t&&(clearTimeout(n._saveTimer),n._saveTimer=setTimeout(n.save,2500),clearTimeout(n._sendTimer),n._sendTimer=setTimeout(n.send,5e3)))},save:function(){if(!lsCheck()||isEmpty(n._seen))return n._seen;var e,t,i,a,o,r=window.vk,s=Math.floor((r.ts+Math.floor((vkNow()-r.started)/1e3))/3600),l=lsGet("posts_sent")||{},c=lsGet("posts_seen")||{},u=lsGet("posts_extras")||{};for(t in window._postsExtras||(window._postsExtras={}),n._seen)o=n._seen[t],_postsExtras[t]&&(u[t]={index:_postsExtras[t].index,block:_postsExtras[t].block,height:_postsExtras[t].height,viewportHeight:_postsExtras[t].viewportHeight},delete window._postsExtras[t]),"ad"!==(i=t.split("_"))[0]&&"adsite"!==i[0]&&"block"!==i[0]&&(i[0]=intval(i[0]),i[1]=intval(i[1])),a=(l[i[0]]||{})[i[1]],i[0]!=r.id&&(!a||-1==o&&a>0)&&(c[i[0]]||(c[i[0]]={}),(!c[i[0]][i[1]]||-1==o&&c[i[0]][i[1]]>0)&&(e=c[i[0]][i[1]]=s*o)),n._saved[t]=o;n._seen={},e&&(lsSet("posts_seen",c),lsSet("posts_extras",u))},getSeenData:function(){var e,t,i,a={},o={},r=[];if(lsCheck())a=lsGet("posts_seen"),o=lsGet("posts_extras")||{};else for(e in i=n.save()){var s=i[e],l=e.split("_");l[0]=intval(l[0]),l[0]&&(l[1]=intval(l[1])),a[l[0]]||(a[l[0]]={}),(!a[l[0]][l[1]]||-1==s&&a[l[0]][l[1]]>0)&&(a[l[0]][l[1]]=s)}for(e in a){for(t in i=[],a[e]){var c=a[e][t]>0?t:-t,u=o[e+"_"+t],d="";u?(d+=":"+(u.index||""),d+=":"+(u.block||""),d+=":"+(u.height||""),d=(d+=":"+(u.viewportHeight||"")).replace(/:+$/,"")):d="","block"!==e||cur._pstatbref||(cur._pstatbref=attr(ge(e+"_"+t),"data-ref")),i.push(c+d)}i.length&&r.push(e+"_"+i.join(","))}return r.length?{seen:a,data:r.join(";")}:""},onSend:function(e){if(!lsCheck())return extend(n._saved,n._seen);var t,i,a=lsGet("posts_seen")||{},o=lsGet("posts_sent")||{};for(t in e){for(i in e[t])o[t]||(o[t]={}),-1!=o[t][i]&&(o[t][i]=e[t][i]),(a[t]||{})[i]&&delete a[t][i];a[t]&&isEmpty(a[t])&&delete a[t]}lsSet("posts_seen",a),lsSet("posts_sent",o),clearTimeout(n._cleanTimer),n._cleanTimer=setTimeout(n.clean,1e4)},send:function(){var e=window.cur,t=window.vk,i=n.getSeenData();if(i.data){if(!t.id)return n.clear();var a="";!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur?e&&e.module?a=e.module:nav&&"/feed"==nav.cur&&(a="feed"):a="feed_podcasts";var o={_ajax:1,act:"ping",_pstat:i.data,_pstatref:a};e._pstatbref&&(o._pstatbref=e._pstatbref),ajax.post("/",o,{onDone:function(){n.onSend(i.seen)}}),delete e._pstatbref}},clean:function(){var e,t,i,a=window.vk,o=Math.floor((a.ts+Math.floor((vkNow()-a.started)/1e3))/3600),r=lsGet("posts_sent")||{};for(e in r){for(t in r[e])o-((i=r[e][t])>0?i:-i)>24&&delete r[e][t];isEmpty(r[e])&&delete r[e]}lsSet("posts_sent",r),n.cleanAdsEvents()},clear:function(){lsSet("posts_seen",{}),lsSet("posts_sent",n._saved=n._seen={}),lsSet(n.LS_ADS_EVENTS,n._lsAdsEvents={})},getStatsObj:function(e){return e=ge(e),hasClass("_stats_cont",e)?e:gpeByClass("_stats_cont",e)},getAdsEvents:function(){var e=n._lsAdsEvents;return e||(e=n._lsAdsEvents=lsGet(n.LS_ADS_EVENTS)||{}),e},cleanAdsEvents:function(){var e=n.getAdsEvents(),t=(new Date).getTime()/1e3|0,i=!1;each(e,function(n,a){t-a>=3600&&(delete e[n],i=!0)}),i&&lsSet(n.LS_ADS_EVENTS,e)},checkPixelEvent:function(e,t){var i=e.getAttribute("data-ad-block-uid"),a=-1!==indexOf(["load","impression"],t);if(!i||!a)return!0;try{var o=hashCode(""+t+i),r=n.getAdsEvents();if(r[o])return!1;var s=(new Date).getTime()/1e3|0;r[o]=s,lsSet(n.LS_ADS_EVENTS,r)}catch(e){try{console.log(e.message)}catch(e){}}return!0},getPixelElements:function(e,t){var n=[];return each(geByClass(t,e),function(){attr(this,"data-src")&&n.push(this)}),n},sendPixels:function(e){each(e,function(){attr(this,"src",attr(this,"data-src")),attr(this,"data-src",!1),addClass("_cntr",this)})},viewed:function(e){if(e=n.getStatsObj(e)){var t=n.getPixelElements(e,"_cntr_view");t.length&&n.checkPixelEvent(e,"impression")&&n.sendPixels(t)}},clicked:function(e){if(e=n.getStatsObj(e)){attr(e,"data-clicked","1");var t=n.getPixelElements(e,"_cntr_click");t.length&&n.sendPixels(t),checkPostsSeen()}}};n._sendTimer||(n._sendTimer=setTimeout(n.send,1e4)),window.pStats=n},AgBx:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){return Object(a.default)({mix:i.default.class(e.mix,"ScrollView"),attrs:e.attrs,inner:e.inner})};n("QMH7"),t.default=o;window.ScrollView=o},"B+U2":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("29dZ"),a=n("Y6JH"),o=n("TYsd"),r=n("z9sQ"),s=n("fdw3"),l=function(e){var t=e.keyboard,n=e.msgId;return{class:"BotsKeyboard__main",inner:t.buttons.map(function(e){return function(e,t,n){return{class:"BotsKeyboard__row",inner:e.map(function(e){return function(e,t,n){var l,c=window.lang,u=e.action.type,d=r.default.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===u,positive:"positive"===e.color,negative:"negative"===e.color},"--"),_=["uMailWrite._onKeyboardButtonClick","this","event",{action:(f=Object(s.stringifyJSON)(e.action),f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;")),authorId:t.author_id,inline:t.inline,msgId:n}];var f;l="vkpay"===u?[{class:"BotsKeyboard__buttonInner",inner:[o.default.wrap(c.mobile_mail_keyboard_label_vkpay),o.default.wrap("&nbsp;"),o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","vkpay")]}]:"location"===u?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","place_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(c.mobile_mail_keyboard_label_location)]}]}]:"open_app"===u?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","service_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]}]}]:"open_link"===u?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]},o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","open_link_16")]}]:[o.default.wrap(e.action.label)];return Object(i.default)({class:d,on_click:_,use_native_onclick:!0,inner:l,theme:"none",size:"normal",type:"button"})}(e,t,n)})}}(e,t,n)})}};t.default=l},B5sG:function(e,t,n){"use strict";n.r(t);var i=n("bYEY"),a=n("DkIl");function o(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel;return e>-2e9&&e<0?[r("showMedias",n.showMedia),r("deleteHistory",n.flushHistory),r("blockCommunity",n.blockCommunity),r("unblockCommunity",n.unblockCommunity),r("blockNotify",n.blockNotify)]:e>2e9?[r("chatInfo",n.chatInfo,"",i),r("chatAdd",n.addToChat),r("inviteLink",n.inviteLink,"",i),r("showMedias",n.showMedia),n.unpinMsg?r("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?r("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?r("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",r("chatDeleteHistory",n.flushHistory),r("chatReturn",n.returnToChat,"",i),r("chatLeave",n.leaveChat,"",i)]:t.cur.groupId?[r("showMedias",n.showMedia),r("markAsAnswered",n.communityMarkAsAnswered),n.isDialogImportant?r("removeImportantMark",n.communityToggleImportant):r("markAsImportant",n.communityToggleImportant),n.isBlacklisted?r("unbanUser",n.userBan):r("banUser",n.userBan),r("deleteHistory",n.flushHistory)]:[r("showMedias",n.showMedia),r("deleteHistory",n.flushHistory)]}function r(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1);var a=window.lang;if(!t&&!n)return null;var o={showMedias:[a.mobile_mail_show_medias,"picture_outline_28"],deleteHistory:[a.mobile_mail_delete_history,"delete_outline_28"],blockCommunity:[a.mobile_mail_block_community,"remove_circle_outline_28"],blockNotify:[a.mobile_mail_block_community_notify,"remove_circle_outline_28"],unblockCommunity:[a.mobile_mail_unblock_community,"add_circle_outline_28"],chatAdd:[a.mobile_mail_add_to_chat,"add_circle_outline_28"],chatUnpinMsg:[a.mobile_mail_unpin_msg,"unpin_outline_28","unpin"],chatShowPinnedMsg:[a.mobile_mail_pin_show,"pin_outline_28","showPinned"],chatHidePinnedMsg:[a.mobile_mail_pin_hide,"hide_outline_28","hidePinned"],chatInfo:[a.mobile_mail_chat_info,"info_outline_28"],chatDeleteHistory:[a.mobile_mail_delete_chat_history,"delete_outline_28"],chatReturn:[i?a.mobile_mail_return_to_channel:a.mobile_mail_chat_return,"chevron_left_outline_28","returnToChat"],chatLeave:[i?a.mobile_mail_channel_leave:a.mobile_mail_chat_leave,"cancel_circle_outline_28","leaveChat"],markAsAnswered:[a.mobile_mail_mark_as_answered,"double_mark_outline_28"],removeImportantMark:[a.mobile_mail_remove_important_mark,"unfavorite_outline_28"],markAsImportant:[a.mobile_mail_mark_as_important,"favorite_outline_28"],unbanUser:[a.mobile_settings_blacklist_unban_user,"add_circle_outline_28"],banUser:[a.mobile_settings_blacklist_ban_user,"remove_circle_outline_28"],inviteLink:[i?a.mobile_mail_channel_invite_link:a.mobile_mail_invite_link,"link_outline_28"]},r={text:o[e][0],icon:SVGIcon("mail-unfold",o[e][1]),attrs:n,url:t};return o[e][2]&&(r.name=o[e][2]),r}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=e>2e9,r={title:n.title,photos:n.avatarImages,actions:o(e),editing:t.cur.editing};if(i){var s=i?e-2e9:null;if(r.url="/mail?act=info&chat="+s,r.membersCount=n.countMembers,r.hasPinnedMsg=n.hasPinnedMsg,r.isChannel=n.isChannel,r.isChannel||n.isCommunityChat){var l=-n.ownerId;r.url="/club"+l}else if(n.viewerId<0){var c=-n.viewerId;r.url="/mail?act=info&chat="+s+"&community="+c}}else r.url=n.profileUrl,r.isOnline=n.isOnline,r.onlinePlatform=n.onlinePlatform,r.offlineText=n.offlineText;return Object(a.MailHat_convo)(r)}(e);if(t)return function(e){return Object(a.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=t?"&community="+t:"",o=t?"?community="+t:"";return Object(a.MailHat_main)({folder:e.folder,urls:{all:"/mail"+o,unrespond:"/mail?act=unrespond"+n,unread:"/mail?act=unread"+n,important:"/mail?act=important"+n,createChatUrl:"/mail?act=new_chat"},unreadCount:e.countUnread,importantCount:e.countImportant,withUnrespond:!!t,forwarding:!!e.forwardFromId,notifier:Object(i.default)()})}()}},B9v3:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("fdw3");var o=function(e){return Object(a.extend)({tag:"textarea",class:["Textarea",e.mix],name:e.name,placeholder:e.placeholder,rows:e.rows?e.rows:3,inner:e.text},e.attrs)},r=n("p5n7"),s=n("29dZ");function l(e){return void 0===e&&(e={}),{class:"SharePanel SharePanel-header SharePanel--active ShareHeaderConversationsPanel","aria-hidden":"false","data-name":"ShareHeaderConversationsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_close"),onclick:"cur.share.destroy()",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","cancel_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")},{class:"SharePanel-headerText__receivers"}]},{class:"SharePanel-headerRight",inner:[{"aria-label":Object(a.getLang)("mobile_search"),class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:"cur.share.toggleConversationsSearch(true)"},e.supportsExternalShare?{"aria-label":Object(a.getLang)("mobile_share_external"),class:"SharePanel-headerRight__externalShare",role:"button",inner:"iOS"===e.platform?Object(i.default)("wall","share_external_ios_24"):Object(i.default)("wall","share_external_android_24"),onclick:"cur.share.externalShare()"}:null]}]}}function c(e){var t=e.buttons,n=e.options,i="boolean"!=typeof e.active||e.active;return{class:"ActionsPanel SharePanel "+(i?"SharePanel--active":""),"data-name":"ActionsPanel","aria-hidden":!i,style:!(n.can_to_own||n.can_to_club||n.can_bookmark)?"display: none;":"",inner:t.map(function(e){if(e)return function(e){var t=e.href?"a":"div",n=e.onclick,i={tag:t,role:"button",tabindex:-1,href:e.href,onclick:n,class:"ActionsPanel-button ActionsPanel-button--"+e.target,inner:[{class:"ActionsPanel-button__icon",inner:e.icon},{class:"ActionsPanel-button__label",inner:e.label}]};"boolean"==typeof e["aria-pressed"]&&(i["aria-pressed"]=e["aria-pressed"]+"");return i}(e)})}}var u=function(e){var t=e.can_bookmark,n=e.is_bookmarked,u=e.object,d=e.list,_=e.from,f=e.post_from,p=e.supportsExternalShare,h=e.isVKApp,m=e.targetOwnOnClick,v=Object(a.makeUrl)("/wall",{act:"add",share_box:1,is_vk_app:h,object:u,list:d,from:_,post_from:f});return{inner:[{inner:[l({platform:e.platform,supportsExternalShare:p}),{class:"SharePanel ShareHeaderSearch ShareHeaderConversationsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderConversationsSearchPanel",role:"search",inner:Object(r.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "peers", true)',prefix:{text:{role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",role:"button",onclick:'cur.share.clearSearch(event, "peers")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderConversationsSearchPanel__input",id:"ShareHeaderConversationsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})},{class:"SharePanel SharePanel-header ShareHeaderGroupsPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_back"),onclick:"cur.share.toggleGroupsPanel(false)",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","back_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")}]},{class:"SharePanel-headerRight",inner:[{class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:'cur.share.setActivePanel(this, "ShareHeaderGroupsSearchPanel", true)'}]}]},{class:"SharePanel ShareHeaderSearch ShareHeaderGroupsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsSearchPanel",role:"search",inner:Object(r.default)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "group", true)',prefix:{text:{"aria-label":Object(a.getLang)("mobile_search"),role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",onclick:'cur.share.clearSearch(event, "group")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderGroupsSearchPanel__input",id:"ShareHeaderGroupsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})}],class:"SharePanelRoot ShareHeader",tag:"header"},{id:"Share__input",style:"display: none;",tag:"input"},{inner:[{class:"ShareConversations SharePanel SharePanel--active filter_peer_wrap","data-name":"ShareConversations","aria-hidden":"false",role:"group",id:"ShareConversations"},{class:"ShareGroups SharePanel","data-name":"ShareGroups","aria-hidden":"true",role:"group",id:"ShareGroups"}],class:"SharePanelRoot ShareLists",tag:"section"},{inner:[c({active:!0,options:e,buttons:[e.can_to_own?{target:"own",label:Object(a.getLang)("mobile_share_target_own"),onclick:m||"cur.share.go('"+v+"')",icon:Object(i.default)("wall","repost_outline_28")}:null,e.can_to_club?{target:"group",label:Object(a.getLang)("mobile_share_target_group"),icon:Object(i.default)("wall","users_outline_28")}:null,t?{target:"bookmark","aria-pressed":n,label:n?Object(a.getLang)("mobile_share_target_bookmark_active"):Object(a.getLang)("mobile_share_target_bookmark"),icon:Object(i.default)("wall",e.is_bookmarked?"favorite_28":"favorite_outline_28")}:null]}),{class:"SharePanel MessagePanel","aria-hidden":"true","data-name":"MessagePanel",inner:[Object(r.default)({tabindex:-1,autocomplete:!1,class:"MessagePanel__input",on_click:["cur.share.expandMessage"],placeholder:Object(a.getLang)("mobile_share_message_placeholder"),spellcheck:!1,readonly:!0,disabled:!0}),Object(s.default)({stretch:!0,size:"large",inner:Object(a.getLang)("mobile_share_message_single"),on_click:"cur.share.sendMessage(event)",use_native_onclick:!0})]},{class:"SharePanel ExpandedMessagePanel","aria-hidden":"true","data-name":"ExpandedMessagePanel",inner:[{class:"ExpandedMessagePanel__textareaWrap",inner:[o({placeholder:Object(a.getLang)("mobile_share_message_placeholder"),rows:1}),{class:"ExpandedMessagePanelSend",inner:Object(i.default)("common","send_active_24")}]}]},{class:"SharePanel ProcessingPanel","aria-hidden":"true","data-name":"ProcessingPanel",inner:[{class:"ProcessingPanel__icon ProcessingPanel__icon--loading",inner:Object(i.default)("wall","loading_40")},{class:"ProcessingPanel__label",inner:Object(a.getLang)("mobile_share_state_progress")}]}],class:"SharePanelRoot ShareBottom",tag:"footer"}],class:"Share","aria-role":"dialog","aria-label":Object(a.getLang)("mobile_like_publish_head_title"),hidden:"false",tabindex:"-1",tag:"div"}},d=n("wTbK"),_=n("YU/R"),f=n("Qz23"),p=n("OcsD"),h=n("UxAg"),m=n("j80l"),v="/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1",A="ShareConversations",g="ShareGroups",b=v+A,y=!1,w=0,k=!1,S={bookmarks:{}};function C(e){E(e)}function O(e){nav.go(e),cur.share.destroy({isNavigation:!0})}function E(e){var t=cur.share._els.header,n=e.scrollTop;t.classList.toggle("ShareHeader--scrolled",n>=10)}function j(e,t,n){cur.share._els.content;if(cur.share.blocked)return!1;if(I(!0),cancelEvent(n),hasClass("inline_item_selected",t))return cur.shareSearch.toggleAttach(e,!1),function(e,t){cur.share._els.content;for(var n=0;n<cur.share.selected.length;n++)if(cur.share.selected[n]===e){cur.share.selected.splice(n,1);break}return B(!1),!1}(e);cur.shareSearch.toggleAttach(e,!0);for(var i=!1,a=0;a<cur.share.selected.length;a++)if(cur.share.selected[a]===e){i=!0;break}return i||cur.share.selected.push(e),I(!1),B(!1),R(),!1}function T(e,t,n){if(!cur.share.blocked){e=e.closest(".SharePanelRoot");var i,a=Object(h.$$)(".SharePanel",e);t&&(i=Object(h.$)("."+t,e)),a.forEach(function(e){var t=e===i;e.setAttribute("aria-hidden",!t),e.classList.toggle("SharePanel--active",t),t?e.removeAttribute("tabindex"):e.setAttribute("tabindex",-1),Object(h.$$)("input, ul",e).forEach(function(e){e.setAttribute("aria-hidden",!t),t?(e.removeAttribute("disabled"),e.setAttribute("tabindex",0)):(e.setAttribute("disabled",!0),e.setAttribute("tabindex",-1))})});var o=Object(h.$)("input",i);o&&n&&o.focus(),setStyle(e,{height:i?i.clientHeight:0})}}function I(e){var t=Object(h.$)(".ShareModal");t&&t.classList.toggle("ShareModal--disableAnimations",!e)}function M(e){var t=cur.share._els,n=t.header,i=t.content,a=t.bottom;i.classList.add("ShareLists--transition"),I(!0),T(n,e?"ShareHeaderGroupsPanel":"ShareHeaderConversationsPanel"),T(i,e?"ShareGroups":"ShareConversations"),T(a,e?"":"ActionsPanel"),setTimeout(function(){i.classList.remove("ShareLists--transition")},300),Object(h.$)(".SharePanel--active ul",i).focus(),R(),E(e?Object(h.$)("#ShareGroups .ShareList__container"):Object(h.$)("#ShareConversations .ShareList__container"))}function x(e){var t=cur.share._els,n=t.header,i=(t.content,t.bottom),a=L();y=!0,k=e,R(e),I(!1),T(i,e?"":a),e&&T(n,"ShareHeaderConversationsSearchPanel",!0),R(e),setTimeout(function(){browser.ios&&Object(p.scrollTop)(document.activeElement),y=!1},500)}function P(){var e=cur.share._els,t=e.content,n=e.bottom,i=e.messageTextarea;y=!0,T(n,"ExpandedMessagePanel"),t.classList.add("ShareLists--transition"),R(!1),i.focus({preventScroll:!0})}function B(e){void 0===e&&(e=!0);var t=cur.share,n=t.selected,i=t._els;ge(A)&&(!function(){if(!cur.share)return;var e=cur.share.cache._cache,t=Object(h.$)(".ShareHeaderConversationsPanel"),n=Object(h.$)(".ShareHeaderConversationsPanel .SharePanel-headerText__receivers",t),i=cur.share.selected,a=i.length;t.classList.toggle("ShareHeaderConversationsPanel--hasReceivers",a>0);var o="";if(1===a){o=getLang("mobile_share_box_to_single");var r=e[i[0]][0];o=o.replace("{name}",r)}else if(2===a){o=getLang("mobile_share_box_to_couple");var s=e[i[0]][6]||e[i[0]][0],l=e[i[1]][6]||e[i[1]][0];o=o.replace("{name1}",s).replace("{name2}",l)}else if(a>2){o=getLang("mobile_share_box_to_many");var c=e[i[0]][6]||e[i[0]][0];o=o.replace("{name}",c).replace("{count}",a-1)}n.innerHTML=o}(),D());var a,o,r=L();T(i.bottom,r,e),a=n.length>1,o=cur.share._els.messagePanel,Object(h.$)(".Btn",o).innerHTML=a?getLang("mobile_share_message_many"):getLang("mobile_share_message_single")}function L(){var e=cur.share,t=e.selected,n=e.content;return"ShareHeaderGroupsSearchPanel"===Object(h.$)(".SharePanel--active",n).getAttribute("data-name")?"":t.length>0?"MessagePanel":"ActionsPanel"}function R(e){if(cur.share&&cur.share._els){var t=cur.share._els,n=t.header,i=t.bottom,a=t.content,o=t.groupsList;if(n&&i&&a){var r=Object(h.$)(".ShareModal"),s=400;(e=k||e)&&(s+=cur.share.lastBottomHeight-Object(p.getH)(i)),i.clientHeight&&(cur.share.lastBottomHeight=i.clientHeight);var l=[n,i].reduce(function(e,t){var n=Object(h.$)(".SharePanel--active",t);return n&&(e+=n.clientHeight,setStyle(t,{height:n.clientHeight})),e},0),c=Math.min(s,innerHeight-l);(y||cur.share.blocked)&&(browser.ios||browser.ipad||browser.safari)&&(c=Math.min(s,document.body.clientHeight-l));var u=l+c!==w;u||(I(!1),a.classList.remove("ShareLists--transition")),setStyle(o,{bottom:-i.clientHeight}),r.classList.contains("ModalMenu--focused")||setStyle(a,{height:c}),u||I(!0),w=l+c}}}function D(){cur.share&&each(geByClass("inline_item",Object(h.$)("ShareConversations__container")),function(e,t){if(cur.share){var n=intval((t.id||"").substr(4)),i=-1!==cur.share.selected.indexOf(n);toggleClass("inline_item_selected",t,i),t.setAttribute("aria-selected",i);var a=Object(h.$)('input[type="checkbox"]',t);a&&(a.checked=i)}})}function N(e){var t=cur.share._els.bookmarkButton;if(t){var n=Object(h.$)(".ActionsPanel-button__icon",t),a=Object(h.$)(".ActionsPanel-button__label",t);t.setAttribute("aria-pressed",e),e?(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_28")),a.innerHTML=getLang("mobile_share_target_bookmark_active")):(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_outline_28")),a.innerHTML=getLang("mobile_share_target_bookmark")),window.thover.clear()}}function H(e){var t=cur.share._els,n=t.bottom,a=t.processingPanel,o=this.mail_hash,r=this.object,s=this.list,l=this.appId,c=Object(h.$)(".ExpandedMessagePanel__textareaWrap textarea");I(!0),e&&cancelEvent(e),T(n,"ProcessingPanel"),cur.share.blocked=!0,(r.startsWith("story")||r.startsWith("narrative"))&&Stories.sendAnalyticsEvent("share_to_message"),setTimeout(function(){R()}),setTimeout(function(){R()},350),ajax.post("/mail?act=send",{_ajax:1,from:"share_box",hash:o,media:r,list:s,message:c.value,to:cur.share.selected.join(","),app_id:l},{onDone:function(e){I(!0);var t=Object(h.$)(".ProcessingPanel__icon",a),n=Object(h.$)(".ProcessingPanel__label",a);t.classList.remove("ProcessingPanel__icon--loading");var o=e.error;t.innerHTML=Wd.html(o?Object(i.default)("wall","error_circle_40"):Object(i.default)("wall","done_circle_40")),n.innerText=o?getLang("mobile_share_state_error"):getLang("mobile_share_state_success"),setTimeout(function(){cur.app&&(o&&cur.app.hasOwnProperty("vkMiniAppShareFail")?cur.app.vkMiniAppShareFail():!o&&window.isFunction(cur.app.vkMiniAppShareSuccess)&&cur.app.vkMiniAppShareSuccess(0)),cur.share&&cur.share.destroy({isFail:o})},1e3)}})}function V(e,t,n){void 0===n&&(n=!1),Object(p.preventEvent)(e);var i,a,o,r=cur.share._els.header;if("group"===t?(i=ge("ShareHeaderGroupsSearchPanel__input"),a="ShareHeaderGroupsPanel",o=cur.shareGroupSearch):"peers"===t&&(i=ge("ShareHeaderConversationsSearchPanel__input"),a="ShareHeaderConversationsPanel",o=cur.shareSearch),I(!1),i.value){if(n)return void I(!0);o.clear()}else"peers"===t?(T(r,a),x(!1)):(T(r,a),I(!0))}function F(){var e=/^([a-z_]+)(-?\d+)_(\d+)$/.exec(cur.share.options.object),t=e[1],n=e[2],i=e[3],a=cur.share.options.object;"app"===t&&"0"===i&&(a="app"+n),cur.share.options.list&&(a+="?list="+cur.share.options.list),a=a.replace("wall_reply","wall"),a=cur.share.options.external_url||a;var o=navigator.share({url:a});if(!o)return Object(p.statlogsValueEvent)("mvk_share_external",t);o.then(function(){cur.share&&Object(p.statlogsValueEvent)("mvk_share_external",t)})}function U(e,t){S.bookmarks[e]=t}var $=function(e,t,n){var a=t.can_to_own,o=void 0===a||a,r=t.can_to_club,s=void 0===r||r,l=t.can_bookmark,c=t.is_bookmarked,w=t.from,k=t.post_from,E=t.list,L=(t.message,t.targetOwnOnClick),U=t.appId;cur.share&&cur.share.destroy(),_.default&&_.default.close();var $=U?v+"&app_id="+U+A:b;t.withoutScrollView||Object(f.preventDocumentScroll)(),c=void 0!==S.bookmarks[e]?S.bookmarks[e]:c,t.is_bookmarked=c,cancelEvent(n);var q=!!navigator.share,W=browser.ios?"iOS":"Android",z=Object(d.default)({on_overlay_click:"cur.share.destroy()",class:"ShareModal",attached:!0,body:u({targetOwnOnClick:!!L&&"cur.share.toOwnWall()",can_to_own:o,can_to_club:s,supportsExternalShare:q,platform:W,can_bookmark:l,is_bookmarked:c,list:E,from:w,post_from:k,object:t.object,isVKApp:t.isVKApp})}),Q=t.withoutHash?null:"share";d.default.open(Wd.elem(z),!0,Q,{swipeDown:!0,onClose:function(){cur.share&&cur.share.destroy({closeModal:!1})}});var Y=Object(h.$)(".ShareModal"),G=Object(h.$)(".ShareHeader"),X=Object(h.$)(".ShareLists"),K=Object(h.$)(".ShareBottom"),J=Object(h.$)(".ActionsPanel-button--bookmark"),Z=Object(h.$)(".ActionsPanel-button--group");!function(e){void 0===e&&(e={});cur.shareSearch=new QuickSearch;var t=e.appId?v+"&app_id="+e.appId:v;cur.shareSearch.init({action:t,field:"ShareHeaderConversationsSearchPanel__input",container:A,top_len:20,tpl:function(e,t){return'<ul aria-multiselectable="true" aria-hidden="false" class="ScrollView ShareConversations__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(e,t){if(cur.share){var n=cur.share.cache._cache,a=n[this.id][0],o=!(!n[this.id][8]||!n[this.id][8].is_casper)?'<span class="ShareConversationsCasperTitle">\n             <span class="ShareConversationsCasperTitle__text">'+this.highlight(a)+'</span>\n             <span class="ShareConversationsCasperTitle__icon">'+Wd.html(Object(i.default)("mail","casper_16"))+"</span>\n           </span>":this.highlight(a),r=-1!==cur.share.selected.indexOf(+this.id)?"inline_item_selected":"";return'\n        <label aria-label="'+a+'" tabindex="0" role="checkbox" id="peer'+this.id+'" onclick="cur.share.select('+this.id+', this)" class="inline_item active '+r+'">\n          <input type="checkbox" style="display: none;">\n            <img aria-hidden="true" class="ii_img" src="'+t+'" />\n            <div class="ii_body">\n              <div class="ii_owner">\n                 '+o+"\n              </div>\n            </div>\n          </input>\n        </label>\n      "}},null_tpl:function(e){var t=getLang("mobile_friends_search_not_found").replace("%s",htsc(e));return e||(t=getLang("mobile_share_list_no_friends")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}}),D()}({appId:U}),addEvent(J,"click",function(e,t,n){var i=e.split("_"),a=31,o=5,r=[a,o,3].includes(Object(p.toInt)(t.bookmark_type));ajax.post("/bookmarks.php",{_ajax:1,wide:2===t.bookmark_type?1:0,from:"share_box",star:r?1:0,act:t.is_bookmarked?"bookmark_remove":"bookmark_add",item_type:t.bookmark_type,item_oid:i[0],item_id:i[1],hash:t.bookmark_hash},{onDone:function(e,t){var n=Object(h.$)("."+e),i=Object(p.ceFromString)(t);n&&Object(p.replace)(i,n.parentNode)}}),t.bookmark_type===o&&Article.toggleButton(e,!t.is_bookmarked);if(t.bookmark_type===a){var s=Object(h.$)(".StoryMenu__button");Stories.toggleBookmark(s,!0)}t.is_bookmarked=!t.is_bookmarked,S.bookmarks[e]=t.is_bookmarked,n()}.bind(this,e,t,function(){N(t.is_bookmarked)}),{passive:!0}),addEvent(Z,"click",function(){M(!0)},{passive:!0});var ee=Object(h.$)(".ExpandedMessagePanel textarea"),te=Object(h.$)(".MessagePanel__input input");ee.value=t.message||"",te.value=t.message||"",function(e,t){void 0===t&&(t=3);var n=ce("span");setStyle(n,{width:e.clientWidth+"px"}),n.innerText="_",append(n,e.parentNode);var i=n.clientHeight;addEvent(e,"input",function(){n.innerText=e.value,e.rows=Math.max(1,Math.min(t,Math.ceil(n.clientHeight/i)))})}(ee),addEvent(ee,"input blur focus",function(){te.value=ee.value.replace(/\n/gi," "),I(!1)}),addEvent(Object(h.$)(".ExpandedMessagePanelSend"),"click",function(){cur.share.sendMessage()},{capture:!0}),addEvent(ee,"input",function(){I(!1),R(!browser.ios),setTimeout(function(){I(!0)},150)}),addEvent(ee,"touchmove",function(e){stopEvent(e)},{capture:!0}),addEvent(ee,"focus",function(e){var t=cur.share._els.content;cancelEvent(e),!0,t.classList.remove("ShareLists--transition"),Y.classList.add("ModalMenu--blocked"),I(!1),R(!1),setTimeout(function(){R(!1),0===Object(p.scrollTop)()||browser.ios||(Y.classList.add("ModalMenu--focused"),Object(p.scrollTop)(document.body.clientHeight))},300)}),addEvent(ee,"blur",function(){Y.classList.remove("ModalMenu--blocked"),I(!1),!1,setTimeout(function(){Y.classList.remove("ModalMenu--focused"),document.activeElement&&document.activeElement.blur(),B(),R(!1),y=!1},100),setTimeout(function(){document.activeElement&&document.activeElement.blur(),R(!1)},250)}),addEvent(ee,"keydown",function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey&&browser.mac)&&cur.share.sendMessage(e)});var ne={act:"publish_box",object:"null"};U&&(ne.app_id=U),t.object&&(ne.object=t.object,t.list&&(ne.list=t.list));var ie=Object(m.makeUrl)("/like",ne);cur.share={open:!0,onClose:befall(),go:O,options:t,externalShare:F,actionBox:ie,blocked:!1,_els:{actionsPanel:Object(h.$)(".ActionsPanel"),messagePanel:Object(h.$)(".MessagePanel"),processingPanel:Object(h.$)(".ProcessingPanel"),groupsList:ge("ShareGroups"),conversationsList:ge("ShareConversations"),bookmarkButton:J,messageTextarea:ee,header:G,content:X,bottom:K},selected:[],cache:QuickSearchCache[$],expandMessage:P,toggleGroupsPanel:M,toggleConversationsSearch:x,select:j,clearSearch:V,setActivePanel:T,onScroll:C,sendMessage:H.bind(t),lastBottomHeight:K.clientHeight,destroy:function(e){void 0===e&&(e={}),e=extend({closeModal:!0,isFail:!0,isNavigation:!1},e);var t=Object(h.$)(".ShareModal");e.isFail&&cur.app&&cur.app.vkMiniAppShareFail&&cur.app.vkMiniAppShareFail(),t&&e.closeModal&&d.default.close(t),cur.share&&(cur.share.onClose(e.isNavigation),cur.share.open=!1),cur.share.options.withoutScrollView||Object(f.restoreDocumentScroll)(),delete cur.share,delete cur.shareSearch,delete cur.shareGroupSearch}},L&&(cur.share.toOwnWall=L),function(){cur.shareGroupSearch=new QuickSearch;var e=Icon({icon:"chevron_right"});cur.shareGroupSearch.init({load_once:!0,field:"ShareHeaderGroupsSearchPanel__input",container:g,action:cur.share.actionBox,tpl:function(e,t){return'<ul aria-hidden="true"  class="ScrollView ShareGroups__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(t,n){if(!cur.share)return"";var i=function(){if(!cur.share)return{};var e=cur.share.actionBox+g;return QuickSearchCache[e]}()._cache[this.id][0],a=cur.share.options,o=a.object,r=a.list,s=a.from,l=a.post_from,c={act:"add",share_box:"1"};o&&(c=extend(c,{object:o,list:r,from:s,post_from:l})),cur.share.options.isVKApp&&(c.is_vk_app=+cur.share.options.isVKApp);var u=Object(m.makeUrl)("/wall"+this.id,c);return'\n        <li aria-label="'+i+'" tabindex="0" role="link" id="group'+this.id+'" onclick="cur.share.go(\''+u+"', "+cur.share.options.isVKApp+')" class="inline_item " xmlns="http://www.w3.org/1999/html">\n          <img aria-hidden="true" class="ii_img" src="'+n+'" />\n          <div class="ii_body">\n            <div class="ii_owner">\n               '+this.highlight(i)+'\n            </div>\n            <div class="ii_go">\n               '+e+"\n            </div>\n          </div>\n        </li>\n      "},null_tpl:function(e){var t=getLang("mobile_groups_no_groups_found");return e||(t=getLang("mobile_share_list_no_groups")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}})}(),N(c),R(),G.closest(".Share").focus(),onBodyResize(function(){Y.classList.contains("ModalMenu--focused")||(R(),setTimeout(function(){I(!0)},150))})};n.d(t,"setBookmarkState",function(){return U}),n.d(t,"ActionsPanel",function(){return c}),n.d(t,"init",function(){return $}),window.Share=$,extend(window.Share,{setBookmarkState:U});t.default=u},"BJj/":function(e,t,n){"use strict";function i(e,t,n){var i;return function(){var a=this,o=arguments,r=function(){i=null,n||e.apply(a,o)},s=n&&!i;clearTimeout(i),i=setTimeout(r,t),s&&e.apply(this,o)}}n.r(t),n.d(t,"debounce",function(){return i})},BLcx:function(e,t){var n,i=(n=document.getElementsByClassName("gift_create_post_counter"),{counter:function(e){var t=n[0];if(t){var i=e.value.length,a=e.maxLength;if(i>a)e.value=e.value.substr(0,a);else if(i>a/2){var o=Math.max(a-i,0);t.innerText=langNumeric(o,lang.text_N_symbols_remain),show(t)}else hide(t)}}});window.GiftsSendFormCounter=i},BZzM:function(e,t,n){"use strict";n.r(t),n.d(t,"resizePosters",function(){return o});var i=.75,a=1/18;function o(e,t,n){var o=ge(t)||document,r="[data-poster-resized='false']";(e||n)&&(r="");var s=domQuery(".poster__text"+r,o),l=[],c=cur.posterConfig&&cur.posterConfig.constants;if(!c){if(!s.length)return;c=JSON.parse(domData(s[0].parentElement,"poster-constants"))}for(var u=0;u<s.length;u++){var d=s[u],_=domPN(d);l.push(domPN(_).clientWidth)}for(var f=0;f<s.length;f++){var p=s[f],h=domPN(p),m=l[f],v=c.font_size_ratio_range_1*m+"px",A=Math.round(c.line_height_ratio_range_1*m)+"px",g="0 "+Math.round(m*a)+"px";p.textContent.length>c.range_threshold&&(v=Math.round(c.font_size_ratio_range_2*m)+"px",A=Math.round(c.line_height_ratio_range_2*m)+"px"),setStyle(h,{height:m*i+"px",width:m}),setStyle(p,{fontSize:v,lineHeight:A,padding:g}),domData(p,"poster-resized",!0)}}},BoyB:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=function(e){void 0===e&&(e={});var t=e.class||e.mix;return i.default.html({class:[t,a.default.class("Loading",{white:e.white,large:e.large})],inner:{class:"Loading__items",inner:[{class:"Loading__item Loading__item_0"},{class:"Loading__item Loading__item_1"},{class:"Loading__item Loading__item_2"}]}})};t.default=o;window.Loading=o},CQvH:function(e,t,n){"use strict";n.r(t),n.d(t,"setFocusTrap",function(){return s}),n.d(t,"setMenuNavigation",function(){return l}),n.d(t,"expandPopup",function(){return c});var i=n("OcsD"),a=n("H5mD"),o={UP:38,DOWN:40,HOME:36,END:35,SPACE:32,ENTER:13,ESC:27,TAB:9};function r(){document.body.classList.add("tabbing")}function s(e){if(a.isIOS&&a.iosMajor>8)return!1;if(!e)throw new Error("A11y: No element passed to setFocusTrap");var t=['a[href]:not([tabindex^="-"])','area[href]:not([tabindex^="-"])',"input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'iframe:not([tabindex^="-"])','audio:not([tabindex^="-"])','video:not([tabindex^="-"])','[contenteditable]:not([tabindex^="-"])','[tabindex]:not([tabindex^="-"])'].join(),n=Array.from(e.querySelectorAll(t));if(!(n=n.filter(function(e){return null!==e.offsetParent})).length)return!1;var i=n[0],r=n[n.length-1],s=d(e,function(e){var t=e.event,n=e.exit;t.keyCode===o.TAB&&(t.shiftKey?document.activeElement===i&&(t.preventDefault(),r.focus()):document.activeElement===r&&(t.preventDefault(),i.focus())),t.keyCode===o.ESC&&n()});return cur.destroy.push(function(){s()}),setTimeout(function(){i.focus()}),s}function l(e){if(a.isIOS&&a.iosMajor>8)return!1;if(!e)throw new Error("A11y: No element passed to setMenuNavigation");if(!["menu","menubar"].includes(e.getAttribute("role")))throw new Error('A11y: Element must be `role="menu"` or `role="menubar"`');var t=['[role="menu"]','[role="menubar"]'].join(),n=['[role="menuitem"]','[role="menuitemradio"]','[role="menuitemcheckbox"]'].join(),i=Array.from(e.querySelectorAll(t)),r=Array.from(e.querySelectorAll(n));return i.forEach(function(e){Array.from(e.querySelectorAll(n)).forEach(function(e){r[r.indexOf(e)]=null})}),!!(r=(r=r.filter(function(e){return e})).filter(function(e){return null!==e.offsetParent})).length&&(u(r[0]),d(e,function(e){var t=e.event,n=e.exit,i=document.activeElement,a=r[0],s=r[r.length-1||0],l=r.indexOf(i),c=r[l+1],d=r[l-1];t.keyCode===o.UP&&(d?u(d,t):s&&u(s,t)),t.keyCode===o.DOWN&&(c?u(c,t):a&&u(a,t)),t.keyCode===o.HOME&&a&&u(a,t),t.keyCode===o.END&&s&&u(s,t),t.keyCode!==o.SPACE&&t.keyCode!==o.ENTER||(i.click(),n()),t.keyCode!==o.ESC&&t.keyCode!==o.TAB||n()},{onExit:function(){}}))}function c(e){if(!e)throw new Error("A11y: No element passed to expandPopup");if(!e.getAttribute("aria-haspopup"))throw new Error("A11y: No `aria-haspopup` attribute on expanded element");if(null==e.getAttribute("aria-expanded"))throw new Error("A11y: No `aria-expanded` attribute on expanded element");if(null==e.getAttribute("aria-controls"))throw new Error("A11y: No `aria-controls` attribute on expanded element");if(!document.getElementById(e.getAttribute("aria-controls")))throw new Error("A11y: No element that the `aria-controls` refers to. Try to call `expandPopup` _after_ appending a popup");return e.setAttribute("aria-expanded",!0),d(e,function(e){var t=e.event,n=e.exit;t.keyCode===o.ESC&&n()},{onExit:function(){e.setAttribute("aria-expanded",!1)}})}function u(e,t){t&&(r(),t.preventDefault());var n=!1;null!=e.getAttribute("tabindex")&&(n=!0),n||e.setAttribute("tabindex",0),e.focus(),setTimeout(function(){n||e.removeAttribute("tabindex")})}function d(e,t,n){void 0===n&&(n={}),e._enteredA11yElementKeyDownHandler&&document.removeEventListener("keydown",e._enteredA11yElementKeyDownHandler);var a=document.activeElement;function o(e){if(e&&o.exitIntent&&!1===o.exitIntent(e))e.preventDefault();else{var t=Object(i.scrollTop)();a&&u(a),Object(i.scrollTop)(t),document.removeEventListener("keydown",r),n.onExit&&n.onExit()}}function r(e){e.ctrlKey||e.altKey||e.metaKey||t({event:e,exit:o.bind(null,e)})}return document.addEventListener("keydown",r),e._enteredA11yElementKeyDownHandler=r,o}addEvent(window,"keydown",function(e){e.keyCode===o.TAB&&r()},{passive:!0}),addEvent(window,"mousedown touchstart",function(){document.body.classList.remove("tabbing")},{capture:!0,passive:!0}),document.addEventListener("keydown",function(e){e.ctrlKey||e.altKey||e.metaKey||e.keyCode===o.SPACE&&"button"===e.target.getAttribute("role")&&(e.target.click(),e.preventDefault())})},Cbap:function(e,t,n){"use strict";n.r(t);var i=function(){function e(){this.routes=[]}e.getRouter=function(){return window.router||(window.router=new e),window.router};var t=e.prototype;return t.addRoute=function(e,t,n){this.routes.push({isActive:!1,test:e,activateCallback:t,deactivateCallback:n})},t.test=function(e){var t=e.test;if(nav.cur)return"function"==typeof t?t(window.nav.cur):t instanceof RegExp?t.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof t)&&window.nav.cur.startsWith(t)},t.deactivateAllRoutes=function(){this.routes=this.routes.map(function(e){return e.isActive=!1,e.deactivateCallback&&e.deactivateCallback(),e})},t.checkRoutes=function(){var e=this;this.routes=this.routes.map(function(t){var n=e.test(t);return n&&t.activateCallback&&t.activateCallback(),!n&&t.isActive&&t.deactivateCallback&&t.deactivateCallback(),t.isActive=n,t})},e}();t.default=i,window.Router=i},CkGd:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81");function r(){var e=Object(i.default)(['\n    <div class="','" ',">","</div>\n  "]);return r=function(){return e},e}function s(){var e=Object(i.default)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <button class="Btn Btn_theme_small ','" ',">\n      ","\n    </button>\n  "]);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){e||(e={});window.lang;var t=a.default.onClick("MailActs._onMoreClick"),n=Object(o.default)({mix:"mailActs__close",icon:"close12",attrs:a.default.onClick("MailActs._onCloseClick")}),i=d("reply"),r=d("forward"),s=_("edit",e),l=_("pin",e),u=_("important",e),p=_("remove",e),h=_("spam",e),m=f("edit",e),v=f("pin",e),A=f("important",e),g=f("remove",e),b=f("spam",e),y=a.default.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel});return a.default.html(c(),y,n,i,r,s,l,u,p,h,t,m,v,A,g,b)};function d(e){var t=window.lang,n=a.default.class("mailActs__button",{type:e}),i=a.default.onClick("MailActs._onButtonClick",e),o="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return a.default.html(l(),n,i,o)}function _(e,t){var n,i=window.lang,o=a.default.class("mailActs__icon",{type:e}),r=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(s(),o,n,r)}function f(e,t){var n,i=window.lang,o=a.default.class("mailActs__chevronListItem",{type:e}),s=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(r(),o,s,n)}var p=n("UxAg"),h=n("+cqQ");function m(){store.mail.cur&&y()}function v(e){store.mail.cur&&function(e){var t=e.target,n=$(".mailActs");n&&n.classList.contains("mailActs_menuOpened")&&!t.closest(".mailActs__chevronList")&&!t.closest(".mailActs__chevronMoreIcon")&&n.classList.remove("mailActs_menuOpened")}(e)}function A(e){g({canEdit:e})}function g(e){Object(p.$$)(".mailActs").forEach(function(t){var n=a.default.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailActs",Object.assign({},n,e)))})}function b(e){switch(e){case"edit":u.onEditClick();break;case"remove":u.onRemoveClick();break;case"important":u.onImportantClick();break;case"reply":u.onReplyClick();break;case"forward":u.onForwardClick();break;case"spam":u.onSpamClick();break;case"pin":u.onPinClick()}}function y(){var e=document.querySelector(".mailActs__chevron"),t=e.offsetWidth-1,n=e.querySelectorAll(".mailActs__chevronListItem"),i=e.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(i,function(e,a){t<36*i.length?t-34>=36*(a+1)?(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden")):(e.classList.add("mailActs__icon_hidden"),n[a].classList.remove("mailActs__chevronListItem_hidden")):(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden"))}),g({cutted:t<36*i.length})}function w(){Object(p.$$)(".mailActs").forEach(function(e){return e.classList.toggle("mailActs_menuOpened")})}Object.assign(u,{onCloseClick:Object(h.default)(),onRemoveClick:Object(h.default)(),onImportantClick:Object(h.default)(),onReplyClick:Object(h.default)(),onForwardClick:Object(h.default)(),onSpamClick:Object(h.default)(),onPinClick:Object(h.default)(),onMoreClick:Object(h.default)(),onEditClick:Object(h.default)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);Object(p.$$)(".mailActs__counter").forEach(function(e){return e.innerText=t}),1!=e&&A(!1);y()},setEditAvailable:A,setImportantAvailable:function(e){g({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e},togglePin:function(e){Object(p.$$)(".mailActs").forEach(function(t){return t.classList.toggle("mailActs_canPin",e)})},setModifiers:g,setLabels:function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},update:y}),u._onButtonClick=b,u._onCloseClick=u.onCloseClick,u._onMoreClick=w,onBodyResize(m),document.addEventListener("click",v);t.default=u;window.MailActs=u},DG1x:function(e,t){window.LoadMore={setUrl:r,destroy:s},LoadMore._strategy={replace:{onFail:m,onSuccess:function(e){var t=e.response;a.outerHTML=t,s()}},padsExtend:{onFail:m,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach(function(e){var t=n[e];Pad.addContent(e,t)}),i?r(i):s()}}},LoadMore._onButtonClick=l,onDOMReady(c),page.onChange(c);var n={loadMore:".LoadMore",button:".LoadMore__button"},i="_loadMore_loading",a=null,o=null;function r(e){o.setAttribute("href",e)}function s(e){a.remove(),a=null,o=null,d()}function l(){h()||_()}function c(){if(a=$(n.loadMore)){var e=window.cur;o=a.$(n.button),u(0),onBodyScroll(u),e.destroy.push(d)}}function u(e){if(a&&!h()){var t=getY(a),n=getCh();t-(e+n)<2*n&&_()}}function d(){onBodyScroll("__clear",u)}function _(){p(!0);var e=o.getAttribute("href");ajax.post(e,{_ajax:1},{onDone:function(e){return f(e,!0)},onFail:function(e){return f(e,!1)}})}function f(e,t){if(p(!1),a){var n=t?"data-success-handler":"data-fail-handler";n=a.getAttribute(n),Wd.handle(n,{$loadMore:a,response:e}),a=null,o=null,d(),c()}}function p(e){o&&a&&(Btn.setLoading(o,e),a[i]=e)}function h(){return a&&a[i]}function m(e){console.error("LoadMore: failed to load more",e)}},DVnk:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}})},Dh0N:function(e,t){function n(e,t){var n=t.$select,o=t.value;n.closest(i.email).classList.toggle(a.groupsVisible,e.includes(o)||e.includes(Number(o)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=n;var i={email:".settingsEmail"},a={groupsVisible:"settingsEmail_groupsVisible"}},DkIl:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81"),r=n("gy8s"),s=n("KMpi"),l=n("Y6JH"),c=n("fdw3");function u(){var e=Object(i.default)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return u=function(){return e},e}function d(){var e=Object(i.default)(['\n    <a class="','" href="','">\n      ','\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitle">',"</div>\n        ","\n      </div>\n    </a>\n  "]);return d=function(){return e},e}function _(){var e=Object(i.default)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return _=function(){return e},e}function f(){var e=Object(i.default)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return f=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="mailHat__unreadCount mailHat__unreadCount_length_','">\n      ',"\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="mailHat '," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return v=function(){return e},e}function A(e){Object(o.default)({mix:"mailHat__burger",icon:"burger",attrs:a.default.onClick("MailHat_main.onBurgerClick")});var t,n,i,s,c,u,d,_=function(e,t,n,i){var a=window.lang;return Object(r.default)({mix:"mailHat__folder",items:[{name:"all",text:a.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:a.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:a.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:a.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important}]})}(e.folder,e.urls,e.withUnrespond,e.importantCount);i=e.unreadCount,s=a.default.class("mailHat__unread",{hasUnread:i>0}),c=Object(o.default)({mix:"mailHat__unreadIcon",icon:"msg"}),(t=i)>999?(t="999+",n=4):n=t>99?3:t>9?2:1,u=a.default.html(h(),n,t),d=a.default.onClick("MailHat_main.onUnreadClick"),a.default.html(m(),s,d,c,u);return y({type:"main",left:""+Wd.html({class:"mailHat__cancelForward",inner:Object(l.default)("base","back_outline_28"),onmousedown:["MailHat_main.onCancelForwardTap"]}),center:""+_+function(){var e=window.lang;return a.default.html(p(),e.mobile_mail_choose_recipient)}(),right:""+Wd.html({href:e.urls.createChatUrl,class:"mailFilter__create",inner:Object(l.default)("base","write_outline_28")}),forwarding:e.forwarding})}function g(e){var t;return y({type:"convo",left:""+k()+Wd.html({class:"mailHat__cancelEditing",inner:Object(l.default)("base","cancel_outline_28"),onmousedown:["MailHat_convo.onCancelEditingTap"]}),center:""+function(e){var t=a.default.class("mailHat__convo",{mobile:e.mobile}),n=Object(s.default)({mix:"mailHat__convoAvatar",photos:e.photos,size:36}),i=function(e){var t=window.lang,n=e.membersCount,i="",o="";if(n>0)o=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var r=e.onlinePlatform;o=C(e.isOnline,e.offlineText),"mobile"===r&&(i=Wd.html({class:a.default.class("mailHat__onlineIcon",{platform:"mobile",isOnline:e.isOnline}),inner:e.isOnline?Object(l.default)("base","online_mobile_composite_16"):Object(l.default)("profile","online_mobile_12_gray_200")}))}return a.default.html(u(),o,i)}(e);return a.default.html(d(),t,e.url,n,e.title,i)}(e)+function(){var e=window.lang;return a.default.html(f(),e.mobile_mail_message_editing)}(),right:(t=e.actions,Object(r.default)({mix:"mailHat__actions",trigger_attrs:{"aria-label":Object(c.getLang)("mobile_mail_actions_label")},icon_html:Wd.html(Object(l.default)("base","more_horizontal_28")),position:"topRight",items:t})),hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function b(e){return y({type:"page",left:""+k(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function y(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,o=e.editing?"mailHat_editing":"";return a.default.html(v(),i,t,n,o,e.left,e.center,e.right)}function w(e){return a.default.html(_(),e.title)}function k(){return Wd.html({tag:"button",type:"button","aria-label":Object(c.getLang)("mobile_back"),class:"mailHat__back",inner:Object(l.default)("base","back_outline_28"),onclick:["MailHat_convo.onBackTap"]})}function S(e){return Object(o.default)({mix:a.default.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url})}function C(e,t){var n=window.lang;return e?n.mobile_mail_online:t}var O=n("UxAg"),E=n("+cqQ");function j(e){Object(O.$$)(".mailHat").forEach(function(t){var n=a.default.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailHat",Object.assign({},n,e)))})}Object.assign(A,{onUnreadClick:Object(E.default)(),onBurgerClick:Object(E.default)(),onCancelForwardTap:Object(E.default)(),setFolder:function(e){Object(O.$$)(".mailHat__folder").forEach(function(t){r.default.setActive(t,e)})},setImportantCount:function(e){Object(O.$$)(".mailHat__folder").forEach(function(t){r.default.setCount(t,"important",e)})},setForwarding:function(e){Object(O.$$)(".mailHat_type_main").forEach(function(t){return t.classList.toggle("mailHat_forwarding",e)})},setModifiers:j}),Object.assign(g,{onBackTap:Object(E.default)(),onCancelEditingTap:Object(E.default)(),setOnline:function(e,t){var n=C(e,t);Object(O.$$)(".mailHat__convoDetailsText").forEach(function(e){return e.innerText=n})},setMobile:function(e){Object(O.$$)(".mailHat__convo").forEach(function(t){return t.classList.toggle("mailHat__convo_mobile",e)})},setHasPinnedMsg:function(e){Object(O.$$)(".mailHat_type_convo").forEach(function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)})},setModifiers:j}),n.d(t,"MailHat",function(){return y}),n.d(t,"MailHat__Title",function(){return w}),n.d(t,"MailHat__icon",function(){return S}),n.d(t,"MailHat_main",function(){return A}),n.d(t,"MailHat_convo",function(){return g}),n.d(t,"MailHat_page",function(){return b}),window.MailHat_main=A,window.MailHat_convo=g},Fhlr:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)}),e._promoButtonClickHandlerAdded=!0}})},Fkq0:function(e,t,n){"use strict";function i(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n&&i?{width:n,height:i}:{width:e.offsetWidth,height:e.offsetHeight}}n.r(t);var a=n("W9Tc");n.d(t,"marketDebug",function(){return r}),n.d(t,"marketItemIdToObject",function(){return s}),n.d(t,"albumLinkToObject",function(){return l}),n.d(t,"parseBookmarkedProductClass",function(){return c}),n.d(t,"isElementVisible",function(){return u}),n.d(t,"isElementInViewport",function(){return d});var o="#page_header_wrap,#market_search_input";function r(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];Object(a.partConfigEnabled)("extended_client_logging")&&("error"===e?console.error("[market "+t+"]: ",n):"warn"===e?console.warn("[market "+t+"]: ",n):"info"===e?console.info("[market "+t+"]: ",n):console.debug("[market "+t+"]: ",n))}function s(e,t){void 0===t&&(t="market");var n=new RegExp(t+"(-?[0-9]+)_([0-9]+)"),i=e.match(n);if(!i||i.length<3)return null;var a=i[1],o=i[2];return{id:a+"_"+o,ownerId:parseInt(a),itemId:parseInt(o)}}function l(e){var t=e.match(/market(\-?[0-9]+).+section=album_([0-9]+)/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:n+"_"+i,ownerId:parseInt(n),itemId:parseInt(i)}}function c(e){var t=e.match(/_([0-9]+)_(\-?[0-9]+)_4/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:i+"_"+n,ownerId:parseInt(i),itemId:parseInt(n)}}function u(e){var t;return"none"!==(null===(t=e.style)||void 0===t?void 0:t.display)}function d(e,t){void 0===t&&(t=50);var n,a,r=(n=0,document.querySelectorAll(o).forEach(function(e){var t=i(e);n+=t.height}),n),s={width:(a=document.documentElement).clientWidth,height:a.clientHeight},l=function(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}(e),c=i(e),u=c.width*t/100,d=c.height*t/100;return!(l.left+c.width<0+u)&&(!(l.left+u>s.width)&&(!(l.top+c.height<r+d)&&!(l.top+d>s.height)))}},G0UO:function(e,t){var n=Array.isArray,i={mail:{}},a={injectStore:function(e){i.mail={};var t=e.mail,a=t.cur,o=t.rolls,r=t.reached;t.msgs,t.queue;n(e.mail.msgs)&&(e.mail.msgs={}),n(e.mail.replies)&&(e.mail.replies={}),o&&n(o.peer)&&(o.peer={}),o&&n(o.search.peers)&&(o.search.peers={}),o&&n(o.search.msgs)&&(o.search.msgs={}),r&&n(r.search.peers)&&(r.search.peers={}),r&&n(r.search.msgs)&&(r.search.msgs={}),r&&n(r.peer.before)&&(r.peer.before={}),r&&n(r.peer.after)&&(r.peer.after={}),i.mail=e.mail,i.mail.pendingReplies={},i.mail.presend={},a&&(a.msgSelected={},a.msgRemoved={},a.msgAttached={},a.msgReply={},a.keyboards={},a.typings={},a.peerMembers={}),"notificationsCount"in i||(i.notificationsCount=e.notificationsCount)},injectMail:function(e){var t=i.mail,n=e;isObject(n.msgs)&&Object.assign(t.msgs,n.msgs),isObject(n.peers)&&Object.assign(t.peers,n.peers),isObject(n.members)&&Object.assign(t.members,n.members),isObject(n.replies)&&Object.assign(t.replies,n.replies),isObject(n.forwards)&&Object.assign(t.forwards,n.forwards),t.page=n.page,n.mrs&&(t.cur.countMR=n.mrs.count,t.rolls.mrs=n.mrs.rolls,t.reached.mrs=n.mrs.reached,t.scraps.mrs=n.mrs.rolls,Object.keys(n.msgs).forEach(function(e){var i=n.msgs[e],a=i.peerId;t.rolls.peer[a]=[i.id],t.reached.peer.after[a]=!0}),t.mrs=n.mrs)},injectMsg:function(e){var t;a.injectMail({msgs:(t={},t[e.id]=e,t)})},resetMail:function(){i.mail={}}};window.storeMethods=a,window.store=i},"GR/G":function(e,t,n){var i=n("/8IX"),a=n("HN+/"),o=3;function r(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||s(e)!==s(t)?e:(a(e,t),l(e,t),t):null:e}function s(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function l(e,t){for(var n,i,a,o,s=0,l=0;n=t.childNodes[l],i=e.childNodes[l-s],n||i;l++)if(i)if(n)if(c(i,n))(a=r(i,n))!==n&&(t.replaceChild(a,n),s++);else{o=null;for(var u=l;u<t.childNodes.length;u++)if(c(t.childNodes[u],i)){o=t.childNodes[u];break}o?((a=r(i,o))!==o&&s++,t.insertBefore(a,n)):i.id||n.id?(t.insertBefore(i,n),s++):(a=r(i,n))!==n&&(t.replaceChild(a,n),s++)}else t.appendChild(i),s++;else t.removeChild(n),l--}function c(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(e.type===o&&e.nodeValue===t.nodeValue)}e.exports=function(e,t,n){if(i.equal(typeof e,"object","nanomorph: oldTree should be an object"),i.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly)return l(t,e),e;return i.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),r(t,e)}},GVTI:function(e,t,n){"use strict";n.r(t);var i=n("vOib"),a=n("rc7J"),o=n("fdw3"),r=n("29dZ");var s=function(e){var t=e.btns||e.inner||[];e.nowrap&&(t=t.map(function(e){return e.nowrap=!0,e}));var n,i=Bem.class("BtnStack",{stretchOnSmallScreens:e.stretch_on_small_screens,table:e.nowrap}),a=t.map(function(e){if(!e)return null;var t=["BtnStack__btn"];e.class&&(t=Object(o.extend)(t,[e.class])),e.mix&&(t=Object(o.extend)(t,[e.mix]));var n=0;if(t.filter(function(e){return t.indexOf(e)===n++}),e.class=t,!!e._&&e._.__is_wd_internal_data||(e=Object(o.extend)(Object(r.default)(e),{nowrap:e.nowrap,is_icon:e.is_icon})),e.nowrap){var i=Bem.class("BtnStack__cell",{icon:e.is_icon});return delete e.nowrap,{inner:[e],class:i,tag:"div"}}return e});return e.after&&(n={class:Bem.class("BtnStack__cell",e.after_mix),inner:e.after}),{inner:[a[0]?a:null,n],class:i,tag:"div"}},l=n("Q8gl"),c=n("0Nfb"),u=n("O5lf");function d(e){var t="wi_like_wrap";return e.liked_people||(t+=" is_empty"),{inner:[e.photo.caption?{inner:[Wd.wrap(e.photo.caption)],class:"PhotoviewPage__caption",tag:"div"}:null,e.photo.description.full?{inner:[Object(c.default)({inner:[e.photo.description.full],short:e.photo.description.short})],class:"PhotoviewPage__description",tag:"div"}:null,{inner:[e.liked_people?e.liked_people:null],class:t,tag:"div"},e.buttons?{inner:[{inner:[e.buttons],class:"wi_buttons",tag:"div"}],class:"wi_buttons_wrap",tag:"div"}:null,e.author,e.replies],class:"PhotoviewPage__footer",tag:"div"}}function _(e){var t=window.lang;return{inner:[{inner:[e.edit_data.rotate.can_rotate?s({inner:[Object(r.default)({inner:[t.mobile_photos_edit_rotate_left],url:e.edit_data.rotate.left,stretch:!0}),Object(r.default)({inner:[t.mobile_photos_edit_rotate_right],url:e.edit_data.rotate.right,stretch:!0})],nowrap:!0}):null,{inner:[{inner:[t.mobile_photos_edit_desc_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.photo.description.full],name:"text",class:"textfield",rows:"4",tag:"textarea"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[{inner:[t.mobile_photos_edit_album_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.edit_data.albums.map(function(e){return{inner:[e.name],selected:e.selected?"selected":null,value:e.id,tag:"option"}})],name:"aid",tag:"select"},{inner:[Object(l.default)({withoutWrap:!0,name:"cover",label:t.mobile_photos_edit_cover_label,type:"checkbox"})],class:"fi_subrow",tag:"div"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[s({inner:[Object(r.default)({inner:[t.mobile_photos_edit_save_btn],type:"submit"}),Object(r.default)({inner:[t.mobile_cancel],theme:"link",url:e.edit_data.back_url})]})],class:"fi_row",tag:"div"}],action:e.edit_data.action,method:"post",tag:"form"}],class:"form_item",tag:"div"}}function f(e){return void 0===e&&(e=[]),{inner:[Object.keys(e).map(function(t){return{inner:[{class:"fill",tag:"div"}],class:"pv_tag",id:"pv_tag"+t,style:function(e){if(!e||!e[0])return"";var t=e[0];return"left: "+t[0]+"%; top: "+t[1]+"%; width: "+t[2]+"%; height: "+t[3]+"%"}(e[t]),tag:"div"}})],class:"PhotoviewPage__tags",tag:"div"}}var p=function(e){void 0===e&&(e={});var t=e.info||{},n=e.photo||{},r=e.is_loading||!1,s=e.navigation_buttons||{},l=Object(o.concatValues)("PhotoviewPage ",e.class);e.info&&(e.author=Object(a.default)({url:t.url,author_url:t.author_url,avatar:t.avatar,title:t.title,subtitle:t.subtitle,withoutBottomBorder:!e.has_replies})),e.photo||(e.photo={}),e.photo.description||(e.photo.description={});var c="",p=null;return r&&(l=Object(o.concatValues)(l," PhotoviewPage--skeleton"),n.width?c+=" width"+e.width+"px;":p=Wd.wrap(Object(u.default)({mix:"al_loading",type:"pageLoader"}))),Object(i.default)({inner:[{inner:[{inner:[p||{inner:[{src:n.src,style:c,tag:"img"},f(e.tags)],class:"PhotoviewPage__photo",href:n.href,tag:"a"},s],class:"PhotoviewPage__thumb",tag:"div"},e.edit_mode?_(e):d(e)],id:e.photo.id,tag:"div"}],class:l})};n.d(t,"_PhotoviewPage_tags",function(){return f});t.default=p},GtpT:function(e,t,n){"use strict";n.r(t);var i=function(e){var t,n=e.album,i=n.url,a=n.title,o=n.photos_count_label,r="AlbumItem al_album";return n.thumb?t=n.thumb:r+=" AlbumItem--empty",{inner:[{inner:[{class:"AlbumItem__thumb",style:"background-image: url("+t+")",tag:"div"}],class:"AlbumItem__thumbWrap",tag:"div"},{inner:[{inner:[a],class:"AlbumItemInfo__title",tag:"div"},{inner:[o],class:"AlbumItemInfo__subtitle",tag:"div"}],class:"AlbumItemInfo",tag:"div"}],href:i,class:r,onclick:e.onClick,tag:"a"}},a=n("OcsD");function o(e){if(!e.classList.contains("AlbumItem"))return{};var t=Object(a.val)($(".AlbumItemInfo__title",e))||"",n=Object(a.val)($(".AlbumItemInfo__subtitle",e))||"",i=e.getAttribute("href"),o=$(".AlbumItem__thumb",e),r=/url\((.*)\)/.exec(o.style.backgroundImage),s=r&&r[1];return{album:{title:Wd.wrap(t),photos_count_label:n,url:i,thumb:s},onClick:e.getAttribute("onclick")}}n.d(t,"getDataFromDOM",function(){return o});t.default=i},Gzds:function(e,t,n){"use strict";n.r(t);var i,a,o=n("+cqQ"),r=n("wkhI"),s={curGif:null,onStickersTabSelected:Object(o.default)(),onStickerClick:Object(o.default)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var o=!1;if(each(i,function(e,t){if("submit"===t.type)return o=t,!1}),o)return append(a,i),window.al&&n.ver?nav.go(o,t):i.submit()}return!0},saveDraft:function(e,t,n,i){if(e&&e.preventDefault(),!i||!i.classList.contains("CreatePostButtons__item--disabled")){var a=ge("feed_add_form"),o=qs2obj(nav.params),s={act:"post",save_draft:1,redirect:n,hash:t};o.comment&&(s.comment=o.comment),each(a.elements,function(e,t){if(!["submit","file"].includes(t.type)){if(Object(r.isFieldIgnored)(t))return;s[t.name]="checkbox"===t.type?(+t.checked).toString():t.value}}),ajax.post(window.nav.path,s)}},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var a=geByClass1("wi_actions_wrap",i),o=geByClass1("wi_actions",a),r=geByClass1("wi_actions_btn",i);s.wallActionsHide(),addClass("wi_actions_opened",i);var l=getY(i)+45+getH(o)+7,c=scrollTop()+getCh();toggleClass("wi_actions_top",a,l>c),n.addHandler(s.wallActionsHide),n.show(a,r)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,a){return void 0===a&&(a=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?s.hideGif(e,t,a):(a||Gif.autoplayTest(),s.showGif(e,t,n,a))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach(function(n,i){n!==e&&s.hideGif(n,!1,t)})},showGif:function(e,t,n,o){var r=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(r.loadedGifs||(r.loadedGifs={}),!r.loadedGifs[e.href]&&!confirm(n))return!1;r.loadedGifs[e.href]=!0}if(clearInterval(i),!o){var l=getY(e),c=scrollTop();scrollTop(c-(l-getY(e)))}geByClass("current_gif","mcont").forEach(function(e,t){s.hideGif(e,!1,o)});var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports();if(u){var d=geByClass1("ph_img",e).src;a&&"VIDEO"===a.tagName&&(a.pause(),a.src="",a.load()),(a=ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:d},{position:"relative"})).setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.setAttribute("controls",!0),a.controls=!1,a.load()}else a=ce("img",{src:e.href,className:"gif_original"});addClass("current_gif gif_loading",e);var _=function(t,n){hasClass("current_gif",e)&&(replaceClass("gif_loading","gif_opened",e),append(a,e),s.curGif=e,n&&n())};return u?a.oncanplay=function(){e!==s.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,o?1:0),_())}:i=setInterval(function(){a.complete&&(statlogsValueEvent("gif_play",0,"gif",null,o?1:0),_(),clearInterval(i))},100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach(function(e){remove(e)}),!n){var i=Gif.getState(),a=i.currentAutoplayElement,o=i.ignore;a===e&&(o.push(e),Gif.setState("ignore",o))}return s.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,function(){t.push(escapeRE(this[0]))}),new RegExp("^("+t.join("|")+")")},replyTo:function(e,t,n,i,a){var o=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var r=ge("nc_form"),l=ge("nc_message"),c=geByClass1("nc_reply_name",r),u=gpeByClass("near_btn",c),d=ge("nc_reply_as"),_=val(l),f=s.replyNamesRE();if(n){var p=ge(t+"_"+n),h=getY(p)+getH(p),m=scrollTop();after(r,p),addClass("nc_current_reply",geByClass1("pi_reply_wrap",p)),scrollTop(m+getY(p)+getH(p)-h);var v=o.replyNames[i]||{},A=v[0]||"",g=v[1]||"";_=_?f?_.replace(f,A):_:A,s.onReplyClick(!0,A)}else{append(r,geByClass1("wall_replies")),scrollToEl(r);g="";_=f?_.replace(f,""):_}return val(l,replaceEntities(_)),val(c,g),toggle(u,n),d&&(val(d,+a),toggleClass("cp_post_as_group",r,+a)),val("nc_reply_to",n),o.replyTo=n,elfocus(l),!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=ge("stickers_panel");if(n){var i=geByClass1("sp_body",n),a=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push(function(){e.scroller.destroy()}),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(a),e.tabScroller.init(),e.destroy.push(function(){e.tabScroller.destroy()}),s.onStickersInit(!0)}}},stickersToggle:function(e,t){var n=window.cur;if(!n.stickers)return!0;isUndefined(t)&&(t=!isVisible("stickers_panel"));var i=ge("write_form")||ge("nc_form"),a=ge("stickers_panel"),o=geByClass1("cp_sticker_btn",i);return!a||(toggle(a,t),toggleClass("cp_sticker_btn_sel",o,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach(function(e){return e(t)}),!1)},stickersClick:function(e,t){var n=window.cur;return n.stickers&&n.stickers[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),s.stickersToggle(null,!0),s.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getStickersTabHTML:function(e){var t=cur.stickers[e],n=window.isNewMail?16:8,i=[];if(t&&t.length)for(var a=0;a<t.length/n;a++)i.push(t.slice(a*n,a*n+n));var o=i.map(function(e){return'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map(function(e){var t=s.fromStickerToObject(e),n=t.id,i=t.size,a=t.url,o=t.animationUrl,r=t.recent,l=t.ref,c="",u="";return o&&(c=" sticker_animation",u='\n          data-animation-path="'+o+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+c+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(r)+", '"+l+"');\"")+" "+u+'>\n              <img src="'+a+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '}).join("\n")+"\n          </div>\n        </div>\n      "}).join("\n"),r='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",l=i.map(function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '}).join("\n");return'\n        <div class="sp_cont scroller_wrap">\n          <div class="scroller_cont">\n            '+(t&&t.length?o:r)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(i.length>1?l:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),a=geByClass1("sp_body",i),o=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(a,s.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",o),addClass("sp_tab_selected",e);var r=getY(i),l=r+getW(i),c=scrollTop(),u=c+getCh();return(r<c||l>u)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),window.isNewMail&&s.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){var i=window.cur,a=gpeByClass("sticker_item",e);if(i.stickers&&a){var o=Object.keys(i.stickers).reduce(function(e,n){return e||i.stickers[n].find(function(e){return s.fromStickerToObject(e).id===t})},null);if(!o)throw new Error("Sticker "+t+" not found");var r=s.fromStickerToObject(o),l=r.id,c=r.size,u=r.url,d=r.animationUrl;i.stickers[-1]=i.stickers[-1]||[],i.stickers[-1]=i.stickers[-1].filter(function(e){return s.fromStickerToObject(e).id!==l}),i.stickers[-1].unshift(s.fromObjectToSticker({id:l,size:c,url:u,animationUrl:d,recent:1,ref:"recent"})),i.stickers[-1]=i.stickers[-1].filter(function(e,t){return t<(window.isNewMail?16:8)}),n&&s.stickersSelectTab(!1,-1)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&s.onStickerClick(t,i))return s.addRecentSticker(e,t,!1),!1;var a=window.cur;if(a.scroller&&!a.scroller.canClick())return!1;s.stickersToggle(e,!1);var o=ge("write_submit"),r={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(r.url_params.media_from="recent"),a.ref&&(r.url_params.ref=a.ref,a.ref=void 0),a.refSource&&(r.url_params.ref_source=a.refSource,a.refSource=void 0),!i){var l=attr(e,"href");l&&(i=l.split("sticker_referrer=")[1].split("&")[0])}return i&&(r.url_params.sticker_referrer=i),s.addRecentSticker(e,t,n),o?ajax.click(o,extend({save:!0},Dialog),r):(o=ge("nc_submit"))?(setTimeout(function(){Replies.setCurrentTimestamp(0)},0),ajax.click(o,{},r)):void 0},toggleMarkAsAds:function(e,t){cancelEvent(t);var n=$("input[name='from_group']");if(!n||n.checked){var i=$("input",e);i.checked=!i.checked;var a=$("input[name='mute_notifications']");a&&(a.checked=i.checked,a.disabled=i.checked),s.checkCopyright()}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input");n.checked=!n.checked;var i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications"]},a=$("input[name='marked_as_ads']");$$(".Control.Control_type_switcher.Row").forEach(function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)n.checked&&!i.group.includes(t.name)?t.disabled=!n.checked:!n.checked&&i.user.includes(t.name)&&(t.disabled=!n.checked),"mute_notifications"===t.name&&a&&a.checked&&(t.disabled=!0);else{var o=$(".header__user"),r=$(".header__group"),s=$("#select-timer"),l=$("input[name=postpone]"),c=$("input#add_post_btn");if(n.checked?(o.classList.add("header_hidden"),r.classList.remove("header_hidden"),s.style.display="inline-block",l.disabled=!1):(o.classList.remove("header_hidden"),r.classList.add("header_hidden"),s.style.display="none",l.disabled=!0),c){var u=c.value;c.value=c.dataset.value,c.dataset.value=u}}}}),s.checkCopyright()},checkCopyright:function(){var e=$("input[name='marked_as_ads']"),t=$("input[name='from_group']"),n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option");if(n){var o=$(".Btn",a),r=$(".Btn__text",o);e&&e.checked&&(!t||t.checked)?(hide(n),attr(o,"disabled",!0),a.classList.add("create_post__source-option--disabled"),r.innerHTML=getLang("mobile_wall_post_copyright_add_button")):(attr(o,"disabled",!1),a.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),r.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):r.innerHTML=getLang("mobile_wall_post_copyright_add_button"))}}};t.default=s,window.post=s},HGMY:function(e,t,n){"use strict";n.r(t);n("TYsd");var i=n("/Id8"),a=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}};function o(e){var t=store.mail,n=t.members[e.authorId],a=e.peerId,o=t.peers[a],r=Object(i.Msg__authorName)(n,a,t.cur.userId);return Object(i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:r,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:o.isChannel&&o.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,maxDepth:store.mail.cur.maxMsgDepth})}var r=n("UxAg");function s(){return Object(r.$)(".MailPreSendList__box")}function l(e){s().innerHTML=e.map(function(e){return o(e)}).join("")}function c(e){s().insertAdjacentHTML("beforeend",o(e)),MailScrap.peerGoToBottom()}function u(e){var t=i.default.getElem(e.sendId);t&&t.remove()}function d(e){return i.default.getElem(e.sendId)}n.d(t,"MailPreSendList__Msg",function(){return o}),n.d(t,"getElem",function(){return s}),n.d(t,"setMsgs",function(){return l}),n.d(t,"addMsg",function(){return c}),n.d(t,"removeMsg",function(){return u}),n.d(t,"getMsg",function(){return d});t.default=a},"HN+/":function(e,t,n){var i=n("vOyG"),a=i.length,o=1,r=3,s=8;function l(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}e.exports=function(e,t){var n=e.nodeType,c=e.nodeName;n===o&&function(e,t){for(var n=t.attributes,i=e.attributes,a=null,o=null,r=null,s=null,l=i.length-1;l>=0;--l)s=i[l],r=s.name,a=s.namespaceURI,o=s.value,a?(r=s.localName||r,t.getAttributeNS(a,r)!==o&&t.setAttributeNS(a,r,o)):t.hasAttribute(r)?t.getAttribute(r)!==o&&("null"===o||"undefined"===o?t.removeAttribute(r):t.setAttribute(r,o)):t.setAttribute(r,o);for(var c=n.length-1;c>=0;--c)!1!==(s=n[c]).specified&&(r=s.name,(a=s.namespaceURI)?(r=s.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttributeNS(null,r)||t.removeAttribute(r))}(e,t);n!==r&&n!==s||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);"INPUT"===c?function(e,t){var n=e.value,i=t.value;l(e,t,"checked"),l(e,t,"disabled"),n!==i&&(t.setAttribute("value",n),t.value=n);"null"===n&&(t.value="",t.removeAttribute("value"));e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===c?function(e,t){l(e,t,"selected")}(e,t):"TEXTAREA"===c&&function(e,t){var n=e.value;n!==t.value&&(t.value=n);if(t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t);!function(e,t){for(var n=0;n<a;n++){var o=i[n];e[o]?t[o]=e[o]:t[o]&&(t[o]=void 0)}}(e,t)}},HPEO:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("Mc5h"),s=n("9y81"),l=n("AXyT"),c=n("gy8s"),u=n("29dZ"),d=n("Y6JH"),_=n("/Id8");n("BoyB");function f(){var e=Object(i.default)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return f=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return m=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return v=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return A=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return g=function(){return e},e}function b(){var e=Object(i.default)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return y=function(){return e},e}function w(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return w=function(){return e},e}function k(){var e=Object(i.default)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return k=function(){return e},e}function S(){var e=Object(i.default)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n      </div>\n    "]);return S=function(){return e},e}var C=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel)return"";var l=i.kickedMessage||e.mobile_msg_mail_privacy_error,u=Object(s.default)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"});return a.default.html(S(),u,l)}var _=a.default.onSubmit("uMailWrite._onSubmit","event","this"),f=a.default.onClick("uMailWrite.onToBottomClick"),p=Object(r.default)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:""}),h=j(null),m=T(n),b=function(e){var t=window.lang,n=store.mail,i=n.cur,r=n.queue,l=a.default.onMouseDown("uMailWrite._onStickersClick","event"),u=a.default.onMouseDown("uMailWrite._onKeyboardClick","event"),_=n.peers[e],f=i.groupId,p=Math.abs(f),h=f?"&community="+p:"",m=Object(c.default)({icon_html:o.default.html(Object(d.default)("base","attach_outline_28")),name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:Object(d.default)("mail-attachments","picture_outline_28")},{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+h,icon:Object(d.default)("mail-attachments","camera_outline_28")},{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+h,icon:Object(d.default)("mail-attachments","video_outline_28")},{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+h,icon:Object(d.default)("mail-attachments","music_outline_28")},{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+h,icon:Object(d.default)("mail-attachments","document_outline_28")},_.canSendGift?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:Object(d.default)("mail-attachments","gift_outline_28")}:null,_.canAttachMoney?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+h,icon:Object(d.default)("mail-attachments","money_transfer_outline_28")}:null,_.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+h,icon:Object(d.default)("mail-attachments","poll_outline_28"),mix:"uMailWrite__pollUnfoldItem"}:null]}),v=a.default.onKeyUp("uMailWrite._onKeyUp"),g=a.default.onInput("uMailWrite._onInput","event","this"),b=a.default.onKeyDown("uMailWrite._onKeyDown","event","this"),w=a.default.onFocus("uMailWrite._onFocus","event","this"),k=a.default.onBlur("uMailWrite._onBlur","event","this"),S=a.default.onClick("uMailWrite._onClick","event","this"),C=a.default.onTouchEnd("uMailWrite._onSendTouchEnd","event","this"),O=o.default.html({class:"uMailWrite__buttonSendIcon Icon_send",inner:Object(d.default)("base","send_outline_28")}),j=o.default.html({class:"uMailWrite__buttonSendIcon Icon_send Icon_active",inner:Object(d.default)("base","send_outline_28")}),T=E("accept"),I=E("remove"),M=E("templates"),x=E("templatesActive"),P=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"}),B=o.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker",inner:Object(d.default)("base","smile_outline_28")}),L=o.default.html({class:"uMailWrite__buttonStickersIcon Icon_sticker Icon_active",inner:Object(d.default)("base","smile_outline_28")}),R=a.default.html(A()),D=_.attachmentsHTML.length,N=i.msgAttached[i.peerId],H=N&&N.length,V=!!(r[i.peerId]||[]).length,F=a.default.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(D>150||H),loading:V});return a.default.html(y(),m,u,R,l,B,L,F,C,O,j,P,T,I,M,x,t.mobile_mail_message_placeholder,w,v,g,b,w,k,S)}(n),w=a.default.html(g()),C=function(){var e=window.lang,t=Object(s.default)({icon:"plus"}),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,o="/mail?act=template&from="+n+i,r=a.default.onClick("uMailWrite.loadTemplatePage","event","this",o);return a.default.html(v(),e.mobile_mail_templates_panel_title,o,r,t)}(),I=O(),M=a.default.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});return a.default.html(k(),M,n,i.hashSend,t.cur.communityParam,_,f,I,h,m,b,p,w,C)};function O(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,o=i?Object(l.default)({mix:"uMailWrite__toBottomValue",value:i}):"",r=Object(s.default)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"});return a.default.html(w(),o,r)}function E(e){return a.default.html(b(),e)}function j(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,o=t.msgReply[i],r=null;o&&(r=store.mail.forwards[o]||store.mail.msgs[o]);var s="",l="";if(r){var c=Object(_.Msg__authorName)(n[r.authorId],i,t.userId);s=Object(_.Msg__reply)(r,c,e),l='\n      <input type="hidden" name="attached_messages" value="'+o+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(l+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=a.default.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:a.default.onClick("uMailWrite.onReplyClose")});return a.default.html(m(),u,s,d,l)}function T(e){var t,n=store.mail,i=n.cur,o=n.peers[e].attachmentsHTML,r=a.default.class("uMailWrite__attachments",((t={})[e]=!0,t)),l=i.msgAttached[e]||[],c=l.length,u="";c>0&&(u=function(e,t){var n=window.lang,i=a.default.onClick("uMailWrite.onAttachedMsgsRemove"),o=Object(s.default)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"}),r=Object(s.default)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i}),l=langNumeric(e,n.mobile_mail_messages),c=function(e){return a.default.html(f(),e)}(t);return a.default.html(p(),c,r,o,l)}(c,l.join(";")));return a.default.html(h(),r,u,o)}var I=n("UxAg"),M=n("+cqQ"),x=n("jk6M"),P=n("rKp0"),B=(n("u33z"),n("V4qE")),L=n("HGMY"),R=n("t7Ww"),D=n("r/ag"),N=2147483647;function H(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(function(e,t){return e+t}))}}catch(e){}return intval(rand(0,N).toFixed(0))}var V=n("9M99"),F=n("H5mD"),U=n("aiw/"),$=n("Qz23"),q=n("jE6c"),W=n("UlUB"),z=n("hw56"),Q=n("j80l"),Y=n("wcVR"),G=n("B+U2");function X(e){var t=e.length,n=!t;return o.default.html([K(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map(function(e,n){return function(e,t,n){var i=t>0&&t===n-1,r=store.mail.cur.communityParam,s=store.mail.cur.peerId,l=e.name,u=e.text;l=Object(V.emojiToHTML)(l),u=J(u,!0);var d="_touched uMailWrite__templatesRow";d+=" uMailWrite__templatesRow"+e.id,e.deleting&&(d+=" uMailWrite__templatesRow_hidden");return{class:d,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:o.default.html(l)},{class:"uMailWrite__templatesRowText",inner:o.default.html(u)}]},{class:"uMailWrite__templatesRowMore",inner:[o.default.wrap(Object(c.default)({mix:"",icon:"more",position:i?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+r+"&from="+s},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:a.default.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)})}])}function K(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=a.default.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},Object(u.default)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function J(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,a=store.mail.cur,o=i[a.peerId],r=i[a.userId],s=i[a.groupId],l=o.name.replace(o.firstName,"").trim(),c=r.name.replace(r.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,o.firstName)).replace(/{user surname}/g,l)).replace(/{admin name}/g,r.firstName)).replace(/{admin surname}/g,c)).replace(/{community}/g,s.name)).match(/{greeting}/g)){var u,d=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());u=d>=3&&d<12?lang.mobile_mail_templates_greeting_morning:d>=12&&d<17?lang.mobile_mail_templates_greeting_afternoon:d>=17&&d<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,u)}return t&&(e=Object(V.emojiToHTML)(e)),e}var Z=n("HdGT"),ee=n("qHA9");Object.assign(C,{onToBottomClick:Object(M.default)(),onAttachedMsgsRemove:Object(M.default)(),onReplyClose:Object(M.default)(),onMessage:Object(M.default)(),showToBottom:function(){if(de)return;_e&&(clearTimeout(_e),_e=null);addClass("uMailWrite__toBottom_visible",Object(I.$)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(fe),_e=setTimeout(function(){removeClass("uMailWrite__toBottom_visible",Object(I.$)(".uMailWrite__toBottom"))},100)},preventShowToBottom:function(){de=!0,setTimeout(function(){de=!1},300)},openStickersPanel:Te,redrawReply:Fe,uiRedrawAttachments:Ue,redrawToBottom:function(){Object(I.$$)(".uMailWrite__toBottom").forEach(function(e){return e.innerHTML=O()})},drawStickers:Oe,setModifiers:function(e){Object(I.$$)(".uMailWrite").forEach(function(t){var n=a.default.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",a.default.class("uMailWrite",Object.assign({},n,e)))})},hideStickersPanel:je,setText:ot,renderKeyboardIfNeeded:st,openKeyboard:ct,init:function(){var e=store.mail,t=e.cur,n=(e.msgs,e.pendingReplies),i=t&&Object(z.getPeerDraft)(t.viewerId,t.peerId);i&&!t.editing&&i.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;Object(I.$$)(".uMailWrite__textarea").forEach(function(e){return e.value=n});var i=Object(I.$)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");Ae()}(i.text);"templates"===Object(z.getKeyboardType)()?Re():st();ht(),ye(),i&&!t.editing&&Array.isArray(i.msgs)&&(t.msgAttached[t.peerId]=i.msgs);if(i&&!t.editing&&isFinite(i.reply)){var a=_.default.getReplyDataFromHTML(i.reply);a&&(t.msgReply[t.peerId]=i.reply,n[i.reply]=a)}Fe(),Ue(t.peerId),Object(I.$$)(".uMailWrite__textarea").forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,overscrollY:!1})}),Object(I.$$)(".uMailWrite__attachments").forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,allowY:!1})})},reset:function(){Object(z.setKeyboardType)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)}}),uVK.onReady(be),C._onBlur=Je,C._onKeyUp=We,C._onKeyDown=Ge,C._onFocus=Ke,C._onInput=ze,C._onSubmit=$e,C._onClick=Xe,C._onAttachClick=Ne,C._onStickersClick=Ee,C._onKeyboardClick=Ie,C._onKeyboardButtonClick=Me,C._onDeleteTemplate=dt,C._onConfirmDeleteTemplate=_t,C._onSendTouchEnd=qe,C._onRetryFailedMsg=vt,C._onDeleteFailedMsg=At,C._onCancelPendingMsg=gt,C._onConfirmSendGeo=xe,mediaUpload.onRemove(we),mediaUpload.onComplete(Ce),mediaUpload.onStart(ke),mediaUpload.onError(Se),post.onStickersTabSelected(He),post.onStickerClick(Ve),Z.onSent(pt),Z.onErrorMessage(bt),_.default.onPendingClick(mt),c.default.onOpen("uMailWrite_attachments")(ve),C.onToBottomClick(function(){var e=Object(I.$)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),P.default.removeDivider()}),C.onReplyClose(function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,Object(z.setPeerDraft)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),Fe()}),C.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some(function(e){if(e.id===n)return i=e,!0}),i&&ot(J(i.text)))},Mention.onOpen(function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},function(e){Object.assign(store.mail.members,e);var t=Qe(n);Mention.update({items:t,defaultItems:t})},function(){t[n]=!1}))}});var te,ne,ie="uMailWrite__popupAttach_open",ae="uMailWrite__popupStickers_open",oe="uMailWrite__keyboard_open",re="uMailWrite__templates_open",se=!1,le=8,ce={canAttachPoll:"uMailWrite_canAttachPoll"},ue={mailWrite:".uMailWrite",pollAttachment:".attachment_type_poll"},de=!1,_e=null,fe=null,pe=[],he=Object(W.default)(et,100),me=Object(W.default)(Ze,1e3);function ve(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}Object(I.$$)("a.Unfold__item").forEach(function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)}),Object(I.$$)("input.inline_upload").forEach(function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))})}function Ae(){var e=Object(I.$)(".uMailWrite__textareaGhost").offsetHeight;Object(I.$$)(".uMailWrite__textarea").forEach(function(t){return setStyle(t,"height",e)}),Object(I.$$)(".uMailWrite__main").forEach(function(t){return setStyle(t,"height",e+le)}),et()}function be(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,Object(I.$$)(".uMailWrite__attachments").forEach(function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)}),function(){var e=Object(I.$)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=Object(I.$)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",at,!0):e.removeEventListener("mousedown",at,!0)}()}}}function ye(){var e=store.mail.cur;e&&e.peerId&&(pe=Qe(e.peerId),Mention.init({defaultItems:pe,items:pe,appendTo:geByClass1("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=Object(I.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,Ae(),Ze(i,e.viewerId,e.peerId)}}))}function we(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,Ue(a)),e.closest(ue.pollAttachment))Object(I.$)(ue.mailWrite).classList.add(ce.canAttachPoll)}}function ke(){store.mail.cur&&(be(),et())}function Se(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&(Ue(n),Messenger.scrollConvoToBottom())}}function Ce(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,et())}}function Oe(){var e=store.mail.cur,t=Object(I.$)(".uMailWrite__popupStickers");e&&t&&!t.childElementCount&&(t.innerHTML=e.stickersPanelHTML.replace(/mail0/g,"mail"+e.peerId),Object(I.$$)(".sp_body",t).forEach(function(e){Object($.setScrollView)(e,{topBanner:!1})}),Object(I.$$)(".scroller_wrap",t).forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,allowY:!1})}),post.stickersSelectTab(null,-1))}function Ee(e){var t=Object(I.$)(".uMailWrite__popupStickers"),n=hasClass(ae,t);e.preventDefault(),Oe(),ut("stickers"),n?je():Te()}function je(){"stickers"===Object(z.getKeyboardType)()&&Object(z.setKeyboardType)("");var e=Object(I.$)(".uMailWrite__popupStickers");removeClass(ae,e),tt(!1);var t=ge("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none")}function Te(){Object(z.setKeyboardType)("stickers");var e=Object(I.$)(".uMailWrite__popupStickers");addClass(ae,e),post.stickersInit(),tt(!0)}function Ie(e){var t=Object(I.$)(".uMailWrite__keyboard"),n=hasClass(oe,t);e.preventDefault(),ut("buttons"),n?Pe({store:!0}):Be({store:!0})}function Me(e,t,n){var i,o=n.authorId,r=n.inline,s=n.msgId,l=JSON.parse(Object(q.replaceEntities)(n.action)),c=l.type,d=l.payload,_=l.rawLabel,f=store.mail,p=f.cur,h=f.members,m=f.peers,v=f.msgs,A=h[o],g=H();if(s){var b=v[s];i=b.peerId}else i=p.peerId;var y,w=m[i],k=_||"";if(i>=2e9)if(A.domain)y="@"+A.domain+" "+k;else{var S=A.url.replace(/^\//,"");y="@"+S+" ("+A.firstName+") "+k}else y=k;var C=c,O=r?"inline":"normal";if("open_app"===C&&(C="app"),statlogsValueEvent("message_send_from_keyboard",0,p.viewerId,i,o,C,O),"vkpay"!==c)if("open_app"!==c)if("open_link"!==c){if("location"!==c)it({act:"send",to:i,from:"dialog",hash:w.hashSend,message:y,media:"",_af:p._af,random_id:g,payload:d}),r&&!p.peerId&&nav.go(Object(Q.makeUrl)("/mail",{act:"show",peer:i,community:nav.getQuery("community")}));else Y.default.init()?(u.default.setLoading(e,!0,"blue"),Y.default.getCurrentPosition(function(t){var n=t.coords,o=n.latitude,r=n.longitude;u.default.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmSendGeo",o,r,d,y,i)})},function(){u.default.setLoading(e,!1),B.init({text:lang.mobile_mail_geo_not_available})},{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):B.init({text:lang.mobile_mail_geo_not_available})}else{var E=function(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}(l.link,!0);nav.hard_go(E)}else{var j=l.app_id,T=l.hash,I=Object(Q.makeUrl)("/app"+j,{from:nav.cur.slice(1)});nav.go(I+"#"+T)}else{var M=l.hash,x=Object(Q.makeUrl)("/app6217559",{from:nav.cur.slice(1)});nav.go(x+"#"+M)}}function xe(e,t,n,i,a){var o=store.mail,r=o.cur,s=o.peers[a],l=H();it({act:"send",to:a,from:"dialog",hash:s.hashSend,message:i,media:"",_af:r._af,random_id:l,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go(Object(Q.makeUrl)("/mail",{act:"show",peer:a,community:nav.getQuery("community")}))}function Pe(e){"buttons"===Object(z.getKeyboardType)()&&Object(z.setKeyboardType)("");var t=Object(I.$)(".uMailWrite__keyboard");if(removeClass(oe,t),nt(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(te[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",te))}}function Be(e){Object(z.setKeyboardType)("buttons");var t=Object(I.$)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass(oe,t),nt(!0);var i=Object(z.getKeyboardState)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=o.default.render(Object(G.default)({keyboard:i.keyboard})),r=Object(I.$)(".uMailWrite__keyboard");r.innerHTML=a,Object($.setScrollView)(r,{topBanner:!1}),Object(z.getKeyboardState)(t.peerId).rendered=!0}(),e&&e.store&&Le()}function Le(){var e=store.mail.cur.peerId;te&&(delete te[e],lsSet("mail_keyboard_hidden",te))}function Re(){Object(z.setKeyboardType)("templates");var e=Object(I.$)(".uMailWrite__templates");addClass(re,e),et(),lt()}function De(){"templates"===Object(z.getKeyboardType)()&&Object(z.setKeyboardType)("");var e=Object(I.$)(".uMailWrite__templates");removeClass(re,e),et()}function Ne(e){var t=Object(I.$)(".uMailWrite__popupAttach"),n=Object(I.$)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(ae,n)&&removeClass(ae,n),hasClass(ie,t)?removeClass(ie,t):(addClass(ie,t),addEvent(window,"click",function e(n){removeClass(ie,t);removeEvent(window,"click",e)}))}function He(){store.mail.cur&&(geByClass1("sp_body")&&(cur.scroller&&cur.scroller.destroy(),geByClass1("sp_body").scrollTop=0,removeClass("scroller_wrap",geByClass1("sp_cont")),geByClass("sp_page").forEach(function(e){return removeClass("scroller_page",e)})))}function Ve(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,o=(geByClass1("uMailWrite"),Object(I.$)(".uMailWrite__popupStickers")),r=H(),s=0===t.indexOf("suggestion"),l={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:r,sticker_referrer:t},c=i.msgReply[i.peerId];if(c&&(l.attached_messages=c,l.has_reply=!0,Object(z.setPeerDraft)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),s){var u=Object(I.$)(".uMailWrite__textarea");u.value="",Ze("",i.viewerId,i.peerId),ze({},u)}return it(l),et(),Fe(),se&&(removeClass(ae,o),tt(!1)),!0}}function Fe(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var o=n[i];o&&(a=o.preview_url)}else{var r=i&&_.default.getElem(i);if(r){var s=Object(I.$)(".thumbs_map .thumb_map_img_as_div",r);(a=s&&s.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}Object(I.$$)(".uMailWrite__reply").forEach(function(e){e.outerHTML=j(a)})}function Ue(e){Object(I.$$)(".uMailWrite__attachments_"+e).forEach(function(t){t.outerHTML=T(e)}),be(),Object(I.$)(".uMailWrite__textarea")&&et();var t=Object(I.$)(ue.mailWrite);if(t){var n=!!t.$(ue.pollAttachment);t.classList.toggle(ce.canAttachPoll,!n)}}function $e(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=Object(I.$)(".uMailWrite__textarea"),i=store.mail,a=i.cur,o=i.peers,r=H(),s=store.mail.cur.editing,l=s&&store.mail.msgs[s],c=l?{act:"edit_message",id:s,peerId:l.peerId,hash:o[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:o[a.peerId].hashSend,_af:a._af,random_id:r,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!rt())return l?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&!Object(ee.isChatPeer)(a.peerId)&&(t=Object(I.$)(".uMailWrite__templates"),ut("templates"),hasClass(re,t)?De():Re()),!1;each(geByClass1("uMailWrite"),function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(c[t.name]=t.value))))))}),s?(uMailHat.onCancelEditing(!0),it(c)):(it(c),store.mail.cur.mvk_entrypoint="",Object(z.popPeerAttachments)(a.peerId),n.value="",Ze("",a.viewerId,a.peerId),Object(z.setPeerDraft)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,ze({},n)),P.default.onSystemMessageClick(),Ue(a.peerId),Fe(),StickersHints.actualizeVisibility(),F.isIOS?(n.focus(),setTimeout(function(){return n.focus()})):x.default.msie_edge||(n.focus(),requestAnimationFrame(function(){return n.focus()}))}function qe(e){x.default.msie_edge&&(e.preventDefault(),$e(e))}function We(){var e=We,t=e.typingData||(e.typingData={});if(0!==Object(I.$)(".uMailWrite__textarea").value.length&&!store.mail.cur.editing){var n=Date.now(),i=store.mail,a=i.cur,o=i.peers,r=a.peerId;r<=-2e9||t[r]&&n-t[r]<5e3||(t[r]=n,ajaxRequest("/mail",{_ajax:1,act:"typing",peer:r,hash:o[r].hashTyping,community:nav.getQuery("community")}))}}function ze(e,t){var n=Object(I.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,o=n.offsetHeight;Object(I.$$)(".uMailWrite__textarea").forEach(function(e){return setStyle(e,"height",o)}),Object(I.$$)(".uMailWrite__main").forEach(function(e){return setStyle(e,"height",o+le)}),he(),a&&me(i,a.viewerId,a.peerId),Ye(e,t,function(){Mention.onKeyUp(e,t)})}function Qe(e){var t=store.mail,n=t.peers,i=t.members,a=t.cur,o=n[e].memberIds||[],r=[],s=[];return o.forEach(function(e,t){if(e!==a.viewerId){var n=i[e];if(n){var o=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];r.push(o)}else{var l=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];s.push(l)}}}),r.concat(s)}function Ye(e,t,n){pe.length&&(!hasClass("Mention_inited",geByClass1("uMailWrite__main"))&&ye(),n(e,t))}function Ge(e,t){Ye(e,t,function(){Mention.onKeyDown(e,t)}),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&$e()}function Xe(e,t){Ye(e,t,function(){Mention.onClick(e,t)})}function Ke(e,t){Object(z.setKeyboardType)("text");var n=function(){Oe(),ut("text"),StickersHints.init({peerId:store.mail.cur.peerId}),Ye(e,t,function(){Mention.onFocus(e,t)})};F.isIOS?n():requestAnimationFrame(function(){requestAnimationFrame(function(){n()})}),U.onOpen("bottom")}function Je(e,t){if("text"===Object(z.getKeyboardType)()&&Object(z.setKeyboardType)(""),U.onClose(),me._timer&&clearTimeout(me._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,a=n.peerId;Ze(t.value,i,a)}}function Ze(e,t,n){var i=store.mail.cur.editing;Object(z.setPeerDraft)(t,n,{text:e},i)}function et(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t.peerId){var i=!rt(),o=!mediaUpload.checkUploading(),r=!!t.editing,s={sendActive:!i&&!r&&!o,loading:o,editAccept:r&&!i,editRemove:r&&i},l=n.templates&&!(r||!t.groupId||Object(ee.isChatPeer)(t.peerId)||!i||s.loading||s.uploading);s.templates=l&&"templates"!==Object(z.getKeyboardType)(),s.templatesActive=l&&"templates"===Object(z.getKeyboardType)();var c=!(s.sendActive||s.loading||s.editAccept||s.editRemove||s.templates||s.templatesActive);s.disabled=c;var u=a.default.class("uMailWrite__button","uMailWrite__buttonSend",s);Object(I.$$)(".uMailWrite__buttonSend").forEach(function(e){return e.className=u})}}function tt(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});Object(I.$$)(".uMailWrite__buttonStickers").forEach(function(e){return e.className=t})}function nt(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});Object(I.$$)(".uMailWrite__buttonKeyboard").forEach(function(e){return e.className=t})}function it(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,a=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),Z.send(e),a){var o=store.mail.peers[a];if(o&&o.keyboard&&o.keyboard.one_time)o.keyboard=null,Object(z.getKeyboardState)(a).updateTime=Date.now(),st()}et()}}function at(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function ot(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=Object(I.$$)(".uMailWrite__textarea");i.forEach(function(e){return e.value=n}),ze({},i[0])}function rt(){return function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!Object(I.$)(".uMailWrite__textarea").value.trim()}function st(e){if(Object(I.$)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,o=n.peers,r=i.peerId&&o[i.peerId];t=!(i.groupId||!r||r.closed||r.kicked)&&!(!r.keyboard||!r.keyboard.buttons.length);var s=Object(I.$)(".uMailWrite"),l=a.default.parseClass("uMailWrite",s.className);if(l.keyboard!==t&&(s.className=a.default.class("uMailWrite",Object.assign({},l,{keyboard:t}))),Object(z.getKeyboardState)(i.peerId).rendered=!1,t){te||(te=lsGet("mail_keyboard_hidden")||{});var c=r.keyboard,u=te[i.peerId],d=(e&&e.update,!Object(z.getKeyboardType)()||"buttons"===Object(z.getKeyboardType)()||"text"===Object(z.getKeyboardType)()),_=!1;u&&(u==c.chat_local_id?d=!1:_=!0),d?ct("buttons",{store:_}):_&&Le()}else Pe()}}function lt(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=Object(I.$)(".uMailWrite__templatesBody"),o=t.templates;if(a)return o?void function(e,t){e.innerHTML=X(t)}(a,o):(function(e){e.innerHTML=Loading({mix:"uMailWrite__templatesLoading"})}(a),ne||(ne=new Promise(function(e){ajaxRequest("/mail",{act:"get_templates"},function(t){e(t)},function(t){e()})})),void ne.then(function(e){ne=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),lt()}))}}function ct(e,t){switch(ut(e),e){case"stickers":Te();break;case"buttons":Be(t);break;case"text":(n=Object(I.$)(".uMailWrite__textarea"))&&n.focus();break;case"templates":Re()}var n}function ut(e){var t;"stickers"!==e&&je(),"buttons"!==e&&Pe(),"text"!==e&&(t=Object(I.$)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&De()}function dt(e){var t=store.mail.cur.templates.find(function(t){return t.id===e});if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",Object(V.emojiToHTML)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function _t(e){var t=store.mail.cur.templates,n=t.findIndex(function(t){return t.id===e});if(-1!==n){var i=t[n],a=Object(I.$)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},function(n){if(n.error)ft(e);else{var i=t.findIndex(function(t){return t.id===e});t.splice(i,1),lt()}},function(){ft(e)})}MailDialog.close()}function ft(e){var t=store.mail.cur.templates,n=Object(I.$)(".uMailWrite__templatesRow"+e),i=t.findIndex(function(t){return t.id===e}),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var o=lang.mobile_mail_templates_delete_error;o=o.replace("{name}",a.name),B.init({text:o,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}function pt(){P.default.clearSystemMessage2(),remove(geByClass1("message__newMsgsDivider")),remove(geByClass1("Unfold__item_returnToChat"))}function ht(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,a=[],o=n.failed[t.peerId]||[],r=n.pending[t.peerId]||[];(o.length||r.length)&&(o.concat(r).map(function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))C.onMessage(t);else{if(t.reply){var o=_.default.getReplyDataFromHTML(t.reply);o&&(i[t.reply]=o)}a.push(t)}}),L.setMsgs(a))}function mt(e,t,n){var i;n?i=[Object(R.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),Object(R.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[Object(R.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var a=Object(R.default)({class:"",close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});D.default.open(o.default.elem(a),!0)}function vt(e,t){R.default.close(e);var n=store.mail.presend.msgs[t];Object(z.removeFailedMsg)(n),Z.retry(t,function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e})}function At(e,t){R.default.close(e),Z.remove(t)}function gt(e,t){R.default.close(e),Z.remove(t)}function bt(e){B.init({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}t.default=C;window.uMailWrite=C},HdGT:function(e,t,n){"use strict";n.r(t);var i=n("W38l"),a=n("OcsD"),o={},r={},s="idle",l="sending";function c(e,t){var n=o[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),f(e)}function u(e){var t=o[e];t.failed=t.failed.concat(t.pending),t.pending=[],r[e]=s,t.sendingItemId=null,t.onStopped(),f(e)}function d(e){var t=o[e];return t.loaded?Promise.resolve():t.retrieving?t.retrieving:(t.retrieving=function(e){return new Promise(function(t){var n=Object(a.lsGet)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter(function(e){return!!n.items[e]}),n.pending=[],t(n)})}(e).then(function(t){var n=t.pending,i=t.failed,a=t.items,r=o[e];r.retrieving=null,r.loaded=!0,r.pending=n,r.failed=i,r.items=a}),t.retrieving)}function _(e,t){if(!1!==navigator.onLine){var n=o[e];if(r[e]!==l&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],a=n.items[i];if(!a.fails||t)r[e]=l,n.sendingItemId=i,n.onSend(a.id,a.data);else{var s=Math.pow(2,Math.max(a.fails-2,0));n.backoffTimer=setTimeout(function(){n.backoffTimer=null,_(e,!0)},1e3*s)}}}}function f(e){var t=o[e],n=t.pending,i=t.failed,r=t.items;Object(a.lsSet)("q_"+e,{pending:n,failed:i,items:r})}window.addEventListener("online",function(){Object.keys(o).forEach(function(e){_(e)})});var p=n("qHA9"),h=n("+cqQ"),m=n("j80l");n.d(t,"onStopped",function(){return g}),n.d(t,"onSent",function(){return b}),n.d(t,"onFailed",function(){return y}),n.d(t,"onCaptcha",function(){return w}),n.d(t,"onErrorMessage",function(){return k}),n.d(t,"onMessage",function(){return S}),n.d(t,"onMessageRemove",function(){return C}),n.d(t,"QUEUE_MAX_FAILS",function(){return O}),n.d(t,"QUEUE_NAME",function(){return E}),n.d(t,"ready",function(){return j}),n.d(t,"getItems",function(){return T}),n.d(t,"send",function(){return I}),n.d(t,"retry",function(){return M}),n.d(t,"remove",function(){return x});var v,A,g=Object(h.default)(),b=Object(h.default)(),y=Object(h.default)(),w=Object(h.default)(),k=Object(h.default)(),S=Object(h.default)(),C=Object(h.default)(),O=5,E="mail_send";function j(){return d(E)}function T(){return{pending:(e=o[E]).pending,failed:e.failed,items:e.items};var e}function I(e){j().then(function(){var t;i.logQueueSize((t=o[E])?t.pending.length:0);var n=Object(p.sendDataToMessage)(e);!function(e,t,n){var i={id:t,data:n,fails:0},a=o[e];c(e,t),a.items[t]=i,a.pending.push(t),_(e),f(e)}(E,n.sendId,{data:e}),S(n)})}function M(e,t){var n,i=(n=e,o[E].items[n]||null);t&&(i.data=t(i.data)),c(E,e),I(i.data.data)}function x(e,t){c(E,e),"silent"!==t&&C(e)}A={onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",a="edit_message"===e.act;a?Object.keys(e).forEach(function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]}):(n=Object(m.makeUrl)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach(function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t||delete e[t]})),i.log(t,a?"edit":"send");var l=function(e){var n,l,c;i.mark(t,"server"),a&&!e.was_modified&&C(t),b(),l=o[n=E],(c=l.sendingItemId)&&(l.pending[0]===c&&l.pending.shift(),delete l.items[c]),r[n]=s,l.sendingItemId=null,_(n),f(n)};Object(p.mailRequest)(n,e).then(l,function e(n){var a=n.type,c=n.code,d=n.message,f=n.data;if(i.error(t,"server_send",a),"captcha"!==a&&i.clean(t),"server"===a&&c&&c!==p.UNKNOWN_ERROR)return d&&k(d),void u(E);"captcha"!==a?(function(e){var t=o[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void u(e)}r[e]=s,t.sendingItemId=null,_(e)}(E),y()):w(f,function(n){if(!n)return i.clean(t),void u(E);n.then(l,e)})})}(t.data,e)},onStopped:g,maxFails:O},o[v=E]={pending:[],failed:[],items:{},onSend:A.onSend,onStopped:A.onStopped,maxFails:0|A.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},r[v]=s},I2ZF:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,a=n;return[a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]]].join("")}},JuPy:function(e,t,n){"use strict";function i(){return!!window.isMVK}n.r(t),n.d(t,"isMvk",function(){return i})},KMpi:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n,o=e.photos||[e.photo],l=(o=Array.isArray(o)?o:[o]).length,c="";if(l>1)for(var u=0;u<l;u++)c+=r(o[u],u);n=40===e.size?"m":36===e.size?"s":e.size?e.size:"xl";return Object(a.default)({mix:i.default.class(e.mix,"Avatar",(t={},t[l]=!0,t.size=n,t)),url:e.url,attrs:1===l?s(o[0]):"",inner:c})};function r(e,t){var n;return Object(a.default)({mix:i.default.class("Avatar__image",(n={},n[t]=!0,n)),attrs:s(e)})}function s(e){return i.default.attr("style","background-image: url('"+e+"')")}t.default=o;window.Avatar=o},L9Nh:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"QueueManager",function(){return QueueManager});var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("wx14"),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("OcsD"),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t]},QueueManager.start=function(){QueueManager.started||(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach(function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))}),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}},function(){return!0})},QueueManager.init=function(e){window.curNotifier=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.default)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__.createIframe)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path});var t=setInterval(function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())},500);setTimeout(function(){return clearInterval(t)},1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},LTt1:function(e,t){var n=need("page"),i=need("audio"),a=need("onDOMReady"),o=need("audioplayer"),r=need("AudioSpecialForYou");function s(){c(),i.subscribe([i.events.INIT,i.events.SELECT,i.events.PAUSE],c),n.onChange(c)}function l(e){var t=e.$btn;d()?o.playPause():o.playFirst(null,t),o.onPlay(c),o.onPause(c)}function c(){r.setPlaying(i.playing()&&d())}window.uAudioBlock={},a(s),uAudioBlock._onSpecialPlayAllClick=l;var u=null;function d(){var e=i.getCurrentPlaylistId();if(!u){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(u=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!u&&e===u}},M2vk:function(e,t,n){"use strict";n.r(t);var i=n("rKUZ"),a=n("7jQU"),o=function(){return Object(i.default)(r())};function r(){var e,t,n=store.mail.cur.peerId,i=Object(a.uTyping_getPeerTyping)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:Object(a.uTyping_getNames)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}Object.assign(o,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.default.getElem("curConvo"),t=r();q.parseClass("typing",e.className).animation===t.animation?i.default.setTyping(e,t):e.outerHTML=Object(i.default)(t)}});t.default=o;window.uCurConvoTyping=o},Mc5h:function(e,t,n){"use strict";n.r(t);var i=n("2IoG");t.default=i.default,window.Brick=i.default},MzAf:function(e,t){function n(e){return function(t){t.$control.closest(a.sms).classList.toggle(o[e])}}function i(e,t){var n=t.$select,i=t.value;n.closest(a.sms).classList.toggle(o.pmUsersVisible,e.includes(i)||e.includes(Number(i)))}window.SettingsSms={},SettingsSms._onEnabledChange=n("enabled"),SettingsSms._onTimeLimitedChange=n("timeLimited"),SettingsSms._onFrequencyChange=i;var a={sms:".settingsSms"},o={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},NBPr:function(e,t){window.closePostSuggest=function(e,t){return re(geByClass1("post_suggest")),ajax.post("wall.php",{_ajax:1,act:"close_suggest_post",suggest_id:e.getAttribute("data-suggest-id")}),cancelEvent(t)}},O5lf:function(e,t,n){"use strict";n.r(t);var i=n("9y81"),a=n("Y6JH"),o=function(e){void 0===e&&(e={});var t=e.mix||"";if("pageLoader"===(e.type||"gray"))return Wd.html({inner:[Object(a.default)("wall","loading_40")],class:t+" Spinner Spinner--pageLoader",tag:"div"});return Object(i.default)({mix:t+" Spinner",icon:"spinner"})};t.default=o;window.Spinner=o},OGWK:function(e,t){window.SubscribeBtn={onClick:function(e,t,u,d,_,f){try{var p=f+n,h=f+o,m=f+i,v=f+a,A=hasClass(e,p),g=A?d:u,b=A?getLang(s):getLang(r),y=!A,w=geByClass1(h,e),k=function(e){var t=intval(domData(e,"block-id"));if(!t){var n=domCA(e,c);t=intval(domData(n,"block-id"))||null}return t}(e),S=domData(e,"from")||null;w&&(toggleClass(m,w,y),toggleClass(v,w,!y)),attr(e,"aria-label",escapeAttr(b)),toggleClass(p,e,y),_===l?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(t,g,A):function(e,t,n,i,a){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,a)}(t,g,A,S,k)}catch(e){console.trace(e)}return!1}};var n="_unsubscribe",i="Icon_unsubscribe",a="Icon_subscribe",o="Icon",r="mobile_groups_you_are_in_public",s="mobile_groups_public_subscribe",l="group",c=".feedAssistance"},"Po+v":function(e,t,n){"use strict";n.r(t),t.default=function(e){void 0===e&&(e={});var t=[];if(e.on_overlay_click_native)t=e.on_overlay_click_native;else{var n=!0;"boolean"==typeof e.hide_on_overlay_click&&(n=e.hide_on_overlay_click),t=["Popup._onOverlayClick","this",e.on_overlay_click||null,n]}return{id:e.id,class:[e.mix?e.mix:e.class,Bem.class("Popup",{open:e.open,scrollable:e.scrollable})],inner:[e.rel?e.rel:null,{class:"Popup__overlay",onclick:t},{class:"Popup__wrap",inner:{tag:"div",class:"Popup__content","aria-modal":"true",tabindex:"-1",inner:[e.header?{class:"Popup__header",inner:[e.header.title?{class:"Popup__headerTitle",inner:e.header.title}:null,e.header.corner?{class:["Popup__headerCorner",e.header.corner.class],inner:e.header.corner.text,href:e.header.corner.url,onclick:e.header.corner.onclick,attrs:e.header.corner.attrs}:null]}:null,e.scrollable?{class:"Popup__scroll ScrollView",inner:{class:"Popup__scrollContent",inner:e.content}}:e.content,e.footer?{class:"Popup__footer",inner:e.footer}:null]}}]}}},Q8gl:function(e,t,n){"use strict";n.r(t);var i=n("OcsD"),a=n("z9sQ"),o=n("UWnA"),r=n("fdw3");function s(e){return u(Object(r.extend)(e,{type:"checkbox"}))}function l(e){return u(Object(r.extend)(e,{type:"radio"}))}function c(e){return u(Object(r.extend)(e,{type:"switcher"}))}function u(e){void 0===e&&(e={});var t=e.name,n=e.label,i=e.type,s=e.checked,l=e.disabled,c=e.on_change||e.onChange,u="value"in e?e.value:"1",d=[e.class||e.mix,a.default.class("Control",{type:i})],_=e.attrs||[];_=Object(r.extend)({onclick:!0},_);var f={inner:[{class:"Control__native",name:t,value:u,checked:!!s&&"checked",disabled:!!l&&"disabled",type:"switcher"===i?"checkbox":i,onChange:c?["Control._onChange","this",c]:null,tag:"input"},{class:"Control__icon",tag:"div"},{inner:[n],class:"Control__label",tag:"div"}],tag:"div"}.inner;return e.withoutWrap?{inner:[f],class:d,attrs:_,tag:"label"}:Object(o.default)({inner:[f],tag:"label",class:d,attrs:_})}var d=u,_=n("TYsd"),f={setChecked:function(e,t){void 0===t&&(t=!0);v(e).checked=t},isChecked:function(e){return v(e).checked}},p=f;f._onChange=m;var h={control:".Control",native:".Control__native"};function m(e,t){_.default.handle(t,{$control:e.closest(h.control),name:e.name,checked:e.checked,value:e.value})}function v(e){return e.$(h.native)}n.d(t,"Control_switcher",function(){return c}),n.d(t,"Control_checkbox",function(){return s}),n.d(t,"Control_radio",function(){return l});var A=Object(i.extend)(d,p);t.default=A;window.Control=A},QBkA:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("9y81"),o=function(e){var t=window.lang,n=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!n}),e.mix],inner:[SVGIcon("base","search_outline_16"),{class:"mailFilter__input",tag:"input",placeholder:t.mobile_search,value:n,oninput:["MailFilter._onInput","this"],attrs:i.default.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[Wd.wrap(Object(a.default)({mix:"mailFilter__clear",icon:"close12",attrs:i.default.onMouseDown("MailFilter._onClearMouseDown","this")}))]}]})};var r=n("UxAg"),s=n("+cqQ"),l=n("jk6M"),c=n("aiw/");function u(e){requestAnimationFrame(function(){var t=e.value;f(e.value),o.onChange(t)})}function d(){c.onOpen("top")}function _(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(l.default.ios?setTimeout:requestAnimationFrame)(function(){f(""),t.value="",n&&t.focus(),o.onClear(),o.onChange("")})}function f(e){Object(r.$$)(".mailFilter").forEach(function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)})}Object.assign(o,{onChange:Object(s.default)("query"),onClear:Object(s.default)(),setQuery:function(e){var t=Object(r.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,o.onChange(e),f(e))},setQuerySilently:function(e){var t=Object(r.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,f(e))}}),o._onInput=u,o._onClearMouseDown=_,o._onFocus=d;t.default=o;window.MailFilter=o},QMH7:function(e,t,n){"use strict";n.r(t),n.d(t,"healScroll",function(){return c}),n.d(t,"unhealScroll",function(){return u});var i=n("UxAg"),a=n("Qz23");n("H5mD").isIOS&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",s);var o={scrollView:".ScrollView"},r="_scrollViewHealed";function s(){(l(),document.body)&&new MutationObserver(l).observe(document.body,{childList:!0,subtree:!0})}function l(){Object(i.$$)(o.scrollView).forEach(c)}function c(e){if(!e[r]){e[r]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),i=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=i+1+"px",d(e),Object(a.setScrollView)(e,{override:!1}),hasClass("messenger__body",e)||addEvent(e,"scroll",f),addEvent(e,"scroll",_)}}function u(e){e[r]&&(e[r]=null,e.style.paddingTop="",e.style.paddingBottom="",Object(a.cleanScrollView)(e),removeEvent(e,"scroll",f),removeEvent(e,"scroll",_))}function d(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function _(e){var t=e.target,n=t[r];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout(function(){t[r]&&d(t)},50))}function f(){onBodyScroll(!0)}},QQoL:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=n("9y81"),r=function(e){var t=window.lang,n=e.count;return i.default.html({class:[a.default.class("Bell",{empty:!n}),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[i.default.html(Object(o.default)({mix:"Bell__icon",icon:"bell"})),{class:"Bell__counter",inner:n,tag:"em"}]})};var s=n("UxAg");Object.assign(r,{setCount:function(e){Object(s.$$)(c.bell).forEach(function(t){var n=t.$(c.counter);t.classList.toggle(l.empty,!e),n.innerText=e})}});var l={empty:"Bell_empty"},c={bell:".Bell",counter:".Bell__counter"};t.default=r;window.Bell=r},Qg0H:function(e,t,n){"use strict";n.r(t);var i=n("UxAg"),a=n("TYsd"),o=n("+cqQ");window.Voting={cls:"Voting",setLoading:_,setHtml:function(e,t){c(e).forEach(function(e){e.outerHTML=t}),c(e).forEach(function(e){e.classList.add(s.beforeAnimation)}),setTimeout(function(){c(e).forEach(function(e){e.classList.remove(s.beforeAnimation),Voting.onHtmlUpdate(e)})},30)},getVotingsById:c,onHtmlUpdate:Object(o.default)("$voting")},Voting._onSubmit=f,Voting._onSingleAnswerClick=d,Voting._onCheckboxClick=u,Voting._onRevoteClick=p;var r="_Voting_singleAnswerAction",s={loading:"Voting_loading",beforeAnimation:"Voting_beforeAnimation",hasCheckedOptions:"Voting_hasCheckedOptions"},l={voting:".Voting",votingById:function(e){return'.Voting[data-id="'+e+'"]'},optionControl:".Voting__optionControl",submit:".Voting__submit"};function c(e){return Object(i.$$)(l.votingById(e))}function u(e){var t=e.closest(l.voting),n=Array.from(Object(i.$$)(l.optionControl)).some(function(e){return e.checked});t.classList.toggle(s.hasCheckedOptions,n)}function d(e){var t=e.name,n=e.value,i=e.closest("form"),a=i.getAttribute("action");i[r]=a+"&"+t+"="+encodeURIComponent(n)}function _(e){e.classList.add(s.loading)}function f(e,t,n){var i;if(e.preventDefault(),t[r])i=t[r],_(t);else{var o=Array.from(t.$$("input:checked"));if(0===o.length)return;var s=o[0].name,l=o.map(function(e){return e.value}).join(","),c=t.getAttribute("action"),u=c.includes("?")?"&":"?";_(t),i=""+c+u+s+"="+l+"&is_board="+t.$('input[name="is_board"]').value}a.default.handle(n,{$voting:t,url:i})}function p(e,t){var n=e.closest(l.voting);a.default.handle(t,{$voting:n})}},Qz23:function(e,t,n){"use strict";n.r(t),n.d(t,"init",function(){return g}),n.d(t,"preventDocumentScroll",function(){return b}),n.d(t,"restoreDocumentScroll",function(){return y}),n.d(t,"cleanDocumentViews",function(){return w}),n.d(t,"allowScrolling",function(){return k}),n.d(t,"setScrollView",function(){return O}),n.d(t,"cleanScrollView",function(){return E}),n.d(t,"hideTopBanner",function(){return V}),n.d(t,"showTopBanner",function(){return F});var i,a,o,r,s,l,c,u=n("UxAg"),d=n("aiw/"),_=n("H5mD"),f=".layout",p=!0,h=!1,m="closed",v=!1,A=[];function g(e){v&&w(),b(e)}function b(e){void 0===e&&(e={}),_.isIOS&&(!0!==e.stack&&v||(c={initialized:!1,scrollViews:[]},A.push(c),e.layoutElement&&e.layoutElement.nodeType?c.layoutElement=e.layoutElement:c.layoutElement=Object(u.$)(e.layoutElement||f)),!1===e.topBanner?c.topBanner=!1:c.topBanner=!0,v||(v=!0,addEvent(window,"focusin",R),addEvent(window,"focusout",D),addEvent(document,"touchmove",P,{capture:!0}),addEvent(document,"touchmove",B,{capture:!1}),addEvent(window,"resize",T),d.onCloseCallback(N),_.isWKWebView||(addEvent(window,"orientationchange",I),requestAnimationFrame(function(){Object(_.isLandscapePhone)()?I(null,!0):(T(),c&&!c.topBanner?requestAnimationFrame(V):o||requestAnimationFrame(F))}))))}function y(){v&&(v=!1,w(),1===A.length&&(c.layoutOffset=null,U(),document.body.style.height=""),c.layoutElement=null,A.pop(),(c=A.length?A[A.length-1]:null)&&U(),removeEvent(window,"focusin",R),removeEvent(window,"focusout",D),removeEvent(document,"touchmove",P,{capture:!0}),removeEvent(document,"touchmove",B,{capture:!1}),removeEvent(window,"resize",T),removeEvent(window,"orientationchange",I),removeEvent(window,"resize",M),removeEvent(window,"scroll",x),d.offCloseCallback(N))}function w(){c.scrollViews.forEach(function(e){return E(e)}),c.scrollViews=[]}function k(e){var t=e.currentTarget.__ScrollView;if("prevented"!==t.state){if(!("start"!==t.state||t.allowX&&t.allowY)){var n=Math.abs(t.startX-e.changedTouches[0].clientX),i=Math.abs(t.startY-e.changedTouches[0].clientY);if(!t.allowX&&n>i)return void(t.state="prevented");if(!t.allowY&&i>n)return void(t.state="prevented")}if("allowed"!==t.state&&(t.state="allowed"),p=!1,!t.overscrollX){var a=e.currentTarget.scrollLeft,o=t.startX-e.changedTouches[0].clientX;(a<=0&&o<=0||a>=t.maxX&&o>=0)&&(p=!0,t.standalone&&e.preventDefault())}if(!t.overscrollY){var r=e.currentTarget.scrollTop,s=t.startY-e.changedTouches[0].clientY;(r<=0&&s<=0||r>=t.maxY&&s>=0)&&(p=!0,t.standalone&&e.preventDefault())}}}function S(e){var t=e.currentTarget,n=t.__ScrollView;n.state="start",n.startX=e.changedTouches[0].clientX,n.startY=e.changedTouches[0].clientY,n.maxX=n.overscrollX?null:t.scrollWidth-t.clientWidth,n.maxY=n.overscrollY?null:t.scrollHeight-t.clientHeight}function C(e){e.currentTarget.__ScrollView.state=""}function O(e,t){if(void 0===t&&(t={}),_.isIOS&&(!1!==t.override||!e.__ScrollView)){if(!0!==t.standalone){if(!v)return;e.__ScrollView||c.scrollViews.push(e)}e.__ScrollView={allowX:!1!==t.allowX,allowY:!1!==t.allowY,overscrollX:!1!==t.overscrollX,overscrollY:!1!==t.overscrollY,standalone:!0===t.standalone},c&&(_.isWKWebView||(!1!==t.topBanner&&(e.__ScrollView.topBanner=t.topBanner||{hide:30,show:60}),addEvent(e,"scroll",j))),addEvent(e,"touchstart",S),addEvent(e,"touchmove",k),addEvent(e,"touchend",C)}}function E(e){e.__ScrollView=null,removeEvent(e,"touchstart",S),removeEvent(e,"touchmove",k),removeEvent(e,"touchend",C),removeEvent(e,"scroll",j)}function j(e){if("closed"!==m||Object(_.isLandscapePhone)())return h=!1,void(r&&clearTimeout(r));h=!0;var t=e.target.__ScrollView.topBanner;c&&c.topBanner&&t?H(e.target,t.show,t.hide):H(e.target,1/0,0),r&&clearTimeout(r),r=setTimeout(function(){h=!1,T()},100)}function T(){if(!h)if(l)l=!1;else if(!Object(_.isLandscapePhone)()){window.pageYOffset;"closed"===m&&(_.isWKWebView||(i=document.documentElement.offsetHeight,a=innerHeight,o=i===a,"show"===s?(s=null,requestAnimationFrame(F)):"hide"===s&&(s=null,requestAnimationFrame(V))))}}function I(e,t){_.isIPad?c.topBanner||setTimeout(function(){V()},400):90===Math.abs(window.orientation)?(addEvent(window,"resize",M),document.body.style.height="",c.layoutHeight=null,t?setTimeout(function(){window.scrollTo(0,-300),M()}):setTimeout(function(){window.scrollTo(0,-300)},400)):(removeEvent(window,"resize",M),c.layoutOffset=null,U(),c.topBanner||setTimeout(function(){V()},400))}function M(){if("closed"===m){var e=document.body.offsetHeight,t=e-innerHeight;c.layoutOffset=t,U(),window.scrollTo(0,e)}}function x(){pageYOffset&&(m="opened",removeEvent(window,"scroll",x))}function P(e){p=!0}function B(e){p&&e.preventDefault()}function L(e){var t=e&&e.target,n=0===e.eventPhase&&t.getAttribute("autofocus"),i=!1;return"textarea"!==t.tagName.toLowerCase()||n||(i=!0),"input"!==t.tagName.toLowerCase()||["checkbox","radio","image","submit"].includes(t.type)||n||(i=!0),"select"===t.tagName.toLowerCase()&&(i=!0),i}function R(e){if(L(e)){var t,n=e&&e.target;m="opening",addEvent(window,"scroll",x),window.isCustomScroll&&(t=n.dataset.scrollviewposition),d.onOpen(t,{exitIfStarted:!0})}}function D(e){L(e)&&d.onClose({exitIfStarted:!0})}function N(){removeEvent(window,"scroll",x),m="closed",setTimeout(function(){Object(_.isLandscapePhone)()?M():T()},100)}function H(e,t,n){var i=e.scrollTop;i<=-t&&(o||s)?(s="show",window.scrollTo(0,-10)):i>=n&&(!o||s)&&(s="hide",window.scrollTo(0,10))}function V(){window.scrollTo(0,300)}function F(){window.scrollTo(0,-300)}function U(){var e=c.layoutOffset;c.layoutElement.style.top=e?e+"px":""}},T24x:function(e,t,n){"use strict";n.r(t);var i=n("BZzM"),a=n("QMH7"),o=n("Y6JH"),r={onChange:se(),onRestore:se(),fast_load:!1,need_hard_go:!1,getHash:function(e){if("#player"===e.hash)return e.path+e.hash;var t=qs2obj(e.params);return delete t.z,e.path+obj2qs(t)},getAlias:function(e){if(!e)return!1;var t=(e||"").split("?"),n=t[0],i=qs2obj(t[1]);return i.from&&delete i.offset,delete i.from,delete i.z,delete i.ref,Object.keys(i).forEach(function(e){0===e.indexOf("_")&&delete i[e]}),n+obj2qs(i)},set:function(e,t,n,o){void 0===n&&(n={});var s=window,l=s.zlayer,c=s.cur,u=s.nav,d=s.menu,_=s.audioplayer,f=$("body.fixed"),p=f?Math.abs(parseInt(getStyle(f,"top"),10)):scrollTop(),h=null;window.isNewMail&&toggleClass("vk__page_mail",window.bodyNode,"/mail"===e),l.opened()&&(p=l._st);var m=n.forceUpdate&&t.newHTML,v=!m&&u.hasUpdate(o,e,t),A=!!v||u.needUpdate(o,e,t),g=0;if(!n.force&&!v&&A||m?(g=scrollTop(),h=remove("m"),each(geByClass("_cntr",h),function(){remove(this)}),each(geByClass("ScrollView",h),function(){Object(a.unhealScroll)(this)}),remove(geByClass1("_cntrs",h))):each(geByClass("ScrollView",geByClass1("m")),function(){Object(a.unhealScroll)(this)}),!n.after&&!r.fast_load){var b=r.getHash(u),y=o||t.options||{};o&&o.is_native_back&&(y.prev_tab=y.native_prev),r.save(b,{html:null,st:p,page:h,state:r.stash(),cur:window.cur,options:y},!0)}if(n.before||r.clear(),(n.before||!n.before&&!n.after)&&(window.lm_qsearch_counter?window.lm_qsearch_counter++:window.lm_qsearch_counter=1),n.before){var w=o&&o.target;r.fast_load=!0,w&&addClass("__al_target",w);var k=h.cloneNode(!0);w&&removeClass("__al_target",w);var S=geByClass1("__al_target",k);removeClass("__al_target",S),n.beforeAppend&&n.beforeAppend(k,S),after(k,"l"),scrollTop(g),c.toggleHeaderSearch&&c.toggleHeaderSearch(!1),n.afterAppend&&n.afterAppend(k),d&&d.clear_hover(),d&&d.closeSearch(),d&&d.enabled(!0)}else{o&&o.zProcess&&o.zProcess(0,!0)&&delete o.zProcess;var C=!1;if(o&&u.set(o),r.need_hard_go)return u.hard_go(u.cur,null,{replace:!0});if(!n.force&&!v&&A||m){var O;if(t.title&&(document.title=t.title),m?(O=ce("div",{className:"layout__basis",id:"m"}),val(O,t.newHTML)):(O=t.page)?C=!0:(O=ce("div",{className:"layout__basis",id:"m"}),val(O,t.html)),d.opened()){var E=ce("div",{id:"m_helper",onclick:d.close});append(E,O)}after(O,"l")}r.fast_load=!1,thover.clear(),!v&&A&&(t.lm&&d.refresh(t.lm),t.bc&&(window.bodyNode.className=t.bc),l.opened(),o&&o.zProcess?o.zProcess(0,!1)&&delete o.zProcess:l.close()),n.force||(C&&(window.qsearch.isCachedPage=!0),t.js&&evalJs(t.js),C&&(window.qsearch.isCachedPage=!1),t.state&&r.stash(t.state),t.cur&&extend(window.cur,t.cur),o&&(t.options=o),post.wallActionsHide(),r.save(e,t));var j=o?o.nav&&o.nav.hash:u.hash;if(v||A)if(v)Tabbar.showUpdateButton(v.currentCache.d.page);else if(t.st||!j){var T=window.isCustomScroll&&hasClass("ScrollView","mcont")?1:0;scrollTop(t.st||T),scrollTop(t.st||T,10)}else j?scrollToHash(j):n.no_scroll&&!n.force?(scrollTop(p),scrollTop(p,10)):scrollToHash();else;_&&_.initAudio(),AudioMessagePlayer&&AudioMessagePlayer.redrawWaves()}var I=window.Tabs;onBodyResize(I.actualizeShowMoreVisibility),I.actualizeShowMoreVisibility(),Object(i.resizePosters)(),r.onChange(!0,o&&o.nav&&o.nav.push)},save:function(e,t,n){if(e){var i=window.nav,a=n?i.page_get(e,t.options.prev_tab):{};a&&i.page_set(e,extend(a,t),r.getAlias(e))}},restore:function(e){var t=window.nav,n=t.page_get(e);return n||(n=t.page_get(r.getAlias(e))),!!n&&(r.onRestore(!0),n)},stash:function(e){var t=window.cur;return window.cur&&t.stash&&t.stash(e)||!1},clear:function(){var e=window.cur,t=window.zlayer,n=window.menu,i=window.tooltip;onBodyScroll("__clear"),onBodyResize("__clear"),n&&n.initEvents(),t.isReady&&t.initEvents(),i&&i.clear(),window.cur&&e.destroy&&each(e.destroy,function(){this()}),window.cur={destroy:[]}},hideHeader:function(e){var t=geByClass1("mhead",e);hide(t)},setMhead:function(e,t,n,i,a){void 0===a&&(a={});var r=geByClass1("mhead",e),s=geByClass1("mhb_logo",r),l=geByClass1("mh_header",e),c=!1,u=window.nav,d=document.body,_=geByClass1("SliderTabs",r),f=geByClass1("header__right",r),p=geByClass1("header__gear",r);_&&remove(_),f&&remove(f),p&&remove(p),removeClass("vk_header_tabs",d);var h="header__title hb_btn mh_header mhi_back";if(a.movable&&(h+=" header__title--movable header__title--initial-position"),n){!0===n?c=u.path+(u.params?"?"+u.params:""):n&&(c=n),t||(t=val(l)||"&nbsp;");var m=geByClass1("mhb_back",e),v="",A=hasClass("mh_nobr",m)?" mh_nobr":"",g=i?' onclick="'+i+'"':"";if("/"==c)v='<div class="hb_wrap mhb_back'+A+'"'+g+'><h1 class="hb_btn mh_header">'+t+"</h1></div>";else{var b=Wd.html(Object(o.default)("base","back_outline_28"));v='\n        <div class="header__center hb_wrap mhb_back '+A+'">\n          <a class="header__back al_back" href="'+escapeAttr(c)+'" accesskey="0" '+g+">"+b+'</a>\n          <h1 class="'+h+'">\n            <div class="header__text">\n                '+t+"\n            </div>\n          </h1>\n        </div>\n      "}if(r&&s){var y=geByClass1("mhb_notify",e);val(r,(window.al&&window.al.menu?'<a href="/" class="hb_wrap mhb_home" accesskey="*" onclick="return menu.toggle(event);"><div class="hb_btn mhi_home">&nbsp;</div></a>':'<a href="/" class="hb_wrap mhb_home mhb_vkhome" accesskey="*"><div class="hb_btn mhi_home mhi_vkhome">&nbsp;</div></a>')+'<div id="header_msgs" class="hb_wrap mhb_notify'+(!y||hasClass("mhb_no_notify",y)?" mhb_no_notify":"")+'">'+val(y)+"</div>"+v)}else m&&(m.outerHTML=v)}else t&&val(l,t)}};window.page=r,t.default=r},Tjn9:function(e,t){function n(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout(function(){addClass(e,"profileEdit_animated"),setTimeout(function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")},1e3)},1500))}function i(e){(e=ge(e))&&setTimeout(function(){var t=getXY(e)[1],i=getSize("mhead")[1],a=scrollGetY(),o=getCh();t<i+a||t>a+o?setTimeout(function(){scrollTo(0,t-i),n(e)},0):n(e)},0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&i(geByClass1("_"+e))},highlightRow:n,scrollHighlightRow:i}},U34x:function(e,t){var n="dropdown_open",i={_onTogglerClick:function(e,t){preventEvent(e),stopEvent(e);var i=gpeByClass("dropdown",t);if(toggleClass(i,n),!1!==i.isFirstClick){i.isFirstClick=!1;var a=function(){removeClass(i,n)};addEvent(window,"click",a),window.cur.destroy.push(function(){removeEvent(window,"click",a),i.isFirstClick=!0})}}};window.Dropdown=i},UWnA:function(e,t,n){"use strict";n.r(t);var i=n("8ZMO"),a=(n("p5n7"),n("9y81"));n("z9sQ");function o(e){void 0===e&&(e={});var t=e.anchor,n=e.attrs||{},o=e.style||{},r=e.url,s=r&&!o.no_go_icon;return{class:[e.mix||e.class,Bem.class("Row",{go:s,style_withBorder:o.with_border,style_withBorderForce:o.with_border_force,style_withHover:o.with_hover,style_smallPaddings:o.small_paddings,style_noPaddingTop:o.no_padding_top,style_noPaddingBottom:o.no_padding_bottom,style_tinyPaddingTop:o.tiny_padding_top,style_tinyPaddingBottom:o.tiny_padding_bottom,paddingTop_short:o.padding_top_short})],tag:e.tag||null,href:r,attrs:n,inner:[t?Object(i.default)({id:t}):null,s?Wd.wrap(Object(a.default)({mix:"Row__go",icon:"chevron_right"})):null,e.content||e.inner]}}var r=o;t.default=r},UlUB:function(e,t,n){"use strict";function i(e,t){var n,i,a=!1;return function o(){if(a)return n=arguments,void(i=this);e.apply(this,arguments),a=!0,setTimeout(function(){a=!1,n&&(o.apply(i,n),n=i=null)},t)}}n.r(t),n.d(t,"default",function(){return i})},UvyM:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("TYsd"),o=n("fdw3");t.default=function(e){void 0===e&&(e={});var t=e.url,n=e.is_icon,r=e.icon,s=e.tag||"button",l=e.on_click||e.onClick,c=e.use_native_onclick,u=e.inner||e.children;isArray(u)&&1===u.length&&"string"==typeof u[0]&&(u=u[0]);var d=!1;"function"==typeof l&&(c=!0,d=!0);l&&!c&&(l=["Btn._onClick","event","this",l]);var _={class:[e.class,i.default.class("Btn",{theme:e.theme||"regular",size:e.size||"",stretch:e.stretch})],onclick:l,attrs:e.attrs};d&&(_.onClick=l,delete _.onclick);var f=e.hide?"; display: none;":"",p=e.style?e.style+f:f;if(t)return Object(o.mergeObjects)(_,{_:a.default.getInternalData(),tag:"a",href:t,role:"button",style:p,inner:r?[{class:"Btn__icon",inner:r},{class:"Btn__text",inner:u}]:n?u:{class:"Btn__text",inner:u},target:e.open_in_new_tab?"_blank":null});var h=e.is_submit?"submit":null,m=e.type||h;return Object(o.mergeObjects)(_,{_:a.default.getInternalData(),"aria-label":e["aria-label"]||"",tag:s,style:p,disabled:e.disabled,type:m,inner:r?[{class:"Btn__icon",inner:r},{class:"Btn__text",inner:u}]:n?u:{class:"Btn__text",inner:u}})}},V4qE:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("29dZ"),o=n("Y6JH"),r=n("fdw3"),s=function(e){void 0===e&&(e={});var t=!(!e.type||e.image),n={class:i.default.class("SnackbarItem__cell",{left:!0,image:!!e.image,icon:t})},s={class:i.default.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar})},l=!1,c=!1;if(e.type){l=!0;var u=null;switch(e.type){case 1:u=Object(o.default)("common","snackbar_done_24");break;case 2:u=Object(o.default)("common","snackbar_error_24");break;case 3:u=Object(o.default)("common","favorites_24");break;case 4:u=Object(o.default)("wall","error_fill_24")}n.inner={class:"SnackbarItem__icon",inner:u}}e.image&&(l=!0,n.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(c=!0,s.inner=Object(a.default)({theme:"none",class:"SnackbarItem__action",url:e.action.url,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));e.avatar&&(c=!0,s.inner={tag:"img",class:"SnackbarItem__avatar",src:e.avatar});return{style:e.style?e.style:"",class:Object(r.concatValues)("SnackbarItem_"+e.id+" ",i.default.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:t},"--")),attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[l?n:null,e.text?{class:i.default.class("SnackbarItem__cell",{text:!0}),inner:{class:"SnackbarItem__text",inner:Wd.wrap(e.text)}}:null,c?s:null]}]}};var l=n("OcsD"),c=n("UxAg"),u=882;window.Snackbar={init:b,close:w,_onActionClick:function(e,t){var n=m[t];if(!n)return void hide(t);var i=n.callback,a=n.url;i?"function"==typeof i?i.call(null,e,{id:t,url:a}):Wd.handle2(i,e,{id:t,url:a}):hide(t)},_onRestoreClick:function(e,t,n){var i=t.closest(".SnackbarItem"),a=domData(i,"snackbar-id"),o=m[a];e.stopPropagation(),e.preventDefault();var r=o.callback;r&&("function"==typeof r?r.call(null,e,{id:a,url:n}):Wd.handle2(r,e,{id:a,url:n}));w(a),ajax.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var d="SnackbarItem_",_="SnackbarItem_added",f="SnackbarItem_removed",p="SnackbarItem--closing",h=0,m={},v="touchstart",A="touchmove",g="touchcancel touchend";function b(e){var t=isFinite(e.duration)?e.duration:5e3,n=h++,i=e.action&&e.action.callback,a=e.action&&e.action.url;e.type;e.id=n,i&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var o,r=Wd.elem(SnackbarItem(e));return function(e){Object(l.append)(e,document.body),setTimeout(function(){e.classList.add(_)},100)}(r),t&&(o=y(n,t)),Object(l.addEvent)(r,v,j,{passive:!0}),Object(l.addEvent)(r,A,T,{capture:!1}),Object(l.addEvent)(r,g,I,{passive:!0}),m[n]={id:n,timer:o,callback:i,url:a,duration:t},n}function y(e,t){return setTimeout(function(){w(e,!1)},t)}function w(e,t){var n=m[e],i=function(e){return Object(c.$)("."+d+e)}(e);n&&(n.timer&&clearTimeout(n.timer),m[e]=null),i&&function(e,t){if(Object(l.removeEvent)(e,v,j,{passive:!0}),Object(l.removeEvent)(e,A,T,{capture:!1}),Object(l.removeEvent)(e,g,I,{passive:!0}),t)return void Object(l.remove)(e);e.classList.add(p);if(!e)return;e.classList.add(f),setTimeout(function(){Object(l.remove)(e)},600)}(i,t)}var k=!1,S=null,C=0,O=!1,E=Object(l.getCw)();function j(e){if((E=Object(l.getCw)())>=u&&(O=!0),e.touches&&e.touches.length>1)k=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=domData(t,"snackbar-id");m[n].timer&&clearTimeout(m[n].timer),S=e.touches[0],C=e.touches[0].clientX,k=!0,document.body.style.overflow="hidden"}}function T(e){if(e.preventDefault(),e.touches&&e.touches.length>1)k=!1;else if(S&&k){var t=e.touches[0],n=e.target.closest(".SnackbarItem"),i=-(C-t.clientX);O&&(i=Math.min(i,0));var a=getX(n),o=(Object(l.getW)(n)+i)/2+a;E>=u&&Object(l.getW)(n)/2;var r=o>=.95*E||o<=E/.95-E,s=domData(n,"snackbar-id");m[s].canClose=r,setStyle.transform(n,1,[i,0])}}function I(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=domData(t,"snackbar-id"),i=m[n];if(m[n].dragging=!1,document.body.style.overflow="visible",i.canClose)return w(n),void setStyle.transform(t,1,[getX(t)>0?Object(l.getCw)():-Object(l.getCw)(),0]);m[n].timer=y(n,i.duration),t&&setStyle.transform(t,1,[0,0])}n.d(t,"init",function(){return b}),n.d(t,"close",function(){return w}),n.d(t,"SNACKBAR_TYPE_SUCCESS",function(){return 1}),n.d(t,"SNACKBAR_TYPE_ERROR",function(){return 2}),n.d(t,"SNACKBAR_TYPE_BOOKMARK",function(){return 3}),n.d(t,"SNACKBAR_TYPE_BULLYING",function(){return 4});t.default=s;window.SnackbarItem=s},W38l:function(e,t,n){"use strict";n.r(t);var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function a(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}var o=n("WwUR");n.d(t,"log",function(){return s}),n.d(t,"mark",function(){return l}),n.d(t,"error",function(){return c}),n.d(t,"clean",function(){return u}),n.d(t,"logQueueSize",function(){return d});var r={};function s(e,t){var n={action:t,startTime:Date.now(),networkType:a(),lpState:o.default.isLongPollingEnabled()};r[e]=n}function l(e,t){if(r[e]){var n=r[e],i=n.startTime,a=n.action,o=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,a,t,o,s)}}function c(e,t,n){if(r[e]){var i=r[e],a=i.action,o=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,a,t,n,o,s)}}function u(e){delete r[e]}function d(e){statlogsValueEvent("mvk_mail_send_queue_size",e,a())}},WwUR:function(e,t,n){"use strict";n.r(t);var i=n("OcsD"),a=n("+cqQ");function o(e,t){var n,i=new Promise(function(i){n=i,setTimeout(i.bind(null,t),1e3*e)});return{pause:function(){return i},abort:function(){n(t)}}}var r=n("cGUQ"),s=window.ajax,l=3;function c(e,t,n){var i;return void 0===n&&(n={}),i=window.XDomainRequest?new XDomainRequest:s._getreq(),{request:new Promise(function(a,o){var s,l=Date.now(),c=n.timeout||60,u=Object(r.toQueryString)(t);if(window.XDomainRequest)i.open("get",e+"?"+u),i.ontimeout=function(e){o([e,{}])},i.onerror=function(e){o([e,{}])},i.onload=function(){a([i.responseText,{}])},setTimeout(function(){i.send()},0);else{i.onreadystatechange=function(){4==i.readyState&&(clearInterval(s),i.status>=200&&i.status<300?a([i.responseText,i]):o([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return o([e,i])}i.send()}s=setInterval(function(){Date.now()-l>1e3*c&&(window.browser.safari&&i.abort(),o(["",{}]),clearInterval(s))},1e3)}),cancel:function(){i.abort()}}}var u=n("jE6c");function d(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var _={};function f(e){if(_[e])return _[e];for(var t=e?e.length:0,n=[],i=[],a="",o=0;o<t;o++){var r=e[o],s=r.charCodeAt(0);s>=48&&s<=57||"_"===r||"-"===r?a+=r:"("!==r&&")"!==r&&":"!==r&&","!==r||(""!==a&&(i.push(a),n.push("id"),a=""),i.push(r),n.push(r))}a.length>0&&(i.push(a),n.push("id"));var l=function e(t,n,i,a){if(void 0===i&&(i=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var o=[],r="";i<t.length;){var s=t[i];if("id"===s)r=n[i];else if(","===s&&r)o.push(d(r)),r="";else if("("===s){var l=e(t,n,i+1,a+1),c=l[0];i=l[1],o.push(d(r,c)),r=""}else if(")"===s)return""!==r&&o.push(d(r)),[o,i];i++}return r&&o.push(d(r)),[o,i]}(n,i)[0];return Object.keys(_).length>300&&(_={}),_[e]=l,l}function p(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:f(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?n.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(u.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(u.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(u.intval)(e["attach"+i+"_call_receiver_id"])}):n.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}var h="event_delete",m="event_set_flags",v="event_replace_flags",A="event_reset_flags",g="event_add_message",b="event_read_inbound",y="event_read_outbound",w="event_got_online",k="event_got_offline",S="event_chat_changed",C="event_chat_updated",O="event_typing",E="event_recoding_audio",j="event_video_call",T="event_unread_count",I="event_notify_settings_changed",M="event_empty",x="event_reset_directories",P="event_replace_directories",B="event_set_directories",L="event_resync",R="event_refresh_lp_key",D="event_delete_dialog",N="event_edit_message",H="event_replace_message",V="event_audio_start",F="event_waiting_for_reconnect",U="event_reconnecting",$="event_reconnected",q=2,W=1<<21;function z(e){var t,n=e[1],i=e[2],a=e[3],o=e[4],r=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],_=extend(s,l||void 0);return{type:g,messageId:intval(n),flags:intval(i),peerId:intval(a),date:intval(o),attaches:p(_,n),subject:s.title||"",text:r,kludges:_,randomId:intval(c),userId:(t=a,t>2e9?intval(_.from):intval(a)),update_time:d,chat_local_id:u}}var Q=202,Y=9,G=4,X=-3,K=-4,J=-5;function Z(e,t){e.waitAbortFns.push(t)}function ee(e){return e.map(function(e){switch(e[0]){case 0:return ee=e[1],{type:h,localId:ee};case 1:return Y=(Q=e)[1],G=Q[2],Z=Q[3],{type:v,messageId:Y,mask:G,peerId:Z};case 2:return function(e){var t=e[1],n=e[2],i=e[3];return{type:m,messageId:t,flags:n,peerId:i}}(e);case 3:return function(e){var t=e[1],n=e[2],i=e[3];return{type:A,messageId:t,flags:n,peerId:i}}(e);case 4:return z(e);case 5:return(W=z(e)).type=N,W;case 6:return function(e){var t=e[1],n=e[2],i=e[3];return{type:b,peerId:t,upToId:n,unread:i}}(e);case 7:return function(e){var t=e[1],n=e[2],i=e[3];return{type:y,peerId:t,upToId:n,unread:i}}(e);case 8:return p=(f=e)[1],g=f[2],q=f[3],{type:w,userId:-p,platform:g,lastSeenTs:q};case 9:return function(e){var t=e[1],n=e[2],i=e[3];return{type:k,userId:-t,reason:n,lastSeenTs:i}}(e);case 10:return function(e){var t=e[1],n=e[2],i=e[3];return{type:x,peerId:t,mask:n,local:void 0!==i&&i}}(e);case 11:return function(e){var t=e[1],n=e[2];return{type:P,peerId:t,mask:n}}(e);case 12:return function(e){var t=e[1],n=e[2],i=e[3];return{type:B,peerId:t,mask:n,local:void 0!==i&&i}}(e);case 13:return function(e){var t=e[1],n=e[2];return{type:D,peerId:t,localId:n}}(e);case 18:return function(e){var t=z(e);return t.type=H,t}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:S,chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],i=e[3];return{type:C,peerId:n,updateType:t,updateArg:i}}(e);case 63:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:O,peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:E,peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:j,userId:t,callId:n}}(e);case 80:return u=(c=e)[1],d=c[2],_=c[3],{type:T,count:u,countNotMuted:d,showOnlyNotMuted:_};case 114:return s=e[1],{type:I,peerId:(l=void 0===s?{}:s).peer_id,sound:l.sound,disabledUntil:l.disabled_until};case 116:return function(e){var t=e[1],n=void 0===t?{}:t,i=z([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return i.type=N,i}(e);case 117:return o=e[1],{type:V,uuid:(r=void 0===o?{}:o).uuid,deviceName:r.device_name||""};case-1:return{type:L};case-2:return i=(n=e)[1],a=n[2],{type:R,key:i,url:a};case X:return t=e[1],{type:F,timeout:t};case K:return{type:U};case J:return{type:$};default:return function(e){return{type:M,params:e}}(e)}var t,n,i,a,o,r,s,l,c,u,d,_,f,p,g,q,W,Q,Y,G,Z,ee})}function te(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=c(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,n.then(function(t){var n=t[0],i=t[1];return e.onData(e,i),e.waitTimeout=2,JSON.parse(n)}).catch(function(t){var n=t[1];return e.onData(e,n),Promise.reject(new Error(""))}).then(function(t){return function(e,t){var n=t.failed?o(G,null):{abort:function(){},pause:function(){return Promise.resolve()}},i=n.abort,a=n.pause;switch(t.failed){case 1:return Z(e,i),e.onHistoryLost(e,t).then(function(){return e.onResult({ts:t.ts,updates:[[-1]]})}).then(a).then(function(){return te(e)});case 2:return Z(e,i),e.onKeyExpired(e,t).then(function(t){var n=t[0],i=t[1],a=t[2],o=t[3];return e.onResult({ts:+o,updates:[[-2,n,i+"/"+a],[-1]]})}).then(a).then(function(){return te(e)});case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)})}function ne(e){e.isStoppedFn()||te(e).then(e.onResult.bind(e)).then(function(){return e.isReconnecting&&ie(e,J)}).catch(function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),ie(e,X);var n=o(e.waitTimeout,null),i=n.abort,a=n.pause;return Z(e,i),a().then(function(){return ie(e,K)})}(e,t)}).then(function(){return ne(e)})}function ie(e,t){e.isReconnecting=t===K,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function ae(e){return e||function(){}}function oe(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}function re(e,t,n){var i=0,a=e,o=[],r=!1;function s(){!o.length||i>0||r||(t(o),o=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,s())},onLp:function(e,t,i){r||(a>=e?(a=t,o.push.apply(o,i),s()):n&&(r=!0,n(a).then(function(e){var t=e[1],n=e[2];a=t,r=!1,o.push.apply(o,n),s()})))}}}var se={onNewMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(a.default)("msgId","dialogId"),onMsgReadByOther:Object(a.default)("msgId","dialogId"),onOnlineChange:Object(a.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(a.default)("dialogId","authorId"),onMultiTyping:Object(a.default)("peerId","userIds","totalCount"),onRecordingAudio:Object(a.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(a.default)("msgId"),onMsgImportantAdd:Object(a.default)("msgId"),onMsgRequestChange:Object(a.default)("peerId","type"),onMsgRemove:Object(a.default)("msgId"),onMsgListen:Object(a.default)("msgId"),onMsgRestore:Object(a.default)("msgId"),onPeerKeyboard:Object(a.default)("peerId"),onPeerBanner:Object(a.default)("peerId"),onPeerConvert:Object(a.default)("peerId","convertId"),onPeerAdmin:Object(a.default)("peerId","userId","isAdmin"),onDialogImportant:Object(a.default)("peerId","isImportant"),onDialogRemove:Object(a.default)("peerId"),onUnreadCount:Object(a.default)("count"),onResync:Object(a.default)(),_onLpEvents:Object(a.default)("Array<Object>"),init:function(e){se._lpConnect&&(se._onLpEvents.off(),se._lpConnect.stopConnection(),se._lpQueue=null,se._lpConnect=null),se._lpConfig=e},isLongPollingEnabled:function(){return!(!se._lpConnect||se._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",le),window.addEventListener("offline",le),se._lpConnect?se._lpConnect.reinitConnection():se._createLongpoll(se._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",le),window.removeEventListener("offline",le),se._lpConnect&&se._lpConnect.stopConnection()},pause:function(){clog("[longpoll] pause"),se._lpQueue&&se._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),se._lpQueue&&se._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),se._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!se._lpConnect){var t=re(e.ts,function(e){se._onLpEvents(e)}),n=function(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||Y,mode:Q,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&o(i.ts,e.ts,ee(e.updates))},onData:ae(t.onData),onRequestError:ae(t.onRequestError),onHistoryLost:oe(t.onHistoryLost),onKeyExpired:oe(t.onKeyExpired),onLpBroken:oe(t.onHistoryLost)},a=t.onEvents;function o(e,t,n){i.ts=t;for(var o=0;o<n.length;++o)n[o].type===R&&(i.key=n[o].key||"",i.url=n[o].url||"");a(e,t,n)}var r={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,this.abortWaiting()},reinitConnection:function(){this.stopConnection(),ie(i,K),n=!1,ne(i)},abortWaiting:function(){i.waitAbortFns.forEach(function(e){return e()}),i.waitAbortFns=[],i.waitTimeout=2},onLp:o};return ne(i),r}(e,{onEvents:function(e,n,i){i.forEach(function(i){t.onLp(e,n,[i])})},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),t="/mail",(n={act:"get_key",user_id:e.id})&&(n.im_v=l),new Promise(function(e,a){s.post(t,n,{timeout:i,onDone:function(){e.apply(null,[Array.prototype.slice.call(arguments)])},onFail:function(){return a.apply(null,arguments),!0}})});var t,n,i},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});se._lpQueue=t,se._lpConnect=n,se._onLpEvents(function(e){try{e.forEach(se._onEvent)}catch(e){console.error(e)}})}},_onEvent:function(e){var t=e.type;switch(t){case v:var n=e.flags,a=e.messageId;e.peerId;8&n?se.onMsgImportantAdd(a):se.onMsgImportantRemove(a),128&n||64&n?se.onMsgRemove(a):se.onMsgRestore(a);break;case m:var o=e.flags,r=e.messageId,s=e.peerId;8&o&&se.onMsgImportantAdd(r),(128&o||64&o)&&se.onMsgRemove(r,s),4096&o&&se.onMsgListen(r);break;case A:var l=e.flags,c=e.messageId;e.peerId;8&l&&se.onMsgImportantRemove(c),(128&l||64&l)&&se.onMsgRestore(c);break;case g:case N:case H:var u=e.messageId,d=e.peerId,_=e.randomId,f=e.text,p=e.flags,h=e.attaches,S=e.kludges,M=e.date,R=Object(i.toInt)(S.from_admin)||null,V=function(e){if(e.flags&q)return se._lpConfig.id;return e.userId}(e),F=!!S.source_act,U=t===N||t===H,$=p&q,z=!!(65536&p),Q=S.keyboard,Y=function(e,t){t&W&&function(e){e.fwd_count}(e)}(S,p),G={peerId:d,id:u,authorId:V,attaches:h,text:f,ts:M,flags:p,adminId:R,randomId:_,isService:U?void 0:F,edited:!!U||void 0,replaced:t===H,keyboard:Q,isStealth:z,isOut:$,hasReply:Y};U?se.onEditMsg(G):se.onNewMsg(G);break;case b:case y:var X=e.peerId,K=e.upToId;e.unread;t===b?se.onMsgReadByMe(K,X):se.onMsgReadByOther(K,X);break;case w:case k:var J=e.userId,Z=e.platform,ee=(e.reason,e.lastSeenTs),te="mobile";Z&&6!==Z&&7!==Z||(te="desktop"),se.onOnlineChange({userId:J,isOnline:t===w,onlinePlatform:te,lastActionTime:ee});break;case x:case B:var ne=e.mask,ie=e.peerId;e.local;1&ne&&se.onDialogImportant(ie,t===B);break;case P:var ae=e.mask,oe=e.peerId;e.local;se.onDialogImportant(oe,!!(1&ae));break;case D:var re=e.peerId;se.onDialogRemove(re);break;case C:var le=e.peerId,ce=e.updateType,ue=e.updateArg;if(11===ce&&se.onPeerKeyboard(le),10===ce&&se.onPeerBanner(le),13===ce&&se.onPeerConvert(ue,le),12===ce){var de="";switch(ue){case 3:de="created";break;case 2:de="rejected";break;case 1:de="accepted";break;case 0:de="canceled"}se.onMsgRequestChange(le,de)}3===ce&&se.onPeerAdmin(le,ue,!0),9===ce&&se.onPeerAdmin(le,ue,!1);break;case O:var _e=e.peerId,fe=e.userIds,pe=e.totalCount;e.ts;se.onMultiTyping(_e,fe,pe);break;case E:var he=e.peerId,me=e.userIds,ve=e.totalCount;e.ts;se.onRecordingAudio(he,me,ve);break;case j:break;case T:var Ae=e.count,ge=e.countNotMuted,be=e.showOnlyNotMuted;se.onUnreadCount(be?ge:Ae);break;case I:break;case L:se.onResync()}}};t.default=se;function le(e){"online"===e.type?(clog("[longpoll] online"),se._lpConnect.reinitConnection()):(clog("[longpoll] offline"),se._lpConnect.stopConnection())}},XCiN:function(e,t,n){"use strict";n.r(t);var i=n("izth");window.isBootstrapInited||(window.cur={destroy:[]},window.lang={},Object(i.setDocumentDomain)(),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.isBootstrapInited=!0)},XLP4:function(e,t){window.FeedAssistanceImportContacts={importContacts:function(e,t,i){if(!window.XMLHttpRequest||i)return;var a=domData(e,"service-id");return window.open(t),n[a]=e,!1}};var n={},i="feedAssistanceImportContacts__desc",a=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement(function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(a=!0)}),Friends.onImportSuccess(function(){var e=arguments[0],t=arguments[2],o=n[e];if(o){var r=geByClass1(i,o);r.textContent=getLang("mobile_join_friends_found_count",t)}a&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,o,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})}),Friends.onImportFailed(function(e){var t=n[e];t&&(geByClass1(i,t).textContent=getLang("mobile_friends_import_error"))})},Y6JH:function(e,t,n){"use strict";n.r(t);var i=n("fdw3");var a=function(e,t){void 0===e&&(e="common"),void 0===t&&(t=""),Object(i.isObject)(e)&&(t=e.name?e.name:"",e=e.sprite?e.sprite:"");var n=e.split("/").join("-");return{class:"svgIcon svgIcon-"+n+" svgIcon-"+n+"__"+t,tag:"div"}};t.default=a;window.SVGIcon=a},"YU/R":function(e,t,n){"use strict";n.r(t);n("TYsd");var i=n("t7Ww"),a=n("UxAg"),o={open:function(e,t,n){void 0===n&&(n={});var o=e.closest(t),c=!!n.appendToBody,u=Object(a.$)(s.menu,o);u&&(u=i.default.open(u,c),r=function(){l(u)},nav.onBeforeGo(r));return!1},close:l},r=function(){},s={menu:".ContextMenu",open:".ContextMenu.Popup_open"};function l(e){return e||(e=Object(a.$)(".Popup_open.ContextMenu")||Object(a.$)(s.open)),e&&i.default.close(e),nav.onBeforeGo.off(r),!1}t.default=o;window.ContextMenu=o},"aiw/":function(e,t,n){"use strict";n.r(t);var i=999999,a=0,o=0,r=null,s=null;function l(){var e=pageYOffset;0,e!==a&&e!==i&&(a=e,o=Math.max(o,e),scrollTo(0,i)),clearTimeout(s),s=setTimeout(function(){s=null,window.removeEventListener("scroll",l),scrollTo(0,i),setTimeout(function(){return scrollTo(0,i)},1e3)},150)}var c,u,d,_,f,p,h,m,v,A=n("H5mD"),g=0,b=0,y="",w=!1,k={},S=0;function C(e){if(y=e,w=!1,c=!1,d=0,_=0,p=0,h=0,k={},void 0,m="start",v=0,S=0,A.isIPhone)if("top"===y||"bottom"===y){M()<A.IPHONE_KEYBOARD_REJECT_OFFSET&&x(0);var t=document.body;f=t.offsetHeight,t.offsetWidth,window.addEventListener("scroll",E),"top"===y&&Object(A.isLandscapePhone)()||(T(),j())}else document.body.classList.add("ScrollViewsDisabled")}function O(){"top"===y||"bottom"===y?(u&&clearTimeout(u),window.removeEventListener("scroll",E)):document.body.classList.remove("ScrollViewsDisabled"),w=!1,y="",c=!1,f=0,0}function E(){if(T(),"top"!==y){if("bottom"===y){var e=pageYOffset,t=M();c&&(c=!1,e===p)||(A.isWKWebView?h<=5&&j():e>A.IPHONE_KEYBOARD_REJECT_OFFSET?e>t?(x(e),A.isWKWebView||j()):e<t?k[e]||e>I(t)?(k[e]=!0,j(f)):j():e!==I(t)&&j():t||(e<A.IOS_NO_KEYBOARD_ALLOWED_OFFSET?(d===e?_++:(d=e,_=1),_>=3&&(window.removeEventListener("scroll",E),x(d)),setTimeout(function(){j()},300)):j()))}}else{if(Object(A.isLandscapePhone)())return;if(A.isWKWebView)return void(0!==pageYOffset&&j(0));var n=innerHeight;if("start"===m&&(n<f?m="animate":j(1)),"animate"===m)if(v=f-n,S||(S=Math.max(1,Math.min(4,Math.floor(v/10)))),v<=0)m="stop";else{var i=A.isIPad?A.iosMajor<11?3:2:1;j(Math.min(v,S)*i)}"stop"===m&&j(1)}}function j(e){c=!0;var t,n=M();"bottom"===y?t=e||(!n||A.isWKWebView||A.isIPad?f:I(n)):"top"===y&&(t=isFinite(e)?e:1),h++,p=t,window.scrollTo(0,t)}function T(){u&&clearTimeout(u),w||(u=setTimeout(function(){w=!0,u=null,window.removeEventListener("scroll",E)},500))}function I(e){return A.isIPad||A.isWKWebView?e:90===Math.abs(window.orientation)&&screen.width>=375?e:(A.isIPhoneX?e-=A.IPHONE_X_SAFARI_BOTTOM_BAR:e-=A.IPHONE_SAFARI_BOTTOM_BAR,e)}function M(){return 90===Math.abs(window.orientation)?g:b}function x(e){90===Math.abs(window.orientation)?g=e:b=e}var P=null,B=0,L=0;function R(){if(!(visualViewport.height>=B)){var e=B-visualViewport.height;L!==e&&(!A.isWKWebView&&e<A.IOS_NO_KEYBOARD_ALLOWED_OFFSET?scrollTo(0,0):scrollTo(0,e))}}n.d(t,"onOpen",function(){return z}),n.d(t,"onClose",function(){return Q}),n.d(t,"isKeyboardOpen",function(){return Y}),n.d(t,"onCloseCallback",function(){return G}),n.d(t,"offCloseCallback",function(){return X}),n.d(t,"onOpenCallback",function(){return K}),n.d(t,"offOpenCallback",function(){return J});var D=!1,N=!1,H=!1,V=null,F=[],U=[],$=null,q=A.isScrollBasedViewport&&(A.isIPad||A.isWKWebView),W=A.isScrollBasedViewport&&A.iosMajor<=12;function z(e,t){void 0===e&&(e="default");var n=(void 0===t?{}:t).exitIfStarted,c=void 0!==n&&n;if(A.isIOS&&!(A.iosMajor<8)&&!(N&&c||D)){if($=e,N=!0,V&&(clearTimeout(V),V=null),"bottom"===e){if((Object(A.isLandscapePhone)()||!q&&!W)&&!function(){if(P||(P={onceBlocked:!1}),P.onceBlocked&&(P.opened=!0),!P.onceBlocked&&!P.opened){P.onceBlocked=!0;var e=document.activeElement;return e.blur(),e.focus(),!1}return P.opened=!0,window.visualViewport&&(B=visualViewport.height,L=0,setTimeout(R),visualViewport.addEventListener("scroll",R),visualViewport.addEventListener("resize",R)),!0}())return;!q&&W&&C(e),q&&function(e){void 0===e&&(e="default"),r&&(clearTimeout(r),r=null),s&&(clearTimeout(s),s=null),a=0,0,0,o=0,window.addEventListener("scroll",l),setTimeout(function(){scrollTo(0,i)},10),setTimeout(function(){scrollTo(0,i)},100),setTimeout(function(){scrollTo(0,i)},200),setTimeout(function(){scrollTo(0,i)},300),setTimeout(function(){scrollTo(0,i)},400),setTimeout(function(){scrollTo(0,i)},500)}()}else!q&&W&&C(e);U.length&&U.forEach(function(e){return e()}),D=!0,N=!1}}function Q(e){var t=(void 0===e?{}:e).exitIfStarted,n=void 0!==t&&t;if(A.isIOS&&!(A.iosMajor<8)&&(!H||!n)){if(H=!0,"bottom"===$){if((Object(A.isLandscapePhone)()||!q&&!W)&&(!P||P.onceBlocked&&!P.opened||(window.visualViewport&&(setTimeout(R),visualViewport.removeEventListener("scroll",R),visualViewport.removeEventListener("resize",R)),P=null,B=0,L=0,0)))return;if(!D)return;!q&&W&&O(),q&&(clearTimeout(r),clearTimeout(s),a=0,0,0,r=null,s=null,window.removeEventListener("scroll",l))}else!q&&W&&O();D=!1,H=!1,$=null,V&&clearTimeout(V),V=setTimeout(function(){scrollTo(0,0),F.length&&F.forEach(function(e){return e()})},10)}}function Y(){return D}function G(e){-1===F.indexOf(e)&&F.push(e)}function X(e){var t=F.indexOf(e);-1!==t&&F.splice(t,1)}function K(e){-1===U.indexOf(e)&&U.push(e)}function J(e){var t=U.indexOf(e);-1!==t&&U.splice(t,1)}},bRFj:function(e,t){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(e,t,n,a,r,s,l,c){void 0===n&&(n="");void 0===a&&(a=null);void 0===r&&(r="");void 0===s&&(s="");void 0===l&&(l=o);void 0===c&&(c=o);_(i,e,t,n,a,r,s,l,c)},decline:function(e,t,n,i,r,s,l,c){void 0===n&&(n="");void 0===i&&(i=null);void 0===r&&(r="");void 0===s&&(s="");void 0===l&&(l=o);void 0===c&&(c=o);_(a,e,t,n,i,r,s,l,c)},makeImportRequest:function(e,t,n){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},function(e){return function(e,t,n){var i=parseJSON(e),a=i.user,o=i.user_hash,_=i.contacts,p=r+n;if(i.error)return void f(n);ajax.post(p,{_ajax:1,user:a,userhash:o,hash:t,contacts:_},{onDone:function(e,t){return function(e,t,n){var i=geByClass1(s),a=geByClass1(c);addClass(l,i),a&&(a.innerHTML=t,addClass(u,a));autoScroll(function(){return geByClass1(d)},ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,n),window.opener&&window.opener.Friends.onImportSuccess(e,t,n)}(n,e,t)},onFail:function(){return f(n)}})}(e,t,n)},function(){return f(n)},!0)}};var n="/friends",i="accept",a="decline",o=null,r="/friends.php?act=save_contacts&type=",s="friendsImport__loading",l=s+"_hidden",c="friendsImport__result",u=c+"_shown",d="friendsList__footerBtn_showMore";function _(e,t,i,a,o,r,s,l,c){var u={act:e,hash:i,id:t};a&&(u.from=a),o&&(u.block_id=o),r&&(u.ref=r),s&&(u.track_code=s);var d=n+obj2qs(u);ajax.post(d,{_ajax:1},{onDone:l,onFail:c})}function f(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},bYEY:function(e,t,n){"use strict";n.r(t);var i=n("QQoL"),a=function(){var e=window.store,t="/feed?section=notifications";return Object(i.default)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})};t.default=a;window.uBell=a},"bZ/P":function(e,t,n){"use strict";n.r(t);var i={};function a(e,t){return e+'="'+t+'"'}function o(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(e,r(n))}}function r(e){return e[0]+"("+e.slice(1).map(s).join(", ")+")"}function s(e){return"number"==typeof e||"event"===e||"this"===e?e:JSON.stringify(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}Object.assign(i,{html:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a="";return e.forEach(function(e,t){var i=n[t];a+=e+(i||0===i?i:"")}),a}}),Object.assign(i,{attr:a,onBlur:o("onblur"),onClick:o("onclick"),onFocus:o("onfocus"),onInput:o("oninput"),onKeyDown:o("onkeydown"),onKeyPress:o("onkeypress"),onKeyUp:o("onkeyup"),onMouseDown:o("onmousedown"),onMouseUp:o("onmouseup"),onScroll:o("onscroll"),onSubmit:o("onsubmit"),onTouchEnd:o("ontouchend"),onTouchMove:o("ontouchmove"),onTouchStart:o("ontouchstart"),onWheel:o("onwheel"),onChange:o("onchange")}),Object.assign(i,{list:function(e,t){void 0===t&&(t=null);Array.isArray(e)||(e=[e]);return t?e.map(t).join(""):e.join("")}}),Object.assign(i,{class:function(){for(var e=[],t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach(function(n){"string"==typeof n?(e.push(n),t=n):n&&(e=e.concat(function(e,t){var n,i=[];"string"==typeof t&&((n={})[t]=!0,t=n);return Object.keys(t).forEach(function(n){var a=t[n];!0===a?i.push(e+"_"+n):a&&i.push(e+"_"+n+"_"+a)}),i}(t,n)))}),e.join(" ")},parseClass:function(e,t){var n={};return t.trim().split(/\s+/).forEach(function(t){if(t!==e){var i=t.replace(e+"_","").split("_");n[i[0]]=!(i.length>1)||i[1]}}),n}});t.default=i;window.q=i},cGUQ:function(e,t,n){"use strict";n.r(t),n.d(t,"fromQueryString",function(){return l}),n.d(t,"toQueryString",function(){return s});var i=n("jE6c"),a={},o=function(e){if(a[e])return e;try{return encodeURIComponent(e)}catch(e){return""}},r=function(e){try{return decodeURIComponent(e)}catch(t){return a[e]=1,e}};function s(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)&&null!=e[a]&&!Object(i.isFunction)(e[a]))if(Object(i.isArray)(e[a]))for(var r=0,s=0,l=e[a].length;r<l;++r)null==e[a][r]||Object(i.isFunction)(e[a][r])||(n.push(o(a)+"["+s+"]="+o(e[a][r])),++s);else n.push(o(a)+"="+o(e[a]));return t||n.sort(),n.join("&")}function l(e){if(!e)return{};var t={};return e=e.split("&"),Object(i.each)(e,function(e,n){var i=n.split("=");if(i[0]){var a=r(i[1]+"");if("[]"===i[0].substr(i.length-2)){var o=r(i[0].substr(0,i.length-2));t[o]||(t[o]=[]),t[o].push(a)}else t[r(i[0])]=a}}),t}},cLcH:function(e,t){window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,d,_,p,h){var m=hasClass(e,n),v=m?_:d,A=m?getLang(s):getLang(r),g=!m,b=geByClass1(o,e),y=(w=e,k=domCA(w,u),intval(domData(k,"block-id")));var w,k;b&&(toggleClass(i,b,g),toggleClass(a,b,!g));attr(e,"aria-label",escapeAttr(A)),toggleClass(n,e,g),p===c?function(e,t,n,i){var a=n?Groups.leave:Groups.enter,o=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;i&&f(o),a.call(Groups,e,t,l)}(t,v,m,h):function(e,t,n,i,a){var o=n?Friends.decline:Friends.accept,r=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&f(r),o.call(Friends,e,t,l,i)}(t,v,m,y,h);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(e._exploreBaitClickHandlerAdded)return;d=!0,addEvent(e,"click",function(e){!function(e){var t=e.target,n=p,i=Array.isArray(n),a=0;for(n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if((a=n.next()).done)break;o=a.value}if(!0===o.call(null,t))return}}(e)}),e._exploreBaitClickHandlerAdded=!0}}),nav.onBeforeGo(function(e){if(!d)return void(_=!1);if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;_=hasClass("item_replies",e),function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){if(hasClass(n[t],e))return f(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)}),page.onChange(function(){if(!d)return;_&&function(){var e=ge("nc_submit");addEvent(e,"click",function(){f(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_COMMENT)})}()});var n="post__subscribeBtn_unsubscribe",i="post__subscribeBtnIcon_unsubscribe",a="post__subscribeBtnIcon_subscribe",o="post__subscribeBtnIcon",r="mobile_groups_you_are_in_public",s="mobile_groups_public_subscribe",l="feed",c="group",u=".post_exploreBait",d=!1,_=!1;function f(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var p=[function(e){if("A"!==e.tagName||!hasClass("item_sel",e))return hasClass("item_like",e)?(f(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):(hasClass("i_like",e)||hasClass("v_like",e))&&!hasClass("item_sel",domPN(e))?(f(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):void 0},function(e){if(domData(e,"post-owner-type"))return f("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return f(t),!0}]},ciqL:function(e,t){var n={show:function(e,t){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){n.onCallback(e)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+t})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(e){if(grecaptcha&&e){var t=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",t);i&&(val(i,""),grecaptcha.render(i,{sitekey:e,callback:n.onResponse}))}}};window.ReCaptcha=n},eoxF:function(e,t){var n=function(){var e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l="",c="";function u(e,t){return!t&&A(e)}function d(e){i=!1;var n=ge("medias_map"),a=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),append(n,a));var o=+e[1]||0,r=e[3]||"",s=e[4]||"",l=e[5]||"",c=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",n),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+r+(l?", "+l:s?", "+s:"")+"</div>",_='<input type="hidden" name="place_id" value="'+o+'"><input type="hidden" name="place" value="'+c+'">';if(u)val(u,d+_);else{d='<div class="medias_map">'+d+_+"</div>";val(n,d)}addClass("cp_geo_btn_sel","geo_btn"),t=!0,show(n)}function _(t){return A(e)}function f(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function p(t,n){h();var i=a[n];i&&(e={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):m(e,i))}function h(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function m(e,n){i=!0;var a=ge("medias_map"),o=ge("attached_wrap");a||(a=ce("div",{id:"medias_map",className:"pi_medias"}),o.appendChild(a));var r=e.latitude,s=e.longitude,l=(window.devicePixelRatio,n&&n[4]||!1),c=geByClass1("medias_map",a),u=l?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+l+"</div>":"",d='<input type="hidden" name="map" value="'+(r+"_"+s+"_0")+'">';c?val(c,u+""+d):val(a,'<div class="medias_map">'+u+d+"</div>");t=!0,addClass("cp_geo_btn_sel","geo_btn"),show(a)}function v(){e=null,a={},o=[],r=0,ajax.post(c,{_ajax:1}),remove("medias_map")}function A(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,a=gpeByTag("form","geo_btn"),o=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!a)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var r=!1;return each(a,function(e,t){if("submit"===t.type)return r=t,!1}),r?(append(o,a),window.al&&t.ver?nav.go(r,null,{removeAfterNextResponse:!1}):a.submit()):void 0}function g(t){t&&t.coords&&u(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0})}function b(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},addNewPlace:function(){var t=val("place_name_fld"),n=val("place_address_fld");return t?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:e.latitude,longitude:e.longitude,title:t,address:n,hash:l},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(a,n),o.splice(o[0]?0:1,0,e),f(),p(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(t,n){var i=window.lang,a="/places.php"+obj2qs({act:"add_place",latitude:e.latitude,longitude:e.longitude,hash:l});val("place_add_box",'<h4 class="sub_header">'+i.mobile_geo_new_place_header+'</h4><div class="form_item fi_fat"><form id="place_add_form" action="'+a+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(t)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),t?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:f,selectPlace:p,changePlace:_,back:h,refreshCurrentPosition:function(){geo.getCurrentPosition(g,b)},getCurrentAddress:function(){return a[0]&&a[0][5]||""},savePlaces:function(e){extend(a,e)},add:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(g,b),show("geo_waiting"))},add_place:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(g,b),show("geo_waiting"))},remove:function(){t=!1,removeClass("cp_geo_btn_sel","geo_btn"),v()},stash:function(n){if(!n)return[e,t,i,a,o,r,s];e=n[0],t=n[1],i=n[2],a=n[3],o=n[4],r=n[5],s=n[6]},init:function(u,d,_){return hide("geo_waiting"),e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l=d||"",c=_||"",u&&n.add(u),geo.init()}}}();window.checkin=n},eyw1:function(e,t){var n=function(){var e="/club",t="enter",n="leave",i=null;function a(t,n,i,a,o,r){var s=e+n+obj2qs({act:t,hash:i,id:n,from:a});ajax.post(s,{_ajax:1},{onDone:o,onFail:r})}return{enter:function(e,n,o,r,s){void 0===r&&(r=i),void 0===s&&(s=i),a(t,e,n,o,r,s)},leave:function(e,t,o,r,s){void 0===r&&(r=i),void 0===s&&(s=i),a(n,e,t,o,r,s)}}}();window.Groups=n},fWqt:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"onConfirmDelete",function(){return d}),n.d(i,"open",function(){return _}),n.d(i,"close",function(){return f}),n.d(i,"isDeleteMessagesForAll",function(){return p});var a=n("MUpH"),o=n("bZ/P"),r=n("+cqQ"),s=n("iS9e");function l(){var e=Object(a.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c="MsgDeleteDialog__checkboxInput",u=null,d=Object(r.default)();function _(e){s.default.open({body:h(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:o.default.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:o.default.onClick("MsgDeleteDialog.close")})}function f(){var e=$("."+c);e&&(u=e.checked,lsSet("delete_message_for_all_checked",u)),s.default.close()}function p(){var e=$("."+c);return!!e&&e.checked}function h(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var r=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(r,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var s=lang.mobile_mail_delete_for_all,d=function(){if("boolean"!=typeof u){var e=!!lsGet("delete_message_for_all_checked");u=e}return u}()?"checked":"";n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="'+c+'" '+d+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+s+"</span>\n        </label>\n      </div>\n    "}return o.default.html(l(),t,n)}t.default=i;window.MsgDeleteDialog=i},fYoA:function(e,t){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=i;var n={notifyGroup:".settingsNotifyGroup",description:".settingsNotifyGroup__description"};function i(e,t){t.$control.closest(n.notifyGroup).$(n.description).innerHTML=e}},g3t9:function(e,t,n){"use strict";n.r(t),n.d(t,"Separator",function(){return a});var i=n("z9sQ");function a(e){return void 0===e&&(e={}),{class:i.default.class("Separator",{hideOnDesktop:e.hideOnDesktop,noOffset:e.noOffset,gray:e.gray},"--"),tag:"div"}}t.default=a},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r}),n.d(t,"getVisibilityState",function(){return c}),n.d(t,"getVisiblityEvent",function(){return u});var i=n("uQjJ"),a=n("JuPy"),o=browser.iphone||browser.ipad||browser.ipod;function r(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,n){Object(a.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(a.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(r.prototype,i.default.prototype),extend(r.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&s(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNTM:function(e,t){var n=function(){var e=null,t=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var a=e.latitude,o=e.longitude,r=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",l='<input type="hidden" name="map" value="'+(a+"_"+o+"_0")+'">';r?val(r,s+""+l):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+l+"</div>");show(n)}function a(){e=null,remove("medias_map")}function o(t){var n;t&&t.coords&&(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0},n=e,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:r}))}function r(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},add:function(n){!n&&t||(t=!0,addClass("cp_geo_btn_sel","geo_btn"),n&&(n.latitude||n.longitude)?i(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.label):(geo.getCurrentPosition(o,r),show("geo_waiting")))},remove:function(){t&&(t=!1,removeClass("cp_geo_btn_sel","geo_btn"),a())},init:function(e){return e&&n.add(e),geo.init()}}}();window.geoloc=n},gunf:function(e,t){window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("loginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",function(){return nav.clear(),nav.go(n,null,{isForm:!0})})}}},gy8s:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=n("9y81"),r=n("AXyT"),s=n("Y6JH"),l=(n("fdw3"),function(e){var t="unfold-"+Date.now()+"-"+Math.round(9999*Math.random());e.uniqueId=t;var n=i.default.class(e.mix,"Unfold",{position:e.position,asIcon:!!e.icon||!!e.icon_html,open:e.opened,withTitle:!!e.title}),a=i.default.list(e.items,u);return Wd.html({class:n,"data-name":e.name,onclick:e.onclick,inner:[c(e),{id:t,class:["Unfold__popup","ScrollView",e.popup_class].filter(function(e){return e}).join(" "),inner:Wd.wrap(a)}]})});function c(e){i.default.onClick("Unfold._onTriggerClick","this`");var t,n=e.title;if(e.icon)t=Object(o.default)({icon:e.icon});else if(e.icon_html)t=e.icon_html;else{for(var r=e.items,l=r.length,c="",u="",d=0;d<l;d++){var _=r[d];if(_&&_.active){c=_.text,u=_.activeCount;break}}t=[Object(a.default)({mix:"Unfold__triggerText",tag:"h1",inner:[Wd.html({class:"Unfold__triggerContent",inner:n?[{class:"Unfold__triggerContentTitle",inner:n},{class:"Unfold__triggerContentSubTitle",inner:c}]:[c,u?Wd.html(Object(a.default)({mix:"Unfold__triggerTextCount",inner:u})):""]})]}),Wd.html({class:"Unfold__triggerIcon",inner:Object(s.default)("base","dropdown_16")})],t=i.default.list(t)}var f=e.opened?e.close_url:e.open_url;return{tag:"button",type:"button","aria-haspopup":"true","aria-expanded":"false","aria-controls":e.uniqueId,href:f,class:"Unfold__trigger",onclick:["Unfold._onTriggerClick","this"],attrs:e.trigger_attrs,inner:Wd.wrap(t)}}function u(e){if(!e)return"";var t="";return e.svgIcon?t=Wd.html({class:"Unfold__itemIcon",inner:e.svgIcon}):e.icon&&(t="string"==typeof e.icon?Object(o.default)({mix:"Unfold__itemIcon",icon:e.icon}):Object(a.default)({mix:i.default.class("Unfold__itemIcon",e.icon.class)})),Object(a.default)({mix:i.default.class(e.mix,"_touched","replaceState","Unfold__item",{active:e.active,name:e.name,disabled:e.disabled}),url:e.url,tag:e.tag,attrs:e.attrs,inner:[t,Object(a.default)({mix:"Unfold__itemText",inner:[e.text,e.count?Object(a.default)({mix:"Unfold__itemCountHidden",inner:e.count}):""]}),e.count?Object(r.default)({mix:"Unfold__itemCount",gray:!0,value:e.count}):""]})}var d=n("jk6M"),_=n("CQvH");Object.assign(l,{onOpen:befall.kind("unfoldName"),getByName:function(e){return $(p.unfoldByName(e))},setActive:function(e,t){var n,i;1===arguments.length?e=(i=e).closest(p.unfold):i=e.$(p.itemByName(t));if((n=e.$(p.itemActive))&&i){n.classList.remove(f.itemActive),i.classList.add(f.itemActive);var a=e.$(p.triggerText),o=i.$(p.itemText);a.innerText=o.textContent.trim()}},setCount:function(e,t,n){var i=e.$(p.itemCountByName(t));r.default.setValue(i,n)},setTitle:function(e,t,n){e.$(p.itemByName(t)).$(p.itemText).innerText=n},toggleItemEnabled:function(e,t,n){void 0===n&&(n=!0);var i=e.$(p.itemByName(t));i&&i.classList.toggle(f.itemDisabled,!n)},changePosition:function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!1);var i;e.classList.remove(f.positionTopLeft,f.positionTopRight,f.positionBottomLeft,f.positionBottomRight),i=t?n?f.positionTopLeft:f.positionBottomLeft:n?f.positionTopRight:f.positionBottomRight;e.classList.add(i)}}),l._onTriggerClick=h;var f={itemActive:"Unfold__item_active",itemDisabled:"Unfold__item_disabled",open:"Unfold_open",positionTopLeft:"Unfold_position_topLeft",positionTopRight:"Unfold_position_topRight",positionBottomLeft:"Unfold_position_bottomLeft",positionBottomRight:"Unfold_position_bottomRight"},p={unfold:".Unfold",unfoldByName:function(e){return'.Unfold[data-name="'+e+'"]'},itemActive:"."+f.itemActive,itemByName:function(e){return".Unfold__item_name_"+e},itemCountByName:function(e){return p.itemByName(e)+" .Unfold__itemCount"},item:".Unfold__item",itemDisabled:"."+f.itemDisabled,triggerText:".Unfold__triggerText",itemText:".Unfold__itemText",popup:".Unfold__popup"};function h(e){var t=e.closest(p.unfold),n=d.isTouch?"touchend":"mousedown",i=d.isTouch?"touchend":"mouseup",a=!d.isTouch&&window.innerWidth<882,o=t.getAttribute("data-name"),r=!1;o&&l.onOpen(o)(),t.classList.add(f.open),document.addEventListener("touchmove",m),d.default.msie_mobile?document.addEventListener(i,v,!0):document.addEventListener(n,A,!0);var s=function(){},c=function(){},u=$(p.popup,t);function h(){t.classList.remove(f.open),document.removeEventListener("touchmove",m),document.removeEventListener(n,A,!0),document.removeEventListener(i,v,!0),s&&s(),c()}function m(e){e.target.closest(p.popup)||h(),r=!0}function v(){document.addEventListener(n,A,!0)}function A(e){if(r)r=!1;else{var t=e.target.closest(p.itemDisabled);if(!t){var n=e.target.closest(p.item+"[href]");if(n)return void(d.default.safari&&d.default.safari_mobile&&d.default.version<9?setTimeout(h,500):(cancelEvent(e),nav.onBeforeGo(function(){h()}),nav.go(n)));if(n=e.target.closest(p.item+"[onmousedown]"))return void setTimeout(h);if(n=e.target.closest("label"+p.item))return void(d.default.safari&&d.default.safari_mobile&&d.default.version<9?setTimeout(h,500):setTimeout(h));if(n=e.target.closest("input[onchange]"))return void(d.default.safari&&d.default.safari_mobile&&d.default.version<9?setTimeout(h,500):setTimeout(h))}(d.isTouch||a||t)&&(e.preventDefault(),e.stopImmediatePropagation()),(a||!d.isTouch&&t)&&document.addEventListener("click",g,!0),t||h()}}function g(e){e.preventDefault(),e.stopImmediatePropagation(),document.removeEventListener("click",g,!0)}u&&(c=Object(_.expandPopup)(e),(s=Object(_.setFocusTrap)(u))&&(s.exitIntent=function(){h()}))}t.default=l;window.Unfold=l},h8oe:function(e,t,n){"use strict";n.r(t);var i=n("Fkq0"),a=n("z9Td"),o=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],r=0,s=o.length;r<s;r++,a++)i[a]=o[r];return i},r="market_event_count",s="market_event_item_",l=20,c="al_market.php",u="market.php";function d(e,t,n,a){var c=window.cur.marketAnalyticsHash?window.cur.marketAnalyticsHash:void 0!==window.cur.mkOptions&&void 0!==window.cur.mkOptions.marketAnalyticsHash?window.cur.mkOptions.marketAnalyticsHash:"";if(c){var u=n.slice(0,10),d=0,f=localStorage.getItem(r);f&&(d=parseInt(f)),d>=l&&(_(e),d=0);var p=Date.now(),h=Math.floor(1e5*Math.random()),m=""+s+h+"_"+p+"_"+t;u.unshift(p),u.unshift(t),u.push(c),localStorage.setItem(m,JSON.stringify(u)),localStorage.setItem(r,String(++d)),a&&_(e),i.marketDebug.apply(void 0,o(["debug","event",t],n))}else Object(i.marketDebug)("warn","events","Hash error")}function _(e){var t=Object.keys(localStorage);t=t.filter(function(e){return 0===e.lastIndexOf("market_event_item_")}),localStorage.setItem(r,String(0));var n=[],o="";t.forEach(function(e){var t=localStorage.getItem(e);if(localStorage.removeItem(e),t)try{var a=JSON.parse(t);o?a.pop():o=a.pop(),n.push(Object.values(a))}catch(e){Object(i.marketDebug)("error","event error","Unable to assemble events pack",e)}}),!o||n.length<1||window.ajax.post(e===a.PLATFORM_MVK?u:c,{act:"log_events",hash:o,events:n},{onDone:function(){Object(i.marketDebug)("warn","events sent",n.length+" events sent")}})}var f=function(){function e(){}return e.prototype.connectMutator=function(t){if(this.mutationObserver)throw new Error("{Observer #"+t.getObserverId()+"} MutationObserver already connected to observer");var n=document.querySelector(t.getContainerQuery());n instanceof HTMLElement&&(this.mutationObserver=new MutationObserver(function(n){n.forEach(function(n){if(n.addedNodes)for(var i=0;i<n.addedNodes.length;i++){var a=n.addedNodes[i];if(a instanceof HTMLElement){var o=e.resolveNodes(a,t).filter(function(e){return!!e});o&&(o.forEach(function(e){t.add(e)}),t.scan())}}})}),this.mutationObserver.observe(n,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},e.prototype.disconnectMutator=function(e){e.isRunning()&&this.mutationObserver&&this.mutationObserver.disconnect()},e.resolveNodes=function(e,t){var n=[];if(t.getSelectorQuery(!1).split(",").forEach(function(t){if(e.matches(t))return n.push(e),!1}),n.length<1){var i=e.querySelectorAll(t.getSelectorQuery(!1));n=Array.from(i)}return n},e}(),p=n("BJj/"),h={};var m,v=function(){function e(e,t,n,i,a){var o;if(void 0===i&&(i=20),void 0===a&&(a=!1),this.observerId=e,this.container=t,this.itemSelector=n,this.debounceTimeout=i,this.isUnifyNodes=a,this.trackingItems={},this.uniqueNodeCounter=0,this.nodes=[],this.isWatching=!1,this.mutatorList=[],(o=this).getObserverId()in h&&(h[o.getObserverId()].stop(),delete h[o.getObserverId()]),h[o.getObserverId()]=o,!this.itemSelector.types&&!this.itemSelector.selectors)throw new Error("Empty itemSelector definition")}return Object.defineProperty(e.prototype,"itemReachedCallback",{set:function(e){this._itemReachedCallback=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preCheckReachedCallback",{set:function(e){this._preCheckReachedCallback=e},enumerable:!0,configurable:!0}),e.prototype.getObserverId=function(){return this.observerId},e.prototype.getItemSelector=function(){return this.itemSelector},e.prototype.add=function(e){this.nodes.push(e)},e.prototype.getTrackingItems=function(){return this.trackingItems},e.prototype.addMutators=function(e){this.mutatorList=this.mutatorList.concat(e)},e.prototype.isRunning=function(){return this.isWatching},e.prototype.watch=function(){this.isWatching||(this.update(),this.startObserving(),this.connectMutators(),this.isWatching=!0)},e.prototype.stop=function(){this.isWatching&&(this.stopObserving(),this.disconnectMutators(),this.isWatching=!1)},e.prototype.scan=function(){this.viewportScanner()},e.prototype.connectMutators=function(){var e=this;this.mutatorList.forEach(function(t){t.connectMutator(e)})},e.prototype.disconnectMutators=function(){var e=this;this.mutatorList.forEach(function(t){t.disconnectMutator(e)})},e.prototype.getContainerQuery=function(){var e=this.container.substr(0,1);return"#"===e||"."===e?this.container:'[data-stat-container="'+(this.container?this.container:this.observerId)+'"]'},e.prototype.getSelectorQuery=function(e){void 0===e&&(e=!0);var t=this.getContainerQuery(),n=[];return this.itemSelector.selectors?n=this.itemSelector.selectors.split(",").map(function(n){return e?t+" "+n:n}):this.itemSelector.types&&(n=this.itemSelector.types.split(",").map(function(n){return e?t+' [data-stat-item^="'+n+'|"]':'[data-stat-item^="'+n+'|"]'})),n.join(",")},e.prototype.update=function(){var e=document.querySelectorAll(this.getSelectorQuery());this.nodes=Array.from(e)},e.parseStatAttribute=function(e){var t,n=null===(t=e.getAttribute("data-stat-item"))||void 0===t?void 0:t.split("|");return n?{type:n[0],ownerId:parseInt(n[1]),itemId:parseInt(n[2])}:{type:"",ownerId:0,itemId:0}},e.prototype.getNodeKey=function(e,t){var n=String(t.itemId);this.isUnifyNodes&&(this.unifyNode(e),n=n+"_"+e.getAttribute("data-stat-id"));return this.observerId+"_"+n},e.prototype.isItemReached=function(e){return!(void 0!==this._preCheckReachedCallback&&!this._preCheckReachedCallback(e))&&this.isReached(e)},e.prototype.filterItem=function(e){return!e.isTracked&&!e.isReached&&(this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.persist(e),!0))},e.prototype.track=function(e){e.isTracked||(e.viewEnd=Date.now(),e.duration=e.viewEnd-e.viewStart,this._itemReachedCallback(e),e.isReached=!1,e.isTracked=!0)},e.prototype.persist=function(e){this.trackingItems[e.key]=e},e.prototype.getTrackingItem=function(t){var n=e.parseStatAttribute(t);if(!n.type||!n.itemId)return null;var i=this.getNodeKey(t,n);return i?i in this.trackingItems?this.trackingItems[i]:this.createTrackingItem(t,n):null},e.prototype.createTrackingItem=function(e,t){var n=this.getNodeKey(e,t);return this.trackingItems[n]={key:n,type:t.type,observerId:this.observerId,ownerId:t.ownerId,itemId:t.itemId,isTracked:!1,isReached:!1,viewStart:0,viewEnd:0,duration:0,node:e,viewTimer:0,data:{}},this.trackingItems[n]},e.prototype.getNextUnifyId=function(){return++this.uniqueNodeCounter},e.prototype.unifyNode=function(e){e.getAttribute("data-stat-id")||e.setAttribute("data-stat-id",String(this.getNextUnifyId()))},e.prototype.startObserving=function(){var e=this;this.update(),this.viewportScanner=Object(p.debounce)(function(){e.nodes=e.nodes.filter(function(t){var n=e.getTrackingItem(t);return!!n&&e.filterItem(n)})},this.debounceTimeout),this.scrollEventListener=function(){return e.scan()},document.addEventListener("scroll",this.scrollEventListener,{passive:!0}),this.scan()},e.prototype.stopObserving=function(){document.removeEventListener("scroll",this.scrollEventListener),this.nodes=[],this.viewportScanner=function(){},this.scrollEventListener=function(){}},e}(),A=(m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),g=3e4;var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return A(t,e),t.prototype.filterItem=function(e){return!e.isTracked&&(e.isReached&&!this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.isItemReached(e.node)&&this.view(e),this.persist(e),!0))},t.prototype.view=function(e){var t=this;e.isTracked||(e.isReached=!0,e.viewStart||(e.viewStart=Date.now()),e.viewTimer&&(clearTimeout(e.viewTimer),e.viewTimer=0),e.viewTimer=window.setTimeout(function(){var n=e.node;!t.isItemReached(n)||function(e){var t=e.viewStart;return Date.now()-t>g}(e)?t.track(e):t.view(e)},3e3))},t.prototype.track=function(t){t.viewTimer&&(clearTimeout(t.viewTimer),t.viewTimer=0),e.prototype.track.call(this,t)},t}(v),y=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),w=function(e){function t(t,n,i,a,o,r){void 0===a&&(a=20),void 0===o&&(o=!1),void 0===r&&(r=!1);var s=e.call(this,t,n,i,a,o)||this;return s.observerId=t,s.container=n,s.itemSelector=i,s.debounceTimeout=a,s.isUnifyNodes=o,s.isWithMutations=r,r&&s.addMutators([new f]),s}return y(t,e),t.prototype.isReached=function(e){return!!Object(i.isElementVisible)(e)&&!!Object(i.isElementInViewport)(e,45)},t.create=function(e){var n,i,a;return new t(e.observerId,e.container,e.itemSelector,null===(n=e)||void 0===n?void 0:n.debounceTimeout,null===(i=e)||void 0===i?void 0:i.isUnifyNodes,null===(a=e)||void 0===a?void 0:a.isWithMutations)},t}(b),k=n("+UAi");n.d(t,"TABLE_ECOMM_GOODS",function(){return C}),n.d(t,"TABLE_ECOMM_ORDERS",function(){return O}),n.d(t,"rescan",function(){return P}),n.d(t,"trackMarketEvent",function(){return B}),n.d(t,"observeMarketScreen",function(){return L}),n.d(t,"observeUserProfileScreen",function(){return R}),n.d(t,"observeGroupScreen",function(){return D});var S=function(){return(S=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},C="ecomm_goods",O="ecomm_orders",E=20,j=[],T=!1;function I(e,t){void 0===t&&(t=0);var n=M(t);return!!n&&e.includes(n.event)}function M(e){return void 0===e&&(e=0),j.length>e?j[j.length-(1+e)]:null}function x(e){T||(window.addEventListener("beforeunload",function(){!function(){for(var e in h)if(h[e]){var t=h[e],n=t.getTrackingItems();for(var i in n)if(n[i]){var a=n[i];!a.isTracked&&a.isReached&&(t.track(a),t.persist(a))}}}(),_(e)}),T=!0)}function P(){!function(){for(var e in h){if(h[e])h[e].scan()}}()}function B(e){if(function(e){var t=M();if(t){if(e===k.EVENT_CLOSE_ITEM&&t.event===k.EVENT_CLOSE_ITEM)return!1;if(e===k.EVENT_TRANSITION_TO_ITEM){if(I([k.EVENT_TRANSITION_TO_ITEM_LEFT,k.EVENT_TRANSITION_TO_ITEM_RIGHT]))return!1;if(I([k.EVENT_SWITCH_ITEM_VARIANT_1,k.EVENT_SWITCH_ITEM_VARIANT_2]))return!1}}return!0}(e.event)){e.screen=e.screen?e.screen:window.cur.marketAnalyticsScreen?window.cur.marketAnalyticsScreen:"",e.platform=e.platform?e.platform:"web",x(e.platform),e.table||(e.table=C);var t=e.table+":"+e.event;e.instant?function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];d(e,t,n,!0)}(e.platform,t,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration):function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];d(e,t,n,!1)}(e.platform,t,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration),j.push(e),j.length>3&&j.shift()}}function L(e){void 0===e&&(e="");var t={productParams:{observerId:"market_products",container:"market_products",itemSelector:{types:"market_item"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!0},albumParams:{observerId:"market_albums",container:"market_albums",itemSelector:{types:"market_album"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!1}};_(e);var n=function(t){var n=0;void 0!==window.cur.aid&&(n=window.cur.aid);var i={ownerId:t.ownerId,duration:t.duration,time:t.viewStart,screen:"",platform:e};B("market_album"===t.type?S(S({},i),{event:k.EVENT_VIEW_ALBUM,itemId:0,albumId:t.itemId}):S(S({},i),{event:k.EVENT_VIEW_ITEM,itemId:t.itemId,albumId:n}))},i=w.create(t.productParams);i.itemReachedCallback=n;var o=w.create(t.albumParams);o.itemReachedCallback=n,e!==a.PLATFORM_MVK&&(o.preCheckReachedCallback=function(e){var t,n=e.offsetTop,i=null===(t=e.parentNode)||void 0===t?void 0:t.parentNode;return i&&n<i.offsetHeight}),i.watch(),o.watch()}function R(e){void 0===e&&(e=""),_(e);var t=w.create({observerId:"user_wall",container:"user_wall",itemSelector:{types:"market_item"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!0});t.itemReachedCallback=function(t){B({ownerId:t.ownerId,itemId:t.itemId,duration:t.duration,time:t.viewStart,albumId:0,platform:e,event:k.EVENT_VIEW_ITEM})},t.watch()}function D(e){void 0===e&&(e="");var t={thumbsParams:{observerId:"thumbs",container:e===a.PLATFORM_MVK?".profile_info_cont .profile_market_block .profile_market":"market_module",itemSelector:{types:"market_item"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!1},productSnippetsParams:{observerId:"product_snippets",container:e===a.PLATFORM_MVK?".wall_posts":"group_wall",itemSelector:{types:"market_item"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!0},albumSnippetsParams:{observerId:"album_snippets",container:e===a.PLATFORM_MVK?".wall_posts":"#group_wall",itemSelector:{types:"market_album"},debounceTimeout:E,isUnifyNodes:!0,isWithMutations:!0}};_(e);var n=function(t){var n={ownerId:t.ownerId,duration:t.duration,time:t.viewStart,screen:"",albumId:0,platform:e};B("market_album"===t.type?S(S({},n),{event:k.EVENT_VIEW_ALBUM,itemId:0,albumId:t.itemId}):S(S({},n),{event:k.EVENT_VIEW_ITEM,itemId:t.itemId}))},i=w.create(t.thumbsParams);i.itemReachedCallback=n;var o=w.create(t.productSnippetsParams);o.itemReachedCallback=n;var r=w.create(t.albumSnippetsParams);r.itemReachedCallback=n,i.watch(),o.watch(),r.watch()}},hw56:function(e,t,n){"use strict";n.r(t),n.d(t,"getKeyboardState",function(){return o}),n.d(t,"getKeyboardType",function(){return r}),n.d(t,"setKeyboardType",function(){return s}),n.d(t,"loadDrafts",function(){return l}),n.d(t,"getPeerDraft",function(){return c}),n.d(t,"setPeerDraft",function(){return u}),n.d(t,"pushPeerAttachments",function(){return d}),n.d(t,"popPeerAttachments",function(){return _}),n.d(t,"setPeerTyping",function(){return f}),n.d(t,"removePeerTypingUser",function(){return p}),n.d(t,"filterPeerTypingUser",function(){return h}),n.d(t,"replacePeer",function(){return v}),n.d(t,"removePeer",function(){return A}),n.d(t,"addPeer",function(){return g}),n.d(t,"addPendingMsg",function(){return b}),n.d(t,"getPendingMsg",function(){return y}),n.d(t,"removePendingMsg",function(){return w}),n.d(t,"removeFailedMsg",function(){return k}),n.d(t,"failAllPendingMsgs",function(){return S}),n.d(t,"queueToPresendMsgs",function(){return C}),n.d(t,"saveFolderScroll",function(){return O}),n.d(t,"restoreFolderScroll",function(){return E});var i=n("wx14"),a=(n("2IoG"),n("qHA9"));function o(e){var t=store.mail.cur.keyboards,n=t[e];return n||(n=t[e]={}),n}function r(){return store.mail.cur&&store.mail.cur.keyboardType||""}function s(e){store.mail.cur&&(store.mail.cur.keyboardType=e)}function l(e){var t=store.mail.cur.drafts;return t||(t=lsGet("mail_drafts_"+e),t=store.mail.cur.drafts=t||{}),t}function c(e,t){var n=l(e);return n[t]||(n[t]={})}function u(e,t,n,a){var o=store.mail.cur.drafts;if(o||(o=store.mail.cur.drafts=o||{}),a){var r=o[t],s=r&&r.editing&&r.editing.id===a?r.editing:void 0;o[t]=Object(i.default)({},r,{editing:Object(i.default)({},s,n,{id:a})})}else o[t]=Object(i.default)({},o[t],n,{editing:void 0});lsSet("mail_drafts_"+e,o)}function d(e,t){var n=store.mail.peers[e];n.attachmentsStack.push(n.attachmentsHTML),n.attachmentsHTML=t}function _(e){var t=store.mail.peers[e],n=t.attachmentsStack.pop();n||(n=Brick({mix:"cp_attached_wrap",attrs:'id="attached_wrap"'})),t.attachmentsHTML=n}function f(e,t){var n=store.mail.cur.typings[e];if(n||(n=store.mail.cur.typings[e]={}),"text"!==t.type&&"audio"!==t.type||(t.count?n[t.type]=t:n[t.type]=null),n.text&&n.audio){var i=m(n.text,n.audio);n.mixed=i.count>1?i:null}else n.mixed=null}function p(e,t){var n=store.mail.cur.typings[e];if(n){var i=n.audio,a=n.text;if(i&&((i=h(i,t)).count?n.audio=i:n.audio=null),a&&((a=h(a,t)).count?n.text=a:n.text=null),n.text&&n.audio){var o=m(n.text,n.audio);n.mixed=o.count>1?o:null}else n.mixed=null}}function h(e,t){var n=e.users.filter(function(e){return e!==t});return n.length!==e.users.length&&(e.count=e.count-(e.users.length-n.length),e.users=n),e}function m(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e.count+=t.count,t.users.reduce(function(e,t){return-1===e.users.indexOf(t)?e.users.push(t):e.count--,e},e)},{users:[],count:0,type:"mixed"})}function v(e,t){var n=store.mail,i=n.scraps.folder,a=i.indexOf(e);-1!==a&&(t?i.splice(a,1,t):i.splice(a,1)),Object.keys(n.rolls.folder).forEach(function(i){var a=n.rolls.folder[i],o=a.indexOf(e);-1!==o&&(t?a.splice(o,1,t):a.splice(o,1))}),t&&(n.rolls.peer[t]=n.rolls.peer[e],n.reached.peer.before[t]=n.reached.peer.before[e],n.reached.peer.after[t]=n.reached.peer.after[e]),e!==t&&(n.rolls.peer[e]&&n.rolls.peer[e].forEach(function(i){var a=n.msgs[i];a&&(t?(a.peerId=t,a.authorId===e&&(a.authorId=t)):delete n.msgs[i])}),delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e],delete n.members[e],delete n.peers[e])}function A(e,t){void 0===t&&(t={});var n=store.mail;if(!1!==t.lists){var i=n.scraps.folder,a=i.indexOf(e);-1!==a&&i.splice(a,1),Object.keys(n.rolls.folder).forEach(function(t){var i=n.rolls.folder[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)})}!1!==t.msgs&&n.rolls.peer[e]&&n.rolls.peer[e].forEach(function(e){n.msgs[e]&&delete n.msgs[e]}),!1!==t.lists&&(delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e]),!1!==t.data&&(delete n.members[e],delete n.peers[e])}function g(e,t){void 0===t&&(t={});var n=store.mail;if(t.msgs){var i=t.msgs;n.rolls.peer[e]=i,n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1}else n.rolls.peer[e]||(n.rolls.peer[e]=[],n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1);var a=n.msgs[n.rolls.peer[e][0]];n.rolls.folder.all.unshift(e),n.cur.folder&&n.scraps.folder.unshift(e),a&&(a.isUnread&&n.rolls.folder.unread.unshift(e),a.isImportant&&n.rolls.folder.important.unshift(e))}function b(e){var t=store.mail.presend;t.pending[e.peerId]||(t.pending[e.peerId]=[]),t.msgs[e.sendId]=e,t.pending[e.peerId].push(e.sendId)}function y(e,t){var n=store.mail.presend;return n.pending[t]?n.msgs[e]:null}function w(e){var t=store.mail.presend;if(t.pending[e.peerId]){var n=e.sendId;delete t.msgs[n],t.pending[e.peerId]=t.pending[e.peerId].filter(function(e){return e!==n})}}function k(e){var t=store.mail.presend;if(t.failed[e.peerId]){var n=e.sendId;delete t.msgs[n],t.failed[e.peerId]=t.failed[e.peerId].filter(function(e){return e!==n})}}function S(){var e=store.mail.presend,t={};Object.keys(e.msgs).forEach(function(n){var i=e.msgs[n];i.pending=!1,i.failed=!0,t[i.peerId]||(t[i.peerId]=[]),t[i.peerId].push(n)},{}),e.pending={},e.failed=t}function C(e){var t={};Object.keys(e.items).forEach(function(n){var i=e.items[n];t[n]=Object(a.sendDataToMessage)(i.data.data,-1!==e.failed.indexOf(n))});var n={};e.pending.forEach(function(e){var i=t[e];n[i.peerId]||(n[i.peerId]=[]),n[i.peerId].push(e)},{});var i={};e.failed.forEach(function(e){var n=t[e];i[n.peerId]||(i[n.peerId]=[]),i[n.peerId].push(e)},{}),store.mail.presend={msgs:t,pending:n,failed:i}}function O(e,t){var n=store.mail.cur;n&&(n.folderScroll||(n.folderScroll={}),n.folderScroll[e]=t)}function E(e){var t=store.mail.cur;if(t){t.folderScroll||(t.folderScroll={});var n=t.folderScroll[e]||0;return t.folderScroll[e]=0,n}}},iS9e:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <div class="','">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            <div class="BtnStack">\n              <div class="Btn Btn_theme_regular mailDialog__confirmButton" ',">",'</div>\n              <div class="Btn Btn_theme_secondary mailDialog__button_secondary mailDialog__closeButton" ',">","</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return o=function(){return e},e}var r=function(e){var t=e.onClose||a.default.onClick("MailDialog._onDialogClose"),n=a.default.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");return a.default.html(o(),n,t,t,i,e.body,e.onConfirm,e.confirmText,t,e.cancelText)};var s,l=n("UxAg"),c=n("OcsD");function u(){var e=Object(l.$)(".messenger__dialog");s=null,e.innerHTML=""}Object.assign(r,{open:function(e){s={},"function"==typeof e.onConfirm&&(s.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(s.onClose=e.onClose,e.onClose="");var t=Object(l.$)(".messenger__dialog"),n=r(e),i=Object(c.ceFromString)(n);s.onConfirm&&(Object(l.$)(".mailDialog__confirmButton",i).onclick=function(e){return s.onConfirm(e,t)});s.onClose&&Object(l.$$)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",i).forEach(function(e){e.onclick=function(e){return s.onClose(e,t)}});t.innerHTML="",t.appendChild(i)},close:u,_onDialogClose:u});t.default=r;window.MailDialog=r},irqS:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"showCaptcha",function(){return we}),n.d(i,"renderBody",function(){return ke});var a,o=n("MUpH"),r=n("bZ/P"),s=n("Mc5h"),l=(n("9y81"),n("O5lf")),c=n("AgBx"),u=n("QBkA"),d=n("rKp0"),_=n("u33z"),f=n("HPEO"),p=n("CkGd"),h=n("B5sG"),m=n("+cqQ"),v=n("DkIl"),A="recently",g="last_week",b="last_month",y="long_ago";function w(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&k())}function k(){var e=store.mail.cur;(e?e.peerId:null)?a=setTimeout(function(){E(),k()},3e4):S()}function S(){a&&clearTimeout(a)}function C(){$$(".mailHat").forEach(function(e){return e.outerHTML=Object(h.default)()})}function O(){}function E(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,a=n?n.peerId:null;if(a){var o=i[a];if(o.lastActionTime&&!o.isOnline){var r=n.timeShift,s=function(e,t){var n=window.lang,i="";e+=t;var a=parseInt(Date.now()/1e3)-e;if(a>7776e3)return"";if(a<60)i=n.mobile_profile_status_just_now;else if(a<3600){var o=intval(a/60);i=langWordNumeric(o,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(a<14400){var r=intval(a/3600);i=langWordNumeric(r,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,a=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,a.mobile_mail_date,0,a.months_sm_of,!1):langDate(t,a.mobile_mail_short_date_time,0,a.months_sm_of,!1)}(e);return i}(o.lastActionTime,r);o.offlineText=s?langSex(o.sex,e.mobile_mail_last_activity_tip).replace("{time}",s):""}else o.canSeeOnline||(o.offlineText=function(e,t){var n;switch(e){case A:n=getLang("global_online_was_recently","raw");break;case g:n=getLang("global_online_was_week","raw");break;case b:n=getLang("global_online_this_month","raw");break;case y:n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(o.onlineStatus,o.sex));C()}}Object.assign(h.default,{onUnreadClick:Object(m.default)(),onBackClick:Object(m.default)(),onBackToDialogClick:Object(m.default)(),onCancelEditing:Object(m.default)(),setModifiers:v.MailHat_convo.setModifiers,redrawCounter:function(){var e=store.mail.cur.countUnread;if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e)},redrawOnline:E,redraw:C,startStatusUpdate:k,cancelStatusUpdate:S}),v.MailHat_main.onUnreadClick(h.default.onUnreadClick),v.MailHat_main.onBurgerClick(menu.open),v.MailHat_main.onCancelForwardTap(h.default.onBackToDialogClick),v.MailHat_convo.onBackTap(h.default.onBackClick),v.MailHat_convo.onCancelEditingTap(h.default.onCancelEditing),uVK.onReady(w),uVK.onReady(O),page.onChange(O);var j=h.default;window.uMailHat=h.default;var T=n("TYsd"),I=n("29dZ"),M=function(e){var t=window.lang;return T.default.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[Object(I.default)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),Object(I.default)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})};Object.assign(M,{accept:function(e,t,n){I.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},function(e){e.error&&I.default.setLoading(t,!1)},function(){I.default.setLoading(t,!1)})},reject:function(e,t,n){I.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},function(e){e.error&&I.default.setLoading(t,!1)},function(){I.default.setLoading(t,!1)})}});var x=M;var P=x;function B(){var e=Object(o.default)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return B=function(){return e},e}function L(){var e=Object(o.default)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return L=function(){return e},e}function R(){var e=Object(o.default)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return R=function(){return e},e}function D(){var e=Object(o.default)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return D=function(){return e},e}function N(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return N=function(){return e},e}function H(){var e=Object(o.default)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return H=function(){return e},e}function V(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ','\n      <div class="','">','</div>\n      <div class="messenger__pinned">',"</div>\n    </div>\n    ",'\n    <div class="','">\n      <div class="messenger__mrbox">','</div>\n      <div class="messenger__write">','</div>\n      <div class="messenger__acts">',"</div>\n    </div>\n  "]);return V=function(){return e},e}function F(){var e=Object(o.default)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">',"</div>\n        ",'\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return F=function(){return e},e}window.MessageRequestBox=x;var U=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=Object(d.default)({scrap:"folder"}),a=Object(d.default)({scrap:"search"}),o=e.page,r="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR;return W({mix:K(),mailHat:j(),convo:z(),page:o,mrs:r,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:a})};function W(e){var t=window.lang.mobile_mail_search_only_messages,n=Object(u.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?Z(e.mrs):"",a=r.default.onClick("Messenger._onSearchMsgsClick"),o=Object(c.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onMainScroll","this"),inner:[Object(s.default)({mix:"messenger__filter",inner:n}),Object(s.default)({mix:r.default.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),Object(s.default)({mix:"messenger__searchMsgs",attrs:a,inner:t}),Object(s.default)({mix:"messenger__loadable",inner:[Object(s.default)({mix:"messenger__folderList",inner:e.scrapFolder}),Object(s.default)({mix:"messenger__searchList",inner:e.scrapSearch}),Q()]})]});return r.default.html(F(),e.mix,e.mailHat,o,e.convo,e.page)}function z(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=j(),a=Y(),o=G(),l=Object(f.default)(),u=n&&n.canPin,_=Object(p.default)({canPin:u,isChannel:n.isChannel}),h=Object(d.default)({scrap:"peer"}),m=n.isIncomingMR?P(t.peerId):"",v=n.isRejectedMR?function(){var e=window.lang;return r.default.html(H(),e.mobile_mail_mrs_rejected_info)}():"",A=Object(c.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onConvoScroll","this"),inner:[Object(s.default)({mix:"messenger__spacer"}),Object(s.default)({mix:"messenger__convoList",inner:[h,v]}),Q()]}),g="messenger__banner";o&&(g+=" messenger__bannerVisible");var b=r.default.class("messenger__footer",{actionsOpen:J(),isIncomingMR:n.isIncomingMR});return r.default.html(V(),i,g,o,a,A,b,m,l,_)}function Q(){var e=Object(l.default)({mix:""});return r.default.html(D(),e)}function Y(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function G(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if(!i)return"";var a="";i.icon&&(a=r.default.html(R(),i.icon));for(var o=i.buttons,s=o.length,l=[],c=0;c<s;c++)l.push(X(o[c],c));l=r.default.list(l);var u=Object(_.default)({class:"messenger__banner_close",onClick:r.default.onClick("uMessenger.onBannerButtonClick","event")}),d=r.default.onClick("uMessenger.onBannerTextClick","event");return r.default.html(L(),a,d,i.text,l,u)}function X(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=r.default.class("messenger__banner_button",n),o=e.type;return"gifts_link"===e.type&&(o="link",i="_self"),Object(_.default)({class:a,text:e.text,type:"link"===o?"link":"button",link:"link"===o?{href:e.link,target:i}:null,onClick:r.default.onClick("uMessenger.onBannerButtonClick","event",t)})}function K(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null;return r.default.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e))}function J(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function Z(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return r.default.html(B(),n)}var ee=n("jk6M"),te=n("Qz23");function ne(){Object(te.cleanScrollView)(W.getConvoBody()),removeEvent(W.getConvoBody(),"touchstart",ie,{passive:!0})}function ie(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function ae(e,t){$$(".messenger__layer_"+e).forEach(function(e){e.classList.toggle("messenger__layer_loading",t)})}function oe(e){return $(".messenger__layer_"+e+" .messenger__body")}function re(e){W.onMainScroll(e)}function se(e){W.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&W.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&W.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout(function(){e._isScrolling=!1},100)}function le(){var e,t,n=W.getConvoBody();n&&(n.prevHeight&&n.prevHeight!==n.offsetHeight&&(e=n,t=n.scrollBottom,e.scrollTop=e.scrollHeight-e.offsetHeight-t),n.prevHeight=n.offsetHeight,n.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(n),ce&&requestAnimationFrame(le))}Object.assign(W,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:Object(m.default)("scrollElem"),onQueryChange:u.default.onChange,onQueryClear:u.default.onClear,onSearchMsgsClick:Object(m.default)(),setQuery:u.default.setQuery,setQuerySilently:u.default.setQuerySilently,getMainBody:function(e){return oe("main")},setMainLoading:function(e){return ae("main",e)},onConvoAtTop:Object(m.default)(),onConvoAtBottom:Object(m.default)(),onConvoScroll:Object(m.default)("scrollElem"),setConvoLoading:function(e){return ae("convo",e)},getConvoBody:function(){return oe("convo")},scrollConvoToBottom:function(){var e=W.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=z();ne(),$$(".messenger__layer_convo").forEach(function(t){t.innerHTML=e})},cleanConvoBody:ne,setupConvoBody:function(){Object(te.setScrollView)(W.getConvoBody(),{topBanner:!1}),addEvent(W.getConvoBody(),"touchstart",ie,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")}}),W._onMainScroll=re,W._onConvoScroll=se,W._onSearchMsgsClick=W.onSearchMsgsClick;var ce=!1;if(U.startPolling=function(){ce=!0,le()},U.stopPolling=function(){ce=!1},Object.assign(U,{redraw:function(){$$(".uMessenger").forEach(function(e){return e.outerHTML=U()})},redrawView:function(){$$(".uMessenger").forEach(function(e){return e.className=K()});var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(_e(),p.default.togglePin(n[t.peerId].canPin));fe()},redrawMailActions:function(){var e=J();$$(".messenger__layer_convo").forEach(function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),p.default.update();var n=store.mail,i=n.cur,a=n.peers;if(!i.peerId||!a[i.peerId].isIncomingMR){var o=t.$(".messenger__write").offsetHeight,r=t.$(".messenger__acts").offsetHeight-o,s=t.$(".messenger__body");requestAnimationFrame(function(){!s._fixed&&r&&(s.style.paddingBottom=r+"px",s._fixed=!0),r<=0&&(s.style.paddingBottom=0,s._fixed=!1)})}})},redrawPinnedMsg:_e,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,a=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach(function(t){t.classList.toggle("messenger_pinnedVisible",a&&e),t.classList.toggle("messenger_pinnedHidden",a&&!e)})},redrawBanner:function(){var e=G();$$(".messenger__banner").forEach(function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)})},redrawMRsHint:fe,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=W.getConvoBody();if(ee.default.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach(function(e){return e.classList.remove("load_before_closed")});var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(de&&clearInterval(de),de=setInterval(function(){e.isScrolling||(clearInterval(de),t())},10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach(function(e){return e.classList.remove("load_before_closed")});var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var a=W.getConvoBody();if($(".mailScrap__loading_before"),t)a.scrollTop=i.offsetTop-.18*a.offsetHeight;else{var o=$(".typing_id_curConvo").offsetHeight;a.scrollTop=i.offsetTop-.5*(a.offsetHeight+2)+(i.offsetHeight+o)/2,i.offsetHeight>a.offsetHeight&&(a.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout(function(){removeClass("msg_highlight",i)},1500)),!0},loadMailPage:Object(m.default)()}),ee.default.safari_mobile){var ue=null;W.onConvoScroll(function(e){e.isScrolling=!0,ue&&clearTimeout(ue),ue=setTimeout(function(){return e.isScrolling=!1},50)})}var de=null;function _e(){var e=store.mail,t=e.peers,n=e.cur,i=Y(),a=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(a)}function fe(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var a=t?Z(t):"";i.innerHTML=a}i.classList.toggle("messenger__mrsHint_hidden",!n)}var pe=n("cq4b"),he=n("/Id8"),me=n("fWqt"),ve=n("UxAg"),Ae=n("qHA9"),be=n("iS9e"),ye=n("p5n7");function we(e,t){be.default.open({body:ke(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var a,o=Object(ve.$)('[name="'+e.key+'"]',i);o=o&&o.value||"",be.default.close(),Object(Ae.mailRequest)(e.location,Object.assign({},e.post,(a={},a[e.key]=o,a))).then(function(e){t(Promise.resolve(e))},function(e){t(Promise.reject(e))})},onClose:function(){be.default.close(),t(null)}})}function ke(e){return T.default.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[Object(ye.default)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}var Se=i,Ce=n("/Rzu"),Oe=n("z9sQ"),Ee=n("OcsD"),je=n("wMVj"),Te={onTemplateInput:function(e,t,n,i){var a=$("."+n),o=i-t.value.length;a.textContent=o,a.className=Oe.default.class(n,{error:o<=0})},onButtonMouseDown:function(e,t){ee.default.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),a=i.value,o=i.selectionStart,r=i.selectionEnd;i.value=a.slice(0,o)+n+a.slice(r);var s=o+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,a){var o=$(".MailTemplatePage__NameInput .TextInput__native"),r=$(".MailTemplatePage__TextTextarea");I.default.setLoading(t,!0),Object(Ee.ajaxRequest)("/mail",{act:"save_template",name:o.value,text:r.value,hash:i,id:n},function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),o=$(".MailTemplatePage__ErrorText");return I.default.setLoading(t,!1),i.hidden=!1,void(o.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var r=store.mail.cur.templates,s=n?r.findIndex(function(e){return e.id===n}):-1;-1!==s?r.splice(s,1,e.result):r.push(e.result)}je.default.go(a)}},function(){I.default.setLoading(t,!1)})},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=Te;var Ie=n("Y6JH"),Me=function(e){var t=window.lang,n=Object(v.MailHat)({type:"page",left:T.default.html({class:"mailHat__back",inner:Object(Ie.default)("base","back_outline_28"),href:"/mail"}),center:Object(v.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),i=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},T.default.wrap(Object(d.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[Object(I.default)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:r.default.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:T.default.wrap(n)},{class:"messenger__body",inner:i}]}};Object.assign(Me,{rejectAll:function(e,t){I.default.setLoading(t,!0),Me.onRejectAll(t)},onRejectAll:befall()});var xe=Me;var Pe=xe;window.MessageRequestsPage=xe;var Be,Le,Re=n("M2vk"),De=n("7jQU"),Ne=n("HGMY"),He=n("9M99"),Ve=n("hw56"),Fe=n("H5mD"),Ue=n("aiw/"),$e=n("W38l"),qe=n("HdGT"),We=n("gF8j"),ze=Object(m.default)();function Qe(){Le=null,Be&&Be.stop()}function Ye(e,t){Be&&(Be.is_idle?Le[e]=t:setTimeout(t,0))}function Ge(){var e=Le;Le={},Object.keys(e).forEach(function(t){(0,e[t])()})}var Xe=null,Ke=null;function Je(e){if(Ke&&(clearTimeout(Ke),Ke=null),Xe&&(Xe=Object.assign({},Xe,{fails:0})),"online"===e.type&&Xe){var t=Xe;Xe=null,Ze(t)}}function Ze(e){if(!1!==navigator.onLine)return Object(Ae.mailRequest)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then(function(t){e.onResult(t)}).catch(function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));Xe=Object.assign({},e,{fails:n}),Ke=setTimeout(function(){Ke=null,Ze(Xe)},1e3*i)}else Xe=Object.assign({},e,{fails:0})});Xe=Object.assign({},e,{fails:0})}window.addEventListener("online",Je),window.addEventListener("offline",Je);var et=n("UlUB"),tt=n("BZzM"),nt=!1;uVK.onReady(Rt),W.onQueryChange(Ht),W.onQueryClear(Vt),Ce.default.onTap(bt),j.onUnreadClick(lt),j.onBackClick(sn),j.onBackToDialogClick(ln),j.onCancelEditing(Gn),f.default.onAttachedMsgsRemove(gt),f.default.onToBottomClick(en),f.default.onMessage(pt),qe.onMessage(ft),qe.onStopped(ht),qe.onMessageRemove(mt),qe.onCaptcha(ui),he.default.onClick(Bn),he.default.onRestoreClick(Ln),he.default.onReplyClick(Rn),he.default.onForward(Nn),Voting.onHtmlUpdate(Jn),W.onMainScroll(Zt),W.onConvoScroll(tn),W.onSearchMsgsClick(Nt),W.onConvoScroll(U.expandPeerBefore),W.onConvoAtTop(Xt),W.onConvoAtBottom(Kt),p.default.onCloseClick(Sn),p.default.onRemoveClick(Cn),p.default.onImportantClick(In),p.default.onReplyClick(xn),p.default.onForwardClick(Pn),p.default.onSpamClick(Tn),p.default.onPinClick(wn),p.default.onEditClick(kn),me.default.onConfirmDelete(En),PinnedMsg.onHideClick(Un),Pe.onRejectAll(ii),im.onNewMsg(vt),im.onEditMsg(At),im.onMultiTyping(un),im.onRecordingAudio(pn),im.onOnlineChange(hn),im.onMsgReadByMe(mn),im.onMsgReadByOther(vn),im.onMsgImportantRemove(wt),im.onMsgImportantAdd(yt),im.onMsgRemove(kt),im.onMsgListen(St),im.onPeerKeyboard(Ot),im.onPeerBanner(It),im.onPeerConvert(Mt),im.onPeerAdmin(xt),im.onMsgRequestChange(Pt),im.onDialogImportant(Et),im.onUnreadCount(jt),im.onResync(Tt),ze(li),AudioMessagePlayer.events.on("listened",ci),nav.onPopState(An),nav.onBeforeGo(gn),nav.onBeforeGo2(bn),page.onChange(yn),uVK.onReady(Wn),page.onChange(Wn),uVK.onReady(zn),page.onChange(zn),page.onChange(_t),page.onChange(Kn),uVK.onReady(_t),uVK.onReady(Vn),uVK.onReady(Kn),uVK.onOrientationChange(dt),U.loadMailPage(Zn),U.onShowPinnedMsgClick=Fn,U.onHidePinnedMsgClick=Un,U.onBannerButtonClick=$n,U.onBannerTextClick=qn;var it=!1,at=0,ot=[],rt=[],st=Object(et.default)(function(){if(!ot.length)return;var e=store.mail,t=e.members,n=e.cur,i=ot,a=rt;ot=[],rt=[],ajaxRequest("/mail",{act:"get_members",members:i},function(e){Object.assign(t,e),a.forEach(function(e){e===n.peerId&&Re.default.redraw(),Ce.default.redrawTyping(e)})})},3e3);function lt(){W.scrollMainBodyToTop()}function ct(){Object(te.preventDocumentScroll)();var e=W.getMainBody();e&&Object(te.setScrollView)(e);var t=$(".leftMenu__searchItems");t&&Object(te.setScrollView)(t,{topBanner:!1,overscrollY:!1})}function ut(){Object(te.preventDocumentScroll)({topBanner:!1}),W.setupConvoBody()}function dt(){ee.default.safari_mobile&&document.activeElement.blur()}function _t(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame(function(){U.scrollToMsg(e)}):requestAnimationFrame(W.scrollConvoToBottom)}function ft(e){var t=store.mail.cur;Object(Ve.addPendingMsg)(e),t.peerId&&(0===e.sendId.indexOf("edit")?on(e):(Ne.removeMsg(e),Ne.addMsg(e),ri()))}function pt(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&on(e)}function ht(){Object(Ve.failAllPendingMsgs)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map(function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?on(t):i.push(t))}),Ne.setMsgs(i)}}else Object.keys(n.failed).forEach(function(e){Ce.default.redrawLastMsg(e)})}function mt(e){var t=store.mail.presend.msgs[e];t&&(Object(Ve.removePendingMsg)(t),Object(Ve.removeFailedMsg)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&d.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&Ne.removeMsg(t),ri()))}function vt(e){an(e)}function At(e){an(e)}function gt(){var e=store.mail,t=e.cur;e.peers;Object(Ve.setPeerDraft)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],f.default.uiRedrawAttachments(t.peerId)}function bt(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs,a=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[a]||[])];return Dt(e)}function yt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=i[e];if(r&&(r.isImportant=!0,o.folder.important=o.folder.important.concat(e).filter(unique).sort(desc),he.default.toggleImportant(e,!0),"important"===n.folder)){var s=a.folder.slice();a.folder=a.folder.concat(e).filter(unique).sort(desc),d.default.redrawFolder(s)}}function wt(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,o=n.scraps,r=n.rolls,s=a[e];if(s&&(s.isImportant=!t,Object(pe.arrayRemove)(r.folder.important,e),he.default.toggleImportant(e,!1),"important"===i.folder)){var l=o.folder.slice();Object(pe.arrayRemove)(o.folder,e),d.default.redrawFolder(l)}}function kt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=t.peers,s=i[e];if(s&&!n.msgRemoved[e]){delete i[e],Object(pe.arrayRemove)(o.peer[s.peerId],e),n.peerId===s.peerId&&(Object(pe.arrayRemove)(a.peer,e),he.default.remove(e,!0),n.msgSelected[e]&&(delete n.msgSelected[e],p.default.setCount(Object.keys(n.msgSelected).length),U.redrawMailActions()),a.peer.length?d.default.checkDivider():d.default.redrawPeer()),s.isImportant&&n.countImportant--;var l=r[s.peerId],c=l.isIncomingMR,u=l.isRejectedMR;s.isUnread&&s.authorId!==n.viewerId&&(r[s.peerId].countUnread=r[s.peerId].countUnread-1,c||u||r[s.peerId].countUnread<=0&&(n.countUnread=n.countUnread-1),f.default.redrawToBottom(),j.redrawCounter()),o.peer[s.peerId].length?Ct(s,e):ajaxRequest("/mail",{act:"get_last_msg",peer_id:s.peerId,user_id:n.userId},function(t,n){n&&(storeMethods.injectMail(t),o.peer[s.peerId].push(n)),Ct(s,e)},function(){Ct(s,e)})}}function St(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach(function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})}}function Ct(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),o=n.rolls,r=n.peers,s=r[e.peerId],l=s.isIncomingMR,c=s.isRejectedMR;o.peer[e.peerId].length||(l||c?Object(pe.arrayRemove)(o.mrs,e.peerId):(Object(pe.arrayRemove)(o.folder.all,e.peerId),Object(pe.arrayRemove)(o.folder.unread,e.peerId),Object(pe.arrayRemove)(o.folder.unrespond,e.peerId)),"mrs"===i.page?Object(pe.arrayRemove)(a.mrs,e.peerId):"important"!==i.folder&&Object(pe.arrayRemove)(a.folder,e.peerId)),o.peer[e.peerId]=o.peer[e.peerId].filter(unique).sort(asc),l||c?o.mrs=o.mrs.filter(unique).sort(Hn):(0===s.countUnread&&(o.folder.unread=o.folder.unread.filter(function(t){return t!==e.peerId})),o.folder.all=o.folder.all.filter(unique).sort(Hn),o.folder.unread=o.folder.unread.filter(unique).sort(Hn),i.groupId&&(o.folder.unrespond=o.folder.unrespond.filter(unique).sort(Hn))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(Hn),d.default.redrawMRs()):"important"===i.folder?(Object(pe.arrayRemove)(a.folder,t),d.default.redrawFolder()):"all"===i.folder?(a.folder=a.folder.filter(unique).sort(Hn),d.default.redrawFolder()):"unread"===i.folder?(0===r[e.peerId].countUnread&&Object(pe.arrayRemove)(a.folder,e.peerId),a.folder=a.folder.filter(unique).sort(Hn),d.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(Hn),d.default.redrawFolder())}function Ot(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var a=Object(Ve.getKeyboardState)(e);if(!(Date.now()-a.updateTime<=500)){var o=a.updateTime;ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(t){o===a.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&f.default.renderKeyboardIfNeeded({update:!0}))})}}}function Et(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),Ce.default.redrawImportant(e,t)}function jt(e){nav.getQuery("community")||function(e){if(setNotify(e),!window.al||!window.al.menu)return;var t=window.al,n=new Array(t.menu.length);n[3]=e,menu.refreshCounters(n)}(e);var t=store.mail.cur;t&&(t.countUnread=e,j.redrawCounter()),window.ExperimentalBadge&&window.ExperimentalBadge.set(e)}function Tt(){im.pause(),Lt(function(){im.resume()})}function It(e){Date.now()-at<=500||ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&U.redrawBanner()})}function Mt(e,t){im.pause(),ajaxRequest("/mail",{act:"get_peers",peer_ids:[t]},function(n){Object(Ve.replacePeer)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(d.default.redrawFolder(),t===i.peerId?qt(t):Dt("/mail?act=show&peer="+t,{replace:!0})):i.folder&&d.default.redrawFolder(),im.resume()})}function xt(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(a){var r=o[e];r&&(t===a.userId&&(r.isAdmin=n),n&&!Object(pe.arrayContains)(r.adminIds,t)?r.adminIds.push(t):!n&&Object(pe.arrayContains)(r.adminIds,t)&&Object(pe.arrayRemove)(r.adminIds,t))}}function Pt(e,t){var n=store.mail,i=n.cur,a=n.rolls,o=n.scraps;i&&("created"!==t&&nt||("created"===t&&nt&&(nt=!1),"created"===t?Bt(e,function(t,n){Object(Ve.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(Hn)),i.folder&&(d.default.redrawFolder(),U.redrawMRsHint()),i.peerId===e&&qt(e)}):"canceled"===t?Bt(e,function(t,n){Object(Ve.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),U.redrawMRsHint()),i.peerId===e?qt(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())}):"rejected"===t?Bt(e,function(t,n){Object(Ve.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),U.redrawMRsHint()),i.peerId===e?qt(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())}):"accepted"===t&&Bt(e,function(t,n){Object(Ve.addPeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),U.redrawMRsHint()),i.peerId===e?qt(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())})))}function Bt(e,t){im.pause(),ajaxRequest("/mail",{act:"mrs_get_peer",peer_id:e},function(e,n){t(e,n),im.resume()})}function Lt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls;o.folder[n.folder]=[],a.folder=[],W.setMainLoading(!0),ajaxRequest("/mail",{act:"all"===n.folder?null:n.folder,offset:0},function(t,r){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder||Object.keys(t.msgs).forEach(function(e){e=toInt(e);var n=t.msgs[e].peerId;o.peer[n]=(o.peer[n]||[]).concat(e).filter(function(e){return!!i[e]}).filter(unique).sort(asc)});var s="important"===n.folder,l=s?desc:Hn,c=Object.keys(s?t.msgs:t.peers).map(toInt).sort(l).filter(function(e){return-1===a.folder.indexOf(e)}),u=[].concat(c).filter(unique).sort(l);o.folder[n.folder]=u,a.folder=first(20,u),store.mail.reached.folder[n.folder]=r,d.default.redrawFolder(),j.redrawCounter(),W.setMainLoading(!1),e&&e()}})}function Rt(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||ei()}function Dt(e,t){void 0===t&&(t={});var n=Ft(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function Nt(){Dt("/mail?q="+store.mail.cur.query+"&tab=messages")}function Ht(e){var t=Ht;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var a="msgs"===n.tab?"&tab=messages":"",o=makeUrl("/mail?q="+e+a);Ft(o),i?Dt(o):t.timer=setTimeout(function(){Dt(o,{replace:!0})},300)}else Dt("/mail",{replace:!0})}}function Vt(){W.setMainLoading(!1),W.setConvoLoading(!1),Ht.clearTimer(),Dt("/mail",{replace:!0})}function Ft(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),a=store.mail,o=a.cur,s=a.scraps;if(o){var l=i.act,u=i.peer,_=i.chat,f=i.email,p=i.m,h=toInt(i.msg)||toInt(i.id)||null,m="messages"===i.tab?"msgs":"peers",A=i.q||"",g=+i.community||0;if(gn())return!0;if("/mail"!==n||"add_to_chat"===l||"flush_history"===l||"info"===l||"unpin"===l||"leave_chat"===l||"new_chat"===l||"chat_preview"===l||"return_to_chat"===l||"show_medias"===l||"toggle_community_block"===l||"community_toggle_important"===l||"ban_user"===l||"community_mark_answered"===l||"invite_link"===l||"reset_link"===l||"send"===l||"show"===l&&i.id||70==p||71==p||76==p||784==p||783==p||786==p||785==p||787==p)return clog("[mail nav] Exit Mail"),void ti();if((o.groupId?-o.groupId:0)===g){h&&(it=!0),d.default.clearSystemMessage2();var b=u?toInt(u):_?toInt(_)+2e9:f?-toInt(f)-2e9:null,y="unread"===l||"important"===l||"unrespond"===l?l:"all",w=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(l),k=!w&&!!o.page,S=o.query!==A||o.tab!==m;o.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&Object(Ve.saveFolderScroll)(o.folder,W.getMainBody().scrollTop),k&&(o.page=null),S&&b&&("peers"===o.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===o.tab&&(store.mail.cur.mvk_entrypoint="message_search")),o.peerId&&!b&&A)clog("[mail nav] Peer back to Search"),o.query=A,o.peerId=null,o.tab=m,Wt(),W.setQuery(A),Gt();else if(S&&o.peerId===b)o.query=A,o.tab=m,s.search=[],o.tab!==m&&(store.mail.reached.search.msgs={}),U.redrawView(),W.setQuery(A),d.default.redrawSearch(),A?(clog("[mail nav] Search update"),Gt()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],U.redrawView(),d.default.redrawSearch(),W.setQuery("")}(),0===s.folder.length&&Yt());else if(w)clog("[mail nav] Enter Page: "+l),o.page=l,o.peerId&&(o.peerId=null,Wt()),o.backUrl=ni({peerId:b}),U.redrawView(),function(e){var t=store.mail.cur,n=W.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=T.default.html(Pe({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(i=Object(v.MailHat_page)(),a=Object(c.default)({mix:"messenger__body",inner:[Q()]}),r.default.html(N(),i,a)),ajaxRequest(e,{},function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e}));var i,a}(e);else{if(o.peerId&&o.peerId===b)return!0;o.peerId!==b||k&&b?b?(clog("[mail nav] Enter Dialog"),o.backUrl=ni({peerId:b}),qt(b,h)):(clog("[mail nav] Exit Dialog"),Wt(),Ut(y),Yt()):b&&p?(clog("[mail nav] Peer System Msg"),store.mail.peers[b].systemMessageCode=toInt(p),d.default.updateClass("peer"),d.default.redrawSystemMessage(),W.scrollConvoToBottom()):(o.folder!==y||k&&y)&&(clog("[mail nav] Enter Folder"),Ut(y),Yt())}return!0}}}function Ut(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,a=n.scraps,o=n.rolls;i.folder=e,$t()?Lt():(t.restoreScroll?a.folder=(o.folder[e]||[]).concat():a.folder=first(20,o.folder[e]),d.default.folderSetItems(a.folder),U.redrawView(),j.redraw()),t.restoreScroll?W.getMainBody().scrollTop=Object(Ve.restoreFolderScroll)(e):W.getMainBody().scrollTop=0}function $t(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,a=t.folder[n.folder];return!a||("important"===n.folder?a.some(function(e){return!i[e]}):a.some(function(e){return!(t.peer[e]&&t.peer[e].length>0)}))}function qt(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.peers,r=n.scraps,s=n.rolls,l=n.reached;if(o[e]){var c=s.peer[e]||[];if(t||!(o[e].countUnread>1)||o[e].isIncomingMR||o[e].isRejectedMR){i.peerId=e,r.peer=[],Vn(),t?(r.peer=[t],s.peer[e]=[],l.peer.before[e]=!1,l.peer.after[e]=!1):(r.peer=last(20,c),p()),store.mail.reached.peer.after[e]=!0,d.default.updateClass("peer"),U.redrawView(),W.redrawConvoLayer(),Wn(),j.startStatusUpdate(),d.default.peerSetItems(r.peer),ut(),qe.ready().then(function(){f.default.init()}),t||zt(e);var u=o[e];t&&(d.default.updateClass("peer"),U.scrollToMsg(t)),t?Xt(t):Xt(),Object(tt.resizePosters)(),requestAnimationFrame(function(){t||(W.scrollConvoToBottom(),qe.ready().then(function(){W.scrollConvoToBottom()})),AudioMessagePlayer.redrawWaves(),requestAnimationFrame(function(){t||W.scrollConvoToBottom()})}),u.banner&&"birthday"===u.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{W.setConvoLoading(!0),window._preventedCheckTop=!0,it=!0,i.peerId=e,r.peer=[],Vn(),Ce.default.redrawUnread(e),U.redrawView(),W.redrawConvoLayer(),Wn(),j.startStatusUpdate(),p(),d.default.peerSetItems([]),ut(),qe.ready().then(function(){f.default.init()});var _={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};ajaxRequest("/mail",_,function(t,n,i){if(store.mail.cur){var o=t.rolls.peer[e];if(storeMethods.injectMail(t),l.peer.after[e]=n,l.peer.before[e]=i,c=s.peer[e]||[],(Object(pe.arrayIntersects)(o,c)||n&&0===c.length)&&(s.peer[e]=c.concat(o).filter(unique).sort(asc)),store.mail.cur.peerId===e){f.default.preventShowToBottom(),r.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",d.default.updateClass("peer"),d.default.peerSetItems(o),AudioMessagePlayer.redrawWaves(),zt(e);var u=o.find(function(e){return a[e].isUnread});U.scrollToMsg(u,!0,!1),requestAnimationFrame(function(){window._preventedCheckTop=!1,it=!1,W.setConvoLoading(!1)})}}})}}else ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(n){storeMethods.injectMail(n),o[e]?qt(e,t):window.location.reload()});function p(){i.forwardFromId&&(Mn(),i.forwardFromId=null)}}function Wt(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;j.cancelStatusUpdate(),Gn(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],Vn(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),U.redrawView(),j.redraw(),f.default.reset(),W.cleanConvoBody(),ct(),requestAnimationFrame(function(){p.default.setCount(0),U.redrawMailActions(),Re.default.redraw(),requestAnimationFrame(function(){d.default.peerSetItems(i.peer)})})}function zt(e){Ye("read_dialog"+e,function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0?ajaxRequest("/mail",{act:"read_dialog",peer_id:e,hash:n.hashRead},function(){mn(null,e)}):setTimeout(function(){mn(null,e)},500)}(e)})}function Qt(e,t){Ye("read_dialog"+t,function(){!function(e,t){var n=store.mail.peers;if(!n)return;mn(null,t),ajaxRequest("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},function(){})}(e,t)})}function Yt(){var e=Yt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.folder,l=a.folder,c=o.folder[s],u="folder_"+s,_=r.folder[s]&&last(l)===last(c);if(W.setMainLoading(0===l.length&&!_),!t[u]&&!_){var f="important"===s,p=$t(),h=f?desc:Hn,m=[];if(0===l.length)m=first(20,c);else{var v=c.indexOf(last(l));m=v>=0?c.slice(v+1,v+21):[]}if(m.length&&!p){var A=l.concat(m).filter(unique).sort(h);a.folder=A,d.default.folderAddItems(m)}else{t[u]=!0;var g="all"===s?null:s,b=p?0:l.length;ajaxRequest("/mail",{act:g,offset:b},function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach(function(e){store.mail.reached.peer.after[e]=!0}),"all"!==s&&"unread"!==s||Object.keys(e.msgs).forEach(function(t){t=toInt(t);var n=e.msgs[t].peerId;o.peer[n]=(o.peer[n]||[]).concat(t).filter(unique).sort(asc)});var _=Object.keys(f?e.msgs:e.peers).map(toInt).sort(h).filter(function(e){return-1===l.indexOf(e)}),m=c.concat(_).filter(unique).sort(h);o.folder[s]=m,n&&(r.folder[s]=n),t[u]=!1,i.folder===s&&(a.folder=m,d.default.updateClass("folder"),d.default.folderAddItems(_),W.setMainLoading(!1),p&&(d.default.folderSetItems(a.folder),U.redrawView(),j.redraw()))}})}}}function Gt(){var e=Gt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.tab,l=i.query,c="search_msgs_"+s+"_"+l,u=a.search,_=o.search[s][l]||[],f=r.search[s][l]&&last(u)===last(_);if(W.setMainLoading(0===u.length&&!f),!t[c]&&!f){var p=[];if("peers"===s&&(_.length||(_=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),a=QuickSearch.getQueryREs(t.query),o=[];return a.forEach(function(e){i.forEach(function(t){n[t].title.match(e)&&o.push(t)})}),o.filter(unique).sort(Hn)}()),_.length))if(0===u.length)p=first(20,_);else{var h=_.indexOf(u);p=h>=0?_.slice(h+1,h+41):[]}if(p.length&&(a.search=u.concat(p).filter(unique),d.default.redrawSearch(),d.default.updateClass("search"),W.setMainLoading(!1)),!p.length||"peers"===s){var m="msgs"===s?{act:"search",q:l,offset:a.search.length,messages:1}:{act:"search",q:l};e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){t[c]=!0,ajaxRequest("/mail",m,function(e,n){if(store.mail.cur){t[c]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),f="peers"===s?Hn:desc,p=_.concat(u).filter(unique).sort(f);o.search[s][l]=p,n&&(r.search[s][l]=n),i.tab===s&&i.query===l&&(W.setMainLoading(!1),a.search=a.search.concat(u).filter(unique).sort(f),d.default.redrawSearch(),d.default.updateClass("search"))}})},300)}}}function Xt(e){if(!$(".load_before_closed")){var t=Xt,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,o=i.scraps,r=i.rolls,s=i.reached;if(a){var l=a.peerId,c=o.peer,u=r.peer[l]||[],_="peer_before_"+l,p=s.peer.before[l]&&c[0]===u[0],h=a.msgReply[l];if(W.setConvoLoading(c.length<1&&!p),!n[_]&&!p){var m=W.getConvoBody(),v=!Object(pe.arrayIntersects)(c,u),A=first(c),g=A?u.indexOf(A):-1,b=0===c.length?last(10,u):g>=0?u.slice(g-20,g):[];if(b.length&&!e){if(m.scrollTop>6e3&&!v)return;if(window._preventedCheckTop)return;var y=o.peer.slice(),w=c.concat(b).filter(unique).sort(asc);o.peer=w,d.default.peerAddItemsBefore(b.filter(function(e){return-1===y.indexOf(e)})),AudioMessagePlayer.redrawWaves(),d.default.updateClass("peer"),W.setConvoLoading(!1)}else{if(!l)return;var k={act:"show",peer_id:l,msg:c[0],direction:e?"around":"before",reply_msg_id:h},S=c[0];n[_]=!0,ajaxRequest("/mail",k,function(t,i,a){if(store.mail.cur){e&&setTimeout(function(){it=!1},10),n[_]=!1,t.peers=[],storeMethods.injectMail(t);var p=Object.keys(t.msgs).map(toInt).filter(function(e){return-1===c.indexOf(e)}),h=c.concat(p).filter(unique).sort(asc);if(a&&(s.peer.before[l]=!0),i&&(s.peer.after[l]=!0),u=r.peer[l]||[],(Object(pe.arrayIntersects)(h,u)||a&&0===u.length)&&(r.peer[l]=(r.peer[l]||[]).concat(h).filter(unique).sort(asc)),store.mail.cur.peerId===l){if(f.default.preventShowToBottom(),m.scrollTop>6e3&&!v)return;var A=o.peer.slice();o.peer=h,d.default.updateClass("peer"),S?(d.default.peerAddItemsBefore(p.filter(function(e){return-1===A.indexOf(e)&&e<S}),!0),d.default.peerAddItemsAfter(p.filter(function(e){return-1===A.indexOf(e)&&e>S}),!0)):d.default.peerAddItemsBefore(p,!0),e&&(U.scrollToMsg(e),W.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),W.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),U.expandPeerBefore(),setTimeout(U.expandPeerBefore,100),e&&Mn(),f.default.redrawReply()}}})}}}}}function Kt(){var e=Kt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached;if(!it&&i){var s=i.peerId,l=a.peer,c=o.peer[s]||[],u="peer_after_"+s;if(!(t[u]||r.peer.after[s]&&last(l)===last(c))){var _=W.getConvoBody(),f=!Object(pe.arrayIntersects)(l,c),p=function(){return _.scrollHeight-_.scrollTop-_.offsetHeight},h=last(l),m=h?c.indexOf(h):-1,v=m>=0?c.slice(m+1,m+21):[];if(!v.length||nav.getQuery("msg")||nav.getQuery("id")){if(!s)return;var A={act:"show",peer_id:s,msg:last(l),direction:"after"};t[u]=!0,ajaxRequest("/mail",A,function(e,n){if(store.mail.cur){t[u]=!1,e.peers=[],storeMethods.injectMail(e);var i=Object.keys(e.msgs).map(toInt).filter(function(e){return-1===l.indexOf(e)}).sort(asc),_=l.concat(i).filter(unique).sort(asc);if(n&&(r.peer.after[s]=n),c=o.peer[s]||[],(Object(pe.arrayIntersects)(_,c)||n&&0===c.length)&&(o.peer[s]=(o.peer[s]||[]).concat(_).filter(unique).sort(asc)),store.mail.cur.peerId===s){if(p()>6e3&&!f)return;n&&d.default.updateClass("peer"),a.peer=_,d.default.updateClass("peer"),d.default.peerAddItemsAfter(i),AudioMessagePlayer.redrawWaves()}}})}else{if(p()>6e3&&!f)return;var g=l.concat(v).filter(unique).sort(asc);a.peer=g,d.default.peerAddItemsAfter(v),d.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}Ht.clearTimer=function(){self=Ht,self.timer&&(clearTimeout(self.timer),self.timer=null)};var Jt=!1;function Zt(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.rolls,o=e.scrollTop,r=e.scrollHeight,s=e.offsetHeight;if(n)if(!n.query&&o<=20&&i.folder.length){if(Jt){Jt=!1;i.folder.slice();i.folder=first(20,a.folder[n.folder]),d.default.folderCutItems(20)}}else o>20&&(Jt=!0,r-o-s<window.innerHeight&&(n.query?Gt():Yt()))}function en(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,a=e.reached,o=n.peer,r=i.peer[t.peerId]||[];if(r.length&&last(o)===last(r)&&a.peer.after[t.peerId])W.scrollConvoToBottom(),f.default.hideToBottom(),d.default.updateClass("peer");else{var s=t.peerId;ajaxRequest("/mail",{act:"show",peer_id:s},function(e,t){if(store.mail.cur){var o=e.rolls.peer[s];i.peer[s]=o.slice(),storeMethods.injectMail(e),a.peer.after[s]=!0,store.mail.cur.peerId===s&&(f.default.preventShowToBottom(),n.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",d.default.peerAddItemsBefore(o),d.default.updateClass("peer"),W.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}})}}function tn(e){var t=tn;t.timer||(t.timer=setTimeout(function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.msgs,o=t.peers;if(!n)return;var r=i.peer.find(function(e){return a[e]&&a[e].isUnread&&a[e].authorId!==n.viewerId}),s=e.scrollTop,l=e.scrollHeight-s-e.offsetHeight;if(r){var c=he.default.getElem(r),u=e.scrollHeight-c.offsetTop;l-u<=100&&zt(n.peerId)}e._prevScroll||(e._prevScroll=0),l<300&&$(".mailScrap_reachedAfter")?f.default.hideToBottom():s>e._prevScroll-5||n.peerId&&o[n.peerId].countUnread?f.default.showToBottom():f.default.hideToBottom();e._prevScroll=s}(e)},50))}function nn(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function an(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.attaches,r=e.adminId,s=e.isService,l=e.isStealth,c=e.isOut,u=e.keyboard,d=store.mail,_=(d.cur,d.peers),f=(d.msgs,d.members),p=_[n]&&_[n].pinnedMsgId===i,h=Object(Ae.getMsgSendId)(e),m=Object(Ve.getPendingMsg)(h,n),v=!(!m&&!e.replaced);if(m?($e.mark(h,"opt_to_lp"),t=function(e){return!!e.length}(o)):t=s||o.length||p||!_[n]||!f[a]||r&&!f[r],m){var A=function(e){var t=store.mail.cur;if(Object(Ve.removePendingMsg)(e),qe.remove(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return Ne.getMsg(e)}(m),g=Object.assign({},m,{id:i,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:nn(e)});if(storeMethods.injectMsg(g),on(g,{existingElem:A}),!t)return void $e.clean(h)}if(!u||!u.inline){if((u||t)&&!c&&!e.edited)Object(Ve.getKeyboardState)(n).updateTime=Date.now();!u||t||c||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,a=e.keyboard,o=store.mail.peers[t];o&&(o.keyboard=Object(Ae.prepareKeyboard)({keyboard:a,authorId:n,msgId:i}))}({peerId:n,authorId:a,msgId:i,keyboard:u})}if(t)return im.pause(),void Ze({msgId:i,forcePinned:p,onTryError:function(e){var t=e.type;h&&($e.error(h,"server_load_attach",t),$e.clean(h))},onResult:function(e){var t=e[0],a=e[1];h&&($e.mark(h,"attach"),$e.clean(h)),store.mail.cur&&(storeMethods.injectMail(t),a&&function(e,t){var n=t.unpin,i=t.pinned,a=store.mail,o=a.cur,r=a.peers;if(n){r[e].pinnedMsg="",r[e].hasPinnedMsg=!1;var s=Qn();delete s[e],Yn(s),o.peerId===e&&(U.redrawPinnedMsg(),Wn())}else i&&(r[e].pinnedMsg=i,r[e].hasPinnedMsg=!0,o.peerId===e&&(U.redrawPinnedMsg(),Wn()))}(n,a),on(t.msgs[i],{isStealth:l,isServerMsg:!0,isReplace:v}),im.resume())}});var b=function(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.isOut,r=e.text,s=e.ts,l=e.flags,c=e.adminId,u=e.isService,d=store.mail,_=d.cur,f=(d.peers,d.msgs),p=d.members,h=Object(Ae.formatTime)(s,_.timeShift),m=f[i],v="";r&&(v=r.replace(/<br>/g,"\n").replace(Ae.MENTION_DOMAIN_REGEXP,"@$3").replace(Ae.MENTION_REGEXP,"@$1 ($3)"));t=e.replaced?!!m&&m.edited:!!e.edited;var A=r,g=r;g=Object(Ae.wrapLinks)(g,l),g=Object(Ae.wrapMention)(g),g=Object(He.emojiToHTML)(g);var b=e.keyboard;b=b&&b.inline?Object(Ae.prepareKeyboard)({keyboard:b,authorId:a,msgId:i}):null;var y={id:i,peerId:n,authorId:a,ts:s,date:h,dateShort:h,text:g,textInput:v,body:A,isUnread:!m||m.isUnread,edited:t,canEdit:nn(e),isOut:o,isService:u,keyboard:b,attaches:{},forwards:[],hasReply:!!e.hasReply};c&&(y.adminName=c===_.userId?lang.mobile_mail_you:p[c].name,y.adminUrl=p[c].url);return y}(e);storeMethods.injectMsg(b),on(b,{isStealth:l,isReplace:v})}function on(e,t){var n=void 0===t?{}:t,i=n.isStealth,a=n.isServerMsg,o=n.isReplace,r=n.existingElem,s=store.mail,l=s.cur,c=s.peers,u=(s.msgs,s.members,s.rolls),_=s.scraps,p=s.reached,h=e.peerId,m=(e.keyboard,e.authorId),v=e.isOut,A=e.id,g=!v,b=c[h]&&0===c[h].countUnread&&g,y=o||!!e.edited,w=c[h],k=w.isIncomingMR,S=w.isRejectedMR,C=W.getConvoBody(),O=!1;if(e.isUnread&&(O=l.viewerId===h||l.peerId===h&&g&&C.scrollHeight-C.scrollTop-C.offsetHeight<400&&!!$(".mailScrap_reachedAfter")),O&&g&&!k&&!S&&Qt(A,h),!y){var E=last(u.peer[h]||[]);u.peer[h]=(u.peer[h]||[]).concat(A).filter(unique).sort(asc),i||k||S||(u.folder.all=u.folder.all.concat(h).filter(unique).sort(Hn),p.peer.after[h]||(p.peer.after[h]=!0,p.peer.before[h]=!1));var T=c[h];if(g&&(h===l.peerId&&f.default.renderKeyboardIfNeeded({update:!0}),i||(k||S||(u.folder.unread=u.folder.unread.concat(h).filter(unique).sort(Hn)),a||(T.countUnread||(T.countUnread=0),T.countUnread+=1)),h!==l.peerId&&i||f.default.redrawToBottom()),!i&&!k&&!S)if(b&&(l.countUnread+=1,j.redrawCounter()),l.groupId&&(g?u.folder.unrespond=u.folder.unrespond.concat(h).filter(unique).sort(Hn):Object(pe.arrayRemove)(u.folder.unrespond,h)),"all"===l.folder){var I=_.folder.slice();_.folder=_.folder.concat(h).filter(unique).sort(Hn),d.default.redrawFolder(I)}else if("unread"===l.folder&&m!==l.viewerId){var M=_.folder.slice();_.folder=_.folder.concat(h).filter(unique).sort(Hn),d.default.redrawFolder(M)}else if("unrespond"===l.folder){var x=_.folder.slice();g?_.folder=_.folder.concat(h).filter(unique).sort(Hn):Object(pe.arrayRemove)(_.folder,h),d.default.redrawFolder(x)}if(k&&(u.mrs=u.mrs.concat(h).filter(unique).sort(Hn),"mrs"===l.page)){var P=_.mrs.slice();_.mrs=_.mrs.concat(h).filter(unique).sort(Hn),d.default.redrawMRs(P)}if(l.peerId!==h||!Object(pe.arrayIntersects)(_.peer,u.peer[h])&&0!==_.peer.length||last(_.peer)!==E)r&&r.remove();else{_.peer.slice();_.peer=_.peer.concat(A).filter(unique).sort(asc);var B=rn(function(){r?d.default.peerAddElemAfter(A,r):d.default.peerAddItemsAfter([A])});g&&!B&&f.default.showToBottom(),m===l.viewerId&&d.default.removeDivider()}var L=Object(De.uTyping_getPeerTyping)(h);L&&L.users.length&&(Object(Ve.removePeerTypingUser)(h,m),h===l.peerId&&Re.default.redraw(),Ce.default.redrawTyping(h))}var R=A===Object(Ce.uConvo_getLastMsgId)(h);y&&(R?rn(function(){return d.default.peerReplaceItems([A])}):d.default.peerReplaceItems([A])),!i&&R&&(Ce.default.redrawLastMsg(h),Ce.default.redrawUnread(h),StickersAnimation.checkSettingsAndLoad(e.id)),h===l.peerId&&AudioMessagePlayer.redrawWaves()}function rn(e){var t=W.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&W.scrollConvoToBottom(),i}function sn(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,ct(),e)history.back();else Dt(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):e.tab?"/mail":(e.peerId,"/mail")}(),{replace:!0})}}function ln(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach(function(e){delete t[e]}),he.default.unselectAll(),U.redrawMailActions(),n&&qt(n)}var cn={};function un(e,t,n){var i=store.mail,a=i.cur,o=i.peers,r=o?o[e]:null;if(r&&!r.isIncomingMR&&!r.isRejectedMR){var s=Object(Ve.filterPeerTypingUser)({type:"text",users:t,count:n},a.viewerId);Object(Ve.setPeerTyping)(e,s);var l=cn[e];l&&clearTimeout(l),s.count&&s.users.length&&(cn[e]=setTimeout(function(){cn[e]=null,un(e,[],0)},7e3),oi(s.users,e)),e===a.peerId&&Re.default.redraw(),Ce.default.redrawTyping(e)}}var dn,_n,fn={};function pn(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(o?o[e]:null){var r=Object(Ve.filterPeerTypingUser)({type:"audio",users:t,count:n},a.viewerId);Object(Ve.setPeerTyping)(e,r);var s=fn[e];s&&clearTimeout(s),r.count&&r.users.length&&(fn[e]=setTimeout(function(){fn[e]=null,pn(e,[],0)},7e3),oi(r.users,e)),e===a.peerId&&Re.default.redraw(),Ce.default.redrawTyping(e)}}function hn(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,a=e.lastActionTime,o=store.mail,r=o.cur,s=o.peers[t];s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),a&&(s.lastActionTime=a),Ce.default.redrawOnline(t),r.peerId===t&&j.redrawOnline())}function mn(e,t){var n=store.mail,i=n.cur,a=n.peers,o=n.msgs,r=n.scraps,s=n.rolls;if(i){var l=i.peerId===t?r.peer:[],c=s.peer[t]||[],u=a[t];if(c.concat(l).forEach(function(e){var t=o[e];t&&t.isUnread&&t.authorId!==i.viewerId&&(delete t.isUnread,he.default.markAsRead(e))}),u?u.countUnread&&(i.countUnread-=1,u.countUnread=0):i.countUnread-=1,Object(pe.arrayRemove)(s.folder.unread,t),"unread"===i.folder){var _=r.folder.slice();Object(pe.arrayRemove)(r.folder,t),d.default.redrawFolder(_)}j.redrawCounter(),f.default.redrawToBottom(),Ce.default.redrawUnread(t)}}function vn(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.rolls,r=n.scraps,s=o.peer[t]||[];if(a[e])for(var l=s.indexOf(e);l>=0;){var c=a[s[l]];c.authorId===i.viewerId&&c.isUnread&&(delete c.isUnread,he.default.markAsRead(c.id)),l--}else last(s)&&e<=last(s)&&s.forEach(function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,he.default.markAsRead(t.id))});i.peerId===t&&r.peer.forEach(function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,he.default.markAsRead(t.id))}),Ce.default.redrawUnread(t)}function An(){if(gn())return!0;var e=store.mail.cur;if(e&&(e.backUrl=null),e&&e.forwardFromId)return ln(),!0;ee.default.safari_mobile&&document.activeElement.blur();var t=qs2obj(location.search.slice(1)).act;if(!$(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==t)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var n=new RegExp(/z=photo/).test(location.search);if($(".uMessenger")&&!n&&!ge("z_photoview")&&!ge("StoriesView")){var i=Ft(location.pathname+location.search);return i&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),i}}function gn(){var e=gn;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout(function(){e.noAlert=!1},10),!0}function bn(e,t,n,i){void 0===i&&(i={});var a=store.mail.cur;if(!("/mail"===n&&a&&a.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?Dt(n):void 0}function yn(){window.isNewMail&&(store.mail.cur?"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")?ti():ei():Ht.clearTimer())}function wn(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,a=t.msgSelected,o=toInt(Object.keys(a)[0]),r=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},r.pinnedMsgId=o,r.hasPinnedMsg=!0,he.default.unselectAll(),U.redrawMailActions(),ajaxRequest("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:o,_ajax:1})}function kn(){var e,t=store.mail,n=t.cur,i=t.msgs,a=(t.peers,t.hash),o=(t.replies,t.pendingReplies,n.msgSelected),r=toInt(Object.keys(o)[0]),s=n.peerId,l=Object(Ve.getPeerDraft)(n.viewerId,n.peerId),c=i[r],u=function(e){c.hasReply||l&&l.editing&&l.editing.id==r&&l.msgs&&(n.msgAttached[s]=l.msgs),c.hasReply?n.msgReply[s]=c.reply:n.msgReply[s]=null,f.default.redrawReply(),f.default.onAttachedMsgsRemove(),f.default.uiRedrawAttachments(s),f.default.setModifiers({editing:!0}),j.setModifiers({editing:!0}),U.redrawMailActions(),Sn(),f.default.setText(e)};if(n.editing==r)return e=l&&l.editing&&l.editing.id==r?l.editing.text||"":c.textInput,void u(e);n.editing=r,Xn(),ajaxRequest("/mail?act=edit_message_start",{hash:a.edit,edit_msg_id:r,peerId:s,_ajax:1},function(e,t){Object(Ve.pushPeerAttachments)(n.peerId,e),u(t)})}function Sn(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach(function(t){delete e[t]}),he.default.unselectAll(),p.default.setCount(0),U.redrawMailActions()}function Cn(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(On);1!==Object.keys(t.msgSelected).length||n?me.default.open({canDeleteForAll:n}):jn()}function On(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),a=vk.id,o=n[e],r=nav.getQuery().community,s=i[o.peerId];return!!o&&(o.authorId!==a&&o.authorId!==-r?s.isAdmin&&-1===s.adminIds.indexOf(o.authorId):!(o.peerId===a&&!r)&&(333!==o.peerId&&(!(Date.now()/1e3-o.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function En(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),a=n.peerId;kt(e),ajaxRequest("/mail",{act:"delete_for_all",peer:a,ids:e+"",hash:i[a].hashRemove},function(){}),U.redrawMailActions()}(e),Gn(!0)):jn(!1,me.default.isDeleteMessagesForAll()),me.default.close()}function jn(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,a=(n.hash,n.msgs,n.peers),o=i.peerId,r=i.msgRemoved,s=i.msgSelected,l=Object.keys(s);l.forEach(function(n){delete s[n=+n],t?kt(n):(r[n]=!e||"spam",e?he.default.spam(n):he.default.remove(n))}),ajaxRequest("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:o,ids:l.join(","),hash:a[o].hashRemove},function(){}),U.redrawMailActions()}function Tn(){jn(!0)}function In(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,a=t.msgSelected,o=Object.keys(a),r=o.some(function(e){return!i[e].isImportant})?1:0;o.forEach(function(e){delete a[e],i[e].isImportant!=!!r&&(r?t.countImportant++:t.countImportant--),i[e].isImportant=!!r,he.default.toggleImportant([e],!!r)}),ajaxRequest("/mail",{act:"mark_important",ids:o,hash:n.important,val:r},function(){}),he.default.unselectAll(),U.redrawMailActions()}function Mn(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,Object(Ve.setPeerDraft)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},he.default.unselectAll(),p.default.setCount(0),f.default.redrawReply(),f.default.uiRedrawAttachments(t),U.redrawMailActions()}function xn(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,a=t.peerId;if(!Object(Ae.isContactPeer)(a)){if(!n.replies)return Mn();var o=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[a]=o,i[o]=he.default.getReplyDataFromHTML(o),Object(Ve.setPeerDraft)(t.viewerId,t.peerId,{reply:o,msgs:void 0},t.editing),ajaxRequest("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:o}),t.msgAttached[a]=[],t.msgSelected={},he.default.unselectAll(),p.default.setCount(0),f.default.redrawReply(),f.default.uiRedrawAttachments(a),U.redrawMailActions(),f.default.openKeyboard("text")}}function Pn(){var e=store.mail.cur;e&&(Object(Ae.isContactPeer)(e.peerId)||(e.forwardFromId=e.peerId,e.query="",e.tab="peers",W.setQuerySilently(""),Wt({keepSelected:!0}),Ut("all",{restoreScroll:!1}),Yt()))}function Bn(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=t.msgs,o=t.flags,r=n.msgRemoved,s=n.msgSelected,l=i[n.peerId];if(f.default.hideStickersPanel(),!r[e]){s[e]?delete s[e]:s[e]=!0;var c=Object.keys(s),u=c.length,d=1===u&&c[0]==i[n.peerId].pinnedMsgId,_=c.reduce(function(e,t){return e&&a[t].isImportant},!0);p.default.setCount(u),p.default.setModifiers({pinned:d,important:_}),p.default.setLabels({pinned:d,important:_}),Object(Ae.isContactPeer)(n.peerId)?p.default.toggleQuickButtons(!1):p.default.toggleQuickButtons(!0),o.replies&&(1!==u||l.isIncomingMR?p.default.setReplyAvailable(!1):p.default.setReplyAvailable(!0));var h=toInt(Object.keys(s)[0]),m=1==u&&a[h];if(p.default.setEditAvailable(m&&m.canEdit&&!l.unableToWrite),p.default.setImportantAvailable(u>0&&n.viewerId>0),l.canPin){var v=toInt(Object.keys(s)[0]);p.default.togglePin(1===u&&v!==l.pinnedMsgId)}else p.default.togglePin(!1);U.redrawMailActions()}}}function Ln(e){var t=store.mail,n=t.cur,i=t.hash,a=t.msgs[e],o="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],he.default.restore(e),ajaxRequest("/mail",{act:o,id:e,hash:i.restore},function(){}),a.isImportant&&(n.countImportant++,yt(e)),d.default.redrawFolder()}function Rn(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var a=store.mail.forwards[n];if(a.peerId&&a.peerId===i.peerId&&!i.msgRemoved[e])U.scrollToMsg(e)||ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},function(i){storeMethods.injectMail(i);var a=store.mail,o=a.msgs,r=a.cur;r.peerId&&(o[e]?qt(r.peerId,e):Dn(e,t,n))});else Dn(e,t,n)}else Dn(e,t,n)}function Dn(e,t,n){if(t){var i=nav.getQuery();"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}))}var a=Object(he.Msg_makeReplyLink)(e,t,n);nav.go(a,null,{force:!0})}function Nn(e){var t,n=store.mail.cur;n&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),Pn())}function Hn(e,t){var n=store.mail,i=n.rolls,a=n.presend,o=n.msgs,r=i.peer[e]||[0],s=i.peer[t]||[0],l=si(a.pending[e],function(e){return-1===e.indexOf("edit")}),c=si(a.pending[t],function(e){return-1===e.indexOf("edit")}),u=last(r),d=last(s),_=Math.max(l?a.msgs[l].ts:0,u?o[u].ts:0);return Math.max(c?a.msgs[c].ts:0,d?o[d].ts:0)-_}function Vn(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach(function(t){return t.classList.toggle("messenger_noPullToRefresh",e)})}}function Fn(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){Number(t.dataset.id);var n=Qn();delete n[e],Yn(n),Wn()}}function Un(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=Qn();i[e]=n,Yn(i),Wn()}}function $n(e,t){var n,i=store.mail,a=i.cur,o=i.peers[a.peerId],r=o.banner;void 0!==t&&(n=o.banner&&o.banner.buttons[t],"birthday"===r.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",a.peerId)),ajaxRequest("/mail",{act:"banner_callback",hash:o.hashBanner,peer_id:a.peerId,callback_data:n&&n.callback_data}),at=Date.now(),o.banner=null,U.redrawBanner()}function qn(e){var t=$(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function Wn(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=$(".pinnedMsg"),a=Qn()[n],o=i?intval(i.dataset.id):null;U.setPinnedVisibility(o&&a!==o)}}}function zn(){if(store.mail.cur&&store.mail.cur.peerId){var e=$(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=Qn();delete n[t],Yn(n)}}}function Qn(){return lsGet("messenger.pinHidden")||{}}function Yn(e){lsSet("messenger.pinHidden",e)}function Gn(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,Xn(),!0!==e&&ajaxRequest("/mail?act=edit_message_cancel",{peerId:t.peerId}),Object(Ve.popPeerAttachments)(t.peerId),Object(Ve.setPeerDraft)(t.viewerId,t.peerId,{});var n=Object(Ve.getPeerDraft)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,f.default.setText(n&&n.text||""),f.default.setModifiers({editing:!1}),j.setModifiers({editing:!1}),f.default.uiRedrawAttachments(t.peerId),f.default.redrawReply();var i=W.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&W.scrollConvoToBottom()}}function Xn(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function Kn(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,kn())}}function Jn(e){var t=e.closest("."+he.default.class);if(t){var n=he.default.getId(t);store.mail.msgs[n].textFull=he.default.getTextHtml(t)}}function Zn(e){Dt(e)}function ei(){var e;store.mail.cur&&(window.isCustomScroll&&Object(te.restoreDocumentScroll)(),!store.mail.cur&&!store.mail.page||store.mail.cur.peerId||ct(),store.mail.cur.peerId&&ut(),qe.ready().then(ai).then(function(){ri(),store.mail.cur.peerId&&(f.default.init(),mn(0,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||W.scrollConvoToBottom()}),im.on(),Be||((Be=new We.default({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",Ge),Be.on("unidle",ze)),Le={},Be.start(),e=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=e.mvk_entrypoint||"notifications"===e.from&&"notifications"||"",U.startPolling(),addEvent(window,"resize",tt.resizePosters),window.ExperimentalBadge&&window.ExperimentalBadge.set(store.mail.cur.countUnread),Ue.onOpenCallback(di),Ue.onCloseCallback(_i))}function ti(){if(store.mail.cur){if(Ue.onOpenCallback(di),Ue.onCloseCallback(_i),!document.body.classList.contains("vk__page_mail"))return im.off(),Qe(),void storeMethods.resetMail();Object(te.restoreDocumentScroll)(),W.cleanConvoBody(),im.off(),Qe(),U.stopPolling(),j.cancelStatusUpdate(),d.default.resetPrevScraps(),storeMethods.resetMail()}}function ni(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var a="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+a}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var o="";"all"!==n.folder&&(o="?act="+n.folder),i="/mail"+o}return i}function ii(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,nt=!0,store.mail.rolls.mrs=[],t.forEach(function(e){Object(Ve.removePeer)(e)}),ajaxRequest("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,nt=!1,void Pe.cancelRejeectLoading();U.redrawView(),Dt("/mail")},function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,nt=!1,Pe.cancelRejeectLoading()})}function ai(){store.mail.cur&&Object(Ve.queueToPresendMsgs)(qe.getItems())}function oi(e,t){var n=store.mail.members;(e=e.filter(function(e){return!n[e]})).length&&(ot=ot.concat(e),rt.push(t),st())}function ri(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(Hn),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(Hn),d.default.redrawFolder())}function si(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function li(){im.abortWaiting()}function ci(e){var t=+e.getAttribute("data-msg");if(t&&!Object(Ae.isForwardedMessageId)(t)&&store.mail.cur){var n=store.mail.msgs[t],i=n&&store.mail.peers[n.peerId];i&&!n.listened&&n.authorId!==store.mail.cur.viewerId&&n.peerId===store.mail.cur.peerId&&Object(Ae.mailRequest)("/mail",{act:"listen_audiomsg",msg_id:t,hash:i.hashRead})}}function ui(e,t){Se.showCaptcha(e,t)}function di(){dn&&clearTimeout(dn),dn=setTimeout(function(){return addClass($(".messenger__layer_convo"),fi())},200)}function _i(){dn&&clearTimeout(dn),dn=setTimeout(function(){return removeClass($(".messenger__layer_convo"),fi())},200)}function fi(){return _n||(_n="messenger__layer_convo--iosKeyboard",Fe.isIPad&&Fe.isIOSChrome&&Fe.iosMajor>=11&&(_n="messenger__layer_convo--iosKeyboardChrome"),_n)}n.d(t,"Messenger",function(){return W});t.default=U;window.uMessenger=U,window.Messenger=W},"is+u":function(e,t){var n=need("Voting");function i(e){o(e.$voting,e.url)}function a(e,t){o(t.$voting,e,!0)}function o(e,t,i){var a=setTimeout(function(){n.setLoading(e)},140);ajax.post(t,{_ajax:1},{onDone:function(t,o){domData(e,"is-web-view")&&n._onPollChanged&&n._onPollChanged(e,i),clearTimeout(a),n.setHtml(t,o)}})}window.uVoting={},uVoting._onSubmit=i,uVoting._onRevoteClick=a},"k+Df":function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("TYsd"),o=n("9y81"),r=n("29dZ"),s=n("tlMv");t.default=function(e){void 0===e&&(e={});var t=null;e.icon_raw?t=e.icon_raw:e.icon&&(t=Object(o.IconWd)({class:"SplashScreen__icon",icon:e.icon,svg:e.is_svg_icon}));var n=a.default.wrap(e.more_text);"primary"===e.more_type&&(n=Object(r.default)({inner:[e.more_text],color:"primary",url:e.more_url}),e.more_url=null);return[e.separator?Object(s.default)({hideOnDesktop:!0}):{},{class:[e.class,i.default.class("SplashScreen",e.mix||{})],inner:e.inner||[t,e.title?{class:"SplashScreen__title",inner:a.default.wrap(e.title)}:null,e.text?{class:[e.text_class,"SplashScreen__text"],inner:a.default.wrap(e.text)}:null,e.more_text?{class:"SplashScreen__more",inner:n,href:e.more_url}:null,e.action_text?{class:"SplashScreen__action",inner:{class:"SplashScreen__actionButton",inner:a.default.wrap(e.action_text),href:e.action_url}}:null]}]}},kYGI:function(e,t){var n={tt:!1,handlers:[],show:function(){n.shown||(n.tt=Array.prototype.slice.call(arguments))},hide:function(){n.tt&&(n.tt=!1)},addHandler:function(e){e&&n.handlers.push(e)},removeHandler:function(e){e?each(n.handlers,function(t){if(e===this)return n.handlers.splice(t,1),!1}):n.handlers=[]},onClose:function(){each(n.handlers,function(){this()})},clear:function(){n.tt&&(n.hide(),n.onClose(),n.removeHandler())},closeByTap:function(e){if(!n.tt||!e.target)return!1;var t=e.target;do{for(var i=0;i<n.tt.length;i++)if(t===n.tt[i])return!1}while(t=t.parentNode);return n.hide(),n.onClose(),!0}};window.tooltip=n},kr3z:function(e,t,n){"use strict";n.r(t);var i=n("wx14"),a=n("UxAg"),o=n("+cqQ"),r=n("jk6M"),s=n("OcsD"),l=n("j80l"),c=n("eGQV"),u=n("tgcV"),d=n("cGUQ"),_=n("izth"),f=n("Cbap"),p=function(e){void 0===e&&(e={});return{attrs:{"data-playlist-id":e.playlist_id},inner:e.inner,class:"AudioPlaylistRoot"}};var h=n("g3t9"),m=n("fdw3"),v=n("0hva"),A=n("z1UI"),g=n("GtpT"),b=n("vOib"),y=n("v+Uj");var w=function(e){void 0===e&&(e={});var t=window.lang,n=e.items||[],i=e.count||null,a=e.href,o=n.map(function(e){return{inner:[Object(g.default)({album:e})],class:"AlbumsBlock__album",tag:"div"}}),r={text:Object(m.getLang)("mobile_subheader_show_all"),class:"al_albums",url:a},s=Object(y.default)({inner:[{inner:[o],class:"AlbumsBlock__albums",tag:"div"}]});return{inner:[{name:"albums",tag:"a"},Object(b.default)({title:t.mobile_photos_block_albums_title,count:i,corner:r,content:s,no_border:!0,noShadow:!0})],class:"AlbumsBlock",tag:"div"}},k=n("1VZq");var S=function(e){var t=window.lang,n=e.items||[],i=e.count||null,a=e.buttons||{},o=e.href,r=e.hide_header||!1,s=e.label||t.mobile_photos_block_photos_title,l="PhotosBlock",c="PhotosBlock__photos";!!e.autoload&&(l+=" PhotosBlock--autoload",c+=" photos_page");var u={inner:[n.map(function(e){return Object(k.default)({photo:e})})],class:c,tag:"div"},d=null;return o&&(d={text:Object(m.getLang)("mobile_subheader_show_all"),class:"al_empty",url:o}),{inner:[{name:"photos",tag:"a"},Object(b.default)({inner:[{inner:[a.prev,u,a.more],tag:"div"}],title:r?null:s,corner:d,count:i,noShadow:!0,no_border:!0})],class:l,tag:"div"}},C=n("tlMv");var O=function(e){var t=window.lang,n=e.pretag,i=e.buttons||{},a=e.is_owner,o=[],r=e.section,s=e.albums,l=e.albums_count,c=e.albums_href,u=e.photos,d=e.photos_count,_=e.new_tags_photos,f=e.new_tags_count,p=e.new_tags_href;if("all"===r){var h=s.map(function(e){return Object(g.default)({album:e})});h&&o.push({inner:[i.prev?i.prev:null,{inner:[h],class:"AlbumsPage__items album_items photos_page bl_cont",tag:"div"},i.more?i.more:null],tag:"div"})}else s&&s.length&&o.push(w({items:s,count:l,href:c})),_&&_.length&&o.push(S({label:t.mobile_photos_block_tags_title,items:_,count:f,href:p})),u&&u.length&&o.push(S({autoload:!0,items:u,count:d,buttons:i}));if(!o.length){var m=a?t.mobile_albums_can_store_photos:t.mobile_albums_no_albums;return Object(A.default)({separator:!0,text:m,more_type:"primary",more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_url:e.add_url})}return{inner:["all"!==r?Object(C.default)({hideOnDesktop:!0}):null,{inner:[o],class:"upanel bl_cont",tag:"div"},n],class:"AlbumsPage PageBlock PageBlock_bottomPadding",tag:"div"}},E=n("GVTI"),j={onBeforeRedirect:Object(o.default)("url"),onBeforePageParse:Object(o.default)(),onRedirect:Object(s.se)(),onNavDone:Object(o.default)(),_tStart:!1,_tAlStart:!1,RESPONSE_CAPTCHA:2,_init:function(){try{new XMLHttpRequest&&(j._req=function(){return new XMLHttpRequest})}catch(t){var e=window.ActiveXObject;try{new e("Msxml2.XMLHTTP")&&(j._req=function(){return new e("Msxml2.XMLHTTP")})}catch(t){try{new e("Microsoft.XMLHTTP")&&(j._req=function(){return new e("Microsoft.XMLHTTP")})}catch(e){j._req=!1}}}},_getreq:function(){return j._req||j._init(),j._req()},_al_reqs:[],_last_req:null,save_req:function(e){j._al_reqs.push(e||j._last_req)},abort_reqs:function(){Object(s.each)(j._al_reqs,function(e,t){t.readyState<4&&t.abort()}),j._al_reqs=[]},_failed_relogin:!1,_failed_reqs:[],save_failed_req:function(e,t,n,i){j._failed_reqs.push([e,t,n,i])},repeat_reqs:function(){Object(s.each)(j._failed_reqs,function(){var e=this.shift();j._post.apply(null,this),Object(s.remove)(e)}),j._failed_reqs=[]},plainpost:function(e,t,n,i,a,o,r,s){var l=j._last_req=j._getreq(),u="string"!=typeof t?Object(d.toQueryString)(t,!0):t;l.onreadystatechange=function(){4==l.readyState&&(l.status>=200&&l.status<300?n&&n(l.responseText,l):i&&i(l.responseText,l))};try{l.open("POST",e,!0)}catch(e){return!1}return l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a||s||l.setRequestHeader("X-Requested-With","XMLHttpRequest"),s||(Object(c.isStandalone)()&&l.setRequestHeader("X-View-Mode","pwa"),o&&o.headers&&Object.keys(o.headers).forEach(function(e){try{l.setRequestHeader(e,o.headers[e])}catch(e){}})),l.send(u),l},post:function(e,t,n){return"/"!=e.substr(0,1)&&(e="/"+e),e=e.split("#")[0],j._post(e,t,n||{})},onPrepared:Object(s.se)(),prepare_click:function(e){var t=window.al;if(r.default.ios&&!(r.default.ios>=7)&&window.al&&t.ver){var n=[],i=!1;e&&"a"==(e.tagName||"").toLowerCase()?n.push(e):Object(s.isArray)(e)?n=e:(n=Object(s.geByTag)("a",e),i=!0);for(var a=0,o=n.length;a<o;a++){var l=n[a],c=l&&l.target||"";if(l&&l.getAttribute&&(!i||!l.getAttribute("data-href")&&Object(s.checkElementNav)(l,{skip_onclick:!0})&&"_blank"!=c)){var u=l.getAttribute("href");if(null==u||!Object(s.isHttpHref)(u))continue;Object(s.attr)(l,"data-href",Object(s.getHref)(l)),Object(s.attr)(l,"href",!1)}}}},click:function(e,t,n){var i=window.nav;t=t||{};var a,o=!1,r={_ajax:1},l=Object(s.extend)(t,{link:e});if(n=n||{},(n=Object(s.extend)({closeContextMenu:!0},n)).closeContextMenu&&ContextMenu.close(),t.onStart){var c=j.tAlGetParam();j.tAlStart=(new Date).getTime(),c&&(r._talstat=c)}if(n.use_cache){var u=Object(s.ge)(!0===n.use_cache?"preload_data":n.use_cache),d=u.innerHTML.replace(/(^<!--|-->$)/g,""),_=d.split("--\x3e\x3c!--");if(d)u.innerHTML="",t.onStart&&t.onStart.apply(l),n.nav&&i.go(o,null,{push_only:!0}),t.onDone&&t.onDone.apply(l,_),(e=Object(s.geByClass1)("show_more",Object(s.geByClass1)("pcont","mcont")))&&j.click(e,{onDone:function(){var e="";Object(s.each)(arguments,function(t,n){e+="\x3c!--"+(n||"")+"--\x3e"}),u.innerHTML=e,Object(s.ge)("show_more_loading")&&j.click(!1,t,n)}},{closeContextMenu:!1});else t.onStart&&t.onStart.apply(l),n.nav&&i.go(o,null,{push_only:!0});return!1}if(!e)return!0;if(e.form){if(e.disabled)return!0;var f=e.form,p={};o=(f.action||"").replace(/^https?:\/\/[^\/]+/i,""),Object(s.each)(f,function(t,n){return!(n.name&&!n.disabled)||("radio"===n.type&&!n.checked||("checkbox"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==e||("image"===n.type&&n!==e||void(p[n.name]=n.value))))))}),"image"==e.type&&(p[e.name]=e.value,p[e.name+".x"]=1,p[e.name+".y"]=1),f.method&&"get"!=f.method?Object(s.extend)(r,p):o=o.split("?",1).shift()+Object(s.obj2qs)(p)}else e.getAttribute&&(o=e.getAttribute("data-href")||e.getAttribute("href"));if(o||(o=e.pathname?e.pathname+e.search+e.hash:e),!o)return!0;Object(s.extend)(r,n.url_params||{});var h=window.pStats,m=h.getSeenData();if(m){var v=window.cur;r._pstat=m.data,v&&v.module&&(r._pstatref=v.module)}return(a=j.post(o,r,{onDone:function(){m&&h.onSend(m.seen),n.lock&&Object(s.unlockButton)(e),t.onDone&&t.onDone.apply(l,arguments),(n.nav||n.scroll)&&Object(s.scrollToHash)()},onFail:function(){n.lock&&Object(s.unlockButton)(e),t.onFail&&t.onFail.apply(l,arguments),(n.nav||n.scroll)&&Object(s.scrollToHash)()}}))&&(t.onStart&&t.onStart.apply(l),n.nav&&i.go(o,null,{push_only:!0}),n.lock&&Object(s.lockButton)(e)),!a},nav:function(e,t){var n=window.nav,o=window.page,c=window.menu,d=window.cur,_=window.Tabbar;(t=t||{}).nav=t.nav||{};var f,A=Object(s.getHref)(e),b=o.getHash(t.nav);if(!(A=n.checkUrl(A)))return!1;"/"!=A.substr(0,1)&&(A="/"+A),c.close(null,!0);var y=j.tGetParam();if(j.tStart=(new Date).getTime(),t.need_restore&&c&&c.closeSearch(),window.isNewMail&&(t.need_restore&&t.nav.push&&!t.need_check_updates&&j.abort_reqs(),n.onBeforeGo2(t.nav.path,Object(s.qs2obj)(t.nav.params),t.nav.push,t)))return j.abort_reqs(),!0;if(t.need_restore&&t.nav.push&&(f=o.restore(b))&&(j.abort_reqs(),f.lm&&Object(s.extend)(f.lm,{tn:!1,bn:!1}),o.set(b,f,{},t),t.zProcess&&(t.zProcess(f.st),delete t.zProcess),n.set(t),j.tModule=window.cur.module,j.tRestoreRender=(new Date).getTime(),!t.need_check_updates))return!0;var w=!1,k=!1;if(t.need_check_updates&&n.isTabHaveCache(t.tab,b));else if(t.fast)w=!0,o.set(b,!1,{before:!0,beforeAppend:t.beforeAppend,afterAppend:t.afterAppend}),k=t.onAfterFast||!1;else if(t.target&&t.target.className){(S=/(?:^|\s)(al_([a-z_]+)(-?[0-9]+)?)(?:\s|$)/i.exec(t.target.className))&&S[1];var S,C=S&&S[2]||!1;switch(C){case"menu":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){var n=Object(a.$)(".vk__page");if(n.className=n.className.replace("vk__page_notifications",""),window.isNewMail){var i=Object(s.geByClass1)("mcont",e)||Object(s.geByClass1)("layout__basis");Object(s.val)(i,'<div class="pcont bl_cont"><div id="al_loading"></div></div>')}else Object(s.val)(Object(s.geByClass1)("mcont",e),'<div class="pcont bl_cont"><div id="al_loading"></div></div>');o.setMhead(e,Object(s.attr)(t.target,"data-header"),"/")},afterAppend:function(){window.isNewMail&&"/mail"===b?Object(s.alLoadingFix)(Object(s.geByClass1)("layout").offsetHeight):Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}});break;case"tab":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){Object(s.val)(Object(s.geByClass1)("upanel",e),'<div id="al_loading"></div>'),Object(s.val)(Object(s.geByClass1)("basisDefault",e),'<div id="al_loading"></div>');var t=Object(s.geByClass1)("tabs_block",e)||Object(s.geByClass1)("tabs",e),n=Object(s.geByClass1)("active",t);n&&(Object(s.hasClass)("tab_item_top",n)?(Object(s.removeClass)("tab_item_cur",Object(s.geByClass1)("tab_item_cur",t)),Object(s.addClass)("tab_item_cur",Object(s.geByClass1)("tab_item",t))):(Object(s.removeClass)("tab_item_cur",Object(s.geByClass1)("tab_item_cur",t)),Object(s.addClass)("tab_item_cur",n)))},afterAppend:function(){Object(s.alLoadingFix)()}},t);break;case"post":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(s.clone)(Object(s.gpeByClass)("post_item",t.target)),a=i.id,r=Object(s.outer)(Object(s.gpeByTag)("a",Object(s.geByClass1)("pi_img",i))).replace("pi_img","op_img"),l=Object(s.gpeByTag)("div",Object(s.geByClass1)("pi_author",i)),c=Object(s.remove)(Object(s.geByClass1)("pi_date",i)),u=Object(s.outer)(Object(s.remove)(Object(s.geByClass1)("explain",l))),d=Object(s.remove)(Object(s.geByClass1)("pi_fronly",i)),_=Object(s.outer)(l),f=Object(s.geByClass1)("pi_body",i),p=Object(s.geByClass1)("pi_text_more",f),h=(c=Object(s.geByClass1)("pi_date",i),Object(s.geByClass1)("pi_info",f)),m=Object(s.geByClass1)("pi_links",f),v=Object(s.geByClass1)("replies_link",m),A=Object(s.val)(Object(s.remove)(Object(s.geByClass1)("pi_actions_wrap",i))),g=Object(s.val)(Object(s.remove)(Object(s.geByClass1)("item_replies",h)))?Object(s.val)(v):n.mobile_wall_post_replies_title,b=v?'<a name="comments"></a><h4 class="slim_header">'+(g||"")+'</h4><div id="al_loading"></div>':"";if(p){var y=p.nextSibling?p:p.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}Object(s.val)(m,Object(s.outer)(Object(s.geByClass1)("like_wrap",f))),c&&Object(s.attr)(c,"data-date")&&Object(s.val)(c,Object(s.attr)(c,"data-date")),o.setMhead(e,Object(s.attr)(t.target,"data-header"),!0),Object(s.val)(Object(s.geByClass1)("mcont",e),function(e,t,n,i,a,o,r,s){return'<div class="pcont bl_cont"><div class="owner_panel">'+(t||"")+'<div class="op_cont">'+(n||"")+'<div class="op_info"><span class="item_date">'+(i||"")+'</span></div></div></div><div id="'+(e||"")+'" class="post_item single_post_item"><div class="pi_cont"><div class="pi_head">'+(a||"")+'</div><div class="pi_body">'+(o||"")+"</div></div>"+(s||"")+"</div>"+(r||"")+"</div>"}(a,r,_,Object(s.val)(c)+(d?'<b class="pi_fronly"></b>':""),u,Object(s.val)(f),b,A))},afterAppend:function(e){var n=Object(s.geByTag1)("h4",e);n&&Object(s.alLoadingFix)(t.nav.hash?Object(s.getCh)()-n.offsetHeight:0),t.nav.hash?Object(s.scrollToHash)(t.nav.hash):Object(s.scrollTop)(0)}},t);break;case"wall":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(s.clone)(Object(s.hasClass)("wall_item",t.target)?t.target:Object(s.gpeByClass)("wall_item",t.target)),a=i.id,r=Object(s.geByClass1)("wi_body",i),l=Object(s.geByClass1)("wi_buttons",i),c=Object(s.geByClass1)("item_like",l),u=Object(s.geByClass1)("v_like",c),d=Object(s.geByClass1)("item_share",l),_=Object(s.geByClass1)("v_share",d),f=Object(s.remove)(Object(s.geByClass1)("item_replies",l)),p=!!f&&Object(s.geByClass1)("v_replies",f),m=+Object(s.stripTags)(Object(s.val)(p)).replace(/\D/g,""),v=Object(s.geByClass1)("pi_text_more",r),A=Object(s.geByClass1)("wi_date",i),g=m?Object(s.langNumeric)(m,n.mobile_wall_post_comments):n.mobile_wall_post_replies_title,b=f&&m<50?'<a name="comments"></a><h4 class="slim_header">'+(g||"")+'</h4><div id="al_loading"></div>':"";if(clog("item_replies",f),Object(s.remove)(Object(s.geByClass1)("wi_actions_btn",i)),Object(s.remove)(Object(s.geByClass1)("post__subscribeBtn",i)),Object(s.remove)(Object(s.geByClass1)("post__extraHeader",i)),u?Object(s.val)(u):Object(s.append)(Object(s.ce)("span",{className:"v_like"}),c),_?Object(s.val)(_):Object(s.append)(Object(s.ce)("span",{className:"v_share"}),d),v){var y=v.nextSibling?v:v.parentNode;y.nextSibling.style.display="inline",y.style.display="none"}A&&Object(s.attr)(A,"data-date")&&Object(s.val)(A,Object(s.attr)(A,"data-date")),o.setMhead(e,Object(s.attr)(t.target,"data-header"),!0);var w=Wd.html(Object(h.Separator)({hideOnDesktop:!0}));Object(s.val)(Object(s.geByClass1)("mcont",e),function(e,t,n,i){return'<div class="pcont"><div class="PageBlock">'+e+'<div class="wall_item single_wall_item" id="'+(t||"")+'">'+(n||"")+"</div>"+(i||"")+"</div></div>"}(w,a,Object(s.val)(i),b)),Object(s.addClass)("vk__page_singlePost",document.body)},afterAppend:function(e){var n=Object(s.geByTag1)("h4",e);n&&Object(s.alLoadingFix)(t.nav.hash?Object(s.getCh)()-n.offsetHeight:0),t.nav.hash?Object(s.scrollToHash)(t.nav.hash):Object(s.scrollTop)(0)}},t);break;case"pinfo":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){var t=window.lang,n=Object(s.geByClass1)("owner_panel",e),i=Object(s.geByClass1)("pp_img",n),a=Object(s.geByClass1)("op_header",n),r=Object(s.geByClass1)("lvi",a),l=Object(s.geByClass1)("pp_last_activity",n),c=Object(s.ce)("div");Object(s.addClass)("mhi_back",Object(s.geByClass1)("mh_header",e)),Object(s.val)(n,'<img src="'+Object(s.escapeAttr)(Object(s.attr)(i,"src")||"")+'" class="op_img"><div class="op_cont"><h2 class="op_header">'+Object(s.stripTags)(Object(s.val)(a))+'</h2><div class="pp_online">'+(r?t.mobile_online:Object(s.val)(l))+"</div></div>"),Object(s.val)(Object(s.geByClass1)("ipanel",e),"<div>"+Object(s.val)(c)+'</div><div id="al_loading"></div>'),o.setMhead(e,!1,!0)},afterAppend:function(){Object(s.alLoadingFix)(),Object(s.scrollTop)(0,10)}},t);break;case"player":w=!0;var T=Object(s.qs2obj)(t.nav.params).playlist_id;o.set(b,!1,{before:!0,beforeAppend:function(e){var t=window,n=t.lang,i=t.audio,a=(i.playlist(),i.playlist_q());o.setMhead(e,n.mobile_menu_player_head_title,!0),Object(s.val)(Object(s.geByClass1)("mcont",e),'\n                <div class="pcont audioPage">\n                  <div class="PageBlock">\n                    <div class="audioPage__header">\n                      '+AudioPlaylist.tplPlayerSearch(T)+'\n                    </div>\n                    <div id="au_search_items" class="upanel bl_cont">\n                      <div class="audios_block audios_list _si_container" data-query="'+Object(s.escapeAttr)(a)+'"></div>\n                    </div>\n                  </div>\n                </div>'),Object(s.val)("m",e.innerHTML)}},t),k=function(){var e=window,n=e.qsearch,i=e.audio,a=i.playlist(),l="/audio"+Object(s.obj2qs)({act:"player",list:T}),c=[],u={};Object(s.each)(a,function(e,t){c.push(t.fullId),u[t.fullId]=[t.performer+" "+t.title,t]});var d=[];n.init({action:l,al_action:l,container:Object(s.ge)("au_search_items"),field:Object(s.ge)("au_search_field"),btn:Object(s.ge)("au_search_btn"),top_items:c,_cache:u,tpl:function(e,t,n,a){var o="";if(t){if(a)return a;o=""==a?'<div class="audios_block audios_list _si_container" data-query="'+Object(s.escapeAttr)(t)+'">'+e+"</div>":'<div class="audios_block audios_list _si_container" data-query="'+Object(s.escapeAttr)(t)+'"><div class="al_loading qs_loading">&nbsp;</div></div>'}else o='<div class="audios_block audios_list _si_container" data-query="'+Object(s.escapeAttr)(i.playlist_q())+'">'+e+"</div>";return Wd.html(p({playlist_id:T,inner:Wd.wrap(o)}))},item_tpl:function(e){var t=window.audioplayer;return d.push(e),t&&t.getDOMFromAudio(e,!0,this.q)||""},null_tpl:function(e){var t=window.lang;return'<div class="service_msg_box">\n                  <div class="service_msg service_msg_null">\n                  '+(e?t.mobile_audio_search_not_found.replace("%s",Object(s.htsc)(e)):t.mobile_audio_no_audio)+"\n                  </div>\n                </div>"},soft_filter:!0,need_invalid_keys:r.default.desktop,top_len:50,global_search:!0,onRendered:function(){var e=window,t=e.audioplayer,n=e.audio;t&&t.initAudio(),n.addToPlaylist(d),Object(s.alLoadingFix)()},al_need:!0,init_offset:0});var _=i.getCurrentId(),f=Object(s.ge)("audio"+_);if(f){var h=Object(s.getY)(f)+f.offsetHeight/2-Object(s.getCh)()/2;Object(s.scrollTop)(h),o.save(b,{html:null,st:Object(s.scrollTop)(),page:Object(s.ge)("m"),state:o.stash(),cur:window.cur,options:t||{}},!1)}};break;case"photo":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e);var n=Object(s.geByTag1)("img",t.target),i=(Object(s.attr)(n,"data-src_big")||"").split("|"),a=(i[0],i[1],i[2],n&&n.src||"/images/mobile/blank.gif"),r=n&&n.width||+i[1]||0,l=n&&n.height||+i[2]||0,c=(domData(n,"info-title"),domData(n,"info-subtitle"),function(e,t){return Wd.html(Object(E.default)({is_loading:!0,photo:e}))}({src:a,width:r,height:l}));Object(s.val)(Object(s.geByClass1)("mcont",e),c),Object(s.alLoadingFix)(),o.setMhead(e,lang.mobile_photos_photo_title)},afterAppend:function(){Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}},t);break;case"album":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e);var n,r=t.target.href,c=/((?:album|tag)(-?\d+)(?:(?:_(\d+))?))/.exec(r);c&&(n=c[1]);var u=n&&Object(m.getState)(n)||{},d=Object(a.$)(".AlbumItemInfo__title",t.target),f=!1;t.target.classList.contains("AlbumItem--empty")&&(f=!0);var p=Object(l.makeUrl)("/"+n,{act:"select_album"}),h=Object(i.default)({},u,{title:u.title||Object(s.val)(d)||lang.mobile_page_title_album,description:Wd.wrap(u.description),is_empty:f,add_url:p}),A=function(e){return void 0===e&&(e={}),Wd.html(Object(v.default)(Object(i.default)({},e,{title:Wd.wrap(e.title),is_loading:!e.is_empty})))}(h);Object(s.val)(Object(s.geByClass1)("mcont",e),A),Object(s.alLoadingFix)(),o.setMhead(e,h.title,!0,!1,{movable:!0})},afterAppend:function(){Object(v.initAlbumPage)(),Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}});break;case"albums":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e);var n=t.target.closest(".AlbumsBlock"),o=[];n&&(o=Array.from(Object(a.$$)(".AlbumItem",n)).map(function(e){return Object(g.getDataFromDOM)(e).album}));var r=function(e){return void 0===e&&(e={}),Wd.html(O(Object(i.default)({},e,{section:"all"})))}({albums:o});Object(s.val)(Object(s.geByClass1)("mcont",e),r),Object(s.alLoadingFix)()},afterAppend:function(){Object(v.initAlbumPage)(),Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}});break;case"u":case"g":case"p":case"e":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e)},afterAppend:function(){Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}},t);break;case"playlists":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e)},afterAppend:function(){Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}});break;case"empty":case"artist":case"playlist":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){_.drawLoader(e)},afterAppend:function(){Object(s.alLoadingFix)(),Object(s.scrollTop)(0)}},t);break;case"news_subsection":w=!0,o.set(b,!1,{before:!0,beforeAppend:function(e){var t=Object(s.geByClass1)("news_subsections",e);t&&!Object(s.hasClass)("summary_loading",t.firstChild)&&Object(s.before)(Object(s.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}});break;case"tabbar":w=!0,t.is_fast=!0;var I=!1,M={options:{is_fast:!0,tab:t.tab,prev_tab:t.prev_tab}};t.need_check_updates&&f&&(M=Object(s.extend)(M,f),I=!0),o.set(b,M,{before:!I,beforeAppend:function(e){o.setMhead(e,Object(s.attr)(t.target,"data-header"),!1),_.drawSkeletonLoader(e,t.tab),document.body.classList.contains("vk_tabbar_bottom")&&o.hideHeader(e)},afterAppend:function(){Object(s.alLoadingFix)()}});break;default:d=window.cur;var x=!!Object(s.geByClass1)("mhi_logo","mhead");if(w=!0,d.al_fast&&d.al_fast[C])o.set(b,!1,d.al_fast[C](t),t);else if(!x){var P={options:{is_fast:!0,tab:t.tab,removeAfterNextResponse:t.removeAfterNextResponse}};o.set(b,P,{before:!0,afterAppend:function(){Object(s.alLoadingFix)()}})}}}if(t.need_check_updates||j.abort_reqs(),t.local){var B=!0;o.set(b,{},{after:!0,no_scroll:!0,force:!0},!1),k&&k()}else{var L=Object(s.qs2obj)(t.nav.params);Object(s.extend)(L,t.params||{}),window.al&&!window.al.inited?L[c.NEED_MENU_PARAM]=c.FORCE_NEED_MENU:window.al&&window.al.menu||(L[c.NEED_MENU_PARAM]=c.NEED_MENU),y&&(L._tstat=y);var R=window.pStats,D=R.getSeenData();D&&(L._pstat=D.data,d&&d.module&&(L._pstatref=d.module)),L._ref||(L._ref=(n.path||"").substr(1));var N=A.split("#");!L._hash&&N.length>1&&(L._hash="#"+N[1]),Object(u.preloadStaticForNavigation)(A);var H=Object.assign({},t.headers,{"X-Ajax-Nav":"true"});B=j.post(A,L,{onPageDone:function(e,n,i,r,s){j.fastNav=!1;var l=window.cur;if(D&&R.onSend(D.seen),j.tProcess=(new Date).getTime(),o.set(b,{title:e,html:n,js:i,lm:r,bc:s,st:t.st||0},{after:w,no_scroll:w},!w&&t),t.back){var c=Object(a.$)(".layout");o.setMhead(c,!1,t.back)}j.tModule=l.module,j.tRender=(new Date).getTime(),j.onNavDone()},redirectToLoginPage:t.redirectToLoginPage,headers:H});j.save_req()}return w&&(t.zProcess&&(t.zProcess(),delete t.zProcess),n.set(t),j.tModule=d.module,j.tFastRender=(new Date).getTime(),j.fastNav=!0),B},confirm:function(e){function t(t,n,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,i){return!!confirm(t)&&j.click(e,i,{url_params:{hash:n}})}),_post:function(e,t,n){var i=function(e,t){n.onFail&&n.onFail.call(window,0,e,t)},a=window.debuglogSent?window.debuglogSent(e):-1;return j.plainpost(e,t,function(o,r){if(204===r.status&&r.getResponseHeader("X-AppShell-Fallback")){var c=location.href;return history.replaceState(null,null,Object(l.makeUrl)(location.href,{__appshell_fallback:r.getResponseHeader("X-AppShell-Fallback")})),void location.replace(c)}var u=!1;try{u=Object(s.parseJSON)(o)}catch(e){u=!1}!1===u?i():(j.parseResponse(u,e,t,n),j._debugLog(a,u.debugLog))},i,null,{headers:n.headers})},_debugLog:function(e,t){window.debuglogGot&&window.debuglogGot(e,t)},parseResponse:function(e,t,n,i){var o,r=window.al,l=window.nav,c=window.menu,d=window.page,p=e.version,h=e.counters,m=e.type,v=t.indexOf("community")>=0,A=!1;if(v?A=!(!window.al||p===r.ver):window.al&&p!==r.ver?A=!0:!window.menu||e.lm_data&&e.lm_data.lm||window.al&&window.al.menu&&window.al.menu.length&&(A=!c.refreshCounters(h)),!1!==h&&!v){Object(s.setNotify)(h[3])}switch(e.lm_data&&e.lm_data.lm&&h&&(e.lm_data.counters=h),m){case 0:if(A)return l.hard_go(l.cur,null,{replace:!0});var g=e.data;if(o=g&&isObject(g[0])&&g[0]._snackbar){if(Snackbar.init(o),2===o.type)return photoview.opened()?void photoview.close():Stories.opened?void Stories.close():zlayer.opened()?void zlayer.close():void(j.fastNav&&history.back());delete g[0]._snackbar}i&&i.onDone&&i.onDone.apply(window,g);break;case 1:var b=e.location;j.onRedirect(!0,b);var y=e.hard,w=e.frame,k=e.clear,S=e.restore;if(!w&&window.isNewMail&&j.onBeforeRedirect(b))break;if(k&&l.clear(),(o=e._snackbar)&&(Snackbar.init(o),delete e.snackbar),A||y)l.hard_go(b);else if(w){Object(_.setDocumentDomain)();var C=b+(-1==b.indexOf("?")?"?":"&")+"__extra=1",O=Object(s.createIframe)({src:C})}else l.go(b,null,{ignore_cur_process:!0,need_restore:S});break;case j.RESPONSE_CAPTCHA:var E=e.location,T=e.img,I=e.post,M=e.key;i&&i.onFail?i.onFail(m,E,{location:E,img:T,post:I,key:M}):l.hard_go(E);break;case 3:var x=e.lm_data;if(d.need_hard_go=A,x&&x.rdr&&window.al&&r.menu&&Object(s.getW)("vk_wrap")>=614){l.go(x.rdr,null,{replace:!0});break}f.default.getRouter().deactivateAllRoutes(),cur.share&&"destroy"in cur.share&&cur.share.destroy(),(i=i||{}).onPageDone||(i.onPageDone=function(e,n,i,a,o){l.go(t,null,{push_only:!0}),d.set(d.getHash(l),{title:e,html:n,js:i,lm:a,bc:o})});var P=e.title,B=e.html,L=e.js,R=e.body_class,D=e.top_bar,N=Object(s.ge)("vk_topbar");D&&!N?(N=Object(s.ce)("div",{id:"vk_topbar",innerHTML:D}),Object(s.before)(N,Object(a.$)(".layout"))):Object(s.val)(N,D),Object(u.addStatic)(e.static_files).then(function(){i.onPageDone(P,B,L,x,R)});break;case 4:if(i.redirectToLoginPage)return window.location=e.location,!1;if(!j._failed_relogin){var H=e.location;Object(_.setDocumentDomain)();O=Object(s.createIframe)({src:H})}j._failed_relogin=!0,j.save_failed_req(O,t,n,i)}},onReLoginDone:function(){j.repeat_reqs(),j._failed_relogin=!1},tGetParam:function(){if(j.tStart&&j.tModule){var e=j.tFastRender-j.tStart,t=j.tRestoreRender-j.tStart,n=j.tProcess-j.tStart,i=j.tRender-j.tProcess,a=["/"==j.tModule.substr(0,1)?j.tModule.substr(1):j.tModule,e,t,n,i];for(var o in a)(!a[o]||a[o]<0)&&(a[o]=0);return j.tStart=!1,a.join(",")}},tAlGetParam:function(){if(j.tAlStart&&j.tAlModule){var e=j.tAlProcess-j.tAlStart,t=j.tAlRender-j.tAlProcess,n=["al_"+("/"==j.tAlModule.substr(0,1)?j.tAlModule.substr(1):j.tAlModule),e,t];for(var i in n)(!n[i]||n[i]<0)&&(n[i]=0);return j.tAlStart=!1,n.join(",")}},refreshLinks:function(e,t){if(e){var n=Object(s.geByClass1)("mmi_fv","lm_cont"),i=n&&Object(s.geByClass1)("lfm_item",n),a=Object(s.geByClass1)("mmi_fv","mfoot"),o=a&&Object(s.geByClass1)("lfm_item",a),r=Object(s.ge)("fv_link"),l=Object(s.ge)("menu_fv_link"),c=Object(s.geBySel1)('link[rel="canonical"]');Object(s.attr)(i,"href",e),Object(s.attr)(o,"href",e),Object(s.attr)(r,"href",e),Object(s.attr)(c,"href",Object(s.attr)(Object(s.ge)("mcont"),"data-canonical")),window.nav.prev_fv_link&&Object(s.attr)(l,"href",window.nav.prev_fv_link),window.nav.fv_link=e}if(t){var u=Object(s.geByClass1)("mmi_app","lm_cont"),d=u&&Object(s.geByClass1)("lfm_item",u),_=Object(s.geByClass1)("mmi_app","mfoot"),f=_&&Object(s.geByClass1)("lfm_item",_),p=Object(s.ge)("app_link"),h=!!t&&"return nav.app_go(this, event, '"+Object(s.escapeStr)(t)+"');";Object(s.attr)(d,"onclick",h),Object(s.attr)(f,"onclick",h),Object(s.attr)(p,"onclick",h)}}};window.ajax=j;t.default=j},l51W:function(e,t){var n=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(a),val(a.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(a)}}}();window.GroupsInvite=n},ldCb:function(e,t){window.Informer={close:function(e){hide(e)}}},lkNA:function(e,t,n){"use strict";function i(e,t){var n,i=t.timeout,a=t.onLoad,o=t.onError,r=document.createElement("script");function s(e){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(c(),a&&a())}function l(e){c(),o&&o()}function c(){clearTimeout(n),r.removeEventListener("load",s),r.removeEventListener("readystatechange",s),r.removeEventListener("error",l)}return r.addEventListener("load",s),r.addEventListener("readystatechange",s),r.addEventListener("error",l),r.src=e,document.head.appendChild(r),i&&(n=setTimeout(l,i)),{destroy:function(){c()}}}n.r(t),n.d(t,"loadScript",function(){return i})},mXGF:function(e,t){var n,i,a,o,r,s,l,c=(n="_audioSnippet",i="audio_item",a="audioPlaylist__add_added",o="data-follow_text",r="data-unfollow_text",s="_audioPlaylistsPage__item",l="audioPlaylistsPage__item_removed",{playPause:function(e,t){preventEvent(e);var a=gpeByClass(n,t),o=geByClass1(i,a);audioplayer.playPause(e,attr(o,"data-id")),toggleClass("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){preventEvent(e);var n=geByClass1(s+attr(t,"data-playlist_owner_id")+"_"+attr(t,"data-playlist_id"));hasClass(a,t)?(t.innerText=attr(t,o),addClass(l,n)):(t.innerText=attr(t,r),removeClass(l,n)),function(e){ajax.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:attr(e,"data-playlist_owner_id"),playlist_id:attr(e,"data-playlist_id"),hash:attr(e,"data-hash")},{redirectToLoginPage:!0})}(t),toggleClass(a,t)},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <a href="#" class="ai_menu_toggle_button" onclick="ActionMenu.toggleMenu(event, this);" aria-label="'+lang.mobile_more+'"></a>\n                  <i class="i_pointer"></i>\n                  <div class="ai_menu wi_actions">\n                    '+e.follow_link+"\n                    "+e.publish_link+"\n                  </div>\n                </div>\n             </div>\n             "+e.actions;return t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <a href="#" class="ai_menu_toggle_button"></a>\n                   </div>\n                 </div>'),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var n=window.lang,i=(escapeAttr(e),n.mobile_audio_search_btn,function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+n.mobile_audio_search_placeholder_simple+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"});return t?i():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(i)},copyValue:function(e,t){var n=val(e),i=ge(t+"_field");val(i,n),cur&&cur[t]&&cur[t].go();var a=geBySel1(".audioPage__tabs .tab_item_cur");a&&toggleClass("tab_item_cur_noactive",a,n)}});window.AudioPlaylist=c},myok:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("BoyB"),o={className:"Btn",setLoading:function(e,t,n){void 0===n&&(n="");if(!e)return;var i=e.classList.contains(r.loading);if(t){if(i)return;var o=e.classList.contains(r.secondary),l=e.classList.contains(r.useWhiteLoader);!n&&o&&(n="white");var c=Object(a.default)({mix:r.loader,white:"white"===n||l,large:!0});e.classList.add(r.loading),e.insertAdjacentHTML("afterbegin",c)}else{if(!i)return;var u=e.$(s.loader);e.classList.remove(r.loading),u.remove()}},setDisabled:function(e,t){void 0===t&&(t=!0);e.disabled=t}};t.default=o,o._onClick=l;var r={loading:"Btn_loading",secondary:"Btn_theme_secondary",loader:"Btn__loader",useWhiteLoader:"Btn__loader--white"},s={loader:"."+r.loader};function l(e,t,n){e.preventDefault(),i.default.handle(n,{$btn:t})}},nXjO:function(e,t){var n={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout(function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()},this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),function(){this.src=n}),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=n},p5n7:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=function(e){var t=e.style||[],n=e.class||e.mix,a=e.prefix,o=e.postfix,r=function(e){var t=[];isArray(e.on_key_down)?(e.on_key_down.push("event"),t=e.on_key_down):e.on_key_down&&(t=[e.on_key_down,"event"]);return{class:"TextInput__native",id:e.id,tag:"input",type:e.type,name:e.name,value:e.value,spellcheck:e.spellcheck+"",placeholder:e.placeholder,autocapitalize:!1===e.autocapitalize?"off":null,autocomplete:!1===e.autocomplete?"off":null,tabindex:e.tabindex,readonly:e.readonly,disabled:e.disabled,oninput:e.on_change,onkeydown:t,onblur:e.onblur,onfocus:e.onfocus,maxlength:e.maxlength,pattern:e.pattern}}(e);return{class:[i.default.class("TextInput",{style_stretch:t.stretch,prefixed:!!a,hidden:"hidden"===e.type,error:t.error}),n],tag:"label",onclick:e.on_click,inner:a||o?[a?{class:i.default.class("TextInput__prefix",{rightPadding:a.with_right_padding,gray:a.gray}),inner:a.text}:null,{class:"TextInput__nativeWrap",inner:r},o?{class:"TextInput__postfix",inner:o.text}:null]:r}};Object.assign(a,{setPrefix:function(e,t){e.$(o.prefix).innerText=t},getValue:function(e){return e.$(o.native).value}});var o={native:".TextInput__native",prefix:".TextInput__prefix"};t.default=a;window.TextInput=a},"r/ag":function(e,t,n){"use strict";n.r(t);var i,a,o=n("Po+v"),r=n("1By4"),s=n("UxAg"),l=n("j80l"),c=n("OcsD"),u="pop_";Object.assign(o.default,{open:function(e,t,n){void 0===n&&(n={});var i=n,a=i.hash,o=i.oncloseCallback;if(C(e),v=Boolean(n.forceScrollDisable),t){var r=e;(e=r.cloneNode(!0)).appendedToBody=!0,e.original=r,document.body.appendChild(e)}e.classList.add(_.open);var l=e.$(f.scroll);k(e),o&&g.push([e,o]);if(l){if(y(e,l),e.onResizeHandler=function(){y(e,l)},addEvent(window,"resize",e.onResizeHandler),!window.MutationObserver)return e;e.scrollContentObserver=new MutationObserver(e.onResizeHandler),e.scrollContentObserver.observe(l,{childList:!0,subtree:!0})}if(a){var c="#"+u+a,d=nav.cur.split("#")[0];nav.go(d+c,!1,{push_only:!0}),A[c]=e}var p=Object(s.$)(f.content,e);p&&p.focus();return e},close:w});o.default;o.default._onOverlayClick=b;var d,_=((i={popup:"Popup",open:"Popup_open",wrap:"Popup__wrap",content:"Popup__content",hasScroll:"Popup_hasScroll",scrollView:"ScrollView",closing:"Popup--closing"}).content="Popup__content",i),f=((a={open:"."+_.open,popup:"."+_.popup,wrap:"."+_.wrap,content:"."+_.content,scroll:".Popup__scroll",header:".Popup__header",footer:".Popup__footer"}).content="."+_.content,a),p=!1,h=null,m=null,v=!1,A={},g=[];function b(e,t,n){var i=e.closest(f.popup);t&&r.default.handle(t,{$popup:i}),n&&w(i)}function y(e,t){var n=e.$(f.header),i=e.$(f.footer);t.scrollHeight-6>t.offsetHeight?(Object(c.addClass)(e,_.hasScroll),Object(c.addClass)(t,_.scrollView),ContentScrollView.restore()):(Object(c.removeClass)(e,_.hasScroll),Object(c.removeClass)(t,_.scrollView),t.scrollTop=0);var a=getCh(),o=0,r=0;n&&(o=n.offsetHeight),i&&(r=i.offsetHeight);var s=Math.min(a-o-r-100,420);setStyle(t,"max-height",s+"px")}function w(e,t){void 0===t&&(t={});var n=t,i=n.smooth,a=n.velocity,o=n.lastY;if(e&&!e.classList.contains(_.popup)&&(e=e.closest(f.popup)),e||(e=Object(s.$)(f.open)),e){var r=Object(s.$)(f.wrap,e),d=Object(s.$)(f.content,e);if(i&&a&&o){e.classList.add(_.closing);var p=getH(d),h=(p-o)*a.y;return h>=300&&(h=200),h=Math.max(100,Math.min(300,h)),setStyle.animate(r,"transform",{duration:h,func:"cubic-bezier(0.0, 0.0, 0.2, 1)"}),setStyle.transform(r,1,[0,p+"px"]),setTimeout(function(){w(e,!1)},1.1*h)}if(i){e.classList.add(_.closing);var m=getH(d);return setStyle.animate(r,"transform",{duration:200,func:"cubic-bezier(0.0, 0.0, 0.2, 1)"}),setStyle.transform(r,1,[0,m+"px"]),setTimeout(function(){w(e,!1)},200*1.1)}if(e.classList.remove(_.open),e.appendedToBody&&document.body.contains(e)&&Object(c.replace)(e,e.original),e.classList.remove(_.closing),setStyle.transform(r),removeEvent(window,"resize",e.onResizeHandler),e.scrollContentObserver&&e.scrollContentObserver.disconnect(),Object(s.$)(f.open)||S(),nav.cur&&nav.cur.startsWith("#"+u)){var v=l.default.make(nav.path,qs2obj(nav.params));nav.set({nav:Object(c.extend)({},nav,{cur:nav.path,path:nav.path||"",push:v||""})})}var A,b=(A=e,(g.find(function(e){return e[0]===A})||[])[1]);b&&(b(),C(e)),window.cur&&window.cur.app&&window.cur.app.frame&&window.cur.app.frame.focus()}}function k(e){if(window.MutationObserver&&!p){nav.saveScrollPosition();var t=document.body;h=t.style.overflow,p=!0,browser.ios||browser.ipad||(t.style.overflow="hidden"),v&&(t.style.height="100%",document.documentElement.style.overflow="hidden"),m=new MutationObserver(function(){t.contains(e)||S()}),d=Object(c.scrollTop)(),document.body&&(document.body.classList.add("fixed"),setStyle(document.body,{top:"-"+d+"px"}),browser.safari&&Object(c.getCw)()<882&&document.scrollingElement&&(document.scrollingElement.scrollTop=d,setTimeout(function(){document.scrollingElement.scrollTop=d},100),setTimeout(function(){document.scrollingElement.scrollTop=d},300))),m.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}}function S(){window.MutationObserver&&p&&(document.body.style.overflow=h,v&&(document.documentElement.style.overflow="initial"),m.disconnect(),document.body&&(document.body.classList.remove("fixed"),setStyle(document.body,{top:""}),Object(c.scrollTop)(d)),p=!1)}function C(e){var t=g.findIndex(function(t){return t[0]===e});t>=0&&g.splice(t,1)}nav.onPopState&&nav.onPopState(function(){var e=A[nav.cur];e&&(w(e),delete A[nav.cur])}),n.d(t,"POPUP_DISAPPEAR_TIME",function(){return 200}),n.d(t,"POPUP_NAV_PREFIX",function(){return u}),window.Popup=o.default;t.default=o.default},rKUZ:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("z9sQ"),r=n("BoyB");function s(){var e=Object(i.default)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return l=function(){return e},e}var c=function(e){var t,n,i=e.dimmed,c=e.animation,_=!!e.compact,f=e.typingCount,p=a.default.class("typing",{dimmed:i,id:e.id,empty:u(f),animation:c}),h=d(e);"audio"===c?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!0,compact:_})}),n=""):"dots"===c?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!1,compact:_})}),n=""):"simple-dots"===c&&(t="",n=a.default.html(s()));return a.default.html(l(),p,t,h,n)};function u(e){return!e}function d(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!Array.isArray(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_recaudio_1).replace("{name}",r)}else if(2===a&&i.length>=2){var s=i[0],l=i[1];o=(o=(o=n.mobile_mail_recaudio_2).replace("{name1}",s)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];o=(o=(o=n.mobile_mail_recaudio_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_recaudio_N_unknown));return o}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!Array.isArray(e))return"";var i=e,a=t,o="";if(1===a&&i.length>=1)o="";else if(2===a&&i.length>=2){var r=i[0],s=i[1];o=(o=(o=n.mobile_mail_mixtyping_2).replace("{name1}",r)).replace("{name2}",s)}else if(a>1&&i.length>=1){var l=i[0];o=(o=(o=n.mobile_mail_mixtyping_many).replace("{name}",l)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_mixtyping_N_unknown));return o}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!Array.isArray(e))return e?n.mobile_mail_typing_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_typing_1).replace("{name}",r)}else if(2===a&&i.length>=2){var s=i[0],l=i[1];o=(o=(o=n.mobile_mail_typing_2).replace("{name1}",s)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];o=(o=(o=n.mobile_mail_typing_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_typing_N_unknown));return o}(e.typing,e.typingCount)}var _=n("UxAg");Object.assign(c,{setTyping:function(e,t){var n="string"==typeof e?Object(_.$)(".typing_id_"+e):e,i=n.$(".typing__names");n.classList.toggle("typing_empty",u(t.typingCount)),i.innerHTML=d(t)},getElem:function(e){return Object(_.$)(".typing_id_"+e)}});t.default=c;window.Typing=c,Object.assign(window,{Typing_renderNames:d,Typing_isEmpty:u})},rKp0:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("O5lf"),s=n("M2vk"),l=n("5qQ6"),c=n("/Rzu"),u=n("HGMY"),d=n("TYsd");function _(){var e=Object(i.default)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return _=function(){return e},e}function f(){var e=Object(i.default)(['\n    <div class="mailScrap__empty mailScrap__empty_','">\n      ',"\n    </div>\n  "]);return f=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return h=function(){return e},e}var m=function(e){var t=e.scrap,n="peer"===t,i=k(t),r=n?y("before"):"",l=y("after"),c=y("center"),p=function(e){var t,n=a.default.class("mailScrap__items",((t={})[e]=!0,t)),i=v(e);return Object(o.default)({mix:n,inner:i})}(t),m=function(e){var t=w(e);return a.default.html(f(),e,t)}(t),A=n?Object(s.default)():"",g=n?d.default.html(Object(u.default)()):"",b=n?(S=store.mail.cur.notification||"",C=a.default.onClick("MailScrap.clearSystemMessage2"),a.default.html(_(),C,S)):"";var S,C;return a.default.html(h(),i,r,p,m,l,g,A,b,c)};function v(e){for(var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps[e],r=o.length,s=[],l=!1,c=0;c<r;c++){if(c>0&&"peer"===e&&!l){var u=i[o[c-1]],d=i[o[c]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){l=!0,s.push(A(e,o[c],!0));continue}}s.push(A(e,o[c]))}return a.default.list(s)}function A(e,t,n){void 0===n&&(n=!1);var i=store.mail.cur,a="";if("folder"===e)a="important"===i.folder?g(t):b(t);else if("search"===e){if("peers"===i.tab)a=function(e){return Object(c.default)(e)}(t);else a=g(t)}else if("peer"===e){a=function(e,t){void 0===t&&(t=!1);return Object(l.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){a=b(t)}return a}function g(e){var t=store.mail.msgs[e].peerId;return Object(c.default)(t,e)}function b(e){return Object(c.default)(e,"last")}function y(e){var t,n=a.default.class("mailScrap__loading",((t={})[e]=!0,t)),i=Object(r.default)({mix:""});return a.default.html(p(),n,i)}function w(e){var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function k(e){var t,n=store.mail,i=n.cur,o=n.reached,r=!0,s=!1,l=!1,c=!1;if("peer"===e){var u=i.peerId,d=n.scraps.peer,_=d.length,f=n.rolls.peer[u]||[];r=o.peer.before[u]&&d[0]===f[0],s=last(d)===last(f)&&o.peer.after[u],0===_&&(s=!0);var p=u?n.peers[u]:null;p&&(l=!!p.systemMessageCode,p.isChannel&&(c=p.ownerId!==i.viewerId))}else if("mrs"===e)s=o.mrs;else if("folder"===e)s=o.folder[i.folder];else if("search"===e){var h=i.tab;i.query;if("peers"===h){var m=n.scraps.search.length;s=o.search[i.tab][i.query]||m>0}else s=o.search[i.tab][i.query]}return a.default.class("mailScrap",((t={})[e]=!0,t.empty=function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.reached,o=!1;switch(e){case"peer":var r=n.peerId,s=t.rolls.peer[r];0===(s?s.length:0)&&a.peer.after[r]&&a.peer.before[r]&&(o=!0);break;case"mrs":0===i.mrs.length&&a.mrs&&(o=!0);break;case"folder":0===i.folder.length&&a.folder[n.folder]&&(o=!0);break;case"search":0===i.search.length&&a.search[n.tab][n.query]&&(o=!0)}return o}(e),t.systemMessage=l,t.reachedBefore=r,t.reachedAfter=s,t.tab="search"===e&&i.tab,t.isChannel=c,t))}n("+cqQ");var S=n("irqS"),C=n("BZzM"),O=(n("s0aB"),n("GR/G")),E=n.n(O);Object.assign(m,{updateClass:P,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,P("peer"),B()}()},resetPrevScraps:function(){j={folder:[],search:[],peer:[]}},redrawPeer:function(){x("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach(function(e){return e.className=k("peer")}),$$(".mailScrap__empty_peer").forEach(function(e){return e.innerHTML=w("peer")})},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;x("folder",i.folder,e),$$(".mailScrap_folder").forEach(function(e){return e.className=k("folder")}),$$(".mailScrap__empty_folder").forEach(function(e){return e.innerHTML=w("folder")})},redrawSearch:function(){$$(".mailScrap__items_search").forEach(function(e){return e.innerHTML=v("search")}),$$(".mailScrap_search").forEach(function(e){return e.className=k("search")}),$$(".mailScrap__empty_search").forEach(function(e){return e.innerHTML=w("search")})},redrawMRs:function(e){x("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach(function(e){return e.className=k("mrs")}),$$(".mailScrap__empty_mrs").forEach(function(e){return e.innerHTML=w("mrs")})},redrawSystemMessage:B,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach(function(t){return t.innerHTML=M(e,!0)}),$$(".mailScrap_folder").forEach(function(e){return e.className=k("folder")}),$$(".mailScrap__empty_folder").forEach(function(e){return e.innerHTML=w("folder")})},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach(function(t){return t.insertAdjacentHTML("beforeend",M(e))})},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach(function(t){[].slice.call(t.children).slice(e).forEach(function(e){return t.removeChild(e)})})},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(I([e],!0));n.appendChild(t),E()(t,i),P("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);P("peer"),e=e.filter(unique).filter(function(e){return!$(".msg_id_"+e)});var n=S.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout(function(){return window._preventedCheckTop=!1});var i='\n    <div class="load_before load_before_closed">\n      '+I(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach(function(e){return e.insertAdjacentHTML("afterbegin",i)}),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter(function(e){return!$(".msg_id_"+e)}),$$(".mailScrap__items_peer").forEach(function(n){n.insertAdjacentHTML("beforeend",I(e,t))}),P("peer"),Object(C.resizePosters)()},peerReplaceItems:function(e){e.forEach(function(e){var t=$(".msg_id_"+e),n=ceFromString(I([e],!0));E()(t,n)}),Object(C.resizePosters)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach(function(t){return t.innerHTML=I(e)})},peerGoToBottom:function(){var e=S.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:T,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&T()}}),uVK.onReady(function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;j.folder=e.folder.slice(),j.search=e.search.slice(),j.peer=e.peer.slice()}});var j={folder:[],search:[],peer:[]};function T(){remove($(".msg__newMsgsDivider"))}function I(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,a=i.cur,o=i.msgs,r=!!$(".msg__newMsgsDivider");return e.map(function(e,i){var s=o[e];return i>0&&!r&&!t&&!n.isUnread&&s.isUnread&&s.authorId!==a.viewerId?(n=s,r=!0,A("peer",e,!0)):(n=s,A("peer",e))}).join("")}function M(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map(function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":A("folder",e)}).join("")}function x(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var a=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach(function(n,a){var o=i.indexOf(n);-1===o?(i.splice(a,0,n),domInsert(e,t(n),a)):o!==a&&(i.splice(o,1),i.splice(a,0,n),before(e.children[o],e.children[a]))}),i.forEach(function(t,i){-1===n.indexOf(t)&&a.push(e.children[i])}),a.forEach(remove)}($(".mailScrap__items_"+e),function(t){return A(e,t)},t,n)}function P(e){$$(".mailScrap_"+e).forEach(function(t){return t.className=k(e)})}function B(){$$(".mailScrap__systemMessage").forEach(function(e){e.innerHTML=store.mail.cur.notification||""})}t.default=m;window.MailScrap=m},rc7J:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=i.default.class("AlbumInfoRow",{withoutBottomBorder:e.withoutBottomBorder},"--");return{inner:[{inner:[{src:e.avatar,alt:"avatar",tag:"img"}],class:"AlbumInfoRow__avatar",href:e.author_url,onclick:"cancelEvent(event); nav.go(this);",tag:"a"},{inner:[{inner:[e.title],class:"AlbumInfoRow__title",href:e.url,tag:"a"},{inner:[e.subtitle],class:"AlbumInfoRow__subtitle",tag:"div"}],class:"AlbumInfoRow__content",tag:"div"}],class:t,onclick:"nav.go('"+e.url+"')",tag:"div"}};t.default=a},s0aB:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("AXyT"),s=n("9y81"),l=n("KMpi"),c=n("rKUZ");function u(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title">\n          <div class="convo__title">','</div>\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">','</div>\n          </div>\n        </div>\n        <div class="convo__row convo__row_text">\n          <div class="convo__typing">','</div>\n          <div class="convo__text">','</div>\n          <div class="convo__row_right convo__unreadBox" ',">\n            ",'\n            <div class="convo__unreadOut"></div>\n          </div>\n          <div class="convo__status">',"</div>\n        </div>\n      </a>\n    </div>\n  "]);return u=function(){return e},e}var d=function(e){var t,n,i=e.more,o="",d="",p=0,h=!1,m="";i&&(o=i.text,d=i.date,p=i.unreadCount,h=i.muted,m=i.typing?Object(c.default)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(d=""));var v=a.default.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!m,important:e.important,unread:e.isLast&&p>0,unreadOut:e.isLast&&p<0}),A=Object(l.default)({mix:"convo__avatar",photos:e.photos,url:e.profileUrl}),g=e.isLast?Object(r.default)({mix:"convo__unread",value:p,gray:h}):"",b=f({pending:t,failed:n}),y=_(e.online),w=Object(s.default)({mix:"convo__star",icon:"star",blue:!0}),k=e.url,S=a.default.onClick("Convo._onClick","event",k);return a.default.html(u(),v,S,y,A,e.url,e.title,w,d,m,o,b?"hidden":"",g,b)};function _(e){return"mobile"===e?Object(s.default)({mix:a.default.class("convo__online",{mobile:!0}),icon:"phone"}):"desktop"===e?Object(o.default)({mix:a.default.class("convo__online",{desktop:!0})}):Object(o.default)({mix:"convo__online"})}function f(e){var t=window.lang;return e.pending?'<div class="convo__pending"></div>':e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}var p=n("UxAg"),h=n("+cqQ");n("jk6M");function m(e,t){e.target.closest("a.convo__avatar")||(e.stopPropagation(),e.preventDefault(),d.onTap(t))}Object.assign(d,{onTap:Object(h.default)("url"),setOnline:function(e,t){Object(p.$$)(".convo_id_"+e+" .convo__online").forEach(function(e){e.outerHTML=_(t)})},setLastMsg:function(e,t,n){var i=n.dateShort,a=n.pending,o=n.failed;Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=f({pending:a,failed:o}),a||o?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=i,e.$(".convo__unreadBox").hidden=!1)})},setTyping:function(e,t){Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||Array.isArray(i))){var a=n.$(".typing"),o=a&&q.parseClass("typing",a.className);a&&o.animation===t.animation?c.default.setTyping(a,t):(e.classList.add("convo_typing"),n.innerHTML=Object(c.default)(t))}else n.innerHTML="",e.classList.remove("convo_typing")})},setUnreadCount:function(e,t){Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){var n=e.$(".Oval");e.classList.toggle("convo_unread",t>0),e.classList.toggle("convo_unreadOut",t<0),r.default.setValue(n,t)})},setImportant:function(e,t){Object(p.$$)(".convo_id_"+e).forEach(function(e){e.classList.toggle("convo_important",t)})}}),d._onClick=m;t.default=d;window.Convo=d,window.Convo__online=_},sc7o:function(e,t,n){"use strict";n.r(t);var i=n("+cqQ");window.uVK={onReady:Object(i.default)(),onResize:Object(i.default)(),onOrientationChange:Object(i.default)()},onDOMReady(function(){if(window.isNewMail&&document.body){uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}})},t7Ww:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalMenuBtn",function(){return o}),n.d(t,"ModalMenuContent",function(){return r});var i=n("r/ag"),a=n("29dZ");function o(e){var t=e.class?" "+e.class:"";return Object(a.default)({url:e.url,class:"ModalMenu__btn ModalMenu__item"+t,theme:e.theme?e.theme:"none",size:e.size?e.size:"",inner:e.inner,on_click:e.onclick,use_native_onclick:!0,attrs:e.attrs})}function r(e){return e.class+=" ModalMenuContent",e}t.default=function(e){var t=e.attached?"ModalMenu--attached":"",n=window.lang,o=[];if(e.title&&o.push({class:"ModalMenu__title",inner:e.title}),e.body&&o.push({class:"ModalMenu__body",inner:e.body}),isArray(e.items)){var r=e.items.map(function(e){return e});o.push(r)}e.close&&o.push(Object(a.default)({class:"ModalMenu__btn ModalMenu__cancel",theme:"secondary",size:"large",inner:e.closeText?e.closeText:n.mobile_cancel,on_click:e.onClose?e.onClose:["ModalMenu.close","this"],use_native_onclick:!0}));var s=function(e){if(e&&e[0]&&e[0].inner&&e[0].inner.inner&&"ModalMenuHeader"===e[0].inner.inner[0].class)return!0;return!1}(o)?" ModalMenu--hasHeader":"";return Object(i.default)({class:"ModalMenu "+e.class+" "+t+" "+s,on_overlay_click_native:e.on_overlay_click?e.on_overlay_click:["ModalMenu.close","this"],content:o})}},tgcV:function(e,t,n){"use strict";function i(e){return new Promise(function(t,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=function(){return t(i)},i.onerror=function(){return n(new Error("Stylesheet load error for "+e))},document.head.appendChild(i)})}function a(e){var t,n=(t=e,new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.response):n(i.response)},i.onerror=function(){n(i.response)},i.send()}));return n.then(function(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}),n}var o;n.r(t),n.d(t,"addStatic",function(){return _}),n.d(t,"preloadStaticForNavigation",function(){return f}),n.d(t,"initStaticManager",function(){return p});var r=[];function s(e,t){var n=e+"?"+t,i=new Promise(function(t,i){var a,o,r;a=n,o=function(n){n?(window.stManager.staticFiles[e]=null,i(n)):t()},(r=document.createElement("script")).src=a,r.onload=function(){return o(null,r)},r.onerror=function(){return o(new Error("Script load error for "+a))},document.head.appendChild(r)});return window.stManager.staticFiles[e]=i,i}function l(e,t){var n=(function(){if(void 0!==o)return o;try{var e=document.createElement("b");e.style.display="flex",o="flex"===e.style.display}catch(e){o=!1}return o}()?i:a)(e+"?"+t).catch(function(){return window.stManager.staticFiles[e]=null,Promise.resolve()});return window.stManager.staticFiles[e]=n,n}function c(e){window.stManager.staticFiles[e]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles?(Object.keys(window.vk.stFiles).forEach(function(e){return c(e)}),window.vk.stFiles=[]):setTimeout(u,0)}function d(e){r[e]&&r[e]()}function _(e){return void 0===e&&(e={}),Promise.all(Object.keys(e).map(function(t){return n=t,i=e[t],window.stManager.staticFiles[n]||(n.includes(".js")?s(n,i):n.includes(".css")?l(n,i):Promise.resolve());var n,i}))}function f(e){var t=window.vk.stNavMap||{};for(var n in t){if(t.hasOwnProperty(n))if(new RegExp(n).test(e)){_(t[n]||{});break}}}function p(){u(),window.stManager={done:d,staticFiles:[],registerLoadedScript:c}}},"tlL+":function(e,t){window.FriendsRecommendedSlider={init:function(){window.cur&&(y($("."+p)),cur.destroy.push(function(){A=null,g=null,b=null}))},hideRecommended:function(e,t,o,r){var s=gpeByClass(a,e);if(!s)return r&&cancelEvent(r);var l=S(s),c=domData(s,"code")||domData(l,"code"),u=domData(l,"ref");!function(e){var t=S(e);remove(e),b=null,g=null,w().length||k(t)}(s);var d=n+obj2qs({act:i,hash:o,id:t,track_code:c,ref:u});return ajax.post(d,{_ajax:1}),r&&cancelEvent(r)},hideBlock:k,acceptFriend:function(e,t,n,i){if(hasClass(o,e))return i&&cancelEvent(i);var s=gpeByClass(a,e),d=S(e),_=domData(s,"code")||domData(d,"code"),p=domData(d,"ref");return addClass(r,e),lockButton(e),Friends.accept(t,n,"user_rec",0,p,_,function(t){var n=t||getLang(l);unlockButton(e),removeClass(r,e),addClass(o,e),e.textContent=n,function(e){var t=function(e){var t=domCA(e,f);if(!t)return;return geByClass1(c,t)}(e);addClass(u,t)}(e)},function(t,n){t===v&&nav.hard_go(n),removeClass(r,e),unlockButton(e)}),i&&cancelEvent(i)},onOpenUser:function(e){var t=gpeByClass(a,e);if(!t)return;var n=S(t),i=domData(t,"uid")||"",o=domData(t,"code")||domData(n,"code"),r=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:r,trackCode:o})},onScroll:throttle(y,50)};var n="/friends",i="hide_possible",a="prettyCard",o="prettyCard__button_accepted",r="prettyCard__button_loading",s="recommended_carousel",l="mobile_friends_feed_recom_got_notification",c="prettyCard__closeButton",u="prettyCard__closeButton_hidden",d="Slider__line",_="Slider__scroll",f=".prettyCard",p="friendsRecommendedSliderWrap",h=500,m=3,v=2,A=null,g=null,b=null;function y(e){if(!A&&e&&(A=S(e)),A&&(A._lastScroll=A.scrollLeft,!e.ajaxIsRunning)){var t=A.scrollLeft,i=function(){if(g)return g;if(!A)return{};var e=getSize(A)[0],t=getX(A),n=w(),i=getX(n[0])-t,a=getSize(n[0])[0],o=getX(n[1])-t-i-a,r=Math.floor(a/3);return g={width:e,itemWidth:a+o,leftMargin:i,part:r,scrollWidth:A.scrollWidth}}(),a=Math.max(0,Math.floor((t-i.leftMargin)/i.itemWidth)),o=Math.max(0,Math.floor((t+i.width-i.leftMargin)/i.itemWidth));a*i.itemWidth+i.itemWidth-i.part<t&&a++,o*i.itemWidth+i.part>t+i.width&&o--;var r=w();a=Math.max(0,a),o=Math.min(r.length,o);for(var l=domData(A,"ref"),c=domData(A,"code"),u=a;u<=o;u++){var _=r[u];if(_&&!_.viewed){_.viewed=!0;var f=domData(_,"uid")||"",p=domData(_,"code")||c;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:f,pos:u,ref:l,trackCode:p})}}!e.allLoaded&&t+i.width>=i.scrollWidth/2&&function(e){(e=S(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=m)return void(e.allLoaded=!0);var i=domData(e,"code")||"",a=domData(e,"ref")||"",o=intval(domData(e,"friend-id")),r=n+obj2qs({act:s,next:t,ref:a,friendId:o,track_code:i});e.ajaxIsRunning=!0,ajax.post(r,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1(d,e),a=cdf(t);append(a,i),g=null,b=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout(function(){return e.ajaxIsRunning=!1},h)}})}(e)}}function w(){return b||(A&&(b=geByClass(a,A)),b||[])}function k(e,t){var n=gpeByClass(p,e);if(!n)return t&&cancelEvent(t);var i=A;if(!i&&e&&(i=S(n)),i){var a=domData(i,"code"),o=domData(i,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:o,trackCode:a})}if(remove(n)){var r=nav.getQuery();delete r.recs,nav.go(location.pathname+obj2qs(r),!1,{replace:!0,push_only:!0})}return t&&cancelEvent(t)}function S(e){var t;return hasClass(e,_)?t=e:(t=geByClass1(_,e))||(t=gpeByClass(_,e)),t}},tlMv:function(e,t,n){"use strict";n.r(t);var i=n("g3t9");t.default=i.default},tqja:function(e,t){var n,i,a=(n="_locked",i={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(e,t,a,o,r,s){if(void 0===s&&(s=!1),e.classList.contains(n))return!1;var l=!0;return i[t]&&(l=!1),e.classList.add(n),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:t,resource:a,group_id:o,hash:r},{onDone:function(){if(e.classList.remove(n),s)s();else if(l){var t=attr(e,"href");nav.go(t)}}}),!l}});window.GroupActionButton=a},u33z:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return o=function(){return e},e}function r(){var e=Object(i.default)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return r=function(){return e},e}var s=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return a.default.html(r(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return a.default.html(o(),s,t,e.onClick,e.text)};t.default=s;window.MailButton=s},uQjJ:function(e,t,n){"use strict";n.r(t);var i=n("4O8T"),a=n.n(i);window.EventEmitter=a.a,t.default=a.a},uo4j:function(e,t){ownerPhotoUpload.onUploadedDone(function(e){var t=geByClass1(n);if(t){var s=geByClass1(i,t),d=geByClass1(o,t),_=geByClass1(a,t),f=geByClass1(r,t);(function(e,t){if(window.Image){var n=new Image;n.onload=function(){return u(e,t)},n.src=e}else u(e,t)})(e=function(e){return e.replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"")}(e),s),_&&(_.textContent=getLang(l)),d&&(d.textContent=getLang(c)),FeedAssistance.setFilled(t),remove(f)}}),FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto");var n="feedAssistance_profilePhoto",i="feedAssistanceProfilePhotoContent__avatar",a="feedAssistanceProfilePhotoContent__title",o="feedAssistanceProfilePhotoContent__desc",r="feedAssistance__footerButton",s="feedAssistanceProfilePhotoContent__avatar_uploaded",l="mobile_assistance_profile_photo_uploaded_title",c="mobile_assistance_profile_photo_uploaded_desc";function u(e,t){var n;t&&(addClass(s,t),setStyle(t,"background-image","url("+e+")")),n=e,geByClass("al_u"+vk.id).forEach(function(e){domData(e,"photo")&&domData(e,"photo",n);var t=geByClass1("_u"+vk.id,e);t&&"IMG"===t.tagName&&(t.src=n)})}},"v+Uj":function(e,t,n){"use strict";n.r(t);var i=function(e){return{class:["Slider",e.class||e.mix],inner:{class:["Slider__scroll","_preventMenuOpen"],attrs:e.attrs,onwheel:["Slider._onWheel","event","this"],inner:{class:"Slider__line",inner:e.inner}}}},a=n("UxAg"),o=n("jk6M");window.Slider={scrollToElem:s},Slider._onWheel=l,onDOMReady(c);var r={slider:".Slider",scroll:".Slider__scroll"};function s(e){var t=e.closest(r.scroll);t.scrollLeft=e.offsetLeft-t.offsetWidth/2+e.offsetWidth/2}function l(e,t){var n=e.deltaX,i=e.deltaY;Math.abs(n)>Math.abs(i)&&(e.preventDefault(),t.scrollLeft+=n)}function c(){(o.default.ios||o.default.msie_edge)&&(onDOMReady(d),window.page.onChange(d),window.MutationObserver&&onDOMReady(function(){document.body&&new MutationObserver(u).observe(document.body,{subtree:!0,childList:!0})}))}function u(e){e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&e.$$(r.slider).forEach(_)})})}function d(){Object(a.$$)(r.slider).forEach(_)}function _(e){var t=getComputedStyle(e),n=Number(t.paddingTop.replace("px","")),i=Number(t.paddingBottom.replace("px",""));e.style.overflow="hidden",e.style.height=e.offsetHeight-n-i+"px",e.$(r.scroll).style.paddingBottom="20px"}n.d(t,"scrollToElem",function(){return s}),n.d(t,"_onWheel",function(){return l});t.default=i;window.Slider=i,extend(i,{scrollToElem:s,_onWheel:l})},vOib:function(e,t,n){"use strict";n.r(t);var i=n("UWnA"),a=n("8ZMO");var o=function(e){return{inner:[e.text||e.inner],class:[e.class,Bem.class("Alert",{theme:e.theme})].join(" "),tag:"div"}},r=n("z9sQ"),s=(n("TYsd"),n("fdw3"));function l(e){var t=[e];return Array.isArray(e)&&(t=Object(s.wdToFlatArray)(e)),t.join("")}function c(e){var t=l(e);return!t||"<div></div>"===t}var u=function(e){if(void 0===e&&(e={}),e.content_only)return{outerHTML:l(e.content)};var t=e.title,n=e.corner||{},s=e.inner||e.content||e.children,u=e.anchor,d=e.alert,_=e.style||{},f=e.attrs||{},p=e.noShadow,h="gray";null!==e.count&&(h="black");var m=e.pageBlock?"PageBlock PageBlock--separate":"";return{tag:e.tag||"div",class:[e.class||e.mix,r.default.class("Pad",{empty:c(s),noBorder:e.no_border,noCapsTitle:e.no_caps_for_title,style_extraTopPadding:_.extra_top_padding,theme:h,noShadow:p}),m],attrs:f,"data-id":e.name||e.id,inner:[u?Object(a.default)({mix:"Pad__anchor",id:u}):null,d?Object(i.default)({inner:[o({inner:[d],class:"Pad__alert",theme:e.alert_theme})],style:{tiny_padding_bottom:!0}}):null,t?Object(i.default)({inner:[{inner:[t,null!==e.count?{inner:[e.count],class:"Pad__count",tag:"span"}:null],class:"Pad__title",tag:"h3"},n.url?{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"a"}:{inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class],tag:"div"}],class:"Pad__header"}):null,t?{inner:[s],class:["Pad__content",e.content_mix],tag:"div"}:s]}};t.default=u},vOyG:function(e,t){e.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"]},w1QQ:function(e,t){window.FeedAssistance={hide:function(e,t,a){var s=domCA(e,o),l=hasClass(s,r);remove(s),l||function(e,t,a){var o=FeedAssistanceStats.getFromRef(e);ajax.post(n,{_ajax:1,type:t,hash:a,act:i,from:o})}(e,t,a);return!1},setFilled:function(e){var t=hasClass(e,a)?e:domCA(e,o);addClass(r,t)}};var n="/feed",i="hide_assistance",a="feedAssistance",o="."+a,r="feedAssistance_filled"},wTbK:function(e,t,n){"use strict";n.r(t);var i,a,o,r=n("t7Ww"),s=n("r/ag"),l=n("UxAg"),c=function(){function e(e){this.lastTime=0,this.lastRegisteredTime=0,this.lastCoordinates=[],this.lastTime=e.time,this.lastCoordinates=[e.x,e.y],this.velocity={x:0,y:0}}return e.getVelocity=function(e,t,n){return{x:t/e||0,y:n/e||0}},e.prototype.registerEvent=function(t){if("touchmove"===t.type){var n=t.touches[0].clientX,i=t.touches[0].clientY,a=t.timeStamp-this.lastTime;if(t.timeStamp-this.lastRegisteredTime<=16.67)this.lastCoordinates=[n,i],this.lastTime=t.timeStamp;else{var o=n-this.lastCoordinates[0],r=i-this.lastCoordinates[1];this.velocity=e.getVelocity(a,o,r),this.lastTime=t.timeStamp,this.lastRegisteredTime=this.lastTime,this.lastCoordinates=[n,i]}}else window.clog&&window.clog("[Gestures.js] unhandled event "+t.type)},e}(),u=n("CQvH"),d=882,_=.6,f=!1,p=null,h=0,m=0,v={},A=null,g=Object(l.$)(".Popup__wrap",i),b=5;function y(e,t,n,r){void 0===t&&(t=!0),void 0===n&&(n=""),void 0===r&&(r={});var c=r,_=c.settling,f=void 0===_?75:_,p=c.expandable,h=void 0!==p&&p;if(r.settling=f,r.expandable=h,i=s.default.open(e,t,{hash:n}),v=r,g=Object(l.$)(".Popup__wrap",i),o=Object(l.$)(".Popup__content",g),void 0===r.swipeDown&&(r.swipeDown=!0),h&&k(i)){i.classList.add("ModalMenu--expandable");var m=(100-v.settling)/100*window.innerHeight;E=m,setStyle.transform(g,1,[0,m])}return I(),onBodyResize(I),r.swipeDown&&window.innerWidth<d&&(scrollTop(0),addEvent(o,"touchstart",C,{passive:!0}),addEvent(o,"touchmove",j,{capture:!0}),addEvent(o,"touchcancel touchend",T,{passive:!0}),addEvent(g,"click",w,{passive:!0}),addEvent(g,"click",w,{passive:!0})),(a=Object(u.setFocusTrap)(i))&&(a.exitIntent=function(){return!1}),i}function w(e){if(g&&e.target===g)return(a=Object(u.setFocusTrap)(i))&&(a.beforeExit=function(){return!1}),i}function k(e){var t=Object(l.$)(".ScrollView",e)||Object(l.$)(".ModalMenuContent",e)||Object(l.$)(".Popup__content",e);return!(getCw()>=d)&&(t.scrollHeight||getH(t))>=window.innerHeight}function S(e,t){if(void 0===t&&(t={}),e||(e=document.activeElement),e){var n=e.closest(".ModalMenu.Popup_open")||e;n&&(innerWidth<d?(s.default.close(n,{smooth:!0,velocity:!(!A||!A.velocity)&&A.velocity,lastY:m}),t.onClose&&t.onClose()):setTimeout(function(){s.default.close(n),t.onClose&&t.onClose()}),removeEvent(o,"touchstart",C,{passive:!0}),removeEvent(o,"touchmove",j,{capture:!0}),removeEvent(o,"touchcancel touchend",T,{passive:!0}),removeEvent(g,"click",w,{passive:!0}),removeEvent(g,"click",w,{passive:!0}),p=null,h=0,O=!1,m=0,E=0,i=null,g=null,o=null,A=null,v={},onBodyResize("__clear",I),a&&(a(),a=null))}}function C(e){if(e.touches&&e.touches.length>1)f=!1;else{var t=e.target.closest(".ScrollView")||Object(l.$)(".ScrollView",e.target);Object(l.$)(".ModalMenu").classList.contains("ModalMenu--blocked")||(p=e.touches[0],h=e.touches[0].clientY,t&&t.scrollTop>1?f=!1:(A=new c({time:e.timeStamp,x:e.touches[0].clientX,y:e.touches[0].clientY}),f=!0))}}var O=!1,E=0;function j(e){if(e.touches&&e.touches.length>1)f=!1;else if(p&&f){var t=e.touches[0];A.registerEvent(e);var n=-Math.min(0,h-t.clientY-E);0!==n&&(cancelEvent(e),m=n,O||(i.classList.add("ModalMenu--dragging"),O=!0),setStyle.transform(g,1,[0,n]))}}function T(e){if(f){f=!1,i.classList.remove("ModalMenu--dragging");var t=v.expandable&&k(i),n=i.classList.contains("ModalMenu--expanded"),a=!n,o=function(e){void 0===e&&(e=[]);return e.find(function(e){return 0!==e.scrollTop||e.scrollHeight>e.offsetHeight})}(e.path),r=!1;o&&(r=0!==o.scrollTop);var s=!1;A&&(s=!r&&A.velocity.y>=_);var l=m/innerHeight*100,c="";n?c="expand":a&&(c="collapse");var u=c;!t&&l>=b?u="close":l>=100-v.settling+b?u="close":n?l>=b&&!r&&(u="collapse"):a&&k(i)&&l<=100-v.settling&&(u="expand"),s&&(u="close"),function(e){if(!e)return;switch(i.classList.toggle("ModalMenu--expanded","expand"===e),e){case"collapse":i.classList.add("ModalMenu--restore");var t=0;k(i)&&(t=(100-v.settling)/100*window.innerHeight),E=t,setStyle.transform(g,1,[0,t]),E=t,setTimeout(function(){i&&i.classList.remove("ModalMenu--restore")},200);break;case"expand":i.classList.add("ModalMenu--restore"),i.classList.add("ModalMenu--expanded"),setStyle.transform(g,1,[0,0]),E=0,setTimeout(function(){i&&(I(),i.classList.remove("ModalMenu--restore"))},200);break;case"close":E=0,S(i,v)}}(u),A=null}}function I(){var e=Object(l.$)(".ModalMenuContent",i),t=Object(l.$)(".ModalMenuHeader",i);if(e&&t){var n=getH(t),a=getCh()-n+"px";getCw()>=d&&(a=null),setStyle(e,"height",a)}}addEvent(window,"keydown",function(e){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(l.$)(".ModalMenu.Popup_open");if(t)switch(e.keyCode){case 27:S(t,v)}}),n.d(t,"open",function(){return y}),n.d(t,"close",function(){return S}),n.d(t,"ModalMenuBtn",function(){return r.ModalMenuBtn});t.default=r.default;window.ModalMenu=r.default,extend(r.default,{open:y,close:S})},wcVR:function(e,t,n){"use strict";n.r(t);var i={_def_opts:{enableHighAccuracy:!0,maximumAge:3e5,timeout:6e4},_provider:null,initW3C:function(){i._provider=navigator.geolocation,i.getCurrentPosition=function(e,t,n){i._provider.getCurrentPosition(function(t){void 0!==t.latitude?e(extend(t,{coords:extend(t.coords||{},{latitude:t.latitude,longitude:t.longitude})})):e(t)},t,n)}},initGears:function(){var e=window.google;i._provider=e.gears.factory.create("beta.geolocation")},initSymbian:function(){var e=window.device;i._provider=e.getServiceObject("Service.Location","ILocation"),i.getCurrentPosition=function(e,t){i._provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},function(n,i,a){4==i?t({code:2,message:"Position unavailable"}):e({timestamp:null,coords:{latitude:a.ReturnValue.Latitude,longitude:a.ReturnValue.Longitude,altitude:a.ReturnValue.Altitude,heading:a.ReturnValue.Heading}})})}},initPalm:function(){i.getCurrentPosition=function(e,t,n){var i={};n&&(n.enableHighAccuracy&&1==n.enableHighAccuracy&&(i.accuracy=1),n.maximumAge&&(i.maximumAge=n.maximumAge),n.responseTime&&(n.responseTime<5?i.responseTime=1:n.responseTime<20?i.responseTime=2:i.timeout=3)),new window.Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:i,onSuccess:function(t){e({timestamp:t.timestamp,coords:{latitude:t.latitude,longitude:t.longitude,heading:t.heading}})},onFailure:function(e){1==e.errorCode?t({code:3,message:"Timeout"}):2==e.errorCode?t({code:2,message:"Position unavailable"}):t({code:0,message:"Unknown Error: webOS-code"+e.errorCode})}})}},getCurrentPosition:function(e,t,n){i._provider.getCurrentPosition(e,t,extend(i._def_opts,n||{}))},init:function(){var e=window,t=e.google,n=e.device,a=e.Mojo;try{var o="undefined";if(typeof navigator.geolocation!==o)i.initW3C();else if(typeof window.google!==o&&typeof t.gears!==o)i.initGears();else if(typeof n!==o&&typeof n.getServiceObject!==o)i.initSymbian();else{if(typeof a===o||"Mojo.Service.Request"==typeof a.Service.Request)return!1;i.initPalm()}}catch(e){return!1}return!0}};window.geo=i,t.default=i},wyHI:function(e,t){var n=window,i=n.gpeByClass,a=n.hasClass,o=n.addClass,r=n.removeClass,s=n.geByClass1,l=n.setStyle,c=n.tooltip,u=n.ajax;window.Fave={showActionsTT:function(e,t){cancelEvent(t);var n=i("FaveArticles__row",e);if(a(n,"wi_actions_opened"))Fave.hideActionsTT();else{var r=s("wi_actions_wrap",n),u=s("FaveArticles__row_actions",n);l(r,"top",e.offsetTop+e.offsetHeight+"px"),o(n,"wi_actions_opened"),c.addHandler(Fave.hideActionsTT),c.show(r,u)}},hideActionsTT:function(){r("wi_actions_opened",s("wi_actions_opened")),c.hide()},removeArticle:function(e,t,n){Fave.hideActionsTT();var a=i("FaveArticles__row",e);o(a,"removed"),u.post("fave.php",{act:"defave_article",link:t,hash:n},{onFail:function(){return r(a,"removed")}})},restoreArticle:function(e,t,n){var a=i("FaveArticles__row",e);r(a,"removed"),u.post("fave.php",{act:"enfave_article",link:t,hash:n},{onFail:function(){return o(a,"removed")}})}}},xk4V:function(e,t,n){var i=n("4fRq"),a=n("I2ZF");e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[o+s]=r[s];return t||a(r)}},yuVR:function(e,t){var n=1e4,i="friendsStat.events",a="/friends",o="stats",r=null;function s(){clearTimeout(r);var e=lsGet(i)||[];if(e.length){lsSet(i);var t,n={act:o};n=extend(n,(t={},each(e,function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]}),t)),ajax.post(a,n)}}window.FriendsStats={log:function(e,t){var a=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(e,t);if(!a)return;var o=lsGet(i)||[];o.push({type:e,data:a}),lsSet(i,o),clearTimeout(r),r=setTimeout(s,n)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},r=setTimeout(s,n)},z1UI:function(e,t,n){"use strict";n.r(t);var i=n("k+Df");t.default=i.default},z9Td:function(e,t,n){"use strict";n.r(t),n.d(t,"PLATFORM_MVK",function(){return i});var i="mvk"},z9sQ:function(e,t,n){"use strict";n.r(t);n("OcsD");var i={class:function(e,t,n){void 0===t&&(t={});void 0===n&&(n="_");var i=[e];return Object.keys(t).forEach(function(o){if(a(o)){var r=t[o];!0===r?i.push(""+e+n+o):a(r)&&i.push(""+e+n+o+n+r)}}),i.join(" ")},setMod:function(e,t,n){var i,o=new RegExp("\\s*"+t+"(_[-a-zA-Z]+)?");i=!0===n?" "+t:a(n)?" "+t+"_"+n:"";o.test(e.className)?e.className=e.className.replace(o,i):e.className+=i}};function a(e){return"number"==typeof e||"string"==typeof e&&e}t.default=i;window.Bem=i},zHNa:function(e,t){var n=need("Control"),i=need("Popup"),a={init:function(){var e=geByClass1("_adultConfirm"),t=geByClass1("_adultConfirm__submit",e),i=geByClass1("adultConfirm__checkbox",e);toggleClass("adultConfirm__submit_disabled",t,!n.isChecked(i))},toggle:function(e){var t=gpeByClass("_adultConfirm",e.$control),n=geByClass1("_adultConfirm__submit",t);toggleClass("adultConfirm__submit_disabled",n,!e.checked)},submit:function(e,t){if(cancelEvent(e),!hasClass("adultConfirm__submit_disabled",t)){var n=gpeByClass("_adultConfirm",t),a=geByClass1("_adultConfirm__form",n),o={_ajax:1};each(geByTag("input",a),function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(o[i]=t.value)});var r=attr(a,"action");ajax.post(r,o),i.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}};window.AdultConfirm=a},zRDV:function(e,t){var n="";window.DonutDuration={init:function(e){n=e.select_url||""},selectDuration:function(e){var t=document.querySelector("#value_link");if(t){var i=n.replace("{value}",e);t.setAttribute("href",i)}}}},zouF:function(e,t,n){"use strict";n.r(t),n.d(t,"Confirm",function(){return s});var i=n("OcsD"),a=n("TYsd"),o=n("Po+v"),r=n("z9sQ");function s(e,t,n,r){void 0===r&&(r={});var s=Object(i.ceFromString)(a.default.html(Object(o.default)({id:r.id,class:"Confirm",scrollable:!0,header:{title:r.title||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[l(getLang("mobile_continue"),"regular",t),l(getLang("mobile_cancel"),"secondary",n||"Popup.close(this)")]}]})));o.default.open(s,!0)}function l(e,t,n){return{class:["Popup__button",r.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}page.onChange(function(){$$(".Confirm").forEach(function(e){return o.default.close(e)})}),window.Confirm=s}},[[6,"runtime","vendors","b-90e3308f10e8b0130de467d08f44484f","b-7838b057c2226da38efb8152f7a6b628"]]]);